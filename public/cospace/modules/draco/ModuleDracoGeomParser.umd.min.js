(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t():"function"===typeof define&&define.amd?define([],t):"object"===typeof exports?exports["ModuleDracoGeomParser"]=t():e["ModuleDracoGeomParser"]=t()})("undefined"!==typeof self?self:this,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s="fae3")}({"1eb2":function(e,t,r){"use strict";if("undefined"!==typeof window){var n=window.document.currentScript,i=r("8875");n=i(),"currentScript"in document||Object.defineProperty(document,"currentScript",{get:i});var a=n&&n.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);a&&(r.p=a[1])}},"2e55":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n{}n.PARSE="DRACO_PARSE",n.THREAD_ACQUIRE_DATA="DRACO_THREAD_ACQUIRE_DATA",n.THREAD_TRANSMIT_DATA="DRACO_THREAD_TRANSMIT_DATA",t.DracoTaskCMD=n},"56b4":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r("2e55");let i=n.DracoTaskCMD;const a=1;class s{constructor(){this.parser=null,this.attMap=null,this.attOpts=null,this.verbosity=1,this.drawMode=0,this.vsScale=1,this.attNSMap={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD",generic:"GENERIC"}}getAttributeOptions(e){return"undefined"===typeof this.attOpts[e]&&(this.attOpts[e]={}),this.attOpts[e]}addAttributeToGeometry(e,t,r,n,i,a){if(0===i.ptr){let e="DracoGeomParser: No attribute "+n;throw new Error(e)}let s=i.num_components(),o=new e.DracoFloat32Array;t.GetAttributeFloatForAllPoints(r,i,o);let d=r.num_points(),u=d*s,c=new Float32Array(u+1);c[0]=s;for(let l=0;l<u;l++)c[l+1]=o.GetValue(l);a[n]=c,e.destroy(o)}decodeGeomData(e,t,r,n){let i,s,o;if(!0===this.getAttributeOptions("position").skipDequantization&&t.SkipAttributeTransform(e.POSITION),r===e.TRIANGULAR_MESH?(i=new e.Mesh,s=t.DecodeBufferToMesh(n,i)):(i=new e.PointCloud,s=t.DecodeBufferToPointCloud(n,i)),!s.ok()||0==i.ptr){let r="DracoGeomParser: Decoding failed: ";throw r+=s.error_msg(),e.destroy(t),e.destroy(i),new Error(r)}e.destroy(n),o=r==e.TRIANGULAR_MESH?i.num_faces():0;let d=t.GetAttributeId(i,e.POSITION);if(-1==d){let r="DracoGeomParser: No position attribute found.";throw e.destroy(t),e.destroy(i),new Error(r)}let u={};for(let a in this.attNSMap)if(void 0===this.attMap[a]){let r=t.GetAttributeId(i,e[this.attNSMap[a]]);if(-1!==r){this.verbosity;let n=t.GetAttribute(i,r);this.addAttributeToGeometry(e,t,i,a,n,u)}}for(let a in this.attMap){let r=this.attMap[a],n=t.GetAttributeByUniqueId(i,r);this.addAttributeToGeometry(e,t,i,a,n,u)}if(r==e.TRIANGULAR_MESH)if(this.drawMode===a){let t=new e.DracoInt32Array;u.indices=new Uint32Array(t.size());for(let e=0;e<t.size();++e)u.indices[e]=t.GetValue(e);e.destroy(t)}else{let r=3*o;u.indices=new Uint32Array(r);let n=new e.DracoInt32Array;for(let e=0;e<o;++e){t.GetFaceFromMesh(i,e,n);let r=3*e;u.indices[r]=n.GetValue(0),u.indices[r+1]=n.GetValue(1),u.indices[r+2]=n.GetValue(2)}e.destroy(n)}return r!=e.TRIANGULAR_MESH&&(u.indices=null),e.destroy(t),e.destroy(i),u}parseData(e,t,r,n){let i=this.parser,a=new i.DecoderBuffer,s=r-t;n<1?a.Init(new Int8Array(e.buffer).subarray(0,s),s):a.Init(new Int8Array(e.buffer).subarray(t,r),s);let o=new i.Decoder,d=o.GetEncodedGeometryType(a);if(d==i.TRIANGULAR_MESH)this.verbosity;else{if(d!=i.POINT_CLOUD){let e="DracoGeomParser: Unknown geometry type.";throw new Error(e)}this.verbosity}return this.decodeGeomData(i,o,d,a)}transformVS(e,t,r,n){let i=0,a=0,s=0,o=0,d=e*t[12],u=e*t[13],c=e*t[14];while(i+3<=n)a=r[i],s=r[i+1],o=r[i+2],r[i]=a*t[0]+s*t[4]+o*t[8]+d,r[i+1]=a*t[1]+s*t[5]+o*t[9]+u,r[i+2]=a*t[2]+s*t[6]+o*t[10]+c,i+=3}getParseData(e,t){let r=null;if(null!=e){r=[];let t=null;for(let n in e)null!=e[n]&&r.push(e[n].buffer);if(null!=t){let r,n,i,a=t[0],s=t[1],o=t[2],d=t[3],u=s,c=o,l=d;for(let e=1,f=t.length;e<f;e+=a)r=t[e],n=t[e+1],i=t[e+2],r<s?s=r:r>u&&(u=r),n<o?o=n:n>c&&(c=n),i<d?d=i:i>l&&(l=i);e.min={x:s,y:o,z:d},e.max={x:u,y:c,z:l}}}let n={vertices:e.position,uvsList:null,normals:null,indices:null};return void 0!=e.indices&&(n.indices=e.indices),void 0!=e.normal&&(n.normals=e.normal),void 0!=e.uv&&(n.uvsList=[e.uv]),{data:n,transfers:r,errorFlag:t}}receiveCall(e){let t=e.streams;this.drawMode=0,this.vsScale=1,this.attMap={},this.attOpts={position:{}};let r=0,n=null;if(null!=t){let a=e.descriptor;if(a.endI>a.beginI){let e=t[0];try{n=this.parseData(e,a.beginI,a.endI,a.status)}catch(i){r=-1,n=null}}}else r=-2;return this.getParseData(n,r)}}class o{constructor(){this.m_dataIndex=0,this.m_srcuid=0,this.m_dependencyFinish=!1,this.m_wasmData=null,this.threadIndex=0,this.parser=null,this.decoder={wasmBinary:null},this.dracoParser=new s,ThreadCore.acquireData(this,{},i.THREAD_ACQUIRE_DATA),ThreadCore.useDependency(this)}postDataMessage(e,t){let r={cmd:e.cmd,taskCmd:e.taskCmd,threadIndex:this.threadIndex,taskclass:this.getTaskClass(),srcuid:this.m_srcuid,dataIndex:this.m_dataIndex,streams:e.streams,data:e.data};ThreadCore.postMessageToThread(r,t)}initDecoder(e){let t=e.streams[0];this.decoder["wasmBinary"]=t,this.decoder["onModuleLoaded"]=r=>{this.parser=r,this.dracoParser.parser=r,ThreadCore.transmitData(this,e,i.THREAD_TRANSMIT_DATA,[t]),ThreadCore.initializeExternModule(this)},DracoDecoderModule(this.decoder)}receiveData(e){switch(this.m_srcuid=e.srcuid,this.m_dataIndex=e.dataIndex,e.taskCmd){case i.PARSE:let t=this.dracoParser.receiveCall(e);e.data={model:t.data,errorFlag:t.errorFlag},this.postDataMessage(e,t.transfers);break;case i.THREAD_ACQUIRE_DATA:this.threadIndex=e.threadIndex,this.m_wasmData=e.data,this.m_dependencyFinish&&null!=this.m_wasmData&&this.initDecoder(this.m_wasmData);break;default:break}}getTaskClass(){return 102}getUniqueName(){return"dracoGeomParser"}dependencyFinish(){this.m_dependencyFinish=!0,this.m_dependencyFinish&&null!=this.m_wasmData&&this.initDecoder(this.m_wasmData)}}t.DracoGeomParseTask=o;new o},8875:function(e,t,r){var n,i,a;(function(r,s){i=[],n=s,a="function"===typeof n?n.apply(t,i):n,void 0===a||(e.exports=a)})("undefined"!==typeof self&&self,(function(){function e(){var t=Object.getOwnPropertyDescriptor(document,"currentScript");if(!t&&"currentScript"in document&&document.currentScript)return document.currentScript;if(t&&t.get!==e&&document.currentScript)return document.currentScript;try{throw new Error}catch(h){var r,n,i,a=/.*at [^(]*\((.*):(.+):(.+)\)$/gi,s=/@([^@]*):(\d+):(\d+)\s*$/gi,o=a.exec(h.stack)||s.exec(h.stack),d=o&&o[1]||!1,u=o&&o[2]||!1,c=document.location.href.replace(document.location.hash,""),l=document.getElementsByTagName("script");d===c&&(r=document.documentElement.outerHTML,n=new RegExp("(?:[^\\n]+?\\n){0,"+(u-2)+"}[^<]*<script>([\\d\\D]*?)<\\/script>[\\d\\D]*","i"),i=r.replace(n,"$1").trim());for(var f=0;f<l.length;f++){if("interactive"===l[f].readyState)return l[f];if(l[f].src===d)return l[f];if(d===c&&l[f].innerHTML&&l[f].innerHTML.trim()===i)return l[f]}return null}}return e}))},fae3:function(e,t,r){"use strict";r.r(t);r("1eb2");var n=r("56b4");for(var i in n)["default"].indexOf(i)<0&&function(e){r.d(t,e,(function(){return n[e]}))}(i)}})}));