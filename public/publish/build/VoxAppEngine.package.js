(function(t,e){"object"===typeof exports&&"object"===typeof module?module.exports=e():"function"===typeof define&&define.amd?define([],e):"object"===typeof exports?exports["VoxAppEngine"]=e():t["VoxAppEngine"]=e()})("undefined"!==typeof self?self:this,(function(){return function(t){var e={};function s(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}return s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)s.d(i,r,function(e){return t[e]}.bind(null,r));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s="fb15")}({"0236":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("a996")),a=i(s("1710")),h=i(s("7045")),n=i(s("badb"));class l{constructor(t,e){this.A=0,this.pixelRatio=1,this.stageWidth=800,this.stageHeight=600,this.stageHalfWidth=400,this.stageHalfHeight=300,this.mouseX=0,this.mouseY=0,this.viewWidth=800,this.viewHeight=600,this.mouseViewX=0,this.mouseViewY=0,this.B=0,this.C=0,this.D=1,this.E=1,this.F=new n.default,this.G=[],this.H=[],this.I=[],this.J=[],this.K=[],this.L=[],this.M=[],this.N=[],this.O=0,this.P=0,this.Q=new a.default,this.R=!0,this.uProbe=null,this.S=new r.default,this.A=t}getRCUid(){return this.A}getDevicePixelRatio(){return window.devicePixelRatio}getViewX(){return this.B}getViewY(){return this.C}getViewWidth(){return this.D}getViewHeight(){return this.E}setViewPort(t,e,s,i){this.R=!1,this.B=t,this.C=e,s==this.D&&i==this.E||(this.D=s,this.E=i,this.updateViewUData())}updateViewUData(){this.uProbe.setVec4Data(2/(this.D*this.pixelRatio),2/(this.E*this.pixelRatio),this.D*this.pixelRatio,this.E*this.pixelRatio),this.uProbe.update(),this.O=this.D,this.P=this.E}update(){this.O==this.stageWidth&&this.P==this.stageHeight||(this.R&&(this.D=this.stageWidth,this.E=this.stageHeight,this.updateViewUData()),this.stageHalfWidth=.5*this.stageWidth,this.stageHalfHeight=.5*this.stageHeight)}mouseDown(t=1){this.Q.type=a.default.MOUSE_DOWN,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=t,this.F.dispatchEvt(this.Q)}mouseUp(t=1){this.Q.phase=1,this.Q.type=a.default.MOUSE_UP,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=t,this.F.dispatchEvt(this.Q)}mouseClick(){this.Q.type=a.default.MOUSE_CLICK,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseDoubleClick(){this.Q.type=a.default.MOUSE_DOUBLE_CLICK,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseRightDown(t=1){this.Q.type=a.default.MOUSE_RIGHT_DOWN,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseRightUp(t=1){this.Q.type=a.default.MOUSE_RIGHT_UP,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseBgDown(){this.Q.type=a.default.MOUSE_BG_DOWN,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseBgUp(){this.Q.type=a.default.MOUSE_BG_UP,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseBgClick(){this.Q.type=a.default.MOUSE_BG_CLICK,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseRightClick(){this.Q.type=a.default.MOUSE_RIGHT_CLICK,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseMove(){this.Q.type=a.default.MOUSE_MOVE,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseWheel(t){this.Q.type=a.default.MOUSE_WHEEL,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.wheelDeltaY=t.wheelDeltaY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseCancel(){this.Q.type=a.default.MOUSE_CANCEL,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseMultiDown(t){this.Q.type=a.default.MOUSE_MULTI_DOWN,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.Q.posArray=t,this.F.dispatchEvt(this.Q)}mouseMultiUp(t){this.Q.type=a.default.MOUSE_MULTI_UP,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.Q.posArray=t,this.F.dispatchEvt(this.Q)}mouseMultiMove(t){this.Q.type=a.default.MOUSE_MULTI_MOVE,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.Q.posArray=t,this.F.dispatchEvt(this.Q)}mouseWindowUp(t=1){}mouseWindowRightUp(t=1){}enterFrame(){this.S.type=r.default.ENTER_FRAME;let t=this.I.length;for(var e=0;e<t;++e)this.I[e].call(this.J[e],this.S)}addEventListener(t,e,s,i=!0,a=!0){if(null!=s&&null!=e){let n=0;switch(t){case r.default.RESIZE:break;case r.default.ENTER_FRAME:for(n=this.I.length-1;n>=0;--n)if(e===this.J[n])break;n<0&&(this.J.push(e),this.I.push(s));break;case h.default.KEY_DOWN:break;case h.default.KEY_UP:break;default:this.F.addEventListener(t,e,s,i,a);break}}}removeEventListener(t,e,s){if(null!=s&&null!=e){let i=0;switch(t){case r.default.RESIZE:for(i=this.G.length-1;i>=0;--i)if(e===this.H[i]){this.H.splice(i,1),this.G.splice(i,1);break}break;case r.default.ENTER_FRAME:for(i=this.I.length-1;i>=0;--i)if(e===this.J[i]){this.J.splice(i,1),this.I.splice(i,1);break}break;case h.default.KEY_DOWN:for(i=this.K.length-1;i>=0;--i)if(e===this.L[i]){this.L.splice(i,1),this.K.splice(i,1);break}break;case h.default.KEY_UP:for(i=this.M.length-1;i>=0;--i)if(e===this.N[i]){this.N.splice(i,1),this.M.splice(i,1);break}break;default:this.F.removeEventListener(t,e,s);break}}}}e.default=l},"030e":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static Initialize(t,e){let s=this;1==t?(s.OES_standard_derivatives=e.getExtension("OES_standard_derivatives"),s.OES_standard_derivatives,s.EXT_shader_texture_lod=e.getExtension("EXT_shader_texture_lod"),s.EXT_shader_texture_lod,s.WEBGL_draw_buffers=e.getExtension("WEBGL_draw_buffers"),s.WEBGL_draw_buffers,s.OES_vertex_array_object=e.getExtension("OES_vertex_array_object"),s.OES_vertex_array_object,s.ANGLE_instanced_arrays=e.getExtension("ANGLE_instanced_arrays"),s.ANGLE_instanced_arrays,s.EXT_color_buffer_float=e.getExtension("EXT_color_buffer_float"),s.EXT_color_buffer_float,s.EXT_color_buffer_half_float=e.getExtension("EXT_color_buffer_half_float"),s.EXT_color_buffer_half_float,s.OES_texture_half_float=e.getExtension("OES_texture_half_float"),s.OES_texture_half_float,s.OES_texture_half_float_linear=e.getExtension("OES_texture_half_float_linear"),s.OES_texture_half_float_linear,s.OES_texture_float=e.getExtension("OES_texture_float"),s.OES_texture_float,s.OES_element_index_uint=e.getExtension("OES_element_index_uint"),s.OES_element_index_uint,s.EXT_blend_minmax=e.getExtension("EXT_blend_minmax"),s.EXT_blend_minmax):(s.EXT_shader_texture_lod=e.getExtension("EXT_shader_texture_lod"),s.EXT_shader_texture_lod,s.EXT_color_buffer_half_float=e.getExtension("EXT_color_buffer_half_float"),s.EXT_color_buffer_half_float,s.OES_texture_half_float_linear=e.getExtension("OES_texture_half_float_linear"),s.OES_texture_half_float_linear,s.EXT_color_buffer_float=e.getExtension("EXT_color_buffer_float"),s.EXT_color_buffer_float),s.OES_texture_float_linear=e.getExtension("OES_texture_float_linear"),s.OES_texture_float_linear,s.WEBGL_depth_texture=e.getExtension("WEBGL_depth_texture"),s.WEBGL_depth_texture,s.WEBGL_debug_renderer_info=e.getExtension("WEBGL_debug_renderer_info"),s.WEBGL_debug_renderer_info}}i.OES_standard_derivatives=null,i.EXT_shader_texture_lod=null,i.WEBGL_draw_buffers=null,i.OES_vertex_array_object=null,i.ANGLE_instanced_arrays=null,i.EXT_color_buffer_float=null,i.EXT_color_buffer_half_float=null,i.OES_texture_float_linear=null,i.OES_texture_half_float_linear=null,i.OES_texture_half_float=null,i.OES_texture_float=null,i.OES_element_index_uint=null,i.EXT_blend_minmax=null,i.WEBGL_depth_texture=null,i.WEBGL_debug_renderer_info=null,e.default=i},"070b":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t,e,s,r){this.T=-1,this.U=!0,this.V=!0,this.W=!0,this.X=!0,this.T=i.EM++,this.U=t,this.V=e,this.W=s,this.X=r}getUid(){return this.T}getR(){return this.U}getG(){return this.V}getB(){return this.W}getA(){return this.X}use(){i.EH!=this.T&&(i.Rstate.setColorMask(this.U,this.V,this.W,this.X),i.EH=this.T)}static Create(t,e,s,r,a){if(i.EI.has(t)){let e=i.EI.get(t);return e.getUid()}let h=(e?64:32)|(s?16:8)|(r?4:2)|(a?1:0);if(i.EJ.has(h)){let t=i.EJ.get(h);h=t.getUid()}else{let n=new i(e,s,r,a);h=n.getUid(),i.EJ.set(h,n),i.EI.set(t,n),i.EK.push(n),++i.EN}return h}static GetColorMaskByName(t){if(i.EI.has(t)){let e=i.EI.get(t);return e.getUid()}return-1}static UseRenderState(t){i.EL&&i.Rstate.roColorMask!=t&&t>-1&&t<i.EN&&i.EK[t].use()}static UseColorMaskByName(t){let e=i.GetColorMaskByName(t);i.EL&&i.Rstate.roColorMask!=e&&e>-1&&e<i.EN&&i.EK[e].use()}static Lock(){i.EL=!1}static Unlock(){i.EL=!0}static Reset(){i.EH=-1}}i.EM=0,i.EH=-1,i.EK=[],i.EN=1,i.EJ=new Map,i.EI=new Map,i.EL=!0,i.ALL_TRUE_COLOR_MASK=0,i.ALL_FALSE_COLOR_MASK=1,i.Rstate=null,e.RenderColorMask=i},"0851":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("7918"),a=s("8d98"),h=i(s("6e01")),n=i(s("da6a"));class l{constructor(t,e,s=!1){this.T=-1,this.Y=0,this.Z=null,this.a=null,this.b=-1,this.c=128,this.d=128,this.e=128,this.f=128,this.g=a.TextureTarget.TEXTURE_2D,this.h=-1,this.i=!1,this.j=r.TextureProxyType.Default,this.k=!0,this.name="TextureProxy",this.internalFormat=a.TextureFormat.RGBA,this.srcFormat=a.TextureFormat.RGBA,this.dataType=a.TextureDataType.UNSIGNED_BYTE,this.wrap_s=a.TextureConst.WRAP_CLAMP_TO_EDGE,this.wrap_t=a.TextureConst.WRAP_CLAMP_TO_EDGE,this.wrap_r=a.TextureConst.WRAP_CLAMP_TO_EDGE,this.mipmapEnabled=!1,this.flipY=!1,this.premultiplyAlpha=!1,this.unpackAlignment=4,this.minFilter=a.TextureConst.LINEAR_MIPMAP_LINEAR,this.magFilter=a.TextureConst.LINEAR,this.version=0,this.a=n.default.GetInstance(),this.T=this.a.getFreeUid(),t<1&&(t=128),e<1&&(e=128),s?(this.c=h.default.CalcNearestCeilPow2(t),this.d=h.default.CalcNearestCeilPow2(e)):(this.c=t,this.d=e),this.a.__$$addTexture(this)}__$$use(t){t.bindToGpu(this.getResUid())}__$setRenderProxy(t){null!=this.a||(this.a=n.default.GetInstance(),this.T=this.a.getFreeUid(),this.a.__$$addTexture(this)),this.Z=t}__$attachThis(){-1==this.Y&&(this.a.removeFreeUid(this.getUid()),this.Y=0),++this.Y}__$detachThis(){this.Y>0&&(--this.Y,this.Y<1&&(this.Y=-1,this.a.addFreeUid(this.getUid())))}getAttachCount(){return this.Y}isDirect(){return!0}getType(){return this.j}getResUid(){return this.T}getUid(){return this.T}setWrap(t){this.wrap_s=this.wrap_t=this.wrap_r=t}isGpuEnabled(){return null!=this.Z&&this.Z.Texture.hasResUid(this.getResUid())}getSampler(){return this.h}getTargetType(){return this.g}getBufWidth(){return this.e}getBufHeight(){return this.f}getWidth(){return this.c}getHeight(){return this.d}isDataEnough(){return this.i}uploadFromFbo(t,e,s){throw Error("Illegal operation !!!")}__$buildParam(t){this.e=this.c,this.f=this.d,t.texParameteri(this.h,t.TEXTURE_WRAP_S,a.TextureConst.GetConst(t,this.wrap_s)),t.texParameteri(this.h,t.TEXTURE_WRAP_T,a.TextureConst.GetConst(t,this.wrap_t)),t.texParameteri(this.h,t.TEXTURE_MIN_FILTER,a.TextureConst.GetConst(t,this.minFilter)),t.texParameteri(this.h,t.TEXTURE_MAG_FILTER,a.TextureConst.GetConst(t,this.magFilter)),this.g==a.TextureTarget.TEXTURE_3D&&(t.texParameteri(this.h,t.TEXTURE_WRAP_R,a.TextureConst.GetConst(t,this.wrap_r)),t.texParameteri(t.TEXTURE_3D,t.TEXTURE_BASE_LEVEL,0),t.texParameteri(t.TEXTURE_3D,t.TEXTURE_MAX_LEVEL,Math.log2(this.c))),this.mipmapEnabled&&this.k&&t.generateMipmap(this.h)}enableMipmap(){}disableMipmap(){}generateMipmap(t){if(this.mipmapEnabled&&this.k){let e=t.getRC();t.bindToGpu(this.getResUid()),this.__$buildParam(e)}}uploadData(t){}__$updateToGpu(t){}updateDataToGpu(t=null,e=!0){null!=t&&(this.Z=t),null!=this.Z&&this.Z.MaterialUpdater.updateTextureData(this,e)}createTexBuf(t){return!t.hasResUid(this.getResUid())&&(this.h=a.TextureTarget.GetValue(t.getRC(),this.g),t.createResByParams3(this.getResUid(),this.getWidth(),this.getHeight(),this.h),!0)}__$$upload(t){if(this.i&&null!=this.a){let e=this.createTexBuf(t);e&&(this.__$updateToGpuBegin(t),this.uploadData(t),this.__$buildParam(t.getRC()),this.k=!0)}}dataUploadToGpu(t,e,s,i=!1){this.version=0;let r=a.TextureFormat.ToGL(t,this.internalFormat),h=a.TextureFormat.ToGL(t,this.srcFormat),n=a.TextureDataType.ToGL(t,this.dataType),l=e;if(null==s)(l.status>-1||i)&&l.updateToGpu(t,this.h,r,h,n,i);else{let e=s;for(let s=0,a=e.length;s<a;++s)l=e[s],null!=l&&(l.status>-1||i)&&l.updateToGpu(t,this.h,r,h,n,i);this.k=!1}}__$updateToGpuBegin(t){let e=t.getRC();t.bindToGpu(this.getResUid()),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,this.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,this.unpackAlignment)}__$updateToGpuEnd(t){}isDestroyed(){return this.Y<-1}__$destroy(){this.getAttachCount()<1&&(this.Y=-2,this.i=!1,this.c=1,this.d=1,this.Z=null)}__$$removeFromSlot(){null!=this.a&&-2==this.getAttachCount()&&(this.a=null,this.Z=null,this.T=-1)}toString(){return"[TextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.TextureProxy=l,e.default=l},"090c":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("030e")),a=i(s("3b73")),h=i(s("b0ef")),n=i(s("0c85")),l=s("e08e"),_=i(s("e2fe"));class o{constructor(){this.l=new n.default,this.m=null,this.n=null,this.o=!1,this.p=!0,this.q=!0,this.r=null,this.s=null,this.t=null,this.u=new _.default(0,0,800,600),this.v=2,this.w=2,this.x=1,this.y=new h.default,this.autoSyncRenderBufferAndWindowSize=!0,this.offscreenRenderEnabled=!1,this.z=null,this.A_=0,this.B_=0,this.C_=0,this.D_=0,this.E_=null,this.F_=null}contextrestoredHandler(t){}contextlostHandler(t){}setWebGLMaxVersion(t){1!=t&&2!=t||(this.v=t)}getWebGLVersion(){return this.w}getDiv(){return this.m}setDivStyleLeftAndTop(t,e){this.y.setDivStyleLeftAndTop(t,e)}setDivStyleSize(t,e){this.y.setDivStyleSize(t,e)}getCanvas(){return this.n}isDepthTestEnabled(){return this.p}isStencilTestEnabled(){return this.q}initialize(t,e,s,i=null){this.t=e;var h=null,n=null;try{void 0!=document&&(h=document,n=window)}catch(o){}if(null!=h){this.y.setDiv(s),this.y.createViewEle(h,this.autoSyncRenderBufferAndWindowSize),this.m=s=this.y.getDiv();let o=this.n=this.y.getCanvas();this.x=window.devicePixelRatio,this.l.dpr=this.x;let m=i;null==i?m={depth:this.p,premultipliedAlpha:!1,alpha:!0,antialias:!1,stencil:this.q,preserveDrawingBuffer:!0,powerPreference:"default"}:(this.p=m.depth,this.q=m.stencil);let u=null;if(this.offscreenRenderEnabled&&(u=o.transferControlToOffscreen()),this.r=u,2==this.v&&(this.s=null==u?o.getContext("webgl2",m):u.getContext("webgl2",m),null!=this.s&&(this.w=2)),null==this.s&&(this.s=null==u?o.getContext("webgl",m)||o.getContext("experimental-webgl",m):u.getContext("webgl",m)||u.getContext("experimental-webgl",m),null!=this.s&&(this.w=1)),!this.s)throw this.w=-1,alert("Unable to initialize WebGL. Your browser or machine may not support it."),Error("WebGL initialization failure.");let d=this.s;d.rcuid=t;let c=l.GLStencilFunc;c.NEVER=d.NEVER,c.LESS=d.LESS,c.EQUAL=d.EQUAL,c.GREATER=d.GREATER,c.NOTEQUAL=d.NOTEQUAL,c.GEQUAL=d.GEQUAL,c.ALWAYS=d.ALWAYS;let f=l.GLStencilOp;f.KEEP=d.KEEP,f.ZERO=d.ZERO,f.REPLACE=d.REPLACE,f.INCR=d.INCR,f.INCR_WRAP=d.INCR_WRAP,f.DECR=d.DECR,f.DECR_WRAP=d.DECR_WRAP,f.INVERT=d.INVERT;let p=l.GLBlendMode;p.ZERO=d.ZERO,p.ONE=d.ONE,p.SRC_COLOR=d.SRC_COLOR,p.DST_COLOR=d.DST_COLOR,p.SRC_ALPHA=d.SRC_ALPHA,p.DST_ALPHA=d.DST_ALPHA,p.ONE_MINUS_SRC_ALPHA=d.ONE_MINUS_SRC_ALPHA;let g=l.GLBlendEquation;g.FUNC_ADD=d.FUNC_ADD,g.FUNC_SUBTRACT=d.FUNC_SUBTRACT,g.FUNC_REVERSE_SUBTRACT=d.FUNC_REVERSE_SUBTRACT,g.MIN_EXT=d.MIN_EXT,g.MAX_EXT=d.MAX_EXT,g.MIN=d.MIN,g.MAX=d.MAX;let T=l.CullFaceMode;T.BACK=d.BACK,T.FRONT=d.FRONT,T.FRONT_AND_BACK=d.FRONT_AND_BACK;let E=a.default;E.MAX_TEXTURE_SIZE=this.s.getParameter(this.s.MAX_TEXTURE_SIZE),E.MAX_RENDERBUFFER_SIZE=this.s.getParameter(this.s.MAX_RENDERBUFFER_SIZE);let x=this.s.getParameter(this.s.MAX_VIEWPORT_DIMS);E.MAX_VIEWPORT_WIDTH=x[0],E.MAX_VIEWPORT_HEIGHT=x[1],r.default.Initialize(this.w,this.s),a.default.Initialize([this.w]),null!=e&&this.l.initialize(o,s,e);let S=r.default.WEBGL_debug_renderer_info;if(null!=S){let t=this.s.getParameter(S.UNMASKED_VENDOR_WEBGL),e=this.s.getParameter(S.UNMASKED_RENDERER_WEBGL);E.GPU_VENDOR=t,E.GPU_RENDERER=e,a.default.IsWinExternalVideoCard()}var _=this;n.onresize=function(t){_.autoSyncRenderBufferAndWindowSize&&_.updateRenderBufferSize()},o.addEventListener("webglcontextrestored",this.contextrestoredHandler,!1),o.addEventListener("webglcontextlost",this.contextlostHandler,!1),this.updateRenderBufferSize()}}loseContext(){null==this.z&&(this.z=this.s.getExtension("WEBGL_lose_context")),null==this.z&&this.z.loseContext()}isContextLost(){return this.s.isContextLost()}getRC(){return this.s}setScissorEnabled(t){t?this.o||(this.o=!0,this.s.enable(this.s.SCISSOR_TEST)):this.o&&(this.o=!1,this.s.disable(this.s.SCISSOR_TEST))}setScissorRect(t,e,s,i){this.s.scissor(t,e,s,i)}setResizeCallback(t,e){this.F_=t,this.E_=e}getDevicePixelRatio(){return this.x}resizeBufferSize(t,e){t=Math.floor(t),e=Math.floor(e);let s=window.devicePixelRatio,i=Math.abs(s-this.x)>.02;this.x=s,this.l.dpr=s,a.default.SetDevicePixelRatio(this.x),(this.A_!=t||this.B_!=e||i)&&(this.A_=t,this.B_=e,this.C_=Math.floor(t*s),this.D_=Math.floor(e*s),null==this.r?(this.n.width=this.C_,this.n.height=this.D_):(this.r.width=this.C_,this.r.height=this.D_),this.n.style.width=this.A_+"px",this.n.style.height=this.B_+"px",null!=this.t&&(this.t.stageWidth=this.C_,this.t.stageHeight=this.D_,this.t.viewWidth=this.A_,this.t.viewHeight=this.B_,this.t.pixelRatio=s,this.t.update()),null!=this.E_&&this.E_.call(this.F_))}getStage(){return this.t}getStageWidth(){return this.t.stageWidth}getStageHeight(){return this.t.stageHeight}getDisplayWidth(){return this.A_}getDisplayHeight(){return this.B_}setViewport(t,e,s,i){this.u.setTo(t,e,s,i)}setViewportSize(t,e){this.u.setSize(t,e)}testViewPortChanged(t,e,s,i){return this.u.testEqualWithParams(t,e,s,i)}getViewportX(){return this.u.x}getViewportY(){return this.u.y}getViewportWidth(){return this.u.width}getViewportHeight(){return this.u.height}getViewPortSize(){return this.u}getFBOWidth(){return this.u.width<a.default.MAX_RENDERBUFFER_SIZE?this.u.width:a.default.MAX_RENDERBUFFER_SIZE}getFBOHeight(){return this.u.height<a.default.MAX_RENDERBUFFER_SIZE?this.u.height:a.default.MAX_RENDERBUFFER_SIZE}getRCanvasWidth(){return this.C_}getRCanvasHeight(){return this.D_}updateRenderBufferSize(){let t=this.m.getBoundingClientRect();this.resizeBufferSize(t.width,t.height)}}e.default=o},"0c85":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73"));class a{constructor(){this.G_=!1,this.H_=0,this.I_=0,this.J_=0,this.dpr=1}initMobile(t,e,s){var i=null;try{void 0!=document&&(i=document)}catch(a){}if(null!=i){let t=this;if(e.addEventListener("touchstart",t=>{let e=t.targetTouches,i=0,r=0;if(e.length<2)i=0|this.dpr*t.targetTouches[0].pageX,r=0|this.dpr*t.targetTouches[0].pageY,s.mouseX=i,s.mouseY=s.stageHeight-r,s.mouseViewX=i,s.mouseViewY=r,this.G_=!0,this.H_=s.mouseX,this.I_=s.mouseY,this.J_=Date.now(),s.mouseDown(1);else{let a=[];for(let s=0;s<e.length;++s)i=0|this.dpr*t.targetTouches[s].pageX,r=0|this.dpr*t.targetTouches[s].pageY,a.push({x:i,y:r});s.mouseMultiDown(a),this.G_=!1}t.preventDefault(),t.stopPropagation()},!1),e.addEventListener("touchend",t=>{this.G_=!1;let e=t.targetTouches,i=0,r=0;if(e.length<1)s.mouseUp(1),this.J_=Date.now()-this.J_,Math.abs(this.H_-s.mouseX)<3&&Math.abs(this.I_-s.mouseY)<3&&this.J_<900&&(this.H_=s.mouseX,this.I_=s.mouseY,s.mouseClick());else{let a=[];for(let s=0;s<e.length;++s)i=0|this.dpr*t.targetTouches[s].pageX,r=0|this.dpr*t.targetTouches[s].pageY,a.push({x:i,y:r});s.mouseMultiUp(a)}t.preventDefault()},!1),e.addEventListener("touchcancel",e=>{t.G_=!1;e.targetTouches;s.mouseCancel(),e.preventDefault()},!1),e.addEventListener("touchmove",t=>{t.preventDefault();let e=t.targetTouches,i=0,r=0;if(this.G_&&(i=0|this.dpr*e[0].pageX,r=0|this.dpr*e[0].pageY,s.mouseViewX=i,s.mouseViewY=r,s.mouseX=i,s.mouseY=s.stageHeight-r,s.mouseMove()),e.length>1){let a=[];for(let s=0;s<e.length;++s)i=0|this.dpr*t.targetTouches[s].pageX,r=0|this.dpr*t.targetTouches[s].pageY,a.push({x:i,y:r});s.mouseMultiMove(a)}},{passive:!1},!1),r.default.IsIpadOS()){let t=document.createElement("meta");t.name="viewport",t.content="width=device-width,initial-scale=1.0,minimum-scale=1.0, maximum-scale=1.0, user-scalable=no",document.getElementsByTagName("head")[0].appendChild(t)}}}initialize(t,e,s){r.default.IsMobileWeb()||r.default.IsIpadOS()||this.initPC(t,e,s),this.initMobile(t,e,s)}initPC(t,e,s){var i=null;try{void 0!=document&&(i=document)}catch(r){}if(null!=i){if(void 0==t.onmousewheel&&void 0!=t.addEventListener){let e=function(t){t.wheelDeltaY=-t.detail,s.mouseWheel(t)};t.addEventListener("DOMMouseScroll",e,!1)}t.onmousewheel=t=>{t.preventDefault(),t.stopPropagation(),s.mouseWheel(t)},t.onmousedown=t=>{let i=e.getBoundingClientRect(),r=0|this.dpr*(t.clientX-i.left),a=0|this.dpr*(t.clientY-i.top);s.mouseX=r,s.mouseY=s.stageHeight-a,s.mouseViewX=r,s.mouseViewY=a,this.H_=s.mouseX,this.I_=s.mouseY,this.J_=Date.now(),0==t.button?s.mouseDown(1):2==t.button&&s.mouseRightDown(1)},t.onmouseup=t=>{let i=e.getBoundingClientRect(),r=0|this.dpr*(t.clientX-i.left),a=0|this.dpr*(t.clientY-i.top);s.mouseX=r,s.mouseY=s.stageHeight-a,0==t.button?s.mouseUp(1):2==t.button&&s.mouseRightUp(1)},document.onmouseup=t=>{0==t.button?s.mouseWindowUp(1):2==t.button&&s.mouseWindowRightUp(1)},t.onmousemove=t=>{let i=e.getBoundingClientRect(),r=0|this.dpr*(t.clientX-i.left),a=0|this.dpr*(t.clientY-i.top);s.mouseX=r,s.mouseY=s.stageHeight-a,s.mouseViewX=r,s.mouseViewY=a,s.mouseMove()},t.onclick=t=>{let i=e.getBoundingClientRect(),r=0|this.dpr*(t.clientX-i.left),a=0|this.dpr*(t.clientY-i.top);s.mouseX=r,s.mouseY=s.stageHeight-a,s.mouseViewX=r,s.mouseViewY=a,this.J_=Date.now()-this.J_,Math.abs(this.H_-s.mouseX)<3&&Math.abs(this.I_-s.mouseY)<3&&this.J_<900&&(this.H_=s.mouseX,this.I_=s.mouseY,0==t.button?s.mouseClick():2==t.button&&s.mouseRightClick())},t.ondblclick=t=>{let i=e.getBoundingClientRect(),r=0|this.dpr*(t.clientX-i.left),a=0|this.dpr*(t.clientY-i.top);s.mouseX=r,s.mouseY=s.stageHeight-a,s.mouseViewX=r,s.mouseViewY=a,0==t.button?s.mouseDoubleClick():t.button}}}}e.default=a},"0e01":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("baae")),a=i(s("29ef")),h=i(s("7499")),n=s("de9d");class l{constructor(){this.camera=null,this.stage=null,this.builder=null,this.vtxBuilder=null,this.uniformContext=null,this.shaderProgramBuilder=null}}e.RendererInstanceContextParam=l;class _{constructor(t){this.K_=null,this.Z=null,this.L_=null,this.M_=.1,this.N_=5e3,this.O_=45,this.A=0,this.A=t,this.Z=new n.RenderProxy(t)}getRCUid(){return this.A}getDiv(){return this.K_.getDiv()}getCanvas(){return this.K_.getCanvas()}getRenderAdapter(){return this.K_}getRenderMaterialProxy(){return this.L_}getRenderProxy(){return this.Z}getTextureResTotal(){return this.Z.Texture.getTextureResTotal()}getTextureAttachTotal(){return this.Z.Texture.getAttachTotal()}getDevicePixelRatio(){return this.K_.getDevicePixelRatio()}getStage3D(){return this.Z.getStage3D()}getCamera(){return null!=this.Z?this.Z.getCamera():null}cameraLock(){this.Z.cameraLock()}cameraUnlock(){this.Z.cameraUnlock()}updateCamera(){null!=this.Z&&this.Z.updateCamera()}updateCameraDataFromCamera(t){null!=this.Z&&this.Z.updateCameraDataFromCamera(t)}lockRenderColorMask(){null!=this.Z&&this.Z.lockRenderColorMask()}unlockRendererColorMask(){null!=this.Z&&this.Z.unlockRenderState()}useGlobalRenderColorMask(t){null!=this.Z&&(this.Z.unlockRenderColorMask(),this.Z.useRenderColorMask(t),this.Z.lockRenderColorMask())}useGlobalRenderColorMaskByName(t){null!=this.Z&&(this.Z.unlockRenderColorMask(),this.Z.useRenderColorMask(a.default.GetRenderColorMaskByName(t)),this.Z.lockRenderColorMask())}getRenderColorMaskByName(t){return a.default.GetRenderColorMaskByName(t)}lockRenderState(){null!=this.Z&&this.Z.lockRenderState()}unlockRenderState(){null!=this.Z&&this.Z.unlockRenderState()}useGlobalRenderState(t){null!=this.Z&&(this.Z.unlockRenderState(),this.Z.useRenderState(t),this.Z.lockRenderState())}useGlobalRenderStateByName(t){null!=this.Z&&(this.Z.unlockRenderState(),this.Z.useRenderState(a.default.GetRenderStateByName(t)),this.Z.lockRenderState())}getRenderStateByName(t){return a.default.GetRenderStateByName(t)}lockMaterial(){null!=this.L_&&this.L_.lockMaterial()}unlockMaterial(){null!=this.L_&&this.L_.unlockMaterial()}isUnlockMaterial(){return this.L_.isUnlockMatrial()}useGlobalMaterial(t,e=!1,s=!1){null!=this.L_&&(this.L_.unlockMaterial(),e?this.L_.unlockTexture():this.L_.lockTexture(),this.L_.useGlobalMaterial(t,s),this.L_.lockMaterial())}updateMaterialUniform(t){this.L_.updateMaterialUniform(t)}clearBackBuffer(){this.Z.clearBackBuffer()}setScissorRect(t,e,s,i){this.K_.setScissorRect(t,e,s,i)}setScissorEnabled(t){this.K_.setScissorEnabled(t)}setViewPort(t,e,s,i){this.Z.setViewPort(t,e,s,i)}synFBOSizeWithViewport(){this.K_.synFBOSizeWithViewport()}asynFBOSizeWithViewport(){this.K_.asynFBOSizeWithViewport()}setFBOSizeFactorWithViewPort(t){this.K_.setFBOSizeFactorWithViewPort(t)}createFBOAt(t,e,s,i,r=!1,a=!1,h=0){this.K_.createFBOAt(t,e,s,i,r,a,h)}bindFBOAt(t,e){this.K_.bindFBOAt(t,e)}setRenderToTexture(t,e=!1,s=!1,i=0){this.K_.setRenderToTexture(t,e,s,i)}useFBO(t=!1,e=!1,s=!1){this.K_.useFBO(t,e,s)}resetFBOAttachmentMask(t){this.K_.resetFBOAttachmentMask(t)}setFBOAttachmentMaskAt(t,e){this.K_.setFBOAttachmentMaskAt(t,e)}setRenderToBackBuffer(){null!=this.K_&&(this.K_.setRenderToBackBuffer(r.default.FRAMEBUFFER),this.L_.renderBegin())}lockViewport(){this.K_.lockViewport()}unlockViewport(){this.K_.unlockViewport()}setClearDepth(t){this.K_.setClearDepth(t)}getClearDepth(){return this.K_.getClearDepth()}getViewportX(){return this.K_.getViewportX()}getViewportY(){return this.K_.getViewportY()}getViewportWidth(){return this.K_.getViewportWidth()}getViewportHeight(){return this.K_.getViewportHeight()}setContextViewSize(t,e){this.K_.setContextViewSize(t,e)}setCameraParam(t,e,s){this.O_=t,this.M_=e,this.N_=s,null!=this.Z&&this.Z.setCameraParam(t,e,s)}initialize(t,e,s){if(null==this.K_){this.Z.setCameraParam(this.O_,this.M_,this.N_),this.Z.setWebGLMaxVersion(t.maxWebGLVersion);let i=new n.RenderProxyParam;i.uniformContext=s.uniformContext,i.vtxBufUpdater=s.builder,i.materialUpdater=s.builder,i.vtxBuilder=s.vtxBuilder,this.Z.initialize(t,e,s.stage,i),this.A=this.Z.getRCUid(),s.vtxBuilder.initialize(this.A,this.Z.getRC(),this.Z.getGLVersion()),this.K_=this.Z.getRenderAdapter(),this.K_.bgColor.setRGBA4f(0,0,0,1);let r=this.Z.getContext();r.setViewport(0,0,r.getRCanvasWidth(),r.getRCanvasHeight())}}initManager(t){null==this.L_&&(this.L_=new h.default,this.L_.setDispBuilder(t))}setClearRGBColor3f(t,e,s){this.Z.setClearRGBColor3f(t,e,s)}setClearRGBAColor4f(t,e,s,i){this.Z.setClearRGBAColor4f(t,e,s,i)}getClearRGBAColor4f(t){t.copyFrom(this.K_.bgColor)}updateRenderBufferSize(){this.K_.updateRenderBufferSize()}vertexRenderBegin(){this.Z.Vertex.renderBegin()}renderBegin(t=!0){null!=this.K_&&(this.K_.unlockViewport(),this.K_.setClearDepth(1),this.Z.Vertex.renderBegin(),this.L_.renderBegin(),this.K_.update(),this.K_.setClearMaskClearAll(),this.K_.renderBegin(),a.default.ResetInfo(),a.default.Reset(this.Z.getRenderContext()),t&&(this.Z.useCameraData(),this.Z.updateCameraDataFromCamera(this.Z.getCamera())))}resetState(){a.default.ResetState(),this.L_.renderBegin()}resetmaterial(){this.L_.renderBegin()}resetUniform(){this.L_.resetUniform()}runEnd(){}}e.RendererInstanceContext=_,e.default=_},"0fc4":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("9666")),a=i(s("faa5"));class h{constructor(){this.P_="",this.Q_=null,this.R_=null,this.S_=null,this.T_=null,this.U_=null,this.V_="",this.__$troMid=-1,this.__$uniform=null,this.pipeTypes=null,this.W_=null,this.X_=0,this.Y_=!1,this.Y=0}setPolygonOffset(t,e=0){null==this.R_?this.R_=[t,e]:(this.R_[0]=t,this.R_[1]=e)}getPolygonOffset(){return this.R_}setDepthOffset(t){}setMaterialPipeline(t){this.U_=t}getMaterialPipeline(){return this.U_}getShdUniqueName(){return this.P_}getCodeBuf(){throw Error("Illgel operation !!!")}hasShaderData(){return null!=this.Q_&&(!this.Q_.haveTexture()||this.texDataEnabled())}initializeByRenderer(t=!1){this.initializeByCodeBuf(!0)}initializeByCodeBuf(t=!1){if(null==this.Q_){let e=this.getCodeBuf();if(null!=e){let s;e.reset(),e.pipeline=this.U_,e.pipeTypes=this.pipeTypes,null!=e.pipeline&&e.pipeline.reset(),this.buildBuf();let i=this.V_;if(""!=i&&(s=r.default.FindData(i),this.P_=i),null==s?(t=t||this.getTextureTotal()>0,e.initialize(t),i=e.getUniqueShaderName()+e.keysString+e.getShaderCodeBuilder().getUniqueNSKeyString(),this.P_=i,this.__$initShd(this.P_),s=r.default.FindData(i),this.V_=this.P_):(t=t||this.getTextureTotal()>0,e.initialize(t)),null==s){e.buildShader(),e.buildDefine(),null!=e.pipeline&&(null!=e.getShaderCodeObject()?e.pipeline.addShaderCode(e.getShaderCodeObject(),!1):e.pipeline.addShaderCodeWithUUID(e.getShaderCodeObjectUUID(),!1),e.pipeline.build(e.getShaderCodeBuilder()));let t=e.getFragShaderCode(),h=e.getVertShaderCode();s=r.default.CreateShdData(i,h,t,e.adaptationShaderVersion,a.default.GetPreCompileInfo())}null!=this.U_&&(this.S_=this.U_.getSharedUniforms()),this.Q_=s}}}buildBuf(){}__$initShd(t){}getShaderData(){return this.Q_}setTextureList(t){if(this.W_!=t){this.Y_=!1,this.X_=null!=t?t.length:0;let e=0;if(null!=this.W_)for(;e<this.W_.length;++e)this.W_[e].__$detachThis();if(this.Y_=!0,this.W_=t,null!=this.W_){let t=31;for(e=0;e<this.W_.length;++e)t=131*t+this.W_[e].getUid(),this.W_[e].__$attachThis(),this.W_[e].isDataEnough()||(this.Y_=!1);this.__$troMid=t}}}setTextureAt(t,e){if(t>=0&&null!=e){let s=this.W_,i=s.length;if(null!=s&&s[t]!=e&&t<i&&i>0){s=s.slice(0),s[t].__$detachThis(),s[t]=e,this.Y_=e.isDataEnough(),e.__$attachThis();let r=31;for(let t=0;t<i;++t)r=131*r+s[t].getUid();this.__$troMid=r,this.W_=s}}}getTextureList(){return this.W_}getTextureAt(t){return this.W_[t]}getTextureTotal(){return this.X_}getShdTexTotal(){return null!=this.Q_?this.Q_.getTexTotal():0}texDataEnabled(){if(null!=this.W_){if(this.Y_)return!0;let t=!0,e=this.W_;for(let s=0;s<this.X_;++s)if(!e[s].isDataEnough()){t=!1;break}return this.Y_=t,t}return null!=this.Q_&&this.Q_.getTexTotal(),!1}createSharedUniforms(){return this.S_}createSharedUniformsData(){return null}createSelfUniformData(){return this.T_}updateSelfData(t){}hasTexture(){return this.Q_.haveTexture()}getBufSortFormat(){return null!=this.Q_?this.Q_.getLayoutBit():0}getBufTypeList(){return null!=this.Q_?this.Q_.getLocationTypes():null}getBufSizeList(){return null!=this.Q_?this.Q_.getAttriSizeList():null}__$attachThis(){++this.Y}__$detachThis(){--this.Y,this.Y<1&&(this.Y=0)}getAttachCount(){return this.Y}destroy(){if(this.S_=null,this.T_=null,this.pipeTypes=null,this.getAttachCount()<1){if(null!=this.W_)for(let t=0;t<this.W_.length;++t)this.W_[t].__$detachThis();this.Q_=null,this.W_=null,this.Y_=!1,this.__$troMid=0,null!=this.__$uniform&&(this.__$uniform.destroy(),this.__$uniform=null)}}toString(){return"[MaterialBase()]"}}e.default=h},"11e6":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static AddContainerFlag(t){return 2147483648|t}static RemoveContainerFlag(t){return-2147483649&t}static AddSpaceUid(t,e){return-1048576&t|e}static RemoveSpaceUid(t){return-1048576&t}static GetSpaceUid(t){return 1048575&t}static AddRendererUid(t,e){return-133169153&t|e<<20}static RemoveRendererUid(t){return 133169152|t}static GetRendererUid(t){return t=(133169152&t)>>20,t<127?t:-1}static TestRendererUid(t){return t=(133169152&t)>>20,t<127}static AddSortEnabled(t){return 1073741824|t}static RemoveSortEnabled(t){return-1073741825&t}static TestSortEnabled(t){return 1073741824==(1073741824&t)}static AddRendererLoad(t){return 805306368|t}static RemoveRendererLoad(t){return-805306369&t}static TestSpaceContains(t){return(1048575&t)>0}static TestSpaceEnabled(t){return(1048575&t)<1}static TestSpaceEnabled2(t){return(1048575&t)<1&&2147483648!=(2147483648&t)}static TestContainerEnabled(t){return 133169152==(133169152&t)&&2147483648!=(2147483648&t)}static TestRendererEnabled(t){return 133169152==(938475520&t)&&2147483648!=(2147483648&t)}}i.DEFAULT=133169152,i.CONTAINER_FLAG=2147483648,i.CONTAINER_NOT_FLAG=-2147483649,i.SPACE_FLAG=1048575,i.SPACE_NOT_FLAG=-1048576,i.RENDERER_UID_FLAG=133169152,i.RENDERER_UID_NOT_FLAG=-133169153,i.RENDERER_UID_INVALID=127,i.SORT_FLAG=1073741824,i.SORT_NOT_FLAG=-1073741825,i.RENDERER_LOAD_FLAG=805306368,i.RENDERER_LOAD_NOT_FLAG=-805306369,i.RENDERER_ADN_LOAD_FLAG=938475520,e.default=i},1216:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3930")),a=i(s("baae")),h=i(s("722e")),n=i(s("8333")),l=i(s("6d49")),_=s("e08e"),o=s("8d98"),m=s("070b"),u=s("a5ba"),d=i(s("29ef")),c=i(s("e2fe"));class f{constructor(t,e){this.A=0,this.Z_=null,this.s=null,this.a_=!1,this.b_={mr:!0,mg:!0,mb:!0,ma:!0},this.c_=null,this.d_=0,this.e_=null,this.f_=0,this.g_=a.default.FRAMEBUFFER,this.h_=[null,null,null,null,null,null,null,null],this.i_=!0,this.j_=!1,this.k_=!1,this.R_=!1,this.l_=1,this.y_=0,this.u=new c.default(0,0,800,600),this.n_=new c.default(0,0,800,600),this.o_=1,this.p_=0,this.q_=new Uint16Array(8),this.r_=new Uint16Array(4),this.EO=1,this.o=!1,this.t_=null,this.u_=2,this.bgColor=new r.default,this.uViewProbe=null,this.v_=1,this.w_=!0,this.x_=!1,this.Z_=e,this.A=t}initialize(t,e,s,i){if(null==this.c_&&(this.u_=t.getWebGLVersion(),this.t_=s,this.c_=t,this.s=t.getRC(),this.s.disable(this.s.SCISSOR_TEST),t.isDepthTestEnabled()?this.s.enable(this.s.DEPTH_TEST):this.s.disable(this.s.DEPTH_TEST),t.isStencilTestEnabled()?this.s.enable(this.s.STENCIL_TEST):this.s.disable(this.s.STENCIL_TEST),e.getPolygonOffsetEanbled()?this.enabledPolygonOffset():this.disabledPolygonOffset(),this.s.enable(this.s.CULL_FACE),this.s.cullFace(this.s.BACK),this.s.enable(this.s.BLEND),e.getDitherEanbled()?this.s.enable(this.s.DITHER):this.s.disable(this.s.DITHER),this.s.frontFace(this.s.CCW),this.d_=this.s.COLOR_BUFFER_BIT|this.s.DEPTH_BUFFER_BIT|this.s.STENCIL_BUFFER_BIT,null==this.uViewProbe)){let t=this.u,e=this;e.uViewProbe=i,this.uViewProbe.setVec4DataWithArr4([t.x,t.y,t.width,t.height])}}setFrontFaceFlipped(t){this.a_!=t&&(t?this.s.frontFace(this.s.CW):this.s.frontFace(this.s.CCW),this.a_=t)}enabledPolygonOffset(){this.R_||(this.R_=!0,this.s.enable(this.s.POLYGON_OFFSET_FILL))}disabledPolygonOffset(){this.R_&&(this.R_=!1,this.s.disable(this.s.POLYGON_OFFSET_FILL))}setPolygonOffset(t,e=0){this.s.polygonOffset(t,e),this.k_=!0}resetPolygonOffset(){this.k_&&(this.s.polygonOffset(0,0),this.k_=!1)}getDiv(){return this.c_.getDiv()}getCanvas(){return this.c_.getCanvas()}setClearDepth(t){this.l_=t}getClearDepth(){return this.l_}setContextViewSize(t,e){this.c_.autoSyncRenderBufferAndWindowSize=!1,this.c_.resizeBufferSize(t,e)}getViewportX(){return this.c_.getViewportX()}getViewportY(){return this.c_.getViewportY()}getViewportWidth(){return this.c_.getViewportWidth()}getViewportHeight(){return this.c_.getViewportHeight()}getFBOFitWidth(){return this.c_.getFBOWidth()}getFBOFitHeight(){return this.c_.getFBOHeight()}getRCanvasWidth(){return this.c_.getRCanvasWidth()}getRCanvasHeight(){return this.c_.getRCanvasHeight()}setColorMask(t,e,s,i){this.b_.mr=t,this.b_.mg=e,this.b_.mb=s,this.b_.ma=i}setClearMaskClearAll(){this.d_=this.s.COLOR_BUFFER_BIT|this.s.DEPTH_BUFFER_BIT|this.s.STENCIL_BUFFER_BIT}setClearMaskClearOnlyColor(){this.d_=this.s.COLOR_BUFFER_BIT}setClearMaskClearOnlyDepthAndStencil(){this.d_=this.s.DEPTH_BUFFER_BIT|this.s.STENCIL_BUFFER_BIT}setScissorRect(t,e,s,i){this.o&&this.s.scissor(t,e,s,i)}setScissorEnabled(t){t?this.o||(this.o=!0,this.s.enable(this.s.SCISSOR_TEST)):this.o&&(this.o=!1,this.s.disable(this.s.SCISSOR_TEST))}clearDepth(t=1){this.l_=t,this.y_!==this.l_&&(this.y_=this.l_,this.s.clearDepth(this.l_)),this.s.clear(this.s.DEPTH_BUFFER_BIT)}clearColor(t){this.s.clearColor(t.r,t.g,t.b,t.a),this.s.clear(this.s.COLOR_BUFFER_BIT)}clear(){this.y_!==this.l_&&(this.y_=this.l_,this.s.clearDepth(this.l_)),this.c_.isStencilTestEnabled()&&this.s.clearStencil(this.p_),this.s.clearColor(this.bgColor.r,this.bgColor.g,this.bgColor.b,this.bgColor.a),this.s.clear(this.d_)}reset(){this.t_.setCullFaceMode(_.CullFaceMode.BACK),this.t_.setDepthTestMode(_.DepthTestMode.OPAQUE),d.default.Reset(this.s)}getRenderContext(){return this.c_}renderBegin(){null!=this.c_&&(this.o_=1,this.reseizeViewPort(),u.RenderStateObject.Unlock(),u.RenderStateObject.UseRenderState(d.default.NORMAL_STATE),m.RenderColorMask.Unlock(),m.RenderColorMask.UseRenderState(m.RenderColorMask.ALL_TRUE_COLOR_MASK),this.clear())}updateViewPort(){let t=this.u;this.uViewProbe.setVec4Data(t.x,t.y,t.width,t.height),this.uViewProbe.update(),this.s.viewport(t.x,t.y,t.width,t.height)}checkViewPort(t){let e=this.u,s=this.c_.getDevicePixelRatio(),i=e.testEqual(t);i=i||Math.abs(this.v_-s)>.01,i&&(this.v_=s,e.copyFrom(t),this.updateViewPort())}reseizeViewPort(){this.w_&&this.checkViewPort(this.c_.getViewPortSize())}reseizeFBOViewPort(){this.w_&&this.checkViewPort(this.n_)}setViewProbeValue(t,e,s,i){this.uViewProbe.setVec4Data(t,e,s,i),this.uViewProbe.update()}lockViewport(){this.w_=!1}unlockViewport(){this.w_=!0}renderEnd(){}update(){}updateRenderBufferSize(){this.c_.updateRenderBufferSize()}destroy(){this.c_=null,this.t_=null}getDevicePixelRatio(){return this.c_.getDevicePixelRatio()}loseContext(){this.c_.loseContext()}isContextLost(){return this.c_.isContextLost()}readPixels(t,e,s,i,r,a,h){this.s.readPixels(t,e,s,i,o.TextureFormat.ToGL(this.s,r),o.TextureDataType.ToGL(this.s,a),h)}setFBOViewportRect(t,e,s,i){this.r_[0]=t,this.r_[1]=e,this.r_[2]=s,this.r_[3]=i,this.j_=!0}createFBOAt(t,e,s,i,r=!1,a=!1,h=0){null==this.h_[t]&&(t>7&&(t=7),this.g_=e,this.e_=new l.default(this.A,this.Z_,this.g_),this.e_.multisampleEnabled=h>0,this.e_.multisampleLevel=h,this.e_.writeDepthEnabled=r,this.e_.writeStencilEnabled=a,this.e_.initialize(this.s,s,i),this.h_[t]=this.e_,this.e_.sizeFixed=!0)}resizeFBOAt(t,e,s){t>7?t=7:t<0&&(t=0),null!=this.h_[t]&&this.h_[t].resize(e,s)}getFBOWidthAt(t){return null!=this.h_[t]?this.h_[t].getWidth():0}getFBOHeightAt(t){return null!=this.h_[t]?this.h_[t].getHeight():0}synFBOSizeWithViewport(){this.x_=!0}asynFBOSizeWithViewport(){this.x_=!1}setFBOSizeFactorWithViewPort(t){this.o_=t}bindFBOAt(t,e){if(t>7?t=7:t<0&&(t=0),this.e_=this.h_[t],null==this.e_)throw Error("Fatal Error!!! this.e_ == null.");this.f_=t,this.g_=e,this.e_.bind(e),this.i_=!0}clearFBODepthAt(t,e=1){let s=this.h_[t];null!=s&&s.clearOnlyDepth(e)}resetFBOAttachmentMask(t){null!=this.e_&&this.e_.resetAttachmentMask(t)}setFBOAttachmentMaskAt(t,e){null!=this.e_&&this.e_.setAttachmentMaskAt(t,e)}getFBOAttachmentTotal(){return null!=this.e_?this.e_.getAttachmentTotal():0}setRenderToTexture(t,e=!1,s=!1,i=0){(i<0||i>=8)&&(i=0),null==t&&0==i?this.setRenderToBackBuffer(a.default.FRAMEBUFFER):(0==i&&(null!=this.e_&&(this.x_?this.e_.initialize(this.s,Math.floor(this.c_.getFBOWidth()*this.o_),Math.floor(this.c_.getFBOHeight()*this.o_)):this.j_?this.e_.initialize(this.s,this.r_[2],this.r_[3]):this.e_.sizeFixed||this.e_.initialize(this.s,t.getWidth(),t.getHeight())),this.f_>=0&&null==this.e_&&(this.e_=new l.default(this.A,this.Z_,this.g_),this.h_[this.f_]=this.e_,this.e_.writeDepthEnabled=e,this.e_.writeStencilEnabled=s,this.x_?this.e_.initialize(this.s,Math.floor(this.c_.getFBOWidth()*this.o_),Math.floor(this.c_.getFBOHeight()*this.o_)):this.j_?this.e_.initialize(this.s,this.r_[2],this.r_[3]):this.e_.initialize(this.s,t.getWidth(),t.getHeight()))),null!=this.e_&&this.e_.renderToTexAt(this.s,t,i),this.i_=!0)}getActiveAttachmentTotal(){return this.EO}getAttachmentTotal(){return this.EO}useFBO(t=!1,e=!1,s=!1){if(null!=this.e_&&this.i_){this.i_=!1,this.e_.use(this.s),this.EO=this.e_.getActiveAttachmentTotal(),t&&this.e_.clearOnlyColor(this.bgColor),this.e_.writeDepthEnabled?this.e_.writeStencilEnabled?e&&s?this.e_.clearOnlyDepthAndStencil(this.l_,4294967295):e?this.e_.clearOnlyDepth(this.l_):s&&this.e_.clearOnlyStencil(255):e&&this.e_.clearOnlyDepth(this.l_):s&&this.e_.writeStencilEnabled&&this.e_.clearOnlyStencil(255),1==this.u_&&this.s.clear(this.d_);let i=this.u;this.q_[4]=this.q_[0]=i.x,this.q_[5]=this.q_[1]=i.y,this.q_[6]=this.q_[2]=i.getRight(),this.q_[7]=this.q_[3]=i.getTop(),this.j_?(this.j_=!1,this.n_.setTo(this.r_[0],this.r_[1],this.r_[2],this.r_[3]),this.reseizeFBOViewPort()):(this.x_?this.n_.setTo(0,0,Math.floor(this.c_.getFBOWidth()*this.o_),Math.floor(this.c_.getFBOHeight()*this.o_)):(this.e_.isSizeChanged()&&this.e_.initialize(this.s,this.e_.getWidth(),this.e_.getHeight()),this.n_.setTo(0,0,this.e_.getWidth(),this.e_.getHeight())),this.reseizeFBOViewPort())}}setRenderToBackBuffer(t=a.default.FRAMEBUFFER){this.EO=1,l.default.BindToBackbuffer(this.s,t),this.reseizeViewPort()}bindFBOToDraw(){null!=this.e_&&this.e_.bind(a.default.DRAW_FRAMEBUFFER)}bindFBOToWrite(){null!=this.e_&&this.e_.bind(a.default.READ_FRAMEBUFFER)}setBlitFboSrcRect(t,e,s,i){this.q_[0]=t,this.q_[1]=e,this.q_[2]=t+s,this.q_[3]=e+i}setBlitFboDstRect(t,e,s,i){this.q_[4]=t,this.q_[5]=e,this.q_[6]=t+s,this.q_[7]=e+i}blitFBO(t=0,e=0,s=n.default.COLOR_BUFFER_BIT,i=h.default.NEAREST,r=0,_=0,o=null){t>7&&(t=7),e>7&&(e=7),t>=0&&null!=this.h_[t]?this.h_[t].bind(a.default.READ_FRAMEBUFFER):l.default.BindToBackbuffer(this.s,a.default.READ_FRAMEBUFFER),e>=0&&null!=this.h_[e]?this.h_[e].bind(a.default.DRAW_FRAMEBUFFER):l.default.BindToBackbuffer(this.s,a.default.DRAW_FRAMEBUFFER),r>0&&(_<0&&(_=0),null==o&&(o=[0,0,0,1]),this.s.clearBufferfv(r,_,o));let m=this.q_;this.s.blitFramebuffer(m[0],m[1],m[2],m[3],m[4],m[5],m[6],m[7],s,i)}}e.default=f},1264:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("11e6")),a=s("e08e"),h=s("eca0");class n{constructor(t,e,s,i){this.z_=null,this.AA=null,this.AB=null,this.AC=[],this.AD=[],this.AE=-1,this.AF=0,this.AG=null,this.AH=null,this.version=0,this.AE=t,this.AA=e,this.z_=s,this.AB=i}setListener(t){this.AH=t}isEmpty(){return this.AF<1}isHaveEntity(){return this.AF>0}removeEntity(t){this.AF--;let e=t.getDisplay();if(null!=e&&null!=e.__$$runit){let t=e.__$ruid,s=this.z_.getRCRPObj(t);if(null!=s){if(s.count>0)if(s.count<2)s.rprocessUid>-1&&(this.AG=this.AB.getNodeByUid(s.rprocessUid),this.AG.removeDisp(e),s.rprocessUid=-1);else{let t=h.RCRPObj.RenerProcessMaxTotal;for(let i=0;i<t;++i)(s.idsFlag&1<<i)>0&&(this.AG=this.AB.getNodeByUid(i),this.AG.removeDisp(e))}}else this.AG=this.AB.getNodeByUid(e.__$$runit.getRPROUid()),this.AG.removeDisp(e);0==s.count&&(e.__$$rsign,a.DisplayRenderSign.LIVE_IN_RENDERER,e.__$$rsign=a.DisplayRenderSign.NOT_IN_RENDERER,this.z_.restoreByUid(t)),this.version++}t.__$rseFlag=r.default.RemoveRendererUid(t.__$rseFlag),t.__$rseFlag=r.default.RemoveRendererLoad(t.__$rseFlag),t.__$rseFlag=r.default.RemoveSortEnabled(t.__$rseFlag),null!=this.AH&&this.AH.removeFromRenderer(t,this.AE,-1)}addEntity(t,e,s=!1){if(null!=t){let i=t.getDisplay();if(null!=i){if(i.__$$rsign==a.DisplayRenderSign.LIVE_IN_RENDERER&&!this.z_.testRPNodeNotExists(i.__$ruid,e))return;this.AG=this.AB.getNodeByUid(e),t.__$rseFlag=this.AG.getSortEnabled()?r.default.AddSortEnabled(t.__$rseFlag):r.default.RemoveSortEnabled(t.__$rseFlag),s?(i.__$$rsign==a.DisplayRenderSign.NOT_IN_RENDERER&&(i.__$$rsign=a.DisplayRenderSign.GO_TO_RENDERER),t.__$rseFlag=r.default.AddRendererLoad(t.__$rseFlag),t.__$rseFlag=r.default.AddRendererUid(t.__$rseFlag,this.AE),this.AC.push(t),this.AD.push(e)):this.testValidData(t)?this.ensureAdd(t,i,e):(i.__$$rsign==a.DisplayRenderSign.NOT_IN_RENDERER&&(i.__$$rsign=a.DisplayRenderSign.GO_TO_RENDERER),t.__$rseFlag=r.default.AddRendererLoad(t.__$rseFlag),this.AC.push(t),this.AD.push(e))}else t.__$rseFlag=r.default.AddRendererUid(t.__$rseFlag,this.AE)}return!1}testValidData(t){if(null!=t.getMaterial()&&t.hasMesh()){if(t.getMaterial().hasShaderData())return!0;null!=t.getMaterial().getCodeBuf()&&t.activeDisplay()}return!1}ensureAdd(t,e,s){t.update(),t.__$rseFlag=r.default.AddRendererUid(t.__$rseFlag,this.AE),t.__$rseFlag=r.default.RemoveRendererLoad(t.__$rseFlag),t.__$setRenderProxy(this.AA.getRenderProxy()),this.AF++,e.__$$rsign==a.DisplayRenderSign.NOT_IN_RENDERER&&(e.__$$rsign=a.DisplayRenderSign.GO_TO_RENDERER),this.AG=this.AB.getNodeByUid(s),(e.__$ruid>-1||this.AA.buildGpuDisp(e))&&this.AG.addDisp(e),null!=this.AH&&this.AH.addToRenderer(t,this.AE,s),null!=t.getGlobalBounds()&&(e.__$$runit.bounds=t.getGlobalBounds(),e.__$$runit.pos=e.__$$runit.bounds.center),this.version++}updateWaitList(){let t=this.AC.length,e=null,s=null;for(let i=0;i<t;++i)if(e=this.AC[i],(r.default.RENDERER_LOAD_FLAG&e.__$rseFlag)==r.default.RENDERER_LOAD_FLAG){if(this.testValidData(e)){if(s=e.getDisplay(),s.__$$rsign==a.DisplayRenderSign.LIVE_IN_RENDERER&&!this.z_.testRPNodeNotExists(s.__$ruid,this.AD[i])){this.AC.splice(i,1),this.AD.splice(i,1),--t,--i;continue}this.ensureAdd(e,s,this.AD[i]),this.AC.splice(i,1),this.AD.splice(i,1),--t,--i}}else s=e.getDisplay(),null!=s&&s.__$$rsign==a.DisplayRenderSign.GO_TO_RENDERER&&(s.__$$rsign=a.DisplayRenderSign.NOT_IN_RENDERER),e.__$rseFlag=r.default.RemoveRendererLoad(e.__$rseFlag),e.__$rseFlag=r.default.RemoveRendererUid(e.__$rseFlag),e.__$rseFlag=r.default.RemoveSortEnabled(e.__$rseFlag),this.AC.splice(i,1),this.AD.splice(i,1),--t,--i,null!=this.AH&&this.AH.removeFromRenderer(e,this.AE,-1)}update(){this.AC.length>0&&this.updateWaitList(),this.AA.update()}}e.default=n},1710:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17")),a=i(s("a996"));class h extends a.default{constructor(){super(),this.lpos=new r.default,this.wpos=new r.default,this.raytv=new r.default(1,0,0),this.raypv=new r.default(0,0,0),this.mouseX=0,this.mouseY=0,this.mouseViewX=0,this.mouseViewY=0,this.posArray=null,this.wheelDeltaY=0}static GetMouseEvtTypeValueBase(){return 5001}static GetMouseEvtTypeValuesTotal(){return 18}getClassType(){return h.EventClassType}toString(){return"[MouseEvent]"}}h.EventClassType=1002,h.MOUSE_DOWN=5001,h.MOUSE_UP=5002,h.MOUSE_RIGHT_UP=5003,h.MOUSE_RIGHT_DOWN=5004,h.MOUSE_MOVE=5005,h.MOUSE_WHEEL=5006,h.MOUSE_OVER=5007,h.MOUSE_OUT=5008,h.MOUSE_CLICK=5009,h.MOUSE_RIGHT_CLICK=5010,h.MOUSE_DOUBLE_CLICK=5011,h.MOUSE_CANCEL=5012,h.MOUSE_MULTI_DOWN=5013,h.MOUSE_MULTI_UP=5014,h.MOUSE_MULTI_MOVE=5015,h.MOUSE_BG_DOWN=5016,h.MOUSE_BG_UP=5017,h.MOUSE_BG_CLICK=5018,e.default=h},"18c7":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("8e17")),h=i(s("abdb"));class n{constructor(t=null,e=0){this.T=-1,this.AI=0,this.AJ=null,this.AK=null,this.AI=e,null!=t?(this.T=n.EM++,this.AJ=t,this.AK=this.AJ.subarray(e,e+16)):(this.T=n.ER++,this.AJ=new Float32Array(16),this.AJ.set(n.EQ,0),this.AK=this.AJ)}setData(t){16==t.length&&this.AK.set(t)}getCapacity(){return 16}GetMaxUid(){return n.EM}getUid(){return this.T}getLocalFS32(){return this.AK}getFS32(){return this.AJ}getFSIndex(){return this.AI}identity(){this.AK.set(n.EQ,0)}determinant(){return(this.AK[0]*this.AK[5]-this.AK[4]*this.AK[1])*(this.AK[10]*this.AK[15]-this.AK[14]*this.AK[11])-(this.AK[0]*this.AK[9]-this.AK[8]*this.AK[1])*(this.AK[6]*this.AK[15]-this.AK[14]*this.AK[7])+(this.AK[0]*this.AK[13]-this.AK[12]*this.AK[1])*(this.AK[6]*this.AK[11]-this.AK[10]*this.AK[7])+(this.AK[4]*this.AK[9]-this.AK[8]*this.AK[5])*(this.AK[2]*this.AK[15]-this.AK[14]*this.AK[3])-(this.AK[4]*this.AK[13]-this.AK[12]*this.AK[5])*(this.AK[2]*this.AK[11]-this.AK[10]*this.AK[3])+(this.AK[8]*this.AK[13]-this.AK[12]*this.AK[9])*(this.AK[2]*this.AK[7]-this.AK[6]*this.AK[3])}append(t){let e=t.getLocalFS32(),s=this.AK,i=s[0],r=s[4],a=s[8],h=s[12],n=s[1],l=s[5],_=s[9],o=s[13],m=s[2],u=s[6],d=s[10],c=s[14],f=s[3],p=s[7],g=s[11],T=s[15],E=e[0],x=e[4],S=e[8],R=e[12],y=e[1],A=e[5],v=e[9],b=e[13],L=e[2],M=e[6],F=e[10],D=e[14],P=e[3],B=e[7],N=e[11],C=e[15];s[0]=i*E+n*x+m*S+f*R,s[1]=i*y+n*A+m*v+f*b,s[2]=i*L+n*M+m*F+f*D,s[3]=i*P+n*B+m*N+f*C,s[4]=r*E+l*x+u*S+p*R,s[5]=r*y+l*A+u*v+p*b,s[6]=r*L+l*M+u*F+p*D,s[7]=r*P+l*B+u*N+p*C,s[8]=a*E+_*x+d*S+g*R,s[9]=a*y+_*A+d*v+g*b,s[10]=a*L+_*M+d*F+g*D,s[11]=a*P+_*B+d*N+g*C,s[12]=h*E+o*x+c*S+T*R,s[13]=h*y+o*A+c*v+T*b,s[14]=h*L+o*M+c*F+T*D,s[15]=h*P+o*B+c*N+T*C}append3x3(t){let e=t.getLocalFS32(),s=this.AK,i=s[0],r=s[4],a=s[8],h=s[1],n=s[5],l=s[9],_=s[2],o=s[6],m=s[10],u=e[0],d=e[4],c=e[8],f=e[1],p=e[5],g=e[9],T=e[2],E=e[6],x=e[10];s[0]=i*u+h*d+_*c,s[1]=i*f+h*p+_*g,s[2]=i*T+h*E+_*x,s[4]=r*u+n*d+o*c,s[5]=r*f+n*p+o*g,s[6]=r*T+n*E+o*x,s[8]=a*u+l*d+m*c,s[9]=a*f+l*p+m*g,s[10]=a*T+l*E+m*x}appendRotationPivot(t,e,s=null){null==s&&(s=a.default.Z_AXIS),n.EP.identity(),n.EP.getAxisRotation(e.x,e.y,e.z,t),n.EP.appendTranslationXYZ(s.x,s.y,s.z),this.append(n.EP)}appendRotation(t,e){n.EP.identity(),n.EP.getAxisRotation(e.x,e.y,e.z,t),this.append(n.EP)}appendRotationX(t){n.EP.rotationX(t),this.append3x3(n.EP)}appendRotationY(t){n.EP.rotationY(t),this.append3x3(n.EP)}appendRotationZ(t){n.EP.rotationZ(t),this.append3x3(n.EP)}appendRotationEulerAngle(t,e,s){n.EP.rotationY(e),this.append3x3(n.EP),n.EP.rotationX(t),this.append3x3(n.EP),n.EP.rotationZ(s),this.append3x3(n.EP)}setScaleXYZ(t,e,s){let i=this.AK;i[0]=t,i[5]=e,i[10]=s}setRotationEulerAngle(t,e,s){let i=this.AK,r=Math.cos(t),a=Math.sin(t),h=Math.cos(e),n=Math.sin(e),l=Math.cos(s),_=Math.sin(s),o=l*n,m=_*n,u=h*i[0],d=a*i[5],c=r*i[5],f=r*i[10],p=a*i[10];i[1]=_*u,i[2]=-n*i[0],i[0]=l*u,i[4]=o*d-_*c,i[8]=o*f+_*p,i[5]=m*d+l*c,i[9]=m*f-l*p,i[6]=h*d,i[10]=h*f}setRotationEulerAngle2(t,e,s,i,r,a){let h=this.AK,n=r*i,l=a*i,_=s*h[0],o=e*h[5],m=t*h[5],u=t*h[10],d=e*h[10];h[1]=a*_,h[2]=-i*h[0],h[0]=r*_,h[4]=n*o-a*m,h[8]=n*u+a*d,h[5]=l*o+r*m,h[9]=l*u-r*d,h[6]=s*o,h[10]=s*u}setTranslationXYZ(t,e,s){this.AK[12]=t,this.AK[13]=e,this.AK[14]=s}setTranslation(t){this.AK[12]=t.x,this.AK[13]=t.y,this.AK[14]=t.z}appendScaleXYZ(t,e,s){let i=this.AK;i[0]*=t,i[1]*=t,i[2]*=t,i[3]*=t,i[4]*=e,i[5]*=e,i[6]*=e,i[7]*=e,i[8]*=s,i[9]*=s,i[10]*=s,i[11]*=s}appendScaleXY(t,e){this.AK[0]*=t,this.AK[1]*=t,this.AK[2]*=t,this.AK[3]*=t,this.AK[4]*=e,this.AK[5]*=e,this.AK[6]*=e,this.AK[7]*=e}appendTranslationXYZ(t,e,s){this.AK[12]+=t,this.AK[13]+=e,this.AK[14]+=s}appendTranslation(t){this.AK[12]+=t.x,this.AK[13]+=t.y,this.AK[14]+=t.z}copyColumnFrom(t,e){switch(t){case 0:this.AK[0]=e.x,this.AK[1]=e.y,this.AK[2]=e.z,this.AK[3]=e.w;break;case 1:this.AK[4]=e.x,this.AK[5]=e.y,this.AK[6]=e.z,this.AK[7]=e.w;break;case 2:this.AK[8]=e.x,this.AK[9]=e.y,this.AK[10]=e.z,this.AK[11]=e.w;break;case 3:this.AK[12]=e.x,this.AK[13]=e.y,this.AK[14]=e.z,this.AK[15]=e.w;break;default:break}}copyColumnTo(t,e){t<<=2,e.x=this.AK[t],e.y=this.AK[1+t],e.z=this.AK[2+t],e.w=this.AK[3+t]}setF32ArrAndIndex(t,e=0){null!=t&&e>=0&&(this.AJ=t,this.AI=e,this.AK=this.AJ.subarray(e,e+16))}setF32ArrIndex(t=0){t>=0&&(this.AI=t,this.AK=this.AJ.subarray(t,t+16))}setF32Arr(t){null!=t&&(this.AJ=t)}copyFromF32Arr(t,e=0){let s=0;for(let i=e+16;e<i;e++)this.AK[s]=t[e],++s}copyToF32Arr(t,e=0){t.set(this.AK,e)}copyFrom(t){this.AK.set(t.AK,0)}copyTo(t){t.AK.set(this.AK,0)}copyRawDataFrom(t,e=16,s=0,i=!1){i&&this.transpose(),e-=s;let r=0;while(r<e)this.AJ[this.AI+r]=t[r+s],++r;i&&this.transpose()}copyRawDataTo(t,e=16,s=0,i=!1){i&&this.transpose();let r=0;while(r<e)t[r+s]=this.AJ[this.AI+r],++r;i&&this.transpose()}copyRowFrom(t,e){switch(t){case 0:this.AK[0]=e.x,this.AK[4]=e.y,this.AK[8]=e.z,this.AK[12]=e.w;break;case 1:this.AK[1]=e.x,this.AK[5]=e.y,this.AK[9]=e.z,this.AK[13]=e.w;break;case 2:this.AK[2]=e.x,this.AK[6]=e.y,this.AK[10]=e.z,this.AK[14]=e.w;break;case 3:this.AK[3]=e.x,this.AK[7]=e.y,this.AK[11]=e.z,this.AK[15]=e.w;break;default:break}}copyRowTo(t,e){e.x=this.AK[t],e.y=this.AK[4+t],e.z=this.AK[8+t],e.w=this.AK[12+t]}decompose(t){let e=[],s=n.EP,i=s.getFS32();s.copyFrom(this);let l=new a.default(i[12],i[13],i[14]),_=new a.default;_.x=Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]),_.y=Math.sqrt(i[4]*i[4]+i[5]*i[5]+i[6]*i[6]),_.z=Math.sqrt(i[8]*i[8]+i[9]*i[9]+i[10]*i[10]),i[0]*(i[5]*i[10]-i[6]*i[9])-i[1]*(i[4]*i[10]-i[6]*i[8])+i[2]*(i[4]*i[9]-i[5]*i[8])<0&&(_.z=-_.z),i[0]/=_.x,i[1]/=_.x,i[2]/=_.x,i[4]/=_.y,i[5]/=_.y,i[6]/=_.y,i[8]/=_.z,i[9]/=_.z,i[10]/=_.z;let o=new a.default;switch(t){case h.default.AXIS_ANGLE:{o.w=r.default.SafeACos((i[0]+i[5]+i[10]-1)/2);let t=Math.sqrt((i[6]-i[9])*(i[6]-i[9])+(i[8]-i[2])*(i[8]-i[2])+(i[1]-i[4])*(i[1]-i[4]));t>r.default.MATH_MIN_POSITIVE?(o.x=(i[6]-i[9])/t,o.y=(i[8]-i[2])/t,o.z=(i[1]-i[4])/t):o.x=o.y=o.z=0}break;case h.default.QUATERNION:{let t=i[0]+i[5]+i[10];t>0?(o.w=Math.sqrt(1+t)/2,o.x=(i[6]-i[9])/(4*o.w),o.y=(i[8]-i[2])/(4*o.w),o.z=(i[1]-i[4])/(4*o.w)):i[0]>i[5]&&i[0]>i[10]?(o.x=Math.sqrt(1+i[0]-i[5]-i[10])/2,o.w=(i[6]-i[9])/(4*o.x),o.y=(i[1]+i[4])/(4*o.x),o.z=(i[8]+i[2])/(4*o.x)):i[5]>i[10]?(o.y=Math.sqrt(1+i[5]-i[0]-i[10])/2,o.x=(i[1]+i[4])/(4*o.y),o.w=(i[8]-i[2])/(4*o.y),o.z=(i[6]+i[9])/(4*o.y)):(o.z=Math.sqrt(1+i[10]-i[0]-i[5])/2,o.x=(i[8]+i[2])/(4*o.z),o.y=(i[6]+i[9])/(4*o.z),o.w=(i[1]-i[4])/(4*o.z))}break;case h.default.EULER_ANGLES:o.y=Math.asin(-i[2]),1!=i[2]&&-1!=i[2]?(o.x=Math.atan2(i[6],i[10]),o.z=Math.atan2(i[1],i[0])):(o.z=0,o.x=Math.atan2(i[4],i[5]));break;default:break}return e.push(l),e.push(o),e.push(_),s=null,e}invert(){let t=this.determinant(),e=Math.abs(t)>r.default.MATH_MIN_POSITIVE;if(e){let e=this.AK;t=1/t;let s=e[0],i=e[4],r=e[8],a=e[12],h=e[1],n=e[5],l=e[9],_=e[13],o=e[2],m=e[6],u=e[10],d=e[14],c=e[3],f=e[7],p=e[11],g=e[15];e[0]=t*(n*(u*g-d*p)-l*(m*g-d*f)+_*(m*p-u*f)),e[1]=-t*(h*(u*g-d*p)-l*(o*g-d*c)+_*(o*p-u*c)),e[2]=t*(h*(m*g-d*f)-n*(o*g-d*c)+_*(o*f-m*c)),e[3]=-t*(h*(m*p-u*f)-n*(o*p-u*c)+l*(o*f-m*c)),e[4]=-t*(i*(u*g-d*p)-r*(m*g-d*f)+a*(m*p-u*f)),e[5]=t*(s*(u*g-d*p)-r*(o*g-d*c)+a*(o*p-u*c)),e[6]=-t*(s*(m*g-d*f)-i*(o*g-d*c)+a*(o*f-m*c)),e[7]=t*(s*(m*p-u*f)-i*(o*p-u*c)+r*(o*f-m*c)),e[8]=t*(i*(l*g-_*p)-r*(n*g-_*f)+a*(n*p-l*f)),e[9]=-t*(s*(l*g-_*p)-r*(h*g-_*c)+a*(h*p-l*c)),e[10]=t*(s*(n*g-_*f)-i*(h*g-_*c)+a*(h*f-n*c)),e[11]=-t*(s*(n*p-l*f)-i*(h*p-l*c)+r*(h*f-n*c)),e[12]=-t*(i*(l*d-_*u)-r*(n*d-_*m)+a*(n*u-l*m)),e[13]=t*(s*(l*d-_*u)-r*(h*d-_*o)+a*(h*u-l*o)),e[14]=-t*(s*(n*d-_*m)-i*(h*d-_*o)+a*(h*m-n*o)),e[15]=t*(s*(n*u-l*m)-i*(h*u-l*o)+r*(h*m-n*o))}return e}pointAt(t,e,s){null!=e&&void 0!=e||(e=new a.default(0,0,-1)),null!=s&&void 0!=s||(s=new a.default(0,-1,0));let i=e.subtract(t),h=new a.default(s.x,s.y,s.z);i.normalize(),h.normalize();let n=new a.default(i.x,i.y,i.z);n.scaleBy(h.dot(i)),h.subtractBy(n),h.getLength()>r.default.MATH_MIN_POSITIVE?h.normalize():0!=i.x?h.setTo(-i.y,i.x,0):h.setTo(1,0,0);let l=h.crossProduct(i);l.normalize();let _=this.AK;_[0]=l.x,_[4]=l.y,_[8]=l.z,_[12]=0,_[1]=h.x,_[5]=h.y,_[9]=h.z,_[13]=0,_[2]=i.x,_[6]=i.y,_[10]=i.z,_[14]=0,_[3]=t.x,_[7]=t.y,_[11]=t.z,_[15]=1}prepend(t){let e=t.getLocalFS32(),s=this.AK,i=e[0],r=e[4],a=e[8],h=e[12],n=e[1],l=e[5],_=e[9],o=e[13],m=e[2],u=e[6],d=e[10],c=e[14],f=e[3],p=e[7],g=e[11],T=e[15],E=s[0],x=s[4],S=s[8],R=s[12],y=s[1],A=s[5],v=s[9],b=s[13],L=s[2],M=s[6],F=s[10],D=s[14],P=s[3],B=s[7],N=s[11],C=s[15];s[0]=i*E+n*x+m*S+f*R,s[1]=i*y+n*A+m*v+f*b,s[2]=i*L+n*M+m*F+f*D,s[3]=i*P+n*B+m*N+f*C,s[4]=r*E+l*x+u*S+p*R,s[5]=r*y+l*A+u*v+p*b,s[6]=r*L+l*M+u*F+p*D,s[7]=r*P+l*B+u*N+p*C,s[8]=a*E+_*x+d*S+g*R,s[9]=a*y+_*A+d*v+g*b,s[10]=a*L+_*M+d*F+g*D,s[11]=a*P+_*B+d*N+g*C,s[12]=h*E+o*x+c*S+T*R,s[13]=h*y+o*A+c*v+T*b,s[14]=h*L+o*M+c*F+T*D,s[15]=h*P+o*B+c*N+T*C}prepend3x3(t){let e=t.getLocalFS32(),s=this.AK,i=e[0],r=e[4],a=e[8],h=e[1],n=e[5],l=e[9],_=e[2],o=e[6],m=e[10],u=s[0],d=s[4],c=s[8],f=s[1],p=s[5],g=s[9],T=s[2],E=s[6],x=s[10];s[0]=i*u+h*d+_*c,s[1]=i*f+h*p+_*g,s[2]=i*T+h*E+_*x,s[4]=r*u+n*d+o*c,s[5]=r*f+n*p+o*g,s[6]=r*T+n*E+o*x,s[8]=a*u+l*d+m*c,s[9]=a*f+l*p+m*g,s[10]=a*T+l*E+m*x}prependRotationPivot(t,e,s){n.EP.identity(),n.EP.getAxisRotation(e.x,e.y,e.z,t),n.EP.appendTranslationXYZ(s.x,s.y,s.z),this.prepend(n.EP)}prependRotation(t,e){n.EP.identity(),n.EP.getAxisRotation(e.x,e.y,e.z,t),this.prepend(n.EP)}prependRotationX(t){n.EP.rotationX(t),this.prepend3x3(n.EP)}prependRotationY(t){n.EP.rotationY(t),this.prepend3x3(n.EP)}prependRotationZ(t){n.EP.rotationZ(t),this.prepend3x3(n.EP)}prependRotationEulerAngle(t,e,s){n.EP.rotationY(e),this.prepend3x3(n.EP),n.EP.rotationX(t),this.prepend3x3(n.EP),n.EP.rotationZ(s),this.prepend3x3(n.EP)}prependScale(t,e,s){let i=this.AK;i[0]*=t,i[1]*=e,i[2]*=s,i[4]*=t,i[5]*=e,i[6]*=s,i[8]*=t,i[9]*=e,i[10]*=s,i[12]*=t,i[13]*=e,i[14]*=s}prependScaleXY(t,e){this.AK[0]*=t,this.AK[1]*=e,this.AK[4]*=t,this.AK[5]*=e,this.AK[8]*=t,this.AK[9]*=e,this.AK[12]*=t,this.AK[13]*=e}prependTranslationXYZ(t,e,s){n.EP.identity(),this.prepend(n.EP)}prependTranslation(t){n.EP.identity(),this.prepend(n.EP)}recompose(t,e){if(t.length<3||0==t[2].x||0==t[2].y||0==t[2].z)return!1;this.identity();let s=n.EP.getFS32();s[0]=s[1]=s[2]=t[2].x,s[4]=s[5]=s[6]=t[2].y,s[8]=s[9]=s[10]=t[2].z;let i=this.AK;switch(e){case h.default.EULER_ANGLES:{let e=Math.cos(t[1].x),r=Math.cos(t[1].y),a=Math.cos(t[1].z),h=Math.sin(t[1].x),n=Math.sin(t[1].y),l=Math.sin(t[1].z);i[0]=r*a*s[0],i[1]=r*l*s[1],i[2]=-n*s[2],i[3]=0,i[4]=(h*n*a-e*l)*s[4],i[5]=(h*n*l+e*a)*s[5],i[6]=h*r*s[6],i[7]=0,i[8]=(e*n*a+h*l)*s[8],i[9]=(e*n*l-h*a)*s[9],i[10]=e*r*s[10],i[11]=0,i[12]=t[0].x,i[13]=t[0].y,i[14]=t[0].z,i[15]=1}break;default:{let r=t[1].x,a=t[1].y,n=t[1].z,l=t[1].w;if(e==h.default.AXIS_ANGLE){let t=.5*l;r*=Math.sin(t),a*=Math.sin(t),n*=Math.sin(t),l=Math.cos(t)}i[0]=(1-2*a*a-2*n*n)*s[0],i[1]=(2*r*a+2*l*n)*s[1],i[2]=(2*r*n-2*l*a)*s[2],i[3]=0,i[4]=(2*r*a-2*l*n)*s[4],i[5]=(1-2*r*r-2*n*n)*s[5],i[6]=(2*a*n+2*l*r)*s[6],i[7]=0,i[8]=(2*r*n+2*l*a)*s[8],i[9]=(2*a*n-2*l*r)*s[9],i[10]=(1-2*r*r-2*a*a)*s[10],i[11]=0,i[12]=t[0].x,i[13]=t[0].y,i[14]=t[0].z,i[15]=1}break}return 0==t[2].x&&(this.AK[0]=0),0==t[2].y&&(this.AK[5]=0),0==t[2].z&&(this.AK[10]=0),s=null,!0}setThreeAxes(t,e,s){let i=this.AK;i[0]=t.x,i[1]=t.y,i[2]=t.z,i[4]=e.x,i[5]=e.y,i[6]=e.z,i[8]=s.x,i[9]=s.y,i[10]=s.z}deltaTransformVector(t){let e=t.x,s=t.y,i=t.z;return new a.default(e*this.AK[0]+s*this.AK[4]+i*this.AK[8],e*this.AK[1]+s*this.AK[5]+i*this.AK[9],e*this.AK[2]+s*this.AK[6]+i*this.AK[10],0)}deltaTransformVectorSelf(t){let e=this.AK,s=t.x,i=t.y,r=t.z;t.x=s*e[0]+i*e[4]+r*e[8],t.y=s*e[1]+i*e[5]+r*e[9],t.z=s*e[2]+i*e[6]+r*e[10]}deltaTransformOutVector(t,e){let s=this.AK;e.x=t.x*s[0]+t.y*s[4]+t.z*s[8],e.y=t.x*s[1]+t.y*s[5]+t.z*s[9],e.z=t.x*s[2]+t.y*s[6]+t.z*s[10]}transformVector(t){let e=this.AK,s=t.x,i=t.y,r=t.z;return new a.default(s*e[0]+i*e[4]+r*e[8]+e[12],s*e[1]+i*e[5]+r*e[9]+e[13],s*e[2]+i*e[6]+r*e[10]+e[14],s*e[3]+i*e[7]+r*e[11]+e[15])}transformOutVector(t,e){let s=t.x,i=t.y,r=t.z,a=this.AK;e.setTo(s*a[0]+i*a[4]+r*a[8]+a[12],s*a[1]+i*a[5]+r*a[9]+a[13],s*a[2]+i*a[6]+r*a[10]+a[14],s*a[3]+i*a[7]+r*a[11]+a[15])}transformOutVector3(t,e){let s=this.AK;e.x=t.x*s[0]+t.y*s[4]+t.z*s[8]+s[12],e.y=t.x*s[1]+t.y*s[5]+t.z*s[9]+s[13],e.z=t.x*s[2]+t.y*s[6]+t.z*s[10]+s[14]}transformVector3Self(t){let e=t.x,s=t.y,i=t.z,r=this.AK;t.x=e*r[0]+s*r[4]+i*r[8]+r[12],t.y=e*r[1]+s*r[5]+i*r[9]+r[13],t.z=e*r[2]+s*r[6]+i*r[10]+r[14]}transformVectorSelf(t){let e=t.x,s=t.y,i=t.z,r=this.AK;t.setTo(e*r[0]+s*r[4]+i*r[8]+r[12],e*r[1]+s*r[5]+i*r[9]+r[13],e*r[2]+s*r[6]+i*r[10]+r[14],e*r[3]+s*r[7]+i*r[11]+r[15])}transformVectors(t,e,s){let i,r,a,h=0,n=this.AK;e-=3;while(h<=e)i=t[h],r=t[h+1],a=t[h+2],s[h]=i*n[0]+r*n[4]+a*n[8]+n[12],s[h+1]=i*n[1]+r*n[5]+a*n[9]+n[13],s[h+2]=i*n[2]+r*n[6]+a*n[10]+n[14],h+=3}transformVectorsSelf(t,e){let s,i,r,a=0,h=this.AK;e-=3;while(a<=e)s=t[a],i=t[a+1],r=t[a+2],t[a]=s*h[0]+i*h[4]+r*h[8]+h[12],t[a+1]=s*h[1]+i*h[5]+r*h[9]+h[13],t[a+2]=s*h[2]+i*h[6]+r*h[10]+h[14],a+=3}transformVectorsRangeSelf(t,e,s){let i,r,a,h=e,n=this.AK;s-=3;while(h<=s)i=t[h],r=t[h+1],a=t[h+2],t[h]=i*n[0]+r*n[4]+a*n[8]+n[12],t[h+1]=i*n[1]+r*n[5]+a*n[9]+n[13],t[h+2]=i*n[2]+r*n[6]+a*n[10]+n[14],h+=3}transpose(){n.EP.copyFrom(this);let t=n.EP.getFS32(),e=this.AK;e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11]}interpolateTo(t,e){let s=t.getFS32(),i=t.getFSIndex(),r=0,a=this.AI;while(r<16)this.AJ[a]+=(s[i+r]-this.AJ[a])*e,++a,++r}getAxisRotation(t,e,s,i){i=-i;let r=this.AK,a=Math.sin(i),h=Math.cos(i),n=1-h;r[0]=h+t*t*n,r[5]=h+e*e*n,r[10]=h+s*s*n;let l=t*e*n,_=s*a;r[4]=l+_,r[1]=l-_,l=t*s*n,_=e*a,r[8]=l-_,r[2]=l+_,l=e*s*n,_=t*a,r[9]=l+_,r[6]=l-_}rotationX(t){let e=Math.sin(t),s=Math.cos(t);this.AK[0]=1,this.AK[1]=0,this.AK[2]=0,this.AK[4]=0,this.AK[5]=s,this.AK[6]=e,this.AK[8]=0,this.AK[9]=-e,this.AK[10]=s}rotationY(t){let e=Math.sin(t),s=Math.cos(t);this.AK[0]=s,this.AK[1]=0,this.AK[2]=-e,this.AK[4]=0,this.AK[5]=1,this.AK[6]=0,this.AK[8]=e,this.AK[9]=0,this.AK[10]=s}rotationZ(t){let e=Math.sin(t),s=Math.cos(t);this.AK[0]=s,this.AK[1]=e,this.AK[2]=0,this.AK[4]=-e,this.AK[5]=s,this.AK[6]=0,this.AK[8]=0,this.AK[9]=0,this.AK[10]=1}toString(){let t="\n"+this.AK[0]+","+this.AK[1]+","+this.AK[2]+","+this.AK[3]+"\n";return t+=this.AK[4]+","+this.AK[5]+","+this.AK[6]+","+this.AK[7]+"\n",t+=this.AK[8]+","+this.AK[9]+","+this.AK[10]+","+this.AK[11]+"\n",t+=this.AK[12]+","+this.AK[13]+","+this.AK[14]+","+this.AK[15]+"\n",t}transformPerspV4Self(t){t.w=t.z,t.x*=this.AK[0],t.y*=this.AK[5],t.z*=this.AK[10],t.z+=this.AK[14],t.w*=this.AK[11],t.w+=this.AK[15]}perspectiveRH(t,e,s,i){let r=Math.tan(.5*t);this.identity(),this.AK[0]=1/(e*r),this.AK[5]=1/r,this.AK[10]=-(i+s)/(i-s),this.AK[11]=-1,this.AK[14]=-2*i*s/(i-s)}perspectiveRH2(t,e,s,i,r){let a=e/Math.tan(.5*t),h=a/e,n=a/s,l=-r/(r-i),_=-i*l;this.identity(),this.AK[0]=h,this.AK[5]=n,this.AK[10]=l,this.AK[11]=-1,this.AK[14]=_}orthoRH(t,e,s,i,r,a){this.identity(),this.AK[0]=2/(i-s),this.AK[5]=2/(e-t),this.AK[10]=-2/(a-r),this.AK[12]=-(i+s)/(i-s),this.AK[13]=-(e+t)/(e-t),this.AK[14]=-(a+r)/(a-r),this.AK[15]=1}perspectiveLH(t,e,s,i){let r=Math.tan(.5*t);this.identity(),this.AK[0]=1/(e*r),this.AK[5]=1/r,this.AK[10]=(i+s)/(i-s),this.AK[11]=1,this.AK[14]=2*i*s/(i-s)}orthoLH(t,e,s,i,r,a){this.identity(),this.AK[0]=2/(i-s),this.AK[5]=2/(e-t),this.AK[10]=2/(a-r),this.AK[12]=-(i+s)/(i-s),this.AK[13]=-(e+t)/(e-t),this.AK[14]=-(a+r)/(a-r),this.AK[15]=1}lookAtRH(t,e,s){this.identity();let i=e.subtract(t);i.normalize();let r=i.crossProduct(s);r.normalize();let a=r.crossProduct(i);r.w=-r.dot(t),a.w=-a.dot(t),i.w=i.dot(t),i.negate(),this.copyRowFrom(0,r),this.copyRowFrom(1,a),this.copyRowFrom(2,i)}lookAtLH(t,e,s){this.identity();let i=e.subtract(t);i.normalize();let r=i.crossProduct(s);r.normalize();let a=r.crossProduct(i);r.w=-r.dot(t),a.w=-a.dot(t),i.w=-i.dot(t),this.copyRowFrom(0,r),this.copyRowFrom(1,a),this.copyRowFrom(2,i)}destroy(){this.AK=null,this.AJ=null,this.AI=-1}}n.EQ=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),n.EM=0,n.ER=327679,n.EP=new n,e.default=n},"1e15":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8a0a")),a=i(s("030e"));class h{constructor(){this.A=0,this.AL=2,this.AM=null,this.RGBA=0,this.UNSIGNED_BYTE=0,this.TRIANGLE_STRIP=0,this.TRIANGLE_FAN=0,this.TRIANGLES=0,this.LINES=0,this.LINE_STRIP=0,this.UNSIGNED_SHORT=0,this.UNSIGNED_INT=0,this.COLOR=0,this.DEPTH=0,this.STENCIL=0,this.DEPTH_STENCIL=0,this.MAX=0,this.MIN=0,this.RContext=null,this.vroUid=0,this.rioUid=0}getRC(){return this.AM}getRCUid(){return this.A}createBuf(){return this.AM.createBuffer()}deleteBuf(t){this.AM.deleteBuffer(t)}bindArrBuf(t){this.AM.bindBuffer(this.AM.ARRAY_BUFFER,t)}bindEleBuf(t){this.AM.bindBuffer(this.AM.ELEMENT_ARRAY_BUFFER,t)}arrBufSubData(t,e){this.AM.bufferSubData(this.AM.ARRAY_BUFFER,e,t)}arrBufData(t,e){this.AM.bufferData(this.AM.ARRAY_BUFFER,t,r.default.ToGL(this.AM,e))}eleBufSubData(t,e){this.AM.bufferSubData(this.AM.ELEMENT_ARRAY_BUFFER,e,t)}eleBufData(t,e){this.AM.bufferData(this.AM.ELEMENT_ARRAY_BUFFER,t,r.default.ToGL(this.AM,e))}arrBufDataMem(t,e){this.AM.bufferData(this.AM.ARRAY_BUFFER,t,r.default.ToGL(this.AM,e))}eleBufDataMem(t,e){this.AM.bufferData(this.AM.ELEMENT_ARRAY_BUFFER,t,r.default.ToGL(this.AM,e))}useVtxAttribsPtrTypeFloat(t,e,s,i,r,a){this.AM.bindBuffer(this.AM.ARRAY_BUFFER,e);for(let h=0;h<i;++h)t.vertexAttribPointerTypeFloat(s[h],a,r[h])}useVtxAttribsPtrTypeFloatMulti(t,e,s,i,r,a){for(let h=0;h<i;++h)this.AM.bindBuffer(this.AM.ARRAY_BUFFER,e[h]),t.vertexAttribPointerTypeFloat(s[h],a,r[h])}createVertexArray(){let t=null;return t=2==this.AL?this.AM.createVertexArray():a.default.OES_vertex_array_object.createVertexArrayOES(),t}bindVertexArray(t){return 2==this.AL?this.AM.bindVertexArray(t):a.default.OES_vertex_array_object.bindVertexArrayOES(t),t}deleteVertexArray(t){2==this.AL?this.AM.deleteVertexArray(t):a.default.OES_vertex_array_object.deleteVertexArrayOES(t)}testVROUid(t){return this.vroUid!=t&&(this.vroUid=t,!0)}testRIOUid(t){return this.rioUid!=t&&(this.rioUid=t,!0)}initialize(t,e,s){this.AM=e,this.A=t,this.AL=s;let i=this;i.RGBA=e.RGBA,i.UNSIGNED_BYTE=e.UNSIGNED_BYTE,i.TRIANGLE_STRIP=e.TRIANGLE_STRIP,i.TRIANGLE_FAN=e.TRIANGLE_FAN,i.TRIANGLES=e.TRIANGLES,i.LINES=this.AM.LINES,i.LINE_STRIP=e.LINE_STRIP,i.UNSIGNED_SHORT=e.UNSIGNED_SHORT,i.UNSIGNED_INT=e.UNSIGNED_INT,i.COLOR=e.COLOR,i.DEPTH=e.DEPTH,i.STENCIL=e.STENCIL,i.DEPTH_STENCIL=e.DEPTH_STENCIL,this.AL>1?(i.MIN=e.MIN,i.MAX=e.MAX):(i.MIN=a.default.EXT_blend_minmax.MIN_EXT,i.MAX=a.default.EXT_blend_minmax.MAX_EXT),i.RContext=e}renderBegin(){this.vroUid=-2,this.rioUid=-3}}e.default=h},"1eb2":function(t,e,s){"use strict";if("undefined"!==typeof window){var i=window.document.currentScript,r=s("8875");i=r(),"currentScript"in document||Object.defineProperty(document,"currentScript",{get:r});var a=i&&i.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);a&&(s.p=a[1])}},"20ef":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=i(s("8a0a"));class h{constructor(t){this.Q_=null,this.T=-1,this.AN=null,this.A=-1,this.s=null,this.AO="",this.AP=0,this.AQ=null,this.AR=null,this.AS=null,this.AT=null,this.AU=null,this.AV=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],this.AW=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],this.AX=null,this.AY=new Map,this.AZ=new Map,this.Aa=null,this.Ab=null,this.dataUniformEnabled=!1,this.Ac=0,this.Ad=0,this.Ae=null,this.Af=0,this.T=t}setShdData(t){this.Q_=t,this.AO=t.getUniqueShaderName()}getUid(){return this.T}getTexTotal(){return this.Q_.getTexTotal()}useTexLocation(){for(let t=0;t<this.AP;t++)this.s.uniform1i(this.AU[t],t)}haveTexture(){return this.Q_.haveTexture()}createLocations(){let t=0,e=0,s=this.Q_.getAttriNSList();if(null!=s&&s.length>0&&null==this.AQ){this.dataUniformEnabled=!1;let i=this.Q_.getAttriSizeList();this.AQ=[],this.AR=[],this.AS=[],e=s.length;let h=0,n=0;while(t<e)n=this.s.getAttribLocation(this.AN,s[t]),this.AQ.push(n),h=a.default.GetVBufAttributeTypeByNS(s[t]),this.AR.push(h),this.AS.push(i[t]),this.AV[h]=n,this.AW[h]=i[t],this.dataUniformEnabled=!0,++t;for(this.AX=[],t=0;t<this.AW.length;++t)this.AW[t]>0&&this.AX.push(this.AW[t]);r.default.SHADERCODE_TRACE_ENABLED}if(this.Q_.haveCommonUniform()&&null==this.AT){let s=this.Q_.getUniforms();this.AT=[],e=s.length,t=0;let i=null,a="";while(t<e)s[t].isTex||(a=s[t].name,i=this.s.getUniformLocation(this.AN,a),r.default.SHADERCODE_TRACE_ENABLED,null!=i?(i.uniformName=a,i.uniqueName=this.AO,s[t].location=i,this.AY.set(a,s[t]),this.AZ.set(a,i),this.AT.push(i),this.dataUniformEnabled=!0):r.default.SHADERCODE_TRACE_ENABLED),++t}if(this.AP=this.Q_.getTexTotal(),this.AP>0){this.AU=new Array(this.AP);let e=this.Q_.getTexUniformNames();for(t=0;t<this.AP;++t)e[t]="u_sampler"+t,this.AU[t]=this.s.getUniformLocation(this.AN,e[t])}}getLayoutBit(){return this.Q_.getLayoutBit()}getMid(){return this.Q_.getMid()}getFragOutputTotal(){return this.Q_.getFragOutputTotal()}getLocationsTotal(){return this.AR.length}getLocationTypeByIndex(t){return this.AR[t]}getLocationSizeByIndex(t){return this.AS[t]}testVertexAttribPointerOffset(t){let e=!1;if(null!=t&&null!=this.AX&&t.length>=this.AX.length){let s=0,i=0;for(;i<this.AX.length;++i){if(s!=t[i])break;s+=4*this.AX[i]}e=i>=this.AX.length}if(!e)throw Error("Shader program vertx attributes layout can not match float attribute vertex data !!!");return e}vertexAttribPointerType(t,e,s,i,r,a){this.Ac=this.AV[t],this.Ac>-1&&(this.s.enableVertexAttribArray(this.Ac),this.s.vertexAttribPointer(this.Ac,this.AW[t],s,i,r,a))}vertexAttribPointerTypeFloat(t,e,s){this.Ac=this.AV[t],this.Ac>-1&&(this.s.enableVertexAttribArray(this.Ac),this.s.vertexAttribPointer(this.Ac,this.AW[t],this.s.FLOAT,!1,e,s))}testVertexAttribPointerType(t){return this.AV[t]>-1}getVertexAttribByTpye(t){return this.AV[t]}vertexAttribPointerAt(t,e,s,i,r,a){this.Ad=t,this.Ac=this.AQ[t],this.Ac>-1&&(this.s.enableVertexAttribArray(this.Ac),this.s.vertexAttribPointer(this.Ac,e,s,i,r,a))}vertexAttribPointerNext(t,e,s,i,r){this.Ac=this.AQ[this.Ad],this.Ac>-1&&(this.s.enableVertexAttribArray(this.Ac),this.s.vertexAttribPointer(this.Ac,t,e,s,i,r)),this.Ad++}vertexAttribPointerFirst(t,e,s,i,r){this.Ad=1,this.Ac=this.AQ[0],this.Ac>-1&&(this.s.enableVertexAttribArray(this.Ac),this.s.vertexAttribPointer(this.Ac,t,e,s,i,r))}getUniformLocationAt(t){return this.Af=t+1,this.AT[t]}getUniformLocationNext(){return this.Ae=this.AT[this.Af++],this.Ae}getUniformLocationFirst(){return this.Af=1,this.AT[0]}getUniformLocationByNS(t){return this.AZ.get(t)}getUniformTypeNameByNS(t){return this.AY.has(t)?this.AY.get(t).typeName:""}getUniformTypeByNS(t){return this.AY.has(t)?this.AY.get(t).type:0}hasUniformByName(t){return this.AY.has(t)}getUniformLengthByNS(t){return this.AY.has(t)?this.AY.get(t).arrLength:0}initShdProgram(){let t,e=this.Q_.getVSCodeStr(),s=this.Q_.getFSCodeStr();null==this.Q_.preCompileInfo&&r.default.VERT_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED&&(e.indexOf(" mediump ")>=0&&(t=new RegExp(" mediump ","g"),e=e.replace(t," highp ")),e.indexOf(" lowp ")>=0&&(t=new RegExp(" lowp ","g"),e=e.replace(t," highp "))),r.default.SHADERCODE_TRACE_ENABLED;let i=this.loadShader(this.s.VERTEX_SHADER,e);null==this.Q_.preCompileInfo&&r.default.FRAG_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED&&(s.indexOf(" mediump ")>=0&&(t=new RegExp(" mediump ","g"),s=s.replace(t," highp ")),s.indexOf(" lowp ")>=0&&(t=new RegExp(" lowp ","g"),s=s.replace(t," highp "))),r.default.SHADERCODE_TRACE_ENABLED;let a=this.loadShader(this.s.FRAGMENT_SHADER,s),h=this.s.createProgram();return this.s.attachShader(h,a),this.s.attachShader(h,i),this.s.linkProgram(h),this.s.getProgramParameter(h,this.s.LINK_STATUS)?(this.Aa=i,this.Ab=a,h):(r.default.SHADERCODE_TRACE_ENABLED,null)}loadShader(t,e){let s=this.s.createShader(t);return this.s.shaderSource(s,e),this.s.compileShader(s),this.s.getShaderParameter(s,this.s.COMPILE_STATUS)?s:(r.default.SHADERCODE_TRACE_ENABLED,this.s.deleteShader(s),null)}getUniqueShaderName(){return this.AO}enabled(){return null!=this.AN}upload(t,e){null==this.AN&&(this.A=e,this.s=t,this.AN=this.initShdProgram(),this.AN.uniqueName=this.AO,null!=this.AN&&this.createLocations())}getRCUid(){return this.A}uniformBlockBinding(t,e){this.s.uniformBlockBinding(this.AN,this.s.getUniformBlockIndex(this.AN,t),e)}toString(){return"[ShdProgram(uniqueName = "+this.AO+")]"}getGPUProgram(){return this.AN}destroy(){this.AQ=null,this.AX=null,this.AP>0&&(this.AU.fill(null),this.AP=0),null!=this.AN&&(this.s.deleteShader(this.Aa),this.s.deleteShader(this.Ab),this.Aa=null,this.Ab=null,this.s.deleteProgram(this.AN),this.AN=null),this.s=null,this.Q_=null}}e.default=h},2139:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("18c7"));class a{static GetMatTotal(){return a.EU}static GetFS32Arr(){return a.ES}static SetFS32Arr(t){a.ES=t;let e=a.EU,s=a.ET;for(let i=0;i<e;++i)s[i].setF32Arr(t)}static GetFreeId(){return a.Ag.length>0?a.Ag.pop():-1}static Allocate(t){if(t<1024&&(t=1024),a.EU<1){a.EU=t,a.ES=new Float32Array(16*t);let e=0,s=new r.default(a.ES,16*e),i=s.getUid();for(a.EV=i,a.EW=i+t;e<i;++e)a.ET.push(null),a.EX.push(a.Eq);for(a.ET.push(s),a.EX.push(a.Eq),a.Ag.push(s.getUid()),e=1;e<t;++e)s=new r.default(a.ES,16*e),a.ET.push(s),a.EX.push(a.Eq),a.Ag.push(s.getUid())}}static GetMatrix(){let t=null,e=a.GetFreeId()-a.EV;return e>=0?(t=a.ET[e],t.identity(),a.EX[e]=a.EY):t=new r.default,t}static RetrieveMatrix(t){if(null!=t){let e=t.getUid();e>=a.EV&&e<a.EW&&a.EX[e-a.EV]==a.EY&&(a.Ag.push(e),a.EX[e-a.EV]=a.Eq)}}}a.EY=1,a.Eq=0,a.ET=[],a.EX=[],a.Ag=[],a.ES=null,a.EV=0,a.EW=0,a.EU=0,e.default=a},2560:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("ab73"));class a{create(t,e){let s=t.getCamera();return e.hasUniformByName(r.default.CameraViewMatUNS)&&e.hasUniformByName(r.default.CameraProjectiveMatUNS)?t.uniformContext.createShaderGlobalUniformFromProbe(s.matUProbe,"u_viewAndProjMat",[r.default.CameraViewMatUNS,r.default.CameraProjectiveMatUNS]):e.hasUniformByName(r.default.CameraViewMatUNS)?t.uniformContext.createShaderGlobalUniformFromProbeAt(s.matUProbe,"u_viewMat",[r.default.CameraViewMatUNS],0):e.hasUniformByName(r.default.CameraProjectiveMatUNS)?t.uniformContext.createShaderGlobalUniformFromProbeAt(s.matUProbe,"u_projMat",[r.default.CameraProjectiveMatUNS],1):null}getIDNS(){return"CameraUniformBuilder"}}e.default=a},"264c":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t){this.Ah=null,this.Ai=null,this.Aj=null,this.Ak=null,this.Al=[],this.Am=0,this.An=null,this.Ao=0,this.Ap=null,this.sortEnabled=!0,this.An=t}setSorter(t){this.Ap=t}showInfo(){let t="",e=this.Ah;while(null!=e)t+=e.unit.value+",",e=e.next}clear(){if(null!=this.An){this.Al.length>0&&(this.Al=[]);let t=this.Ah,e=null;while(null!=t)e=t,t=t.next,e.prev=null,e.next=null;this.Ah=this.Ai=null,this.Am=0,this.Ao=0,this.sortEnabled=!0,this.An=null}this.Ap=null}update(){this.sortEnabled&&this.sort()}run(t){this.An.resetUniform();let e=null,s=this.Al;for(let i=0;i<this.Ao;++i)e=s[i],this.An.bindToGpu(e.shdUid),e.run(t),e.partTotal<1?e.drawThis(t):e.drawPart(t)}runLockMaterial(t){this.An.resetUniform();let e=null,s=this.Al;for(let i=0;i<this.Ao;++i)e=s[i],this.An.bindToGpu(e.shdUid),e.vro.run(),e.runLockMaterial2(null),e.partTotal<1?e.drawThis(t):e.drawPart(t)}sort(){if(this.Am>0){let t=this.Ah;this.Al.length<this.Am&&(this.Al=new Array(Math.round(1.1*this.Am)+1));let e=0;while(null!=t)t.drawEnabled&&t.unit.drawEnabled&&(this.Al[e]=t.unit,++e),t=t.next;this.Ao=e;let s=0;null!=this.Ap&&(s=this.Ap.sortRODisplay(this.Al,e)),s<1&&this.snsort(0,e-1)}}sorting(t,e){let s=this.Al;this.Ak=s[t];let i=this.Ak.value;while(t<e){while(t<e&&s[e].value>=i)--e;s[t]=s[e];while(t<e&&s[t].value<=i)++t;s[e]=s[t]}return s[t]=this.Ak,t}snsort(t,e){if(t<e){let s=this.sorting(t,e);this.snsort(t,s-1),this.snsort(s+1,e)}}getNodesTotal(){return this.Am}getBegin(){return this.Aj=this.Ah,this.Ah}getNext(){return null!=this.Aj&&(this.Aj=this.Aj.next),this.Aj}isEmpty(){return this.Am<1}addNode(t){null==t.prev&&null==t.next&&(null==this.Ah?this.Ai=this.Ah=t:null!=this.Ai.prev?(this.Ai.next=t,t.prev=this.Ai,this.Ai=t):(this.Ah.next=t,t.prev=this.Ai,this.Ai=t),this.Ai.next=null,this.Am++)}removeNode(t){null==t.prev&&null==t.next&&t!=this.Ah||(t==this.Ah?t==this.Ai?this.Ah=this.Ai=null:(this.Ah=t.next,this.Ah.prev=null):t==this.Ai?(this.Ai=t.prev,this.Ai.next=null):(t.next.prev=t.prev,t.prev.next=t.next),t.prev=null,t.next=null,this.Am--)}}e.default=i},"265e":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.__$ruid=-1,this.drawEnabled=!0,this.uid=-1,this.index=-1,this.drawMode=0,this.ivsIndex=0,this.ivsCount=0,this.insCount=0,this.shdUid=-1,this.vtxUid=-1,this.texMid=-1,this.rtokey=-1,this.prev=null,this.next=null,this.unit=null,this.vro=null,this.tro=null,this.rvroI=-1,this.rtroI=-1}setValue(t){this.unit.value=t}isVsible(){return null==this.unit||this.unit.drawEnabled}updateData(){let t=this.unit;this.drawMode=t.drawMode,this.ivsIndex=t.ivsIndex,this.ivsCount=t.ivsCount,this.insCount=t.insCount,t.drawOffset=t.ivsIndex*t.ibufStep,this.vtxUid=t.vtxUid,this.vro=t.vro,this.shdUid=t.shdUid,this.texMid=t.texMid,this.tro=t.tro}reset(){this.drawEnabled=!0,this.uid=-1,this.index=-1,this.drawMode=0,this.ivsIndex=0,this.ivsCount=0,this.insCount=0,this.shdUid=-1,this.vtxUid=-1,this.texMid=-1,this.rtokey=-1,this.unit=null,this.vro=null,this.tro=null,this.prev=null,this.next=null}toString(){return"[Object RPONode(uid = "+this.uid+", index = "+this.index+", shdUid = "+this.shdUid+", vtxUid = "+this.vtxUid+")]"}}e.default=i},"278e":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.Aq=null,this.Ar=null,this.slideSpeed=2,this.H_=0,this.I_=0,this.As=!1}initialize(t,e){null==this.Aq&&(this.Aq=t,this.Ar=e)}attach(){this.H_=this.Aq.mouseX,this.I_=this.Aq.mouseY,this.As=!0}detach(){this.As=!1}run(){if(this.As){let t=(this.H_-this.Aq.mouseX)*this.slideSpeed,e=(this.I_-this.Aq.mouseY)*this.slideSpeed;this.Ar.slideViewOffsetXY(t,e),this.H_=this.Aq.mouseX,this.I_=this.Aq.mouseY}}}e.CameraDragSlide=i},"29ef":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("070b"),r=s("a5ba"),a=s("e08e");class h{static Initialize(t,e){if(h.EZ){h.EZ=!1;let s=h;s.Rstate=t,s.VRO=e,i.RenderColorMask.Rstate=t,r.RenderStateObject.Rstate=t,s.COLOR_MASK_ALL_TRUE=i.RenderColorMask.Create("all_true",!0,!0,!0,!0),s.COLOR_MASK_ALL_FALSE=i.RenderColorMask.Create("all_false",!1,!1,!1,!1),s.COLOR_MASK_RED_TRUE=i.RenderColorMask.Create("red_true",!0,!1,!1,!1),s.COLOR_MASK_GREEN_TRUE=i.RenderColorMask.Create("green_true",!1,!0,!1,!1),s.COLOR_MASK_BLUE_TRUE=i.RenderColorMask.Create("blue_true",!1,!1,!0,!1),s.COLOR_MASK_ALPHA_TRUE=i.RenderColorMask.Create("alpha_true",!1,!1,!1,!0),s.COLOR_MASK_RED_FALSE=i.RenderColorMask.Create("red_false",!1,!0,!0,!0),s.COLOR_MASK_GREEN_FALSE=i.RenderColorMask.Create("green_false",!0,!1,!0,!0),s.COLOR_MASK_BLUE_FALSE=i.RenderColorMask.Create("blue_false",!0,!0,!1,!0),s.COLOR_MASK_ALPHA_FALSE=i.RenderColorMask.Create("alpha_false",!0,!0,!0,!1);let n=r.RenderStateObject,l=a.RenderBlendMode;l.NORMAL=n.CreateBlendMode("NORMAL",a.GLBlendMode.ONE,a.GLBlendMode.ZERO,a.GLBlendEquation.FUNC_ADD),l.OPAQUE=n.CreateBlendMode("OPAQUE",a.GLBlendMode.ONE,a.GLBlendMode.ZERO,a.GLBlendEquation.FUNC_ADD),l.TRANSPARENT=n.CreateBlendMode("TRANSPARENT",a.GLBlendMode.SRC_ALPHA,a.GLBlendMode.ONE_MINUS_SRC_ALPHA,a.GLBlendEquation.FUNC_ADD),l.ALPHA_ADD=n.CreateBlendMode("ALPHA_ADD",a.GLBlendMode.ONE,a.GLBlendMode.ONE_MINUS_SRC_ALPHA,a.GLBlendEquation.FUNC_ADD),l.ADD=n.CreateBlendMode("ADD",a.GLBlendMode.SRC_ALPHA,a.GLBlendMode.ONE,a.GLBlendEquation.FUNC_ADD),l.ADD_LINEAR=n.CreateBlendMode("ADD_LINEAR",a.GLBlendMode.ONE,a.GLBlendMode.ONE,a.GLBlendEquation.FUNC_ADD),l.INVERSE_ALPHA=n.CreateBlendMode("INVERSE_ALPHA",a.GLBlendMode.ONE,a.GLBlendMode.SRC_ALPHA,a.GLBlendEquation.FUNC_ADD),l.BLAZE=n.CreateBlendMode("BLAZE",a.GLBlendMode.SRC_COLOR,a.GLBlendMode.ONE,a.GLBlendEquation.FUNC_ADD),l.OVERLAY=n.CreateBlendMode("OVERLAY",a.GLBlendMode.DST_COLOR,a.GLBlendMode.DST_ALPHA,a.GLBlendEquation.FUNC_ADD),l.OVERLAY2=n.CreateBlendMode("OVERLAY2",a.GLBlendMode.DST_COLOR,a.GLBlendMode.SRC_ALPHA,a.GLBlendEquation.FUNC_ADD),s.NORMAL_STATE=n.Create("normal",a.CullFaceMode.BACK,a.RenderBlendMode.NORMAL,a.DepthTestMode.OPAQUE),s.BACK_CULLFACE_NORMAL_STATE=s.NORMAL_STATE,s.FRONT_CULLFACE_NORMAL_STATE=n.Create("front_normal",a.CullFaceMode.FRONT,a.RenderBlendMode.NORMAL,a.DepthTestMode.OPAQUE),s.NONE_CULLFACE_NORMAL_STATE=n.Create("none_normal",a.CullFaceMode.NONE,a.RenderBlendMode.NORMAL,a.DepthTestMode.OPAQUE),s.ALL_CULLFACE_NORMAL_STATE=n.Create("all_cull_normal",a.CullFaceMode.FRONT_AND_BACK,a.RenderBlendMode.NORMAL,a.DepthTestMode.OPAQUE),s.BACK_NORMAL_ALWAYS_STATE=n.Create("back_normal_always",a.CullFaceMode.BACK,a.RenderBlendMode.NORMAL,a.DepthTestMode.ALWAYS),s.BACK_TRANSPARENT_STATE=n.Create("back_transparent",a.CullFaceMode.BACK,a.RenderBlendMode.TRANSPARENT,a.DepthTestMode.TRANSPARENT_SORT),s.BACK_TRANSPARENT_ALWAYS_STATE=n.Create("back_transparent_always",a.CullFaceMode.BACK,a.RenderBlendMode.TRANSPARENT,a.DepthTestMode.ALWAYS),s.NONE_TRANSPARENT_STATE=n.Create("none_transparent",a.CullFaceMode.NONE,a.RenderBlendMode.TRANSPARENT,a.DepthTestMode.TRANSPARENT_SORT),s.NONE_TRANSPARENT_ALWAYS_STATE=n.Create("none_transparent_always",a.CullFaceMode.NONE,a.RenderBlendMode.TRANSPARENT,a.DepthTestMode.ALWAYS),s.FRONT_CULLFACE_GREATER_STATE=n.Create("front_greater",a.CullFaceMode.FRONT,a.RenderBlendMode.NORMAL,a.DepthTestMode.TRUE_GREATER),s.BACK_ADD_BLENDSORT_STATE=n.Create("back_add_blendSort",a.CullFaceMode.BACK,a.RenderBlendMode.ADD,a.DepthTestMode.TRANSPARENT_SORT),s.BACK_ADD_ALWAYS_STATE=n.Create("back_add_always",a.CullFaceMode.BACK,a.RenderBlendMode.ADD,a.DepthTestMode.ALWAYS),s.BACK_ALPHA_ADD_ALWAYS_STATE=n.Create("back_alpha_add_always",a.CullFaceMode.BACK,a.RenderBlendMode.ALPHA_ADD,a.DepthTestMode.ALWAYS),s.NONE_ADD_ALWAYS_STATE=n.Create("none_add_always",a.CullFaceMode.NONE,a.RenderBlendMode.ADD,a.DepthTestMode.ALWAYS),s.NONE_ADD_BLENDSORT_STATE=n.Create("none_add_blendSort",a.CullFaceMode.NONE,a.RenderBlendMode.ADD,a.DepthTestMode.TRANSPARENT_SORT),s.NONE_ALPHA_ADD_ALWAYS_STATE=n.Create("none_alpha_add_always",a.CullFaceMode.NONE,a.RenderBlendMode.ALPHA_ADD,a.DepthTestMode.ALWAYS),s.FRONT_ADD_ALWAYS_STATE=n.Create("front_add_always",a.CullFaceMode.FRONT,a.RenderBlendMode.ADD,a.DepthTestMode.ALWAYS),s.FRONT_TRANSPARENT_STATE=n.Create("front_transparent",a.CullFaceMode.FRONT,a.RenderBlendMode.TRANSPARENT,a.DepthTestMode.TRANSPARENT_SORT),s.FRONT_TRANSPARENT_ALWAYS_STATE=n.Create("front_transparent_always",a.CullFaceMode.FRONT,a.RenderBlendMode.TRANSPARENT,a.DepthTestMode.ALWAYS),s.NONE_CULLFACE_NORMAL_ALWAYS_STATE=n.Create("none_normal_always",a.CullFaceMode.NONE,a.RenderBlendMode.NORMAL,a.DepthTestMode.ALWAYS),s.BACK_ALPHA_ADD_BLENDSORT_STATE=n.Create("back_alpha_add_blendSort",a.CullFaceMode.BACK,a.RenderBlendMode.ALPHA_ADD,a.DepthTestMode.TRANSPARENT_SORT)}}static CreateBlendMode(t,e,s,i=0){return r.RenderStateObject.CreateBlendMode(t,e,s,i)}static CreateBlendModeSeparate(t,e,s,i=0,a=0,h=0){return r.RenderStateObject.CreateBlendModeSeparate(t,e,s,i,a,h)}static CreateRenderState(t,e,s,i){return r.RenderStateObject.Create(t,e,s,i)}static CreateRenderColorMask(t,e,s,r,a){return i.RenderColorMask.Create(t,e,s,r,a)}static GetRenderStateByName(t){return r.RenderStateObject.GetRenderStateByName(t)}static GetRenderColorMaskByName(t){return i.RenderColorMask.GetColorMaskByName(t)}static UnlockBlendMode(){r.RenderStateObject.UnlockBlendMode()}static LockBlendMode(t){r.RenderStateObject.LockBlendMode(t)}static UnlockDepthTestMode(){r.RenderStateObject.UnlockDepthTestMode()}static LockDepthTestMode(t){r.RenderStateObject.LockDepthTestMode(t)}static ResetState(){i.RenderColorMask.Reset(),r.RenderStateObject.Reset(),h.Rstate.reset(),h.VRO.__$resetVRO()}static Reset(t){i.RenderColorMask.Reset(),r.RenderStateObject.Reset(),h.Rstate.setRenderContext(t),h.Rstate.reset()}static ResetInfo(){h.DrawCallTimes=0,h.DrawTrisNumber=0,h.POVNumber=0}static SetDepthTestEnable(t){h.Rstate.setDepthTestEnable(t)}static SetBlendEnable(t){h.Rstate.setBlendEnable(t)}}h.EZ=!0,h.VRO=null,h.Rstate=null,h.DrawCallTimes=0,h.DrawTrisNumber=0,h.POVNumber=0,h.COLOR_MASK_ALL_TRUE=0,h.COLOR_MASK_ALL_FALSE=1,h.COLOR_MASK_RED_TRUE=2,h.COLOR_MASK_GREEN_TRUE=3,h.COLOR_MASK_BLUE_TRUE=4,h.COLOR_MASK_ALPHA_TRUE=5,h.COLOR_MASK_RED_FALSE=6,h.COLOR_MASK_GREEN_FALSE=7,h.COLOR_MASK_BLUE_FALSE=8,h.COLOR_MASK_ALPHA_FALSE=9,h.NORMAL_STATE=0,h.BACK_CULLFACE_NORMAL_STATE=0,h.FRONT_CULLFACE_NORMAL_STATE=1,h.NONE_CULLFACE_NORMAL_STATE=2,h.ALL_CULLFACE_NORMAL_STATE=3,h.BACK_NORMAL_ALWAYS_STATE=4,h.BACK_TRANSPARENT_STATE=5,h.BACK_TRANSPARENT_ALWAYS_STATE=6,h.NONE_TRANSPARENT_STATE=7,h.NONE_TRANSPARENT_ALWAYS_STATE=8,h.FRONT_CULLFACE_GREATER_STATE=9,h.BACK_ADD_BLENDSORT_STATE=10,h.BACK_ADD_ALWAYS_STATE=11,h.BACK_ALPHA_ADD_ALWAYS_STATE=12,h.NONE_ADD_ALWAYS_STATE=13,h.NONE_ADD_BLENDSORT_STATE=14,h.NONE_ALPHA_ADD_ALWAYS_STATE=15,h.FRONT_ADD_ALWAYS_STATE=16,h.FRONT_TRANSPARENT_STATE=17,h.FRONT_TRANSPARENT_ALWAYS_STATE=18,h.NONE_CULLFACE_NORMAL_ALWAYS_STATE=19,h.BACK_ALPHA_ADD_BLENDSORT_STATE=20,e.default=h},"2be1":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.Am=0,this.Al=[],this.At=[],this.Ag=[]}createNode(){return null}restoreUid(t){}getFreeId(){return this.Ag.length>0?this.Ag.pop():-1}getNodeByUid(t){return this.Al[t]}create(){let t=null,e=this.getFreeId();return e>=0?(t=this.Al[e],t.uid=e,this.At[e]=i.S_BUSY):(t=this.createNode(),this.Al.push(t),this.At.push(i.S_BUSY),t.uid=this.Am,this.Am++),t}restore(t){return null!=t&&t.uid>=0&&this.At[t.uid]==i.S_BUSY&&(this.restoreUid(t.uid),this.Ag.push(t.uid),this.At[t.uid]=i.S_FREE,t.reset(),!0)}restoreByUid(t){return t>=0&&t<this.Am&&this.At[t]==i.S_BUSY&&(this.restoreUid(t),this.Ag.push(t),this.At[t]=i.S_FREE,this.Al[t].reset(),!0)}}i.S_BUSY=1,i.S_FREE=0,e.default=i},"2e8a":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8a0a")),a=i(s("644c"));class h{constructor(){this.type=-1,this.attriType=-1,this.typeSize=3,this.typeName="",this.name="",this.layoutEnabled=!0}parseCode(t){const e=";",s=" ";t=t.replace(/^\s*|\s*$/g,"");let i=t.indexOf(e);i>0&&(t=t.slice(0,i));let h=t.split(s);this.typeName=h[h.length-2],this.name=h[h.length-1],this.type=a.default.GetTypeByTypeNS(this.typeName),this.typeSize=parseInt(this.typeName.slice(this.typeName.length-1)),this.attriType=r.default.GetVBufAttributeTypeByNS(this.name)}}e.default=h},3024:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3077"));class a extends r.default{constructor(t,e){super(t),this.Au=null,this.Av=1,e<1&&(e=1),this.Av=e,this.Au=new Float32Array(4*e),this.addVec4Data(this.Au,this.Av)}destroy(){super.destroy(),this.Au=null}}e.default=a},3077:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("644c"));class a{constructor(t){this.T=a.EM++,this.a=null,this.Aw=null,this.Ax=0,this.Ay=-1,this.rst=-1,this.uniformsTotal=0,this.uniformNames=null,this.uniformTypes=null,this.dataSizeList=null,this.bindSlot(t)}bindSlot(t){this.rst>=0&&this.reset(),null==this.Aw&&(this.Aw=[],this.uniformTypes=[],this.dataSizeList=[]),this.a=t,this.rst=1,this.Ay=t.index,this.Ax=t.index}getUid(){return this.T}getSlotBeginIndex(){return this.Ay}getRCUid(){return this.a.getRCUid()}getFS32At(t){return this.Aw[t]}setFS32At(t,e){this.Aw[e]=t}setVec4DataAt(t,e,s,i,r){let a=this.Aw[t];a[0]=e,a[1]=s,a[2]=i,a[3]=r}setVec4Data(t,e,s,i){let r=this.Aw[0];r[0]=t,r[1]=e,r[2]=s,r[3]=i}setVec4DataAtWithArr4(t,e){this.Aw[t].set(e,0)}setVec4DataWithArr4(t){this.Aw[0].set(t,0)}addVec4Data(t,e){t.length,this.Aw.push(t),this.uniformTypes.push(r.default.SHADER_VEC4),this.dataSizeList.push(e),this.a.dataList[this.Ax]=t,this.Ax++,this.uniformsTotal++,this.a.index++}addMat4Data(t,e){this.Aw.push(t),this.uniformTypes.push(r.default.SHADER_MAT4),this.dataSizeList.push(e),this.a.dataList[this.Ax]=t,this.Ax++,this.uniformsTotal++,this.a.index++}isEnabled(){return this.rst>=0}update(){if(this.rst++,this.uniformsTotal<2)this.a.flagList[this.Ay]=this.rst;else for(let t=this.Ay;t<=this.Ax;++t)this.a.flagList[t]=this.rst}reset(){this.rst=-1,this.Ay=-1,this.uniformsTotal=0,this.Ax=0,null!=this.Aw&&(this.Aw=null,this.uniformTypes=null,this.dataSizeList=null),this.a=null}destroy(){this.reset()}}a.EM=0,e.default=a},3113:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("839a"),a=s("a9f4"),h=i(s("ab73"));class n{constructor(){this.Az=null,this.A0="",this.A1=new Uint16Array(128),this.A2=16,this.A3=!1}__$setCodeBuilder(t){this.Az=t}getUniqueNSKeyID(){if(this.A3){let t=31;for(let e=0;e<this.A2;++e)t=131*t+this.A1[e];return t}return 0}getUniqueNSKeyString(){if(this.A3){this.A0="["+this.A1[0];for(let t=1;t<this.A2;++t)this.A0+=""+this.A1[t];return this.A0+="]",this.A0}return""}reset(){if(this.A3){for(let t=0;t<this.A2;++t)this.A1[t]=0;this.A3=!1}}useCameraPosition(t=!1,e=!0){t&&this.Az.addVertUniformParam(h.default.CameraPosParam),e&&this.Az.addFragUniformParam(h.default.CameraPosParam)}useViewPort(t=!1,e=!0){t&&this.Az.addVertUniformParam(h.default.ViewportParam),e&&this.Az.addFragUniformParam(h.default.ViewportParam)}useFrustum(t=!1,e=!0){t&&this.Az.addVertUniformParam(h.default.FrustumParam),e&&this.Az.addFragUniformParam(h.default.FrustumParam)}useStage(t,e){t&&this.Az.addVertUniformParam(h.default.StageParam),e&&this.Az.addFragUniformParam(h.default.StageParam)}addDiffuseMap(){this.Az.addTextureSample2D("VOX_DIFFUSE_MAP",!0,!0,!1),this.A1[0]=1,this.A3=!0}addNormalMap(){this.Az.addTextureSample2D("VOX_NORMAL_MAP",!0,!0,!1),this.Az.normalMapEnabled=!0,this.A1[1]=1,this.A3=!0}addParallaxMap(t){this.Az.addTextureSample2D("VOX_PARALLAX_MAP",!0,!0,!1),t>=0?(this.Az.addDefine("VOX_PARALLAX_PARAMS_INDEX",""+t),this.A1[2]=1+(t<<1)):this.A1[2]=1,this.A3=!0}addDisplacementMap(t){this.Az.addTextureSample2D("VOX_DISPLACEMENT_MAP",!0,!1,!0),t>=0?(this.Az.addDefine("VOX_DISPLACEMENT_PARAMS_INDEX",""+t),this.A1[3]=1+(t<<1)):this.A1[3]=1,this.A3=!0}addSpecularMap(t=r.SpecularMode.Default){this.Az.addTextureSample2D("VOX_SPECULAR_MAP",!0,!0,!1),this.Az.addDefine("VOX_SPECULAR_MODE",""+t),this.A1[5]=1+(t<<1),this.A3=!0}addShadowMap(t=a.ShadowMode.VSM){this.Az.addTextureSample2D("VOX_VSM_SHADOW_MAP",!1,!0,!1),this.A1[6]=1+(t<<1),this.A3=!0}addFogColorMap(){this.Az.addTextureSample2D("VOX_FOG_COLOR_MAP",!0,!0,!1),this.A1[7]=1,this.A3=!0}addSpecularEnvMap(t=!0){t?this.Az.addTextureSampleCube("VOX_ENV_MAP",!0,!1):this.Az.addTextureSample2D("VOX_ENV_MAP",!0,!0,!1),this.A1[8]=1,this.A3=!0}addAOMap(){this.Az.addTextureSample2D("VOX_AO_MAP",!0,!0,!1),this.A1[4]=1,this.A3=!0}addRoughnessMap(){this.Az.addTextureSample2D("VOX_ROUGHNESS_MAP",!0,!0,!1),this.A1[9]=1,this.A3=!0}addMetalnessMap(){this.Az.addTextureSample2D("VOX_METALNESS_MAP",!0,!0,!1),this.A1[10]=1,this.A3=!0}addARMMap(){this.Az.addTextureSample2D("VOX_ARM_MAP",!0,!0,!1),this.A1[11]=1,this.A3=!0}add2DMap(t="",e=!0,s=!0,i=!1){this.Az.addTextureSample2D(t,e,s,i)}addCubeMap(t="",e=!0,s=!1){this.Az.addTextureSampleCube(t,e,s)}add3DMap(t="",e=!0,s=!1){this.Az.addTextureSample3D(t,e,s)}}e.ShaderCodeUniform=n},"36cb":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("e08e"),a=i(s("ab73")),h=s("b02c"),n=i(s("4f27")),l=i(s("b30a")),_=i(s("9156")),o=s("670e");class m{constructor(t){this.A4=null,this.An=null,this.z_=null,this.AB=null,this.A5=null,this.AM=null,this.A6=null,this.A7=null,this.A8=[],this.A9=[],this.A_A=[],this.A_B=!1,this.A_C=null,this.A_C=t}initialize(t,e,s,i){null==this.An&&(this.AM=t,this.A6=t.Vertex,this.A7=t.Texture,this.An=new l.default(t.getRCUid(),t.getRC(),t.getRenderAdapter(),this.A_C),this.z_=e,this.AB=s,this.A5=i,this.A4=new h.EmptyTexRenderObj(this.A7),this.A_D=new n.default,this.A_D.initialize())}getRenderProxy(){return this.AM}getRenderShader(){return this.An}getTextureResource(){return this.A7}updateTextureData(t,e){this.A7.hasResUid(t.getResUid())&&(e?(this.A_A.push(t),this.A_B=!0):t.__$updateToGpu(this.A7))}updateDispTRO(t,e){t.__$ruid>-1&&(e?(this.A9.push(t),this.A_B=!0):this.updateTextureTRO(t))}createTRO(t,e){if(null!=t){for(let e=0;e<t.length;++e)null!=t[e]&&t[e].__$setRenderProxy(this.AM);return h.TextureRenderObj.Create(this.A7,t,e)}return null}updateTextureTRO(t){if(null!=t.__$$runit){let e=t.getMaterial();if(null!=e){let s=this.A7,i=t.__$$runit,r=h.TextureRenderObj.GetByMid(s.getRCUid(),e.__$troMid);if(null!=i.tro&&(null==r||i.tro.getMid()!=r.getMid())){let t=this.A_C.findShdProgramByShdData(e.getShaderData());null!=t&&(t.getTexTotal()>0?(null==r&&(r=this.createTRO(e.getTextureList(),t.getTexTotal())),i.tro!=r&&(null!=i.tro&&i.tro.__$detachThis(),i.tro=r,r.__$attachThis(),i.texMid=i.tro.getMid(),this.AB.rejoinRunitForTro(i),e.__$troMid=i.tro.getMid())):i.tro!=this.A4&&(null!=i.tro&&i.tro.__$detachThis(),i.tro=this.A4,i.texMid=i.tro.getMid(),this.AB.rejoinRunitForTro(i),e.__$troMid=i.texMid))}}}}updateDispMaterial(t,e){let s=null;if(e.__$ruid>=0){let i=this.AM,r=e.getMaterial();if(null!=r){if(null==r.getShaderData()){let t=r.getTextureList(),e=null!=t&&null!=t&&t.length>0;r.initializeByCodeBuf(e)}s=this.A_C.create(r.getShaderData()),s.upload(i.RContext,i.getUid()),t.shdUid=s.getUid();let h=null;if(s.getTexTotal()>0?(h=this.createTRO(r.getTextureList(),s.getTexTotal()),t.tro!=h&&(null!=t.tro&&t.tro.__$detachThis(),t.tro=h,h.__$attachThis(),t.texMid=t.tro.getMid(),t.__$rprouid>=0&&this.AB.rejoinRunitForTro(t),r.__$troMid=t.tro.getMid())):t.tro!=this.A4&&(null!=t.tro&&t.tro.__$detachThis(),t.tro=this.A4,t.texMid=t.tro.getMid(),t.__$rprouid>=0&&this.AB.rejoinRunitForTro(t),r.__$troMid=t.texMid),null==this.An.getSharedUniformByShd(s)){let t=this.createsharedMList(r,s);if(null!=t)for(let e=0;e<t.length;++e)t[e].program=s.getGPUProgram();this.An.setSharedUniformByShd(s,this.A_D.buildShared(t,i,s))}let n=s.hasUniformByName(a.default.LocalTransformMatUNS);null==r.__$uniform&&(r.__$uniform=this.A_D.buildLocalFromData(r.createSelfUniformData(),s)),n&&null!=e.getTransform()&&(t.transUniform=_.default.GetTransUniform(e.getTransform())),null==t.transUniform?(t.transUniform=this.A_D.buildLocalFromTransformV(n?e.getMatrixFS32():null,s),_.default.SetTransUniform(e.getTransform(),t.transUniform)):t.transUniform=this.A_D.updateLocalFromTransformV(t.transUniform,n?e.getMatrixFS32():null,s),t.polygonOffset=r.getPolygonOffset(),t.uniform=r.__$uniform}}return s}updateVtxDataToGpuByUid(t,e){this.A6.updateDataToGpu(t,e)}updateDispVbuf(t,e){if(t.__$ruid>-1)if(e)this.A8.push(t),this.A_B=!0;else{let e=t.__$$runit;if(null!=e&&e.vtxUid!=t.vbuf.getUid()){let s=e.vtxUid,i=this.A6;i.hasResUid(s)&&i.__$detachRes(s),e.vro.__$detachThis(),this.buildVtxRes(t,e,this.A_C.findShdProgramByUid(e.shdUid)),e.__$rprouid>=0&&this.AB.rejoinRunitForVro(e)}}}buildVtxRes(t,e,s){if(null!=t.vbuf){let i=this.A6;e.ivsIndex=t.ivsIndex,e.ivsCount=t.ivsCount,e.insCount=t.insCount,e.visible=t.visible,e.setVisible(t.visible),e.drawMode=t.drawMode,e.renderState=t.renderState,e.rcolorMask=t.rcolorMask,e.trisNumber=t.trisNumber;let r,a=t.vbuf.getUid(),h=!0;i.hasResUid(a)?(r=i.getVertexRes(a),h=r.version!=t.vbuf.version,h&&(i.destroyRes(a),r.rcuid=i.getRCUid(),r.resUid=a)):(r=new o.GpuVtxObject,r.rcuid=i.getRCUid(),r.resUid=a,i.addVertexRes(r)),h&&(r.indices.ibufStep=t.vbuf.getIBufStep(),r.indices.initialize(this.A5,t.vbuf),r.vertex.initialize(this.A5,s,t.vbuf),r.version=t.vbuf.version),i.__$attachRes(a),e.vro=r.createVRO(this.A5,s,!0),e.indicesRes=e.vro.indicesRes,e.vro.__$attachThis(),e.vtxUid=t.vbuf.getUid(),e.ibufStep=e.vro.ibufStep,e.ibufType=4!=e.ibufStep?this.AM.UNSIGNED_SHORT:this.AM.UNSIGNED_INT}}buildGpuDisp(t){if(t.__$ruid<0&&null!=t.getMaterial()){t.__$$rsign=r.DisplayRenderSign.LIVE_IN_RENDERER;let e=this.z_.create();if(t.__$ruid=e.uid,t.__$$runit=e,null!=t.getPartGroup()){e.partGroup=t.getPartGroup().slice(0),e.partTotal=e.partGroup.length;let s=e.partGroup;for(let t=0,i=e.partTotal;t<i;)t++,s[t++]*=e.ibufStep}return e.setDrawFlag(t.renderState,t.rcolorMask),this.buildVtxRes(t,e,this.updateDispMaterial(e,t)),!0}return!1}update(){if(this.A_B){this.A_B=!1;let t=this.A8.length,e=0;if(t>0){for(;e<t;++e)this.updateDispVbuf(this.A8[e],!1);this.A8=[]}if(t=this.A9.length,t>0){for(e=0;e<t;++e)this.updateTextureTRO(this.A9[e]);this.A9=[]}if(t=this.A_A.length,t>0){for(e=0;e<t;++e)this.A_A[e].__$updateToGpu(this.A7);this.A_A=[]}}}createsharedMList(t,e){let s=t.createSharedUniforms();if(null==s){let i=t.createSharedUniformsData();if(null!=i&&i.length>0){s=[];for(let t=0;t<i.length;++t)if(null!=i[t]){let r=this.A_D.buildLocalFromData(i[t],e);s.push(r)}s.length<1&&(s=null)}}return s}updateGlobalMaterial(t,e=!1){if(null!=t){let s=this.AM,i=null,r=null,a=null,h=!1;null==t.getShaderData()?(a=t.getTextureList(),h=null!=a&&a.length>0,t.initializeByCodeBuf(h)):a=t.getTextureList(),r=this.A_C.create(t.getShaderData()),r.upload(s.RContext,s.getUid());let n=r.getTexTotal();if(n>0&&(i=this.createTRO(a,n)),null==this.An.getSharedUniformByShd(r)){let e=this.createsharedMList(t,r);if(null!=e)for(let t=0;t<e.length;++t)e[t].program=r.getGPUProgram();this.An.setSharedUniformByShd(r,this.A_D.buildShared(e,s,r))}null==t.__$uniform&&(t.__$uniform=this.A_D.buildLocalFromData(t.createSelfUniformData(),r)),this.An.__$globalUniform=t.__$uniform,this.An.bindToGpu(r.getUid()),e&&null!=t.__$uniform&&this.An.useUniform(t.__$uniform),null!=i&&i.run()}}reset(){this.A8=[],this.A9=[]}}e.default=m},3806:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("a996")),a=i(s("1710")),h=i(s("7045")),n=i(s("9260")),l=i(s("badb"));class _{constructor(t,e){this.A=0,this.uProbe=null,this.pixelRatio=1,this.stageWidth=800,this.stageHeight=600,this.stageHalfWidth=400,this.stageHalfHeight=300,this.mouseX=0,this.mouseY=0,this.viewWidth=800,this.viewHeight=600,this.mouseViewX=0,this.mouseViewY=0,this.B=0,this.C=0,this.D=1,this.E=1,this.F=new l.default,this.G=[],this.H=[],this.I=[],this.J=[],this.A_E=new h.default,this.K=[],this.L=[],this.M=[],this.N=[],this.O=0,this.P=0,this.Q=new a.default,this.A_F=new r.default,this.R=!0,this.S=new r.default,this.A=t,null==_.Ea&&(_.Ea=e,e.onkeydown=function(t){n.default.KeyDown(t)},e.onkeyup=function(t){n.default.KeyUp(t)}),n.default.AddEventListener(h.default.KEY_DOWN,this,this.keyDown),n.default.AddEventListener(h.default.KEY_UP,this,this.keyUp)}getRCUid(){return this.A}getDevicePixelRatio(){return window.devicePixelRatio}getViewX(){return this.B}getViewY(){return this.C}getViewWidth(){return this.D}getViewHeight(){return this.E}setViewPort(t,e,s,i){this.R=!1,this.B=t,this.C=e,s==this.D&&i==this.E||(this.D=s,this.E=i,this.updateViewUData())}updateViewUData(){this.uProbe.setVec4Data(2/this.stageWidth,2/this.stageHeight,this.stageWidth,this.stageHeight),this.uProbe.update(),this.O=this.D,this.P=this.E}update(){this.O==this.stageWidth&&this.P==this.stageHeight||(this.R&&(this.D=this.stageWidth,this.E=this.stageHeight,this.updateViewUData()),this.stageHalfWidth=.5*this.stageWidth,this.stageHalfHeight=.5*this.stageHeight,this.A_F.target=this,this.A_F.type=r.default.RESIZE,this.A_F.phase=1,this.sendResizeEvt(this.A_F))}keyDown(t){this.A_E.phase=1,this.A_E.type=h.default.KEY_DOWN,this.A_E.altKey=t.altKey,this.A_E.ctrlKey=t.ctrlKey,this.A_E.shiftKey=t.shiftKey,this.A_E.repeat=t.repeat,this.A_E.key=t.key,this.A_E.keyCode=t.keyCode,this.A_E.location=t.location;let e=this.K.length;for(var s=0;s<e;++s)this.K[s].call(this.L[s],this.A_E)}keyUp(t){this.A_E.phase=1,this.A_E.type=h.default.KEY_UP,this.A_E.altKey=t.altKey,this.A_E.ctrlKey=t.ctrlKey,this.A_E.shiftKey=t.shiftKey,this.A_E.repeat=t.repeat,this.A_E.key=t.key,this.A_E.keyCode=t.keyCode,this.A_E.location=t.location,this.A_E.target=this;let e=this.M.length;for(var s=0;s<e;++s)this.M[s].call(this.N[s],this.A_E)}sendResizeEvt(t){let e=this.G.length;for(var s=0;s<e;++s)this.G[s].call(this.H[s],t)}mouseDown(t=1){this.Q.type=a.default.MOUSE_DOWN,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=t,this.F.dispatchEvt(this.Q)}mouseUp(t=1){this.Q.phase=1,this.Q.type=a.default.MOUSE_UP,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=t,this.F.dispatchEvt(this.Q)}mouseClick(){this.Q.type=a.default.MOUSE_CLICK,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseDoubleClick(){this.Q.type=a.default.MOUSE_DOUBLE_CLICK,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseRightDown(t=1){this.Q.type=a.default.MOUSE_RIGHT_DOWN,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseRightUp(t=1){this.Q.type=a.default.MOUSE_RIGHT_UP,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseBgDown(){this.Q.type=a.default.MOUSE_BG_DOWN,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseBgUp(){this.Q.type=a.default.MOUSE_BG_UP,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseBgClick(){this.Q.type=a.default.MOUSE_BG_CLICK,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseRightClick(){this.Q.type=a.default.MOUSE_RIGHT_CLICK,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseMove(){this.Q.type=a.default.MOUSE_MOVE,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseWheel(t){this.Q.type=a.default.MOUSE_WHEEL,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.wheelDeltaY=t.wheelDeltaY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseCancel(){this.Q.type=a.default.MOUSE_CANCEL,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseMultiDown(t){this.Q.type=a.default.MOUSE_MULTI_DOWN,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.Q.posArray=t,this.F.dispatchEvt(this.Q)}mouseMultiUp(t){this.Q.type=a.default.MOUSE_MULTI_UP,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.Q.posArray=t,this.F.dispatchEvt(this.Q)}mouseMultiMove(t){this.Q.type=a.default.MOUSE_MULTI_MOVE,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.Q.posArray=t,this.F.dispatchEvt(this.Q)}mouseWindowUp(t=1){}mouseWindowRightUp(t=1){}enterFrame(){this.S.type=r.default.ENTER_FRAME;let t=this.I.length;for(var e=0;e<t;++e)this.I[e].call(this.J[e],this.S)}addEventListener(t,e,s,i=!0,a=!0){if(null!=s&&null!=e){let n=0;switch(t){case r.default.RESIZE:for(n=this.G.length-1;n>=0;--n)if(e===this.H[n])break;n<0&&(this.H.push(e),this.G.push(s));break;case r.default.ENTER_FRAME:for(n=this.I.length-1;n>=0;--n)if(e===this.J[n])break;n<0&&(this.J.push(e),this.I.push(s));break;case h.default.KEY_DOWN:for(n=this.K.length-1;n>=0;--n)if(e===this.L[n])break;n<0&&(this.L.push(e),this.K.push(s));break;case h.default.KEY_UP:for(n=this.M.length-1;n>=0;--n)if(e===this.N[n])break;n<0&&(this.N.push(e),this.M.push(s));break;default:this.F.addEventListener(t,e,s,i,a);break}}}removeEventListener(t,e,s){if(null!=s&&null!=e){let i=0;switch(t){case r.default.RESIZE:for(i=this.G.length-1;i>=0;--i)if(e===this.H[i]){this.H.splice(i,1),this.G.splice(i,1);break}break;case r.default.ENTER_FRAME:for(i=this.I.length-1;i>=0;--i)if(e===this.J[i]){this.J.splice(i,1),this.I.splice(i,1);break}break;case h.default.KEY_DOWN:for(i=this.K.length-1;i>=0;--i)if(e===this.L[i]){this.L.splice(i,1),this.K.splice(i,1);break}break;case h.default.KEY_UP:for(i=this.M.length-1;i>=0;--i)if(e===this.N[i]){this.N.splice(i,1),this.M.splice(i,1);break}break;default:this.F.removeEventListener(t,e,s);break}}}}_.Ea=null,e.default=_},3930:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01"));class a{constructor(t=1,e=1,s=1,i=1){this.r=1,this.g=1,this.b=1,this.a=1,this.r=t,this.g=e,this.b=s,this.a=i}setRGB3Bytes(t,e,s){this.r=t/255,this.g=e/255,this.b=s/255}setRGB3f(t,e,s){this.r=t,this.g=e,this.b=s}setRGBUint24(t){this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255}setRGBA4f(t,e,s,i){this.r=t,this.g=e,this.b=s,this.a=i}copyFrom(t){this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a}copyFromRGB(t){this.r=t.r,this.g=t.g,this.b=t.b}scaleBy(t){this.r*=t,this.g*=t,this.b*=t}inverseRGB(){this.r=1-this.r,this.g=1-this.g,this.b=1-this.b}randomRGB(t=1,e=0){this.r=Math.random()*t,this.g=Math.random()*t,this.b=Math.random()*t,this.r+=e,this.g+=e,this.b+=e}normalizeRandom(t=1,e=0){this.r=Math.random(),this.g=Math.random(),this.b=Math.random();let s=Math.sqrt(this.r*this.r+this.g*this.g+this.b*this.b);s>r.default.MATH_MIN_POSITIVE&&(this.r=t*this.r/s,this.g=t*this.g/s,this.b=t*this.b/s),this.r+=e,this.g+=e,this.b+=e}normalize(t){void 0==t&&(t=1);let e=Math.sqrt(this.r*this.r+this.g*this.g+this.b*this.b);e>r.default.MATH_MIN_POSITIVE&&(this.r=t*this.r/e,this.g=t*this.g/e,this.b=t*this.b/e)}getCSSDecRGBAColor(){let t=Math.floor(255*this.r),e=Math.floor(255*this.g),s=Math.floor(255*this.b),i=this.a;return"rgba("+t+","+e+","+s+","+i+")"}getCSSHeXRGBColor(){let t="#",e=Math.floor(255*this.r);return t+=e<15?"0"+e.toString(16):""+e.toString(16),e=Math.floor(255*this.g),t+=e<15?"0"+e.toString(16):""+e.toString(16),e=Math.floor(255*this.b),t+=e<15?"0"+e.toString(16):""+e.toString(16),t}toString(){return"[Color4(r="+this.r+", g="+this.g+",b="+this.b+",a="+this.a+")]"}}e.default=a},"3b73":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static SetWebBodyColor(t="white"){const e=document.body;e.style.background=t}static SetLanguage(t){i.Eb=t}static GetLanguage(){return""!=i.Eb||(i.Eb=navigator.language),i.Eb}static SetThreadEnabled(t){i.Ec=t}static GetThreadEnabled(){return i.Ec}static GetDebugEnabled(){return i.Ed}static SetDebugEnabled(t){i.Ed=t}static SetDevicePixelRatio(t){i.Ee=t}static GetDevicePixelRatio(){return i.Ee}static Initialize(t){i.Ef&&(i.Ef=!1,i.Eg=t[0],i.TestMobileWeb(),i.Eb=navigator.language+"")}static IsWindowsPCOS(){return!(i.IsSafariWeb()||i.IsMobileWeb())}static IsWinExternalVideoCard(){if(i.Eh>0)return 2==i.Eh;let t=i.IsSafariWeb()||i.IsMobileWeb();return t||(t=i.GPU_RENDERER.indexOf("Intel(R)")<0),i.Eh=t?2:1,2==i.Eh}static TestSafariWeb(){return/Safari/.test(navigator.userAgent)&&/Mac OS/.test(navigator.userAgent)}static IsWebGL1(){return 1==i.Eg}static IsWebGL2(){return 2==i.Eg}static IsMobileWeb(){return i.Em>0?2==i.Em:i.TestMobileWeb()}static IsSafariWeb(){return i.Ei>0||(i.Ei=i.TestSafariWeb()?2:1),2==i.Ei}static IsIOS(){if(i.Ej>0)return 2==i.Ej;let t=!1;return t=!!/iPad|iPhone|iPod/.test(navigator.platform)||void 0!=navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform),i.Ej=t?2:1,t}static IsIpadOS(){if(i.Ek>0)return 2==i.Ek;let t=navigator.maxTouchPoints>0&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform);return!t&&/iPod|iPad|iPadPro|iPodPro/i.test(navigator.userAgent)&&(t=!0),i.Ek=t?2:1,t}static IsAndroidOS(){if(i.El>0)return 2==i.El;let t=i.TestMobileWeb();return t=!(!t||!/Android|Linux/i.test(navigator.userAgent)),i.El=t?2:1,t}static TestMobileWeb(){return i.Em>0?2==i.Em:/mobile/.test(location.href)?(i.Em=2,2==i.Em):/Android/i.test(navigator.userAgent)?/Mobile/i.test(navigator.userAgent)?(i.Em=2,2==i.Em):(i.Em=1,2==i.Em):/webOS|iPhone|iPod|iPad|iPodPro|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?(i.Em=2,2==i.Em):(i.Em=1,2==i.Em)}}i.Ef=!0,i.Eg=2,i.Ee=1,i.Em=0,i.Ei=0,i.El=0,i.Ej=0,i.Ek=0,i.Eh=0,i.Eb="",i.Ed=!0,i.GPU_VENDOR="unknown",i.GPU_RENDERER="unknown",i.MAX_TEXTURE_SIZE=4096,i.MAX_RENDERBUFFER_SIZE=4096,i.MAX_VIEWPORT_WIDTH=4096,i.MAX_VIEWPORT_HEIGHT=4096,i.SHOWLOG_ENABLED=!1,i.SHADERCODE_TRACE_ENABLED=!1,i.VERT_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED=!0,i.FRAG_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED=!0,i.Ec=!0,e.default=i},"3c81":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("2be1")),a=i(s("7696"));class h extends r.default{setCreateParams(t,e,s,i,r,a){this.An=t,this.A_G=e,this.z_=s,this.A_H=i,this.A_I=r,this.A_J=a}createNode(){return new a.default(this.An,this.A_G,this.z_,this.A_H,this.A_I,this.A_J)}rejoinRunitForTro(t){this.getNodeByUid(t.__$rprouid).rejoinRunitForTro(t)}rejoinRunitForVro(t){this.getNodeByUid(t.__$rprouid).rejoinRunitForVro(t)}}e.default=h},"442e":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("2be1")),a=i(s("265e"));class h extends r.default{createNode(){return new a.default}}e.default=h},"45db":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8def")),a=i(s("fa60"));class h{constructor(){this.A_K=null,this.A_L=-1,this.A_M=[],this.A_N=0,this.j=0,this.A_O=0,this.A_P=0,this.A_Q=null,this.A_R=null,this.A_S=null,this.A_T=[],this.A_U=0}updateToGpu(t){let e=this.A_M.length;if(e>0){let s=this.A_K;if(this.version!=s.vertexVer){let i,r=s.getBufDataUsage(),a=this.A_S;for(let h=0;h<e;++h)i=s.getF32DataAt(h),a[h]>=i.length?(t.bindArrBuf(this.A_M[h]),t.arrBufSubData(i,0)):(t.bindArrBuf(this.A_M[h]),t.arrBufData(i,r),a[h]=i.length);this.version=s.vertexVer}}}uploadCombined(t,e){let s=this.A_K,i=s.getF32DataAt(0);if(this.A_M.push(t.createBuf()),t.bindArrBuf(this.A_M[0]),t.arrBufData(i,s.getBufDataUsage()),this.A_N=1,this.A_S=[i.length],null==this.A_Q){this.A_P=0,this.A_Q=new Array(this.A_O),this.A_R=new Array(this.A_O);let t=s.getBufTypeList(),i=s.getBufSizeList();if(null!=t)for(let e=0;e<this.A_O;++e)this.A_R[e]=this.A_P,this.A_P+=4*i[e],this.A_Q[e]=t[e];else for(let s=0;s<this.A_O;++s)this.A_R[s]=this.A_P,this.A_P+=4*e.getLocationSizeByIndex(s),this.A_Q[s]=e.getLocationTypeByIndex(s)}}uploadSeparated(t,e){let s=this.A_K,i=0,r=null,a=s.getBufDataUsage();if(this.A_N=this.A_K.getBuffersTotal(),this.A_S=new Array(this.A_O),null==s.bufData)for(;i<this.A_O;++i)r=t.createBuf(),this.A_M.push(r),t.bindArrBuf(r),t.arrBufData(s.getF32DataAt(i),a),this.A_S[i]=s.getF32DataAt(i).length;else{let e=null,h=0,n=0,l=0,_=0;for(;i<this.A_O;++i){for(r=t.createBuf(),this.A_M.push(r),t.bindArrBuf(r),t.arrBufDataMem(s.bufData.getAttributeDataTotalBytesAt(i),a),l=0,_=0,n=s.bufData.getAttributeDataTotalAt(i),h=0;h<n;++h)e=s.bufData.getAttributeDataAt(i,h),_+=e.length,t.arrBufSubData(e,l),l+=e.byteLength;this.A_S[i]=_}}if(null==this.A_Q){this.A_Q=new Array(this.A_O),this.A_R=new Array(this.A_O);let t=s.getBufTypeList(),i=s.getBufSizeList();if(null!=t)for(let e=0;e<this.A_O;++e)this.A_R[e]=this.A_P,this.A_P+=4*i[e],this.A_Q[e]=t[e];else for(let s=0;s<this.A_O;++s)this.A_R[s]=this.A_P,this.A_P+=4*e.getLocationSizeByIndex(s),this.A_Q[s]=e.getLocationTypeByIndex(s);this.A_P=0}}initialize(t,e,s){if(this.A_M.length<1&&null!=s){this.version=s.vertexVer,this.A_K=s,this.A_L=s.getUid(),this.j=s.getType();let i=s.getBufTypeList();this.A_O=null!=i?i.length:e.getLocationsTotal(),e.getLocationsTotal(),s.getAttribsTotal(),this.j<1?this.uploadCombined(t,e):this.uploadSeparated(t,e)}}getVROMid(t,e,s,i){let r=(131+t.getRCUid())*this.A_L;return s&&(r=131*r+1),r=131*r+e.getMid(),r=131*r+i,r}createVRO(t,e,s,i,h){let n=e.getLocationsTotal();if(this.A_O*n>0&&n<=this.A_O){let l=this.getVROMid(t,e,s,h),_=0,o=a.default.GetByMid(l);if(null!=o)return o;if(s){let s=a.default.Create(t,l,this.A_K.getUid());if(s.indicesRes=i,s.vao=t.createVertexArray(),t.bindVertexArray(s.vao),this.j<1)for(t.bindArrBuf(this.A_M[0]),_=0;_<n;++_)e.vertexAttribPointerTypeFloat(this.A_Q[_],this.A_P,this.A_R[_]);else for(_=0;_<n;++_)t.bindArrBuf(this.A_M[_]),e.vertexAttribPointerTypeFloat(this.A_Q[_],0,0);o=s,s.ibuf=i.getGpuBuf(),t.bindVertexArray(null)}else{let s=r.default.Create(t,l,this.A_K.getUid());for(s.indicesRes=i,s.shdp=e,s.attribTypes=[],s.wholeOffsetList=[],s.wholeStride=this.A_P,this.j<1?s.vbuf=this.A_M[0]:s.vbufs=this.A_M,_=0;_<n;++_)e.testVertexAttribPointerType(this.A_Q[_])&&(s.attribTypes.push(this.A_Q[_]),s.wholeOffsetList.push(0));s.attribTypesLen=s.attribTypes.length,s.ibuf=i.getGpuBuf(),o=s}return this.A_T.push(o),++this.A_U,o}return null}destroy(t){if(this.A_M.length>0){this.j=-1;let e=0,s=null;for(;e<this.A_U;++e)s=this.A_T.pop(),s.restoreThis(),this.A_T[e]=null;for(this.A_U=0,e=0;e<this.A_O;++e)t.deleteBuf(this.A_M[e]),this.A_M[e]=null;this.A_O=0,this.A_M=[]}}}e.ROVertexRes=h},"4a54":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=i(s("81ce")),h=i(s("f208")),n=s("c164");class l{constructor(t){this.A_V="#version 300 es\n",this.A_W="precision mediump float;\n",this.A_X=[],this.A_Y=[],this.A_Z=[],this.A_a=[],this.A_b=[],this.A_c=[],this.A_d=[],this.A_e=[],this.A_f=[],this.A_g=[],this.A_h=[],this.A_i=[],this.A_j=[],this.A_k=[],this.A_l=[],this.A_m=[],this.A_n=[],this.A_o=[],this.A_p=[],this.A_q=[],this.A_r="",this.A_s=[],this.A_t=!1,this.A_u=!1,this.A_v=!1,this.A_w=!1,this.A_x=!1,this.A_y=!1,this.A_z="",this.A_0="",this.A_1="",this.A_2="",this.A0="",this.A2=10,this.A_3=!1,this.A_4=null,this.fragHeadCodeUnlock=!0,this.fragMainCodeUnlock=!0,this.vertHeadCodeUnlock=!0,this.vertMainCodeUnlock=!0,this.autoBuildHeadCodeEnabled=!0,this.mathDefineEanbled=!0,this.normalEnabled=!1,this.normalMapEnabled=!1,this.mapLodEnabled=!1,this.derivatives=!1,this.vertMatrixInverseEnabled=!1,this.vtxUVTransfromEnabled=!1,this.fragMatrixInverseEnabled=!1;let e=this;e.uniform=t}getUniqueNSKeyID(){throw Error("can not use this function !!!")}getUniqueNSKeyString(){let t=this.A0;return this.vtxUVTransfromEnabled&&(t+="VtxUVT"),this.normalEnabled&&(t+="Nor"),this.uniform.getUniqueNSKeyString()+t}reset(){this.A_t=!0,this.A_u=!0,this.A_v=!0,this.A_w=!1,this.A_x=!1,this.A_y=!1,this.fragHeadCodeUnlock=!0,this.fragMainCodeUnlock=!0,this.vertHeadCodeUnlock=!0,this.vertMainCodeUnlock=!0,this.autoBuildHeadCodeEnabled=!0,this.A_3=!1,this.A_z="",this.A_0="",this.A_1="",this.A_2="",this.A0="",this.A_Y=[],this.A_X=[],this.A_b=[],this.A_c=[],this.A_d=[],this.A_e=[],this.A_f=[],this.A_k=[],this.A_l=[],this.A_g=[],this.A_h=[],this.A_i=[],this.A_j=[],this.A_m=[],this.A_n=[],this.A_Z=[],this.A_a=[],this.A_o=[],this.A_p=[],this.A_q=[],this.A_s=[],this.A_r="",this.mathDefineEanbled=!0,this.normalEnabled=!1,this.normalMapEnabled=!1,this.mapLodEnabled=!1,this.vertMatrixInverseEnabled=!1,this.fragMatrixInverseEnabled=!1,this.vtxUVTransfromEnabled=!1,this.A_4=null,this.uniform.reset()}addUniqueNSKeyString(t){this.A0+=t}getPreCompileInfo(){let t=this.A_4;return this.A_4=null,t}useHighPrecious(){this.A_W="precision highp float;"}useMediumPrecious(){this.A_W="precision mediump float;"}useLowPrecious(){this.A_W="precision lowp float;"}addDefine(t,e="1"){return!this.A_Z.includes(t)&&(this.A_Z.push(t),this.A_a.push(e),!0)}addVertLayout(t,e){this.A_b.includes(e)||(this.A_b.push(e),this.A_c.push(t))}addFragOutputHighp(t,e){this.A_e.includes(e)||(this.A_d.push("highp"),this.A_e.push(e),this.A_f.push(t))}addFragOutput(t,e){this.A_e.includes(e)||(this.A_d.push(""),this.A_e.push(e),this.A_f.push(t))}addVarying(t,e){this.A_k.includes(e)||(this.A_k.push(e),this.A_l.push(t))}addVertUniform(t,e,s=0){this.A_g.includes(e)||(s>0?this.A_g.push(e+"["+s+"]"):this.A_g.push(e),this.A_h.push(t))}addVertUniformParam(t){this.addVertUniform(t.type,t.name,t.arrayLength)}addFragUniform(t,e,s=0){this.A_i.includes(e)||(s>0?this.A_i.push(e+"["+s+"]"):this.A_i.push(e),this.A_j.push(t))}addFragUniformParam(t){this.addFragUniform(t.type,t.name,t.arrayLength)}addVertAndFragUniform(t,e,s=0){this.addVertUniform(t,e,s),this.addFragUniform(t,e,s)}addFragFunction(t){this.A_m.push(t)}addVertFunction(t){this.A_n.push(t)}useTexturePreciseHighp(){this.A_r="highp"}addTextureSample2D(t="",e=!0,s=!0,i=!1){if(""==t||!this.A_q.includes(t)){this.A_o.push("sampler2D"),this.A_q.push(t),this.A_p.push(this.A_r);let r=0;s&&(r|=2),i&&(r|=4),this.A_s.push(r),this.A_r="",e&&(this.A_3=!0)}}addTextureSampleCube(t="",e=!0,s=!1){if(""==t||!this.A_q.includes(t)){this.A_o.push("samplerCube"),this.A_q.push(t),this.A_p.push(this.A_r);let i=0;e&&(i|=2),s&&(i|=4),this.A_s.push(i),this.A_r=""}}addTextureSample3D(t="",e=!0,s=!1){if(""==t||!this.A_q.includes(t)){this.A_o.push("sampler3D"),this.A_q.push(t),this.A_p.push(this.A_r);let i=0;e&&(i|=2),s&&(i|=4),this.A_s.push(i),this.A_r=""}}isHaveTexture(){return this.A_o.length>0}isHaveTexture2D(){return this.A_3}useVertSpaceMats(t=!0,e=!0,s=!0){this.A_t=t,this.A_u=e,this.A_v=s}useFragSpaceMats(t=!0,e=!0,s=!0){this.A_w=t,this.A_x=e,this.A_y=s}addVertExtend(t){this.A_Y.push(t)}addFragExtend(t){this.A_X.push(t)}addVertHeadCode(t){""!=t&&(this.A_z+="\n"+t)}addVertMainCode(t){""!=t&&(this.A_0+="\n"+t)}addFragHeadCode(t){""!=t&&(this.A_1+="\n"+t)}addFragMainCode(t){""!=t&&(this.A_2+="\n"+t)}addShaderObject(t){this.fragHeadCodeUnlock&&this.addFragHeadCode(t.frag_head),this.fragMainCodeUnlock&&this.addFragMainCode(t.frag_body),this.vertHeadCodeUnlock&&this.addVertHeadCode(t.vert_head),this.vertMainCodeUnlock&&this.addVertMainCode(t.vert_body)}addShaderObjectHead(t){this.fragHeadCodeUnlock&&this.addFragHeadCode(t.frag_head),this.vertHeadCodeUnlock&&this.addVertMainCode(t.vert_head)}autoBuildHeadCode(){this.addVertLayout("vec3","a_vs"),(this.A_3||this.A_b.includes("a_uvs"))&&(this.addVertLayout("vec2","a_uvs"),this.addVarying("vec2","v_uv")),(this.normalEnabled||this.normalMapEnabled||this.A_b.includes("a_nvs"))&&(this.addVertLayout("vec3","a_nvs"),this.addVarying("vec3","v_worldNormal"),this.addVarying("vec3","v_worldPosition"),this.addDefine("VOX_USE_NORMAL"));let t=["a_vs","a_uvs","a_nvs"],e=[],s=[];for(;t.length>0;){let i=this.A_b.indexOf(t[0]);i>=0&&(e.push(this.A_b[i]),s.push(this.A_c[i]),this.A_b.splice(i,1),this.A_c.splice(i,1)),t.shift()}this.A_b=e.concat(this.A_b),this.A_c=s.concat(this.A_c),this.vtxUVTransfromEnabled&&this.addDefine("VOX_VTX_TRANSFORM_PARAM_INDEX","0")}buildFragCode(){this.autoBuildHeadCodeEnabled&&this.autoBuildHeadCode(),this.A_e.length<1&&this.addFragOutput("vec4","FragColor0");let t=0,e=0,s="";for((r.default.FRAG_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED||r.default.IsMobileWeb())&&this.useHighPrecious(),r.default.IsWebGL2()&&(s+=this.A_V),this.A_4=new h.default,this.A_4.info="\n//##COMPILE_INFO_BEGIN",this.A_4.info+="\n//##COMPILE_INFO_END",t=0,e=this.A_X.length;t<e;t++)s+="\n"+this.A_X[t];for(r.default.IsWebGL1()&&(this.A_e.length>1&&(s+="\n#extension GL_EXT_draw_buffers: require"),(this.normalMapEnabled||this.derivatives)&&(s+="\n#extension GL_OES_standard_derivatives : enable"),this.mapLodEnabled&&(s+="\n#extension GL_EXT_shader_texture_lod : enable")),r.default.IsMobileWeb()?s+="\nprecision highp float;":s+="\n"+this.A_W,r.default.IsWebGL2()?(s+="\n#define VOX_GLSL_ES3 1",s+="\n#define VOX_IN in",this.mapLodEnabled&&(s+="\n#define VOX_TextureCubeLod textureLod",s+="\n#define VOX_Texture2DLod textureLod"),s+="\n#define VOX_Texture2D texture",s+="\n#define VOX_TextureCube texture"):(s+="\n#define VOX_GLSL_ES2 1",s+="\n#define VOX_IN varying",this.mapLodEnabled&&(s+="\n#define VOX_TextureCubeLod textureCubeLodEXT",s+="\n#define VOX_Texture2DLod texture2DLodEXT"),s+="\n#define VOX_TextureCube textureCube",s+="\n#define VOX_Texture2D texture2D"),this.mathDefineEanbled&&(s+=n.MathShaderCode.BasePredefined),e=this.A_Z.length,t=0;t<e;t++)""!=this.A_a[t]?s+="\n#define "+this.A_Z[t]+" "+this.A_a[t]:s+="\n#define "+this.A_Z[t]+" 1";for(t=0,e=this.A_q.length;t<e;t++)""!=this.A_q[t]&&0!=(2&this.A_s[t])&&(s+="\n#define "+this.A_q[t]+" u_sampler"+t);for(this.A_3&&(s+="\n#define VOX_USE_2D_MAP 1"),t=0,e=this.A_o.length;t<e;t++)0!=(2&this.A_s[t])&&(""==this.A_p[t]?s+="\nuniform "+this.A_o[t]+" u_sampler"+t+";":s+="\nuniform "+this.A_p[t]+" "+this.A_o[t]+" u_sampler"+t+";");for(t=0,e=this.A_j.length;t<e;t++)s+="\nuniform "+this.A_j[t]+" "+this.A_i[t]+";";if(this.A_w&&(s+="\nuniform mat4 u_objMat;"),this.A_x&&(s+="\nuniform mat4 u_viewMat;"),this.A_y&&(s+="\nuniform mat4 u_projMat;"),e=this.A_k.length,r.default.IsWebGL2())for(t=0;t<e;t++)s+="\nin "+this.A_l[t]+" "+this.A_k[t]+";";else for(t=0;t<e;t++)s+="\nvarying "+this.A_l[t]+" "+this.A_k[t]+";";for(s+=n.ShaderCode.BasePredefined,this.fragMatrixInverseEnabled&&r.default.IsWebGL1()&&(this.addVertFunction(a.default.__glslInverseMat3),this.addVertFunction(a.default.__glslInverseMat4)),s+=this.A_1,t=0,e=this.A_m.length;t<e;t++)s+="\n"+this.A_m[t];if(t=0,e=this.A_e.length,r.default.IsWebGL2())for(;t<e;t++)""!=this.A_d[t]?s+="\nlayout(location = "+t+") out "+this.A_d[t]+" "+this.A_f[t]+" "+this.A_e[t]+";":s+="\nlayout(location = "+t+") out "+this.A_f[t]+" "+this.A_e[t]+";";else 1==e&&(s+="\n#define "+this.A_e[t]+" gl_FragColor");let i=!1,l=this.A_2.indexOf("{");if(l>0){let t=this.A_2.slice(0,l);i=t.indexOf(" main")>0,i||(i=this.A_2.indexOf(" main")>0)}if(i?s+=this.A_2:(s+="\nvoid main() {\n",s+=this.A_2,s+="\n}\n"),e=this.A_e.length,r.default.IsWebGL1()&&e>1)for(t=0;t<e;t++){let e=new RegExp(this.A_e[t],"g");s=s.replace(e,"gl_FragData["+t+"]")}return s}buildVertCode(){let t=0,e=0,s="";for(r.default.VERT_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED&&this.useHighPrecious(),r.default.IsWebGL2()&&(s+=this.A_V),t=0,e=this.A_Y.length;t<e;t++)s+="\n"+this.A_Y[t];for(r.default.IsMobileWeb()?s+="\nprecision highp float;":s+="\n"+this.A_W,r.default.IsWebGL2()?(s+="\n#define VOX_GLSL_ES3 1",s+="\n#define VOX_IN in",this.mapLodEnabled&&(s+="\n#define VOX_TextureCubeLod textureLod",s+="\n#define VOX_Texture2DLod textureLod"),s+="\n#define VOX_Texture2D texture",s+="\n#define VOX_TextureCube texture"):(s+="\n#define VOX_GLSL_ES2 1",s+="\n#define VOX_IN varying",this.mapLodEnabled&&(s+="\n#define VOX_TextureCubeLod textureCubeLodEXT",s+="\n#define VOX_Texture2DLod texture2DLodEXT"),s+="\n#define VOX_TextureCube textureCube",s+="\n#define VOX_Texture2D texture2D"),r.default.IsWebGL2()?s+="\n#define VOX_OUT out":s+="\n#define VOX_OUT varying",this.mathDefineEanbled&&(s+=n.MathShaderCode.BasePredefined),e=this.A_Z.length,t=0;t<e;t++)""!=this.A_a[t]?s+="\n#define "+this.A_Z[t]+" "+this.A_a[t]:s+="\n#define "+this.A_Z[t];for(t=0,e=this.A_q.length;t<e;t++)""!=this.A_q[t]&&0!=(4&this.A_s[t])&&(s+="\n#define "+this.A_q[t]+" u_sampler"+t);for(this.A_3&&(s+="\n#define VOX_USE_2D_MAP 1"),t=0,e=this.A_o.length;t<e;t++)0!=(4&this.A_s[t])&&(""==this.A_p[t]?s+="\nuniform "+this.A_o[t]+" u_sampler"+t+";":s+="\nuniform "+this.A_p[t]+" "+this.A_o[t]+" u_sampler"+t+";");if(e=this.A_b.length,r.default.IsWebGL2())for(t=0;t<e;t++)s+="\nlayout(location = "+t+") in "+this.A_c[t]+" "+this.A_b[t]+";";else for(t=0;t<e;t++)s+="\nattribute "+this.A_c[t]+" "+this.A_b[t]+";";for(e=this.A_h.length,t=0;t<e;t++)s+="\nuniform "+this.A_h[t]+" "+this.A_g[t]+";";if(this.A_t&&(s+="\nuniform mat4 u_objMat;"),this.A_u&&(s+="\nuniform mat4 u_viewMat;"),this.A_v&&(s+="\nuniform mat4 u_projMat;"),e=this.A_k.length,r.default.IsWebGL2())for(t=0;t<e;t++)s+="\nout "+this.A_l[t]+" "+this.A_k[t]+";";else for(t=0;t<e;t++)s+="\nvarying "+this.A_l[t]+" "+this.A_k[t]+";";for(s+=n.ShaderCode.BasePredefined,s+=n.ShaderCode.VertPredefined,this.vertMatrixInverseEnabled&&r.default.IsWebGL1()&&(this.addVertFunction(a.default.__glslInverseMat3),this.addVertFunction(a.default.__glslInverseMat4)),s+=this.A_z,t=0,e=this.A_n.length;t<e;t++)s+="\n"+this.A_n[t];let i=!1,h=this.A_0.indexOf("{");if(h>0){let t=this.A_0.slice(0,h);i=t.indexOf(" main")>0,i||(i=this.A_0.indexOf(" main")>0)}return i?s+=this.A_0:(s+="\nvoid main() {\n",s+=this.A_0,s+="\n}\n"),s}}e.default=l},"4cf7":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("7918");class r{constructor(){this.A_5=[],this.A_6=[],this.A_7=[],this.A_8=[]}addTexture(t){switch(t.getType()){case i.TextureProxyType.Image:this.A_5.push(t);break;case i.TextureProxyType.Bytes:this.A_6.push(t);break;case i.TextureProxyType.Float:this.A_7.push(t);break;case i.TextureProxyType.Wrapper:this.A_8.push(t);break;default:break}}getTexture(t){switch(t){case i.TextureProxyType.Image:if(this.A_5.length>0)return this.A_5.pop();break;case i.TextureProxyType.Bytes:if(this.A_6.length>0)return this.A_6.pop();break;case i.TextureProxyType.Float:if(this.A_7.length>0)return this.A_7.pop();break;case i.TextureProxyType.Wrapper:if(this.A_8.length>0)return this.A_8.pop();break;default:break}return null}}e.TexturePool=r,e.default=r},"4efa":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("839a"),r=s("a9f4");class a{constructor(t){this.A_9=null,this.W_=[],this.A_9=t}reset(){this.W_=[]}getTextures(){return this.W_}getTexturesTotal(){return this.W_.length}addDiffuseMap(t){null!=t&&(this.A_9.addDiffuseMap(),this.W_.push(t))}addNormalMap(t){null!=t&&(this.A_9.addNormalMap(),this.W_.push(t))}addParallaxMap(t,e){null!=t&&(this.A_9.addParallaxMap(e),this.W_.push(t))}addDisplacementMap(t,e){null!=t&&(this.A_9.addDisplacementMap(e),this.W_.push(t))}addSpecularMap(t,e=i.SpecularMode.Default){null!=t&&(this.A_9.addSpecularMap(e),this.W_.push(t))}addShadowMap(t,e=r.ShadowMode.VSM){null!=t&&(this.A_9.addShadowMap(e),this.W_.push(t))}addSpecularEnvMap(t,e=!0){null!=t&&(this.A_9.addSpecularEnvMap(e),this.W_.push(t))}addAOMap(t){null!=t&&(this.A_9.addAOMap(),this.W_.push(t))}addRoughnessMap(t){null!=t&&(this.A_9.addRoughnessMap(),this.W_.push(t))}addMetalnessMap(t){null!=t&&(this.A_9.addMetalnessMap(),this.W_.push(t))}addARMMap(t){null!=t&&(this.A_9.addARMMap(),this.W_.push(t))}add2DMap(t,e="",s=!0,i=!0,r=!1){null!=t&&(this.A_9.add2DMap(e,s,i,r),this.W_.push(t))}addCubeMap(t,e="",s=!0,i=!1){null!=t&&(this.A_9.addCubeMap(e,s,i),this.W_.push(t))}add3DMap(t,e="",s=!0,i=!1){null!=t&&(this.A_9.add3DMap(e,s,i),this.W_.push(t))}}e.ShaderTextureBuilder=a},"4f27":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=s("d53d"),h=i(s("2560")),n=i(s("83d1")),l=i(s("a7ed")),_=i(s("857b")),o=i(s("e87b"));class m extends a.ShaderUniform{use(t){}useByLocation(t,e,s,i){}useByShd(t,e){}updateData(){}destroy(){}}m.EmptyUniform=new m;class u{constructor(){this.A_=!0,this.AY=new Map,this.BA=[],this.BB=0,this.BC=new a.ShaderUniform}appendUniformBuilder(t){this.AY.has(t.getIDNS())||(this.BA.push(t),this.AY.set(t.getIDNS(),t),this.BB=this.BA.length)}initialize(){this.A_&&(this.A_=!1,this.appendUniformBuilder(new h.default),this.appendUniformBuilder(new l.default),this.appendUniformBuilder(new _.default),this.appendUniformBuilder(new n.default),this.appendUniformBuilder(new o.default))}addSharedUniformBuilder(t){null==t||this.AY.has(t.getIDNS())||(this.BA.push(t),this.AY.set(t.getIDNS(),t),++this.BB)}removeSharedUniformBuilder(t){if(null!=t&&this.AY.has(t.getIDNS())){for(let e=0;e<this.BB;++e)if(t==this.BA[e]){this.BA.splice(e,1),--this.BB;break}this.AY.delete(t.getIDNS())}}removeSharedUniformBuilderByName(t){if(this.AY.has(t)){let e=this.AY.get(t);for(let t=0;t<this.BB;++t)if(e==this.BA[t]){this.BA.splice(t,1),--this.BB;break}this.AY.delete(t)}}buildShared(t,e,s){let i,r=null,a=null,h=this.BA,n=0,l=this.BB,_=null;for(;n<l;++n)_=h[n].create(e,s),null!=_&&(null!=a?a.next=_:null==r&&(r=_),a=_);if(null==t)i=r;else if(null!=r){for(let e=0;e<t.length;++e)a.next=t[e],a=a.next;i=r}if(null==i)i=m.EmptyUniform;else{let t=i,e=0;while(null!=t){if(null!=t.uniformNameList&&null==t.locations)for(t.types=[],t.locations=[],t.uniformSize=t.uniformNameList.length,e=0;e<t.uniformSize;++e)t.types.push(s.getUniformTypeByNS(t.uniformNameList[e])),t.locations.push(s.getUniformLocationByNS(t.uniformNameList[e]));t=t.next}}return i}buildLocalFromTransformV(t,e){if(null!=t){let s;return s=new a.ShaderMat4Uniform,s.uniformSize=0,s.uniformNameList=[],s.types=[],s.locations=[],s.dataList=[],s.dataSizeList=[],s.uniformSize+=1,s.uniformNameList.push("u_objMat"),s.types.push(e.getUniformTypeByNS("u_objMat")),s.locations.push(e.getUniformLocationByNS("u_objMat")),s.dataList.push(t),s.dataSizeList.push(1),s}return this.BC}updateLocalFromTransformV(t,e,s){if(null!=e){let i,r=t;return null==r?(r=new a.ShaderMat4Uniform,i=r,i.uniformSize=0,i.uniformNameList=[],i.types=[],i.locations=[],i.dataList=[],i.dataSizeList=[],i.uniformSize+=1,i.uniformNameList.push("u_objMat"),i.types.push(s.getUniformTypeByNS("u_objMat")),i.locations.push(s.getUniformLocationByNS("u_objMat")),i.dataList.push(e),i.dataSizeList.push(1)):(i=r,i.locations=[],i.locations.push(s.getUniformLocationByNS("u_objMat"))),i}return this.BC}buildLocalFromData(t,e){if(null!=t){let s;s=r.default.IsWebGL1()?new a.ShaderUniformV1:new a.ShaderUniformV2,s.uns=t.uns,s.uniformNameList=[],s.types=[],s.locations=[],s.dataList=[],s.dataSizeList=[],s.uniformSize=0;let i=t,h=0;while(null!=i){if(null!=i.uniformNameList&&null==i.locations)for(s.uniformSize+=i.uniformNameList.length,h=0;h<s.uniformSize;++h)s.uniformNameList.push(i.uniformNameList[h]),s.types.push(e.getUniformTypeByNS(i.uniformNameList[h])),s.locations.push(e.getUniformLocationByNS(i.uniformNameList[h])),s.dataList.push(i.dataList[h]),s.dataSizeList.push(e.getUniformLengthByNS(i.uniformNameList[h]));i=i.next}return s}return m.EmptyUniform}}e.default=u},"50e8":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73"));e.RendererDevice=r.default;const a=i(s("c497"));e.RendererParam=a.default;const h=i(s("8e17"));e.Vector3D=h.default;const n=i(s("5336")),l=i(s("b161"));e.RendererScene=l.default;const _=i(s("f63b")),o=s("da82"),m=i(s("18c7"));e.Matrix4=m.default;class u{constructor(){this.BD=null,this.BE=null,this.BF=-1,this.BG=50,this.BH=null,this.interaction=new o.UserInteraction}getImageTexByUrl(t,e=!0,s=!0){return null!=this.BH?this.BH.getTexByUrl(t,e,s):null}addEntity(t,e=0){null!=this.BD&&this.BD.addEntity(t,e,!0)}getRendererScene(){return this.BD}createRendererScene(){return new l.default}initialize(t=null,e=50,s=!0){if(null==this.BD){this.BG=e,r.default.SHADERCODE_TRACE_ENABLED=!1,r.default.VERT_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED=!0,r.default.FRAG_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED=!0,null==t&&(t=new a.default),t.setPolygonOffsetEanbled(!1),t.setAttriAlpha(!1),t.setAttriAntialias(!r.default.IsMobileWeb()),t.setCamProject(45,30,9e3),t.setCamPosition(1800,1800,1800);let i=new l.default;i.initialize(t,7),this.BD=i,this.interaction.initialize(this.BD),this.BH=new _.default(this.BD.textureBlock),s&&(this.BE=new n.default,this.BE.initialize()),this.update()}}update(){this.BF>-1&&clearTimeout(this.BF),this.BF=setTimeout(this.update.bind(this),this.BG),null!=this.BE&&this.BE.render()}run(){null!=this.BE&&this.BE.update(!1),null!=this.BD&&(this.interaction.run(),this.BD.run(!0))}}e.Instance=u},5216:function(t,e,s){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t["ENV_LIGHT_PARAM"]=0]="ENV_LIGHT_PARAM",t[t["ENV_AMBIENT_LIGHT"]=1]="ENV_AMBIENT_LIGHT",t[t["FOG"]=2]="FOG",t[t["FOG_EXP2"]=3]="FOG_EXP2",t[t["VSM_SHADOW"]=4]="VSM_SHADOW",t[t["GLOBAL_LIGHT"]=5]="GLOBAL_LIGHT"}(i||(i={})),e.MaterialPipeType=i},"52e0":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("7918"),a=s("8d98"),h=i(s("0851"));class n extends h.default{constructor(t,e){super(t,e,!1),this.BI=null,this.g=a.TextureTarget.TEXTURE_CUBE,this.mipmapEnabled=!0,this.j=r.TextureProxyType.BytesCube}toAlphaFormat(){this.srcFormat=a.TextureFormat.ALPHA,this.internalFormat=a.TextureFormat.ALPHA,this.unpackAlignment=1}toRedFormat(){this.srcFormat=a.TextureFormat.RED,this.internalFormat=a.TextureFormat.RED,this.unpackAlignment=1}toRGBFormat(){this.srcFormat=a.TextureFormat.RGB,this.internalFormat=a.TextureFormat.RGB,this.unpackAlignment=1}toRGBAFormat(){this.srcFormat=a.TextureFormat.RGBA,this.internalFormat=a.TextureFormat.RGBA,this.unpackAlignment=4}setDataFromBytesToFaceAt(t,e,s,i,r=0){if(null==this.BI&&(this.BI=[null,null,null,null,null,null]),s>0&&i>0){0==t&&r<1&&(this.c=s,this.d=i,this.b=r),null==this.BI[t]&&(this.BI[t]=new Array(16));let a=this.BI[t];a[r]={width:s,height:i,imgData:e,miplevel:r},this.i=null!=a[r].imgData}}uploadData(t){let e,s,i=t.getRC(),r=null,h=this.getWidth(),n=this.getHeight();for(let l=0;l<6;++l){let t=this.BI[l];if(this.mipmapEnabled&&this.k)r=t[0],i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+l,0,a.TextureFormat.ToGL(i,this.internalFormat),h,n,0,a.TextureFormat.ToGL(i,this.srcFormat),a.TextureDataType.ToGL(i,this.dataType),r.imgData);else{e=h,s=n;let _=0;for(;e>0||s>0;)null!=t[_]&&(r=t[_],i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+l,_,a.TextureFormat.ToGL(i,this.internalFormat),e,s,0,a.TextureFormat.ToGL(i,this.srcFormat),a.TextureDataType.ToGL(i,this.dataType),r.imgData)),e>0&&(e>>=1),s>0&&(s>>=1),++_}}this.version=0}toString(){return"[BytesCubeTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}__$destroy(){if(this.getAttachCount()<1){if(this.version=0,null!=this.BI)for(let t=0;t<6;++t)null!=this.BI[t]&&(this.BI[t].imgData=null);super.__$destroy()}}}e.default=n},5326:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t,e=256){this.BJ=256,this.A=0,this.index=0,this.dataList=null,this.flagList=null,this.A=t,this.BJ=e,this.flagList=new Uint16Array(this.BJ),this.dataList=new Array(this.BJ);for(let s=0;s<this.BJ;++s)this.dataList[s]=null,this.flagList[s]=0}getRCUid(){return this.A}}e.UniformDataSlot=i},5336:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.BK=0,this.BL=60,this.BM=null,this.BN=null,this.BO=10,this.BP=128,this.BQ=128,this.BR=70,this.delayTime=40,this.statusInfo="",this.statusEnbled=!0}initialize(){var t=null;try{void 0!=document&&(t=document)}catch(e){}if(null!=t){this.BP=window.innerWidth;let t=this.BP-20;this.createCanvas(t)}}createCanvas(t){null==this.BM&&(this.BM=document.createElement("canvas"),document.body.appendChild(this.BM),this.BM.style.display="bolck",this.BM.style.left="0px",this.BM.style.top="0px",this.BM.style.position="absolute",this.BM.style.backgroundColor="transparent",this.BM.style.pointerEvents="none",this.BM.height=this.BR),t=t<10?10:t,this.BM.width=t,this.BN=this.BM.getContext("2d"),this.BN.font="50px Verdana",this.BN.fillStyle="red",this.BN.textAlign="left",this.BQ=this.BM.width}getFPS(){return this.BL}getFPSStr(){return this.BL>60?"FPS: 60":this.BL<10?"FPS: 0"+this.BL:"FPS: "+this.BL}render(){if(this.BP!=window.innerWidth){this.BP=window.innerWidth;let t=this.BP-20;this.createCanvas(t)}this.statusEnbled&&(this.BN.clearRect(0,0,this.BQ,this.BR),this.BN.fillText("FPS:"+this.BL+this.statusInfo,5,50))}update(t=!0){if(this.BO>0)--this.BO,this.BK=Date.now();else{if(null!=this.BN){let e=Date.now();this.BK>0&&(this.BK=e-this.BK,this.BK<1&&(this.BK=1),this.BL=Math.round(1e3/this.BK),t&&this.render()),this.BK=e}this.BO=this.delayTime}}}e.default=i},"53d3":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("29ef"));class a{constructor(){this.NORMAL_STATE=0,this.BACK_CULLFACE_NORMAL_STATE=0,this.FRONT_CULLFACE_NORMAL_STATE=1,this.NONE_CULLFACE_NORMAL_STATE=2,this.ALL_CULLFACE_NORMAL_STATE=3,this.BACK_NORMAL_ALWAYS_STATE=4,this.BACK_TRANSPARENT_STATE=5,this.BACK_TRANSPARENT_ALWAYS_STATE=6,this.NONE_TRANSPARENT_STATE=7,this.NONE_TRANSPARENT_ALWAYS_STATE=8,this.FRONT_CULLFACE_GREATER_STATE=9,this.BACK_ADD_BLENDSORT_STATE=10,this.BACK_ADD_ALWAYS_STATE=11,this.BACK_ALPHA_ADD_ALWAYS_STATE=12,this.NONE_ADD_ALWAYS_STATE=13,this.NONE_ADD_BLENDSORT_STATE=14,this.NONE_ALPHA_ADD_ALWAYS_STATE=15,this.FRONT_ADD_ALWAYS_STATE=16,this.FRONT_TRANSPARENT_STATE=17,this.FRONT_TRANSPARENT_ALWAYS_STATE=18,this.NONE_CULLFACE_NORMAL_ALWAYS_STATE=19,this.BACK_ALPHA_ADD_BLENDSORT_STATE=20;let t=r.default,e=this;e.NORMAL_STATE=t.NORMAL_STATE,e.BACK_CULLFACE_NORMAL_STATE=t.BACK_CULLFACE_NORMAL_STATE,e.FRONT_CULLFACE_NORMAL_STATE=t.FRONT_CULLFACE_NORMAL_STATE,e.NONE_CULLFACE_NORMAL_STATE=t.NONE_CULLFACE_NORMAL_STATE,e.ALL_CULLFACE_NORMAL_STATE=t.ALL_CULLFACE_NORMAL_STATE,e.BACK_NORMAL_ALWAYS_STATE=t.BACK_NORMAL_ALWAYS_STATE,e.BACK_TRANSPARENT_STATE=t.BACK_TRANSPARENT_STATE,e.BACK_TRANSPARENT_ALWAYS_STATE=t.BACK_TRANSPARENT_ALWAYS_STATE,e.NONE_TRANSPARENT_STATE=t.NONE_TRANSPARENT_STATE,e.NONE_TRANSPARENT_ALWAYS_STATE=t.NONE_TRANSPARENT_ALWAYS_STATE,e.FRONT_CULLFACE_GREATER_STATE=t.FRONT_CULLFACE_GREATER_STATE,e.BACK_ADD_BLENDSORT_STATE=t.BACK_ADD_BLENDSORT_STATE,e.BACK_ADD_ALWAYS_STATE=t.BACK_ADD_ALWAYS_STATE,e.BACK_ALPHA_ADD_ALWAYS_STATE=t.BACK_ALPHA_ADD_ALWAYS_STATE,e.NONE_ADD_ALWAYS_STATE=t.NONE_ADD_ALWAYS_STATE,e.NONE_ADD_BLENDSORT_STATE=t.NONE_ADD_BLENDSORT_STATE,e.NONE_ALPHA_ADD_ALWAYS_STATE=t.NONE_ALPHA_ADD_ALWAYS_STATE,e.FRONT_ADD_ALWAYS_STATE=t.FRONT_ADD_ALWAYS_STATE,e.FRONT_TRANSPARENT_STATE=t.FRONT_TRANSPARENT_STATE,e.FRONT_TRANSPARENT_ALWAYS_STATE=t.FRONT_TRANSPARENT_ALWAYS_STATE,e.NONE_CULLFACE_NORMAL_ALWAYS_STATE=t.NONE_CULLFACE_NORMAL_ALWAYS_STATE,e.BACK_ALPHA_ADD_BLENDSORT_STATE=t.BACK_ALPHA_ADD_BLENDSORT_STATE}}e.RenderingState=a},"53ea":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17")),a=i(s("e214"));class h{constructor(){this.Ar=null,this.t=null,this.BS=new r.default,this.BT=new r.default,this.BU=new r.default(0,1,0),this.BV=0,this.position=new r.default}bindCameraAndStage(t,e){this.Ar=t,this.t=e}setPlaneParam(t,e){this.BU.copyFrom(t),this.BU.normalize(),this.BV=e}intersectPlane(){null!=this.Ar&&null!=this.t&&(this.Ar.update(),this.Ar.getWorldPickingRayByScreenXY(this.t.mouseX,this.t.mouseY,this.BS,this.BT),a.default.IntersectionSLV2(this.BU,this.BV,this.BS,this.BT,this.position))}destroy(){this.Ar=null,this.t=null}}e.default=h},"557f":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("7918"),a=s("8d98"),h=i(s("0851"));class n extends h.default{constructor(t,e,s=1,i=!1){super(t,e,i),this.BW=null,this.BX=1,this.internalFormat=a.TextureFormat.R8,this.srcFormat=a.TextureFormat.RED,this.BX=s,this.g=a.TextureTarget.TEXTURE_3D,this.j=r.TextureProxyType.Texture3D,this.unpackAlignment=1}getDepth(){return this.BX}uploadFromTypedArray(t,e=0){this.isGpuEnabled()||(this.BW=t,this.b=e,this.i=!0)}uploadData(t){if(null!=this.BW){let e=t.getRC();e.pixelStorei(e.UNPACK_ALIGNMENT,1),e.texImage3D(e.TEXTURE_3D,0,a.TextureFormat.ToGL(e,this.internalFormat),this.c,this.d,this.BX,0,a.TextureFormat.ToGL(e,this.srcFormat),e.UNSIGNED_BYTE,this.BW),e.pixelStorei(e.UNPACK_ALIGNMENT,4)}}__$destroy(){this.getAttachCount()<1&&(this.BW=null,super.__$destroy())}toString(){return"[Texture3DProxy(width="+this.getWidth()+",height="+this.getHeight()+",depth="+this.getDepth()+")]"}}e.default=n},"56c5":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("030e"));class a{static SetRenderer(t){a.AM=t.getRC(),a.BY=t.getWebGLVersion();let e=a;1==a.BY&&null!=r.default.WEBGL_draw_buffers?e.COLOR_ATTACHMENT0=r.default.WEBGL_draw_buffers.COLOR_ATTACHMENT0_WEBGL:e.COLOR_ATTACHMENT0=a.AM.COLOR_ATTACHMENT0}static DrawBuffers(t){2==a.BY?a.AM.drawBuffers(t):null!=r.default.WEBGL_draw_buffers&&r.default.WEBGL_draw_buffers.drawBuffersWEBGL(t)}}a.AM=null,a.BY=2,a.COLOR_ATTACHMENT0=0,e.default=a},"5d04":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("7918"),a=s("8d98"),h=i(s("4cf7")),n=i(s("5e78")),l=i(s("fe7f")),_=i(s("9f3e")),o=i(s("f928")),m=i(s("eaee")),u=i(s("52e0")),d=i(s("d314")),c=i(s("557f")),f=i(s("da6a")),p=s("ccdf");class g{constructor(){this.BZ=new h.default,this.Ba=null,this.Z=null,this.Bb=[],this.Bc=128}addTexLoader(t){if(null!=t){let e=0,s=this.Bb.length;for(;e<s;++e)if(t==this.Bb[e])break;e>=s&&this.Bb.push(t)}}removeTexLoader(t){if(null!=t){let e=0,s=this.Bb.length;for(;e<s;++e)if(t==this.Bb[e]){this.Bb.slice(e,1);break}}}setRenderer(t){this.Z=t,f.default.GetInstance().setRenderProxy(t),null==this.Ba&&null!=t&&(this.Ba=new p.RTTTextureStore(t))}getRTTStrore(){return this.Ba}createWrapperTex(t,e,s=!1){return this.Ba.createWrapperTex(t,e,s)}createRTTTex2D(t,e,s=!1){let i=this.Ba.createRTTTex2D(t,e,s);return i.__$setRenderProxy(this.Z),i}createImageTex2D(t,e,s=!1){let i=this.BZ.getTexture(r.TextureProxyType.Image);return null==i&&(i=new n.default(t,e,s)),i.__$setRenderProxy(this.Z),i.mipmapEnabled=!0,i.setWrap(a.TextureConst.WRAP_REPEAT),i}createHalfFloatTex2D(t,e,s=!1){let i=this.BZ.getTexture(r.TextureProxyType.Float);return null==i&&(i=new o.default(t,e,s)),i.__$setRenderProxy(this.Z),i.srcFormat=a.TextureFormat.RGBA,i.dataType=a.TextureDataType.HALF_FLOAT_OES,i}createFloatTex2D(t,e,s=!1){let i=this.BZ.getTexture(r.TextureProxyType.Float);return null==i&&(i=new o.default(t,e,s)),i.__$setRenderProxy(this.Z),i}createUint16Tex2D(t,e,s=!1){return new _.default(t,e,s)}createFloatCubeTex(t,e,s=!1){return new m.default(t,e)}createBytesTex(t,e){let s=this.BZ.getTexture(r.TextureProxyType.Bytes);return null==s&&(s=new l.default(t,e)),s.__$setRenderProxy(this.Z),s}createBytesCubeTex(t,e){let s=new u.default(t,e);return s.__$setRenderProxy(this.Z),s}createImageCubeTex(t,e){let s=new d.default(t,e);return s.__$setRenderProxy(this.Z),s}createTex3D(t,e,s=1){s<1&&(s=1);let i=new c.default(t,e,s);return i.__$setRenderProxy(this.Z),i}createRGBATex2D(t,e,s){t=t>1?t:1,e=e>1?e:1;let i=t*e,r=this.createBytesTex(t,e),a=new Uint8Array(4*i),h=Math.round(255*s.r),n=Math.round(255*s.g),l=Math.round(255*s.b),_=Math.round(255*s.a),o=0,m=[h,n,l,_];for(let u=0;u<i;++u)a.set(m,o),o+=4;return r.setDataFromBytes(a,0,t,e,0,0,!1),r.__$setRenderProxy(this.Z),r}createAlphaTex2D(t,e,s){t=t>1?t:1,e=e>1?e:1;let i=t*e,r=this.createBytesTex(t,e);r.toAlphaFormat();let a=new Uint8Array(i),h=Math.round(255*s);return a.fill(h,0,i),r.setDataFromBytes(a,0,t,e,0,0,!1),r.__$setRenderProxy(this.Z),r}createAlphaTexBytes2D(t,e,s){let i=this.createBytesTex(t,e);return i.setDataFromBytes(s,0,t,e,0,0,!1),i.toAlphaFormat(),i.__$setRenderProxy(this.Z),i}getCubeRTTTextureAt(t){return this.Ba.getCubeRTTTextureAt(t)}createCubeRTTTextureAt(t,e,s){return this.Ba.createCubeRTTTextureAt(t,e,s)}getRTTTextureAt(t){return this.Ba.getRTTTextureAt(t)}createRTTTextureAt(t,e,s){return this.Ba.createRTTTextureAt(t,e,s)}getDepthTextureAt(t){return this.Ba.getDepthTextureAt(t)}createDepthTextureAt(t,e,s){return this.Ba.createDepthTextureAt(t,e,s)}getRTTFloatTextureAt(t){return this.Ba.getRTTFloatTextureAt(t)}createRTTFloatTextureAt(t,e,s){return this.Ba.createRTTFloatTextureAt(t,e,s)}run(){let t=0,e=this.Bb.length;for(;t<e;++t)this.Bb[t].run();if(this.Bc<1){let t;this.Bc=128;let e=f.default.GetInstance().getFreeResUidMap(),s=32;for(const[i,r]of e){if(s<1)break;s--,r>2?(e.delete(i),t=f.default.GetInstance().removeTextureByUid(i),null!=t&&this.BZ.addTexture(t)):e.set(i,r+1)}}this.Bc--}}e.TextureBlock=g},"5e78":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("7918"),a=s("8d98"),h=i(s("7181")),n=i(s("0851"));class l extends n.default{constructor(t,e,s=!1){super(t,e,s),this.Bd=null,this.Be=null,this.Bf=0,this.mipmapEnabled=!0,this.minFilter=a.TextureConst.LINEAR_MIPMAP_LINEAR,this.j=r.TextureProxyType.Image}getTexData(){return this.Bd}setDataFromImage(t,e=0,s=0,i=0,r=!1){if(null!=t&&t.width>0&&t.height>0){this.i=!0,e<0&&(e=0),e>15&&(e=15),e>=this.Bf&&(this.Bf=e+1);let a=this.Bd;null!=a?this.Bd.miplevel!=e?(null==this.Be&&(this.Be=[this.Bd,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]),a=this.Be[e],null==a&&(a=h.default.Create(),a.miplevel=e,r=!0,this.Be[e]=a)):this.isGpuEnabled()&&(a.status=0):(a=this.Bd=h.default.Create(),a.miplevel=e,r=!0,this.c=t.width,this.d=t.height),a.data==t&&a.offsetx==s&&a.offsety==i||(0==e&&(this.c=t.width,this.d=t.height),a.data=t,a.status=0,(a.width<t.width||a.height<t.height||r)&&(a.width=t.width,a.height=t.height,a.status=1),a.offsetx=s,a.offsety=i),this.version++}}uploadData(t){null!=this.Bd&&this.dataUploadToGpu(t.getRC(),this.Bd,this.Be,!0),this.version=0}__$updateToGpu(t){if(this.version>0&&t.hasResUid(this.getResUid())&&null!=this.Bd){let e=t.getRC();this.__$updateToGpuBegin(t),this.dataUploadToGpu(e,this.Bd,this.Be),this.__$buildParam(e),this.k=!0}}__$destroy(){if(this.getAttachCount()<1){if(this.version=0,null!=this.Be){for(let t=0;t<this.Bf;++t)h.default.Restore(this.Be[t]);this.Bf=0,this.Be=null,this.Bd=null}null!=this.Bd&&(h.default.Restore(this.Bd),this.Bd=null),super.__$destroy()}}toString(){return"[ImageTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=l},"5f3c":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=i(s("df9d")),h=s("070b"),n=s("a5ba");class l{constructor(t){this.T=-1,this.Bg=new a.default,this.An=null,this.index=-1,this.shdUid=-1,this.procuid=-1,this.batchEnabled=!0,this.fixedState=!0,this.runMode=0,this.rpoNodeBuilder=null,this.rpoUnitBuilder=null,this.vtxResource=null,this.An=t,this.T=l.EM++}showInfo(){this.Bg.showInfo()}addNode(t){this.Bg.addNodeAndSort(t)}rejoinNode(t){this.Bg.containsNode(t)&&(this.Bg.removeNodeAndSort(t),this.Bg.addNodeAndSort(t))}removeNode(t){this.Bg.removeNodeAndSort(t)}isEmpty(){return null==this.Bg.getBegin()}run(t){switch(this.runMode){case 2:this.run2(t);break;case 1:this.run1(t);break;case 0:this.run0(t);break;default:break}}run0(t){let e=this.Bg.getBegin();if(null!=e){this.An.bindToGpu(this.shdUid),this.An.resetUniform();let s=null;while(null!=e)e.drawEnabled&&(s=e.unit,s.drawEnabled&&(s.run(t),s.partTotal<1?s.drawThis(t):s.drawPart(t))),e=e.next}}run1(t){let e=this.Bg.getBegin();if(null!=e){this.An.bindToGpu(this.shdUid),this.An.resetUniform();let s=null,i=this.Bg.getVtxTotalAt(e.rvroI),r=this.Bg.getTexTotalAt(e.rtroI),a=i>0,h=r>0;while(null!=e)i<1&&(i=this.Bg.getVtxTotalAt(e.rvroI),a=!0),i--,r<1&&(r=this.Bg.getTexTotalAt(e.rtroI),h=!0),r--,e.drawEnabled&&(s=e.unit,s.drawEnabled&&(a&&(e.vro.run(),a=!1),h&&(e.tro.run(),h=!1),s.run2(t),s.partTotal<1?s.drawThis(t):s.drawPart(t))),e=e.next}}run2(t){let e=this.Bg.getBegin();if(null!=e){this.An.bindToGpu(this.shdUid),this.An.resetUniform();let s=null;n.RenderStateObject.UseRenderState(e.unit.renderState),h.RenderColorMask.UseRenderState(e.unit.rcolorMask);let i=this.Bg.getVtxTotalAt(e.rvroI),r=this.Bg.getTexTotalAt(e.rtroI),a=i>0,l=r>0;while(null!=e)i<0&&(i=this.Bg.getVtxTotalAt(e.rvroI),a=!0),i--,r<0&&(r=this.Bg.getTexTotalAt(e.rtroI),l=!0),r--,e.drawEnabled&&(s=e.unit,s.drawEnabled&&(a&&(e.vro.run(),a=!1),l&&(e.tro.run(),l=!1),null!=s.ubo&&s.ubo.run(t),this.An.useTransUniform(s.transUniform),this.An.useUniform(s.uniform),s.partTotal<1?s.drawThis(t):s.drawPart(t))),e=e.next}}runLockMaterial(t){let e=this.Bg.getBegin();if(null!=e){this.An.bindToGpu(this.shdUid),this.An.resetUniform();let s=this.An.isTextureUnLocked();t.Texture.unlocked=s;let i=null;if(this.batchEnabled){let r=this.Bg.getVtxTotalAt(e.rvroI),a=r>0;while(null!=e)r<1&&(r=this.Bg.getVtxTotalAt(e.rvroI),a=!0),r--,i=e.unit,e.drawEnabled&&i.drawEnabled&&(a&&(e.vro.run(),a=!1),s&&e.tro.run(),i.runLockMaterial2(null),i.partTotal<1?i.drawThis(t):i.drawPart(t)),e=e.next}else while(null!=e)i=e.unit,e.drawEnabled&&i.drawEnabled&&(i.runLockMaterial(),s&&e.tro.run(),i.partTotal<1?i.drawThis(t):i.drawPart(t)),e=e.next;t.Texture.unlocked=!1}}drawUnit(t,e,s){e.drawEnabled&&(this.An.bindToGpu(e.shdUid),e.run(t),e.partTotal<1?e.drawThis(t):e.drawPart(t))}drawLockMaterialByUnit(t,e,s,i,a){if(e.drawEnabled){if(a&&this.An.resetUniform(),r.default.IsMobileWeb()){let t=this.vtxResource.getVROByResUid(s.vbuf.getUid(),this.An.getCurrentShd(),!0);t.run()}else e.vro.run();e.runLockMaterial2(i?this.An.__$globalUniform:null),e.partTotal<1?e.drawThis(t):e.drawPart(t)}}reset(){let t=this.Bg.getBegin(),e=null;if(null!=t){let s;while(null!=t)e=t,t=t.next,this.rpoUnitBuilder.setRPNodeParam(e.__$ruid,this.procuid,-1),e.reset(),s=e.unit,this.rpoNodeBuilder.restore(e)&&this.rpoUnitBuilder.restore(s)}this.index=-1,this.shdUid=-1,this.procuid=-1,this.Bg.clear(),this.rpoNodeBuilder=null,this.rpoUnitBuilder=null,this.vtxResource=null}destroy(){this.reset()}getUid(){return this.T}toString(){return"[RPOBlock(uid = "+this.T+", index = "+this.index+", shdUid = "+this.shdUid+")]"}}l.EM=0,e.default=l},"644c":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){}static GetTypeByTypeNS(t){switch(t){case"mat4":return i.SHADER_MAT4;case"mat3":return i.SHADER_MAT3;case"mat2":return i.SHADER_MAT2;case"float":return i.SHADER_FLOAT;case"int":return i.SHADER_INT;case"vec4":return i.SHADER_VEC4;case"vec3":return i.SHADER_VEC3;case"vec2":return i.SHADER_VEC2;case"vec4[]":return i.SHADER_VEC4FV;case"vec3[]":return i.SHADER_VEC3FV;case"vec2[]":return i.SHADER_VEC2FV;case"sampler2D":return i.SHADER_SAMPLER2D;case"sampler3D":return i.SHADER_SAMPLER3D;case"samplerCube":return i.SHADER_SAMPLERCUBE;default:break}return i.SHADER_UNDEFINED}static GetTypeNSByType(t){switch(t){case i.SHADER_MAT4:return"mat4";case i.SHADER_MAT3:return"mat3";case i.SHADER_MAT2:return"mat2";case i.SHADER_FLOAT:return"float";case i.SHADER_VEC4:return"vec4";case i.SHADER_VEC3:return"vec3";case i.SHADER_VEC2:return"vec2";case i.SHADER_SAMPLER2D:return"sampler2D";case i.SHADER_SAMPLER3D:return"sampler3D";case i.SHADER_SAMPLERCUBE:return"samplerCube";case i.SHADER_UNDEFINED:return"undefined";default:break}return""}}i.ATTRINS_VTX_VS="a_vs",i.ATTRINS_VTX_UVS="a_uvs",i.ATTRINS_VTX_NVS="a_nvs",i.ATTRINS_VTX_CVS="a_cvs",i.UNIFORMNS_OBJ_MAT_NS="u_objMat",i.UNIFORMNS_VIEW_MAT_NS="u_viewMat",i.UNIFORMNS_PROJ_MAT_NS="u_projMat",i.SHADER_UNDEFINED=3010,i.SHADER_VEC2=3011,i.SHADER_VEC3=3012,i.SHADER_VEC4=3013,i.SHADER_VEC2FV=3014,i.SHADER_VEC3FV=3015,i.SHADER_VEC4FV=3016,i.SHADER_MAT2=3017,i.SHADER_MAT3=3018,i.SHADER_MAT4=3019,i.SHADER_FLOAT=3020,i.SHADER_INT=3021,i.SHADER_MAT2FV=3022,i.SHADER_MAT3FV=3023,i.SHADER_MAT4FV=3024,i.SHADER_SAMPLER2D=3031,i.SHADER_SAMPLERCUBE=3032,i.SHADER_SAMPLER3D=3033,i.SHADER_PRECISION_LOWP=3101,i.SHADER_PRECISION_MEDIUMP=3111,i.SHADER_PRECISION_HIGHP=3121,i.UNIFORM_TEX_SAMPLER2D="sampler2D",i.UNIFORM_TEX_SAMPLERCUBE="samplerCube",i.UNIFORM_TEX_SAMPLER3D="sampler3D",i.UNIFORMNS_TEX_SAMPLER_0="u_sampler0",i.UNIFORMNS_TEX_SAMPLER_1="u_sampler1",i.UNIFORMNS_TEX_SAMPLER_2="u_sampler2",i.UNIFORMNS_TEX_SAMPLER_3="u_sampler3",i.UNIFORMNS_TEX_SAMPLER_4="u_sampler4",i.UNIFORMNS_TEX_SAMPLER_5="u_sampler5",i.UNIFORMNS_TEX_SAMPLER_6="u_sampler6",i.UNIFORMNS_TEX_SAMPLER_7="u_sampler7",i.UNIFORMNS_TEX_SAMPLER_LIST=[i.UNIFORMNS_TEX_SAMPLER_0,i.UNIFORMNS_TEX_SAMPLER_1,i.UNIFORMNS_TEX_SAMPLER_2,i.UNIFORMNS_TEX_SAMPLER_3,i.UNIFORMNS_TEX_SAMPLER_4,i.UNIFORMNS_TEX_SAMPLER_5,i.UNIFORMNS_TEX_SAMPLER_6,i.UNIFORMNS_TEX_SAMPLER_7],e.default=i},"670e":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("45db"),r=s("8ae4");class a{constructor(){this.version=-1,this.waitDelTimes=0,this.rcuid=0,this.resUid=0,this.vertex=new i.ROVertexRes,this.indices=new r.ROIndicesRes,this.Y=0}__$attachThis(){++this.Y}__$detachThis(){--this.Y,this.Y<1&&(this.Y=0)}getAttachCount(){return this.Y}createVRO(t,e,s){let i=this.vertex.createVRO(t,e,s,this.indices,this.indices.getUid());return i.ibufStep=this.indices.ibufStep,i}updateToGpu(t){this.indices.updateToGpu(t),this.vertex.updateToGpu(t)}destroy(t){this.getAttachCount()<1&&this.resUid>=0&&(this.vertex.destroy(t),this.indices.destroy(t),this.resUid=-1)}}e.GpuVtxObject=a},"68aa":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.width=0,this.height=0,this.data=null,this.miplevel=0,this.status=1,this.offsetx=0,this.offsety=0}updateToGpu(t,e,s,i,r,a){1==this.status||a?t.texImage2D(e,this.miplevel,s,this.width,this.height,0,i,r,this.data):0==this.status&&t.texSubImage2D(e,this.miplevel,this.offsetx,this.offsety,this.width,this.height,i,r,this.data),this.status=-1}static Create(){return i.En.length>0?i.En.pop():new i}static Restore(t){null!=t&&(t.data=null,i.En.push(t))}}i.En=[],e.default=i},"6d49":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=i(s("baae")),h=s("8d98"),n=i(s("56c5"));class l{constructor(t,e,s){this.T=-1,this.A=0,this.Bh=0,this.Bi=null,this.Bj=null,this.Bk=null,this.Bl=null,this.BQ=512,this.BR=512,this.Bm=0,this.s=null,this.Bn=0,this.Bo=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.Bp=[!0,!0,!0,!0,!0,!0,!0,!0],this.Bq=0,this.Br=0,this.EO=0,this.Bs=0,this.Bt=new Float32Array(1),this.Bu=new Float32Array(4),this.Bv=new Int16Array(4),this.Bw=!1,this.textureLevel=0,this.sizeFixed=!1,this.writeDepthEnabled=!0,this.writeStencilEnabled=!1,this.multisampleEnabled=!1,this.multisampleLevel=0,this.Bx=new Uint32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),this.By=new Uint32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),this.Bz=0,this.B0=!1,this.B1=2,this.B2=2,this.A=t,this.A7=e,this.Bm=s,this.T=l.EM++}getUid(){return this.T}resetAttachmentMask(t){let e=this.Bp.length-1;while(e>=0)this.Bp[e]=t,--e}setAttachmentMaskAt(t,e){this.Bp[t]=e}getActiveAttachmentTotal(){return this.B0?this.EO-1:this.EO}getAttachmentTotal(){return this.Bp.length}bindToBackbuffer(t){switch(t){case a.default.DRAW_FRAMEBUFFER:this.s.bindFramebuffer(this.s.DRAW_FRAMEBUFFER,null);break;case a.default.READ_FRAMEBUFFER:this.s.indFramebuffer(this.s.READ_FRAMEBUFFER,null);break;default:this.s.bindFramebuffer(this.s.FRAMEBUFFER,null)}}bind(t){if(null!=this.Bi)switch(t){case a.default.DRAW_FRAMEBUFFER:this.s.bindFramebuffer(this.s.DRAW_FRAMEBUFFER,this.Bi);break;case a.default.READ_FRAMEBUFFER:this.s.bindFramebuffer(this.s.READ_FRAMEBUFFER,this.Bi);break;default:this.s.bindFramebuffer(this.s.FRAMEBUFFER,this.Bi)}}getFBO(){return this.Bi}getDepthStencilRBO(){return this.Bj}getDepthRBO(){return this.Bk}getWidth(){return this.BQ}getHeight(){return this.BR}getFramebufferType(){return this.Bm}renderToTexAt(t,e,s){let i=null!=e?e.internalFormat:-1;this.s=t,0==s&&(this.Bz=0,this.B0=!1,this.s.bindFramebuffer(this.Bn,this.Bi),i!=h.TextureFormat.DEPTH_COMPONENT&&i!=h.TextureFormat.DEPTH_STENCIL&&(this.EO=0,this.Bs=0));let r=-1,a=null;null!=e?(r=e.getTargetType(),a=this.A7.getGpuBuffer(e.getResUid()),e.uploadFromFbo(this.A7,this.BQ,this.BR)):r=this.Bo[this.EO],this.framebufferTextureBind(t,r,i,a)}glFramebufferTex2D(t,e){let s=this.s;s.framebufferTexture2D(this.Bn,t,s.TEXTURE_2D,e,0),this.Bx[this.Bz]=t,this.By[this.Bz]=s.TEXTURE_2D,this.Bz++}glFramebufferTexCube(t,e,s){let i=this.s;i.framebufferTexture2D(this.Bn,t,i.TEXTURE_CUBE_MAP_POSITIVE_X+e,s,0),this.Bx[this.Bz]=t,this.By[this.Bz]=i.TEXTURE_CUBE_MAP_POSITIVE_X+e,this.Bz++}framebufferTexture2D(t,e,s,i){let r=-1;switch(s){case h.TextureFormat.DEPTH_COMPONENT:this.B0=!0,r=this.s.DEPTH_ATTACHMENT;break;case h.TextureFormat.DEPTH_STENCIL:this.B0=!0,r=this.s.DEPTH_STENCIL_ATTACHMENT;break;default:r=this.Bh+this.Bs;break}r>0&&(this.Bp[this.EO]?(this.glFramebufferTex2D(r,i),++this.Bs,this.Bo[this.EO]=null!=i?e:0):this.Bo[this.EO]=0,++this.EO)}framebufferTextureBind(t,e,s,i){switch(e){case h.TextureTarget.TEXTURE_2D:this.framebufferTexture2D(t,e,s,i);break;case h.TextureTarget.TEXTURE_CUBE:let r=0;for(let t=0;t<6;++t)this.Bp[t]?(this.glFramebufferTexCube(this.Bh+this.Bs,t,i),++this.Bs,this.Bo[this.EO+t]=null!=i?e:0,r++):this.Bo[this.EO+t]=0;r=r>0?r:6,this.EO+=r;break;case h.TextureTarget.TEXTURE_SHADOW_2D:this.Bp[this.EO]?(this.glFramebufferTex2D(this.s.DEPTH_ATTACHMENT,i),this.Bo[this.EO]=null!=i?e:0):this.Bo[this.EO]=0,++this.EO;break;default:break}}reset(){this.Bq=-1,this.Br=-1}use(t){if(this.s=t,null!=this.Bi){if(this.EO>1){if(this.Br!=this.Bs){let t=[],e=0;for(;e<this.Bs;++e)t.push(this.Bh+e);if(this.Br>this.Bs)for(;e<this.Br;++e)this.s.framebufferTexture2D(this.Bn,this.Bx[e],this.By[e],null,0);n.default.DrawBuffers(t),this.Br=this.Bs}}else if(this.Br!=this.Bs){if(this.Br>this.Bs)for(let e=1;e<this.Br;++e)this.s.framebufferTexture2D(this.Bn,this.Bx[e],this.By[e],null,0);let t=[this.Bh];n.default.DrawBuffers(t),this.Br=this.Bs}this.Bq=this.EO}}clearOnlyColor(t){if(null!=this.Bi)if(r.default.IsWebGL2())if(this.Bu[0]=t.r,this.Bu[1]=t.g,this.Bu[2]=t.b,this.Bu[3]=t.a,this.Bq>1)for(let e=0;e<this.Bq;++e)this.s.clearBufferfv(this.s.COLOR,e,this.Bu);else this.s.clearBufferfv(this.s.COLOR,0,this.Bu);else this.s.clearColor(t.r,t.g,t.b,t.a)}clearOnlyDepth(t=1){r.default.IsWebGL2()?(this.Bt[0]=t,this.s.clearBufferfv(this.s.DEPTH,0,this.Bt)):this.s.clearDepth(t)}clearOnlyStencil(t){this.Bv[0]=t,this.s.clearBufferuiv(this.s.STENCIL,0,this.Bv)}clearOnlyDepthAndStencil(t,e){this.s.clearBufferfi(this.s.DEPTH_STENCIL,0,t,e)}invalidateFramebuffer(){}resize(t,e){this.B1==t&&this.B2==e||(this.Bw=!0,this.B1=t,this.B2=e)}initialize(t,e,s){this.s=t,this.Bh=n.default.COLOR_ATTACHMENT0,this.Bw&&(e=this.B1,s=this.B2),null==this.Bi?this.createNewFBO(t,e,s):this.BQ==e&&this.BR==s||this.createNewFBO(t,e,s),this.Bw=!1}isSizeChanged(){return this.Bw}destroy(t){null!=this.Bi&&(null!=this.Bj&&(t.deleteFramebuffer(this.Bj),this.Bj=null),null!=this.Bk&&(t.deleteFramebuffer(this.Bk),this.Bk=null),null!=this.Bl&&(t.deleteFramebuffer(this.Bl),this.Bl=null),t.deleteFramebuffer(this.Bi),this.Bi=null),this.s=null,this.Bn=0,this.Bw=!1}buildDepthStencilRBO(t,e,s){null==this.Bj&&(this.Bj=t.createRenderbuffer()),this.multisampleEnabled?(t.bindRenderbuffer(t.RENDERBUFFER,this.Bj),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.DEPTH_STENCIL,e,s),t.framebufferRenderbuffer(this.Bn,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this.Bj),null==this.Bl&&(this.Bl=t.createRenderbuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.Bl),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.RGBA8,e,s),t.framebufferRenderbuffer(this.Bn,this.Bh,t.RENDERBUFFER,this.Bl)):(t.bindRenderbuffer(t.RENDERBUFFER,this.Bj),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,e,s),t.framebufferRenderbuffer(this.Bn,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this.Bj))}buildDepthRBO(t,e,s){null==this.Bk&&(this.Bk=t.createRenderbuffer()),this.multisampleEnabled?(t.bindRenderbuffer(t.RENDERBUFFER,this.Bk),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.DEPTH_COMPONENT24,e,s),t.framebufferRenderbuffer(this.Bn,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.Bk),null==this.Bl&&(this.Bl=t.createRenderbuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.Bl),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.RGBA8,e,s),t.framebufferRenderbuffer(this.Bn,this.Bh,t.RENDERBUFFER,this.Bl)):(t.bindRenderbuffer(t.RENDERBUFFER,this.Bk),r.default.IsWebGL2()?t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT24,e,s):t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,e,s),t.framebufferRenderbuffer(this.Bn,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.Bk))}buildStencilRBO(t,e,s){null==this.Bj&&(null==this.Bj&&(this.Bj=t.createRenderbuffer()),this.multisampleEnabled?(t.bindRenderbuffer(t.RENDERBUFFER,this.Bj),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.STENCIL_INDEX8,e,s),t.framebufferRenderbuffer(this.Bn,t.STENCIL_ATTACHMENT,t.RENDERBUFFER,this.Bj),null==this.Bl&&(this.Bl=t.createRenderbuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.Bl),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.RGBA8,e,s),t.framebufferRenderbuffer(this.Bn,this.Bh,t.RENDERBUFFER,this.Bl)):(t.bindRenderbuffer(t.RENDERBUFFER,this.Bj),t.renderbufferStorage(t.RENDERBUFFER,t.STENCIL_INDEX8,e,s),t.framebufferRenderbuffer(this.Bn,t.STENCIL_ATTACHMENT,t.RENDERBUFFER,this.Bj)))}buildColorRBO(t,e,s){this.multisampleEnabled&&(null==this.Bl&&(this.Bl=t.createRenderbuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.Bl),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.RGBA8,e,s),t.framebufferRenderbuffer(this.Bn,this.Bh,t.RENDERBUFFER,this.Bl))}createNewFBO(t,e,s){let i=null==this.Bi;switch(this.Bq=this.EO=0,this.Br=this.Bs=0,this.BQ=e,this.BR=s,this.B1=e,this.B2=s,i&&(this.Bi=t.createFramebuffer()),this.Bm){case a.default.DRAW_FRAMEBUFFER:this.Bn=t.DRAW_FRAMEBUFFER;break;case a.default.READ_FRAMEBUFFER:this.Bn=t.READ_FRAMEBUFFER;break;default:this.Bn=t.FRAMEBUFFER;break}if(t.bindFramebuffer(this.Bn,this.Bi),this.writeDepthEnabled?this.writeStencilEnabled?null==this.Bj&&this.buildDepthStencilRBO(t,e,s):this.buildDepthRBO(t,e,s):this.writeStencilEnabled?this.buildStencilRBO(t,e,s):this.buildColorRBO(t,e,s),i){t.checkFramebufferStatus(this.Bn);t.FRAMEBUFFER_COMPLETE}l.BindToBackbuffer(t,this.Bm)}static BindToBackbuffer(t,e){switch(e){case a.default.DRAW_FRAMEBUFFER:t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null);break;case a.default.READ_FRAMEBUFFER:t.indFramebuffer(t.READ_FRAMEBUFFER,null);break;default:t.bindFramebuffer(t.FRAMEBUFFER,null);break}}}l.EM=0,e.default=l},"6e01":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static Clamp(t,e,s){return Math.max(Math.min(t,s),e)}static IsPowerOf2(t){return 0==(t&t-1)}static CalcCeilPowerOfTwo(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}static CalcNearestCeilPow2(t){return Math.pow(2,Math.round(Math.log(t)/Math.LN2))}static CalcFloorCeilPow2(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}static DegreeToRadian(t){return i.MATH_PI_OVER_180*t}static Log2(t){return Math.log(t)/Math.LN2}static GetMaxMipMapLevel(t,e){return Math.round(i.Log2(Math.max(t,e))+1)}static SafeACos(t){return t<=-1?i.MATH_PI:t>=1?0:Math.acos(t)}static GetNearestCeilPow2(t){let e=1;while(e<t)e<<=1;return e}static GetMinRadian(t,e){return e%=i.MATH_2PI,t%=i.MATH_2PI,e<t?(e=i.MATH_2PI-t+e,e>i.MATH_PI?e-i.MATH_2PI:e):e>t?(t=i.MATH_2PI-e+t,t>i.MATH_PI?i.MATH_2PI-t:-t):0}static GetMinDegree(t,e){let s=0;return e>=270&&t<90?s=(e-(t+360))%180:e<=90&&t>=270?s=(e+360-t)%180:(s=e-t,s>180?(s-=360,s%=360):s<-180&&(s+=360,s%=360)),s}static GetDegreeByXY(t,e){if(Math.abs(t)<1e-5)return e>=0?270:90;let s=180*Math.atan(e/t)/Math.PI;return t>=0?s:180+s}static GetRadianByXY(t,e){if(Math.abs(t)<i.MATH_MIN_POSITIVE)return e>=0?i.MATH_1PER2PI:i.MATH_3PER2PI;let s=Math.atan(e/t);return t>=0?s:i.MATH_PI+s}static GetRadianByCos(t,e,s){var r=Math.acos(t);return e>=0?r:i.MATH_PI+r}}i.MATH_MIN_POSITIVE=1e-5,i.MATH_MAX_NEGATIVE=-1e-5,i.MATH_MAX_POSITIVE=268435454,i.MATH_MIN_NEGATIVE=-268435454,i.MATH_1_OVER_255=1/255,i.MATH_PI=Math.PI,i.MATH_2PI=2*i.MATH_PI,i.MATH_3PER2PI=1.5*i.MATH_PI,i.MATH_1PER2PI=.5*i.MATH_PI,i.MATH_1_OVER_PI=1/i.MATH_PI,i.MATH_1_OVER_360=1/360,i.MATH_1_OVER_180=1/180,i.MATH_180_OVER_PI=180/i.MATH_PI,i.MATH_PI_OVER_180=i.MATH_PI/180,i.MATH_LN2=.6931471805599453,e.default=i},7045:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.phase=0,this.type=i.KEY_DOWN,this.target=null,this.altKey=!1,this.ctrlKey=!1,this.shiftKey=!1,this.repeat=!1,this.key="",this.keyCode=0,this.location=0}getClassType(){return i.EventClassType}toString(){return"[KeyboardEvent]"}}i.EventClassType=1003,i.KEY_DOWN=6001,i.KEY_UP=6002,e.default=i},"70f2":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("8e17")),h=i(s("0236")),n=i(s("c51d")),l=i(s("af68")),_=i(s("a80a")),o=i(s("a446")),m=i(s("c711")),u=i(s("955e")),d=i(s("765c")),c=i(s("af29")),f=i(s("18c7"));class p{constructor(t,e,s){this.T=-1,this.K_=null,this.Z=null,this.c_=null,this.B3=null,this.B4=null,this.B5=new Uint8Array(128),this.B6=0,this.B7=null,this.B8=new a.default,this.B9=new a.default,this.B_A=null,this.B_B=!1,this.B_C=null,this.B_D=!0,this.Ar=null,this.B=0,this.C=0,this.D=800,this.E=800,this.B_E=null,this.B_F=null,this.B_G=!0,this.B_H=null,this.Aq=null,this.An=null,this.B_I=-1,this.B_J=!0,this.B_K=null,this.As=!0,this.textureBlock=null,this.materialBlock=null,this.entityBlock=null,this.B_L=[],this.B_M=0,this.B_N=!0,this.B_O=!0,this.B_P=!0,this.B_Q=!0,this.B_B=s,this.B4=t,this.B3=e,this.An=e.getDataBuilder().getRenderShader(),this.T=1024+p.EM++}enable(){this.As=!0}disable(){this.As=!1}isEnabled(){return this.As}getUid(){return this.T}getRPONodeBuilder(){return null}getRenderProxy(){return this.Z}setViewPort(t,e,s,i){null!=this.Z&&(this.B=t,this.C=e,this.D=s,this.E=i)}reseizeViewPort(){this.Z.reseizeRCViewPort()}getRendererAdapter(){return this.K_}getRenderer(){return this.B3}getRendererContext(){return this.c_}getStage3D(){return this.Z.getStage3D()}getCurrentStage3D(){return this.B_K}getViewWidth(){return this.Z.getStage3D().viewWidth}getViewHeight(){return this.Z.getStage3D().viewHeight}getCamera(){return this.Ar}getRendererStatus(){return this.B3.getRendererStatus()}getMouseXYWorldRay(t,e){this.Ar.getWorldPickingRayByScreenXY(this.Aq.mouseX,this.Aq.mouseY,t,e)}createCamera(){return new n.default}createFBOInstance(){return new c.default(this,this.textureBlock.getRTTStrore())}createMatrix4(){return new f.default}setEvt3DController(t){null!=t&&(null==this.B_K&&(this.B_K=new h.default(this.Z.getRCUid(),null),this.B_K.uProbe=this.Z.uniformContext.createUniformVec4Probe(1)),t.initialize(this.getStage3D(),this.B_K),t.setRaySelector(this.B7.getRaySelector())),this.B_C=t}isRayPickSelected(){return null!=this.B_C&&this.B_C.isSelected()}enableMouseEvent(t=!0){null==this.B_C&&(t?this.B7.setRaySelector(new u.default):this.B7.setRaySelector(new m.default),this.setEvt3DController(new d.default)),this.B_D=!0}disableMouseEvent(){this.B_D=!1}getEvt3DController(){return this.B_C}getSpace(){return this.B7}getDevicePixelRatio(){return this.K_.getDevicePixelRatio()}addEventListener(t,e,s,i=!0,r=!1){this.B_K.addEventListener(t,e,s,i,r)}removeEventListener(t,e,s){this.B_K.removeEventListener(t,e,s)}setAccessor(t){this.B_A=t}initialize(t,e=3,s=!0){if(null==this.Z){e<1&&(e=1),e>8&&(e=8),this.B_H=t,this.B_G=t.cameraPerspectiveEnabled;let i=null;for(;e>=0;)i=this.B3.appendProcess(t.batchEnabled,t.processFixedState),this.B5[this.B6]=i.getRPIndex(),this.B6++,--e;this.c_=this.B3.getRendererContext(),this.Z=this.c_.getRenderProxy(),this.K_=this.Z.getRenderAdapter(),this.Aq=this.Z.getStage3D(),this.B=this.Aq.getViewX(),this.C=this.Aq.getViewY(),this.D=this.Aq.getViewWidth(),this.E=this.Aq.getViewHeight(),s?this.createMainCamera():this.Ar=this.Z.getCamera(),null==this.B7&&(this.B7=new o.default,this.B7.initialize(this.B3,this.Ar))}}createMainCamera(){this.Ar=new n.default,this.Ar.setViewXY(this.B,this.C),this.Ar.setViewSize(this.D,this.E);let t=this.B_H.camProjParam;this.B_G?this.Ar.perspectiveRH(r.default.DegreeToRadian(t.x),this.D/this.E,t.y,t.z):this.Ar.orthoRH(t.y,t.z,-.5*this.E,.5*this.E,-.5*this.D,.5*this.D),this.Ar.lookAtRH(this.B_H.camPosition,this.B_H.camLookAtPos,this.B_H.camUpDirect),this.Ar.update()}cameraLock(){this.Ar.lock()}cameraUnlock(){this.Ar.unlock()}updateRenderBufferSize(){this.K_.updateRenderBufferSize()}setRendererProcessParam(t,e,s){this.B3.setRendererProcessParam(this.B5[t],e,s)}appendARendererProcess(t=!0,e=!1){let s=this.B3.appendProcess(t,e);this.B5[this.B6]=s.getRPIndex(),this.B6++}getRenderProcessAt(t){return this.B3.getProcessAt(this.B5[t])}addContainer(t,e=0){if(e<0&&(e=0),null!=t&&t.__$wuid<0&&t.__$contId<1){let s=0;for(;s<this.B_M;++s)if(this.B_L[s]==t)return;s>=this.B_M&&(t.__$wuid=this.T,t.wprocuid=e,t.__$setRenderer(this),this.B_L.push(t),this.B_M++)}}removeContainer(t){if(null!=t&&t.__$wuid==this.T&&t.getRenderer()==this.B3){let e=0;for(;e<this.B_M;++e)if(this.B_L[e]==t){t.__$wuid=-1,t.wprocuid=-1,t.__$setRenderer(null),this.B_L.splice(e,1),--this.B_M;break}}}setAutoRunningEnabled(t){this.B_J=t}moveEntityTo(t,e){this.B3.moveEntityToProcessAt(t,this.B5[e])}drawEntity(t,e=!1,s=!0){this.B3.drawEntity(t,e,s)}addEntity(t,e=0,s=!0){if(null!=t&&t.__$testSpaceEnabled())if(t.isPolyhedral())if(t.hasMesh())this.B3.addEntity(t,this.B5[e],s),null!=this.B7&&this.B7.addEntity(t);else{null==this.B_E&&(this.B_E=new _.default,this.B_F=new l.default);let s=this.B_F.addEntity(t);s.rstatus=e,this.B_E.addNode(s)}else this.B3.addEntity(t,this.B5[e],s),null!=this.B7&&this.B7.addEntity(t)}removeEntity(t){if(null!=t){let e=null;if(null!=this.B_E){let e=this.B_F.getNodeByEntity(t);null!=e&&(this.B_E.removeNode(e),this.B_F.removeEntity(t))}null==e&&(this.B3.removeEntity(t),null!=this.B7&&this.B7.removeEntity(t))}}updateMaterialUniformToCurrentShd(t){this.B3.updateMaterialUniformToCurrentShd(t)}showInfoAt(t){this.B3.showInfoAt(t)}updateCameraData(t){this.c_.updateCameraDataFromCamera(this.Z.getCamera())}renderBegin(t=!1){t&&this.c_.renderBegin(),this.Z.getCamera()!=this.Ar&&(this.Z.isAutoSynViewAndStage()&&(this.B=this.Z.getViewX(),this.C=this.Z.getViewY(),this.D=this.Z.getViewWidth(),this.E=this.Z.getViewHeight()),this.Ar.setViewXY(this.B,this.C),this.Ar.setViewSize(this.D,this.E),this.Z.setRCViewPort(this.B,this.C,this.D,this.E,this.Z.isAutoSynViewAndStage()),this.Z.reseizeRCViewPort()),this.Ar.update(),this.c_.updateCameraDataFromCamera(this.Ar),this.An.renderBegin(),null!=this.B_A&&this.B_A.renderBegin(this)}runBegin(t=!0,e=!1){t&&this.B_J&&(this.B_I>=0&&this.runEnd(),this.B_I=0),this.renderBegin(e),null!=this.B7&&(this.B7.setCamera(this.Ar),this.B7.runBegin())}setRayTestEanbled(t){this.B_Q=t}runMouseTest(t,e){let s=-1;if(null!=this.B_C&&this.B_D){if(this.B_P&&this.B_C.getEvtType()>0){let t=this.B7.getRaySelector();if(null!=t){this.B_Q?this.mouseRayTest():t.clear();let e=t.getSelectedNodesTotal();if(e>1){let s=0,i=t.getSelectedNodes(),r=null;for(;s<e;++s)r=i[s],r.entity.isPolyhedral()}}this.B_P=!1}s=this.B_C.run(t,e)}return this.B_N=!1,s}update(t=!0,e=!0){if(null!=this.B_K&&this.B_K.enterFrame(),t&&this.B_J&&(0!=this.B_I&&this.runBegin(),this.B_I=1),this.B_N=!0,this.B_O=!0,this.B_P=!0,null!=this.B_E){let t=this.B_E.getBegin();if(null!=t){let e,s,i;while(null!=t)t.entity.hasMesh()?(e=t,t=t.next,s=e.entity,i=e.rstatus,this.B_E.removeNode(e),this.B_F.removeEntity(e.entity),this.addEntity(s,i)):t=t.next}}let s=0;for(;s<this.B_M;++s)this.B_L[s].update();null!=this.B7&&this.B7.update(),null!=this.B7&&this.B_O&&(null==this.B_C&&null==this.B7.getRaySelector()||this.B7.run()),this.B_N&&!this.B_B&&(e?this.runMouseTest(1,0):null!=this.B_C&&this.B_C.mouseOutEventTarget())}cullingTest(){null!=this.B7&&this.B7.run(),this.B_O=!1}mouseRayTest(){null!=this.B7&&(this.getMouseXYWorldRay(this.B9,this.B8),this.B7.rayTest(this.B9,this.B8))}run(t=!1){if(this.As){t&&this.B_J&&(1!=this.B_I&&this.update(),this.B_I=2);for(let t=0;t<this.B6;++t)this.B3.runAt(this.B5[t]);t&&this.runEnd()}}runAt(t){this.B3.runAt(this.B5[t])}runEnd(){null!=this.B_C&&this.B_C.runEnd(),null!=this.B7&&this.B7.runEnd(),this.B_J&&(this.B_I=-1),null!=this.B_A&&this.B_A.renderEnd(this)}useCamera(t,e=!1){this.B4.useCamera(t,e)}useMainCamera(){this.B4.useMainCamera()}updateCamera(){null!=this.Ar&&this.Ar.update()}setClearUint24Color(t,e=1){this.Z.setClearUint24Color(t,e)}setClearRGBColor3f(t,e,s){this.Z.setClearRGBColor3f(t,e,s)}setClearRGBAColor4f(t,e,s,i){this.Z.setClearRGBAColor4f(t,e,s,i)}setClearColor(t){this.Z.setClearRGBAColor4f(t.r,t.g,t.b,t.a)}setRenderToBackBuffer(){this.Z.setRenderToBackBuffer()}toString(){return"[RendererSubScene(uid = "+this.T+")]"}}p.EM=0,e.default=p},7181:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.width=0,this.height=0,this.data=null,this.miplevel=0,this.status=1,this.offsetx=0,this.offsety=0}updateToGpu(t,e,s,i,r,a){1==this.status||a?t.texImage2D(e,this.miplevel,s,i,r,this.data):0==this.status&&t.texSubImage2D(e,this.miplevel,this.offsetx,this.offsety,i,r,this.data),this.status=-1}static Create(){return i.En.length>0?i.En.pop():new i}static Restore(t){null!=t&&(t.data=null,i.En.push(t))}}i.En=[],e.default=i},"722e":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.NEAREST=4001,i.LINEAR=4002,i.LINEAR_MIPMAP_LINEAR=4003,i.NEAREST_MIPMAP_NEAREST=4004,i.LINEAR_MIPMAP_NEAREST=4005,i.NEAREST_MIPMAP_LINEAR=4006,e.default=i},7279:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=i(s("d53d"));class h extends a.default{constructor(t){super(),this.a=null,this.B_R=null,this.B_S=null,this.slotId=0,this.slotIndex=0,this.uniformsTotal=0,this.locationIndexList=null,this.locations=null,this.rst=0,this.always=!1,this.a=t,this.B_R=this.a.flagList,this.B_S=this.a.dataList}applyData(){}clone(){let t=new h(this.a);return t.types=this.types.slice(0),t.uniformNameList=this.uniformNameList.slice(0),t.dataSizeList=this.dataSizeList.slice(0),t.slotIndex=this.slotIndex,t.uniformsTotal=this.uniformsTotal,t.slotId=this.slotId,t.always=this.always,t.rst=this.rst,t}copyDataFromProbe(t){this.types=t.uniformTypes.slice(0),this.dataSizeList=t.dataSizeList.slice(0),this.slotIndex=t.getSlotBeginIndex(),this.uniformsTotal=t.uniformsTotal,this.slotId=t.getRCUid()}copyDataFromProbeAt(t,e){null==this.types&&(this.types=[],this.dataSizeList=[]),this.slotIndex=e.getSlotBeginIndex()+t,this.uniformsTotal=1,this.slotId=e.getRCUid(),this.types[0]=e.uniformTypes[t],this.dataSizeList[0]=e.dataSizeList[t]}use(t){if(this.always||this.rst!=this.B_R[this.slotIndex]){this.rst=this.B_R[this.slotIndex];let e=0,s=this.B_S;if(r.default.IsWebGL1())for(;e<this.uniformsTotal;++e)t.useUniformV1(this.locations[e],this.types[e],s[this.slotIndex+e],this.dataSizeList[e]);else for(;e<this.uniformsTotal;++e)t.useUniformV2(this.locations[e],this.types[e],s[this.slotIndex+e],this.dataSizeList[e],0)}}destroy(){this.types=null,this.dataSizeList=null,this.slotIndex=-1,this.uniformsTotal=0,this.a=null,this.B_R=null,this.B_S=null}}e.default=h},7499:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.B_T=null,this.An=null,this.A7=null}setDispBuilder(t){null==this.B_T&&(this.B_T=t,this.An=t.getRenderShader(),this.A7=t.getTextureResource())}unlockMaterial(){this.An.unlock(),this.A7.unlocked=!0}lockMaterial(){this.An.lock(),this.A7.unlocked=!1}isUnlockMatrial(){return this.A7.unlocked}unlockTexture(){this.An.textureUnlock()}lockTexture(){this.An.textureLock()}renderBegin(){this.An.renderBegin(),this.A7.renderBegin()}resetUniform(){this.An.resetUniform()}useGlobalMaterial(t,e=!1){null!=t&&this.B_T.updateGlobalMaterial(t,e)}updateMaterialUniform(t){this.An.updateUniform(t.__$uniform)}}e.default=i},"74c3":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t,e,s){this.B_U=new Map,this.B_V=new Map,this.B_W=[],this.B_X=0,this.B_Y=0,this.B_Z=128,this.A_B=!1,this.B_a=16,this.A=0,this.s=null,this.B_b=null,this.unlocked=!0,this.A=t,this.s=e,this.B_b=s}setVtxUpdateTimesTotal(t){this.B_a=t>4?t:4}createResByParams3(t,e,s,i){return!1}getRCUid(){return this.A}getRC(){return this.s}hasResUid(t){return this.B_U.has(t)}bindToGpu(t){}getGpuBuffer(t){return null}renderBegin(){this.B_b.renderBegin()}getVertexResTotal(){return this.B_X}updateDataToGpu(t,e){e?(this.B_W.push(t),this.A_B=!0):this.B_U.has(t)&&this.B_U.get(t).updateToGpu(this.B_b)}addVertexRes(t){this.B_U.has(t.resUid)||(t.waitDelTimes=0,this.B_U.set(t.resUid,t),this.B_X++)}getVertexRes(t){return this.B_U.get(t)}destroyRes(t){this.B_U.has(t)&&this.B_U.get(t).destroy(this.B_b)}__$attachRes(t){if(this.B_U.has(t)){this.B_Y++;let e=this.B_U.get(t);e.getAttachCount()<1&&this.B_V.has(t)&&this.B_V.delete(t),e.waitDelTimes=0,e.__$attachThis()}}__$detachRes(t){if(this.B_U.has(t)&&this.B_U.has(t)){let e=this.B_U.get(t);e.getAttachCount()>0&&(this.B_Y--,e.__$detachThis(),e.getAttachCount()<1&&this.B_V.set(t,e))}}getVROByResUid(t,e,s){let i=this.B_U.get(t);return null!=i?i.createVRO(this.B_b,e,s):null}update(){if(this.A_B){let t=this.B_W.length;if(t>0){let e;t>this.B_a&&(t=this.B_a);for(let s=0;s<t;++s)e=this.B_W.shift(),this.B_U.has(e)&&this.B_U.get(e).updateToGpu(this.B_b)}else this.A_B=!1}if(this.B_Z--,this.B_Z<1){this.B_Z=128;for(const[t,e]of this.B_V)e.waitDelTimes++,e.getAttachCount()<1?e.waitDelTimes>5&&(this.B_U.delete(e.resUid),this.B_V.delete(e.resUid),e.destroy(this.B_b),this.B_X--):this.B_V.delete(e.resUid)}}}e.ROVertexResource=i,e.default=i},"765c":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("1710"));class a{constructor(){this.T=0,this.B_c=null,this.B_d=null,this.B_e=null,this.B_f=!0,this.Q=new r.default,this.B_g=new r.default,this.B_h=new r.default,this.B_i=new Float32Array(64),this.B_j=new Float32Array(64),this.B_k=new Float32Array(64),this.B_l=new Float32Array(64),this.B_m=0,this.B_n=null,this.B_o=null,this.B_p=-1,this.T=a.EM++}initialize(t,e){null==this.B_c&&(this.B_c=t,this.B_d=e,t.addEventListener(r.default.MOUSE_DOWN,this,this.mouseDownListener,!0,!1),t.addEventListener(r.default.MOUSE_UP,this,this.mouseUpListener,!0,!1),t.addEventListener(r.default.MOUSE_CLICK,this,this.mouseClickListener,!0,!1),t.addEventListener(r.default.MOUSE_MOVE,this,this.mouseMoveListener,!0,!1),t.addEventListener(r.default.MOUSE_WHEEL,this,this.mouseWheeelListener,!0,!1))}setRaySelector(t){this.B_e=t}mouseWheeelListener(t){null!=this.B_d&&(this.B_d.mouseX=this.B_c.mouseX,this.B_d.mouseY=this.B_c.mouseY),this.B_i[this.B_m]=t.type,this.B_j[this.B_m]=t.mouseX,this.B_k[this.B_m]=t.mouseY,this.B_l[this.B_m]=t.wheelDeltaY,this.Q.type=t.type,this.B_m++}mouseMoveListener(t){null!=this.B_d&&(this.B_d.mouseX=this.B_c.mouseX,this.B_d.mouseY=this.B_c.mouseY),this.B_i[this.B_m]=t.type,this.B_j[this.B_m]=t.mouseX,this.B_k[this.B_m]=t.mouseY,this.B_l[this.B_m]=0,this.Q.type=t.type,this.B_m++}mouseDownListener(t){null!=this.B_d&&(this.B_d.mouseX=this.B_c.mouseX,this.B_d.mouseY=this.B_c.mouseY),a.Eo&&(this.B_i[this.B_m]=t.type,this.B_j[this.B_m]=t.mouseX,this.B_k[this.B_m]=t.mouseY,this.B_l[this.B_m]=0,this.Q.type=t.type,this.B_m++)}mouseUpListener(t){null!=this.B_d&&(this.B_d.mouseX=this.B_c.mouseX,this.B_d.mouseY=this.B_c.mouseY),a.Eo&&(this.B_i[this.B_m]=t.type,this.B_j[this.B_m]=t.mouseX,this.B_k[this.B_m]=t.mouseY,this.B_l[this.B_m]=0,this.Q.type=t.type,this.B_m++)}mouseClickListener(t){null!=this.B_d&&(this.B_d.mouseX=this.B_c.mouseX,this.B_d.mouseY=this.B_c.mouseY),a.Eo&&(this.B_i[this.B_m]=t.type,this.B_j[this.B_m]=t.mouseX,this.B_k[this.B_m]=t.mouseY,this.B_l[this.B_m]=0,this.Q.type=t.type,this.B_m++)}mouseOutEventTarget(){if(null!=this.B_d&&(this.B_d.mouseX=this.B_c.mouseX,this.B_d.mouseY=this.B_c.mouseY),null!=this.B_n){let t=this.B_n.getEvtDispatcher(r.default.EventClassType);if(null!=t)return this.B_h.phase=this.B_p,this.B_h.type=r.default.MOUSE_OUT,this.B_h.mouseX=this.Q.mouseX,this.B_h.mouseY=this.Q.mouseY,this.B_h.target=this.B_n,this.B_e.getRay(this.B_h.raypv,this.B_h.raytv),this.B_n=null,t.dispatchEvt(this.B_h);this.B_n=null}return 0}run(t,e){let s=-1;if(this.B_f){this.B_p=t;let i=0;s=this.B_m>0?0:-1;let h,n,l,_=null;if(s>-1){if(this.B_d!=this.B_c&&null!=this.B_d){for(a.Eo=!1,i=0;i<this.B_m;i++)switch(this.B_i[i]){case r.default.MOUSE_DOWN:this.B_d.mouseDown(1);break;case r.default.MOUSE_UP:this.B_d.mouseUp(1);break;case r.default.MOUSE_MOVE:this.B_d.mouseMove();break;default:break}a.Eo=!0}if(h=e<1?this.B_e.getSelectedNode():null,null!=h){n=h.lpv,l=h.wpv;let e=h.entity;_=e.getEvtDispatcher(r.default.EventClassType);let i=e.__$getParent(),a=null!=i&&i.mouseEnabled;a||(s+=this.mouseOutContainer(t,null,null,null),this.B_o=null);let o=this.B_n;for(let m=0;m<this.B_m;m++)this.Q.type=this.B_i[m],this.Q.mouseX=this.B_j[m],this.Q.mouseY=this.B_k[m],this.Q.wheelDeltaY=this.B_l[m],this.Q.type>0&&null!=h&&null!=_&&(this.Q.target=e,this.Q.currentTarget=e,this.Q.phase=t,this.Q.lpos.copyFrom(n),this.Q.wpos.copyFrom(l),this.B_e.getRay(this.Q.raypv,this.Q.raytv),s+=this.mouseOutEntity(t,e,n,l),this.B_n!=e&&(this.B_g.phase=t,this.B_g.type=r.default.MOUSE_OVER,this.B_g.mouseX=this.Q.mouseX,this.B_g.mouseY=this.Q.mouseY,this.B_g.target=e,this.B_g.currentTarget=e,this.B_g.lpos.copyFrom(n),this.B_g.wpos.copyFrom(l),this.B_e.getRay(this.B_g.raypv,this.B_g.raytv),s+=_.dispatchEvt(this.B_g)),s+=_.dispatchEvt(this.Q),this.B_n=e);if(a){null!=o&&null==o.__$getParent()&&(this.B_n=o,s+=this.mouseOutEntity(t,null,null,null),this.B_n=null);for(let a=0;a<this.B_m;a++)this.Q.type=this.B_i[a],this.Q.mouseX=this.B_j[a],this.Q.mouseY=this.B_k[a],this.Q.wheelDeltaY=this.B_l[a],this.Q.type>0&&null!=h&&(this.Q.target=i,this.Q.currentTarget=e,this.Q.phase=t,this.Q.lpos.copyFrom(n),this.Q.wpos.copyFrom(l),this.B_e.getRay(this.Q.raypv,this.Q.raytv),s+=this.mouseOutContainer(t,i,n,l),this.B_o!=i&&(this.B_g.phase=t,this.B_g.type=r.default.MOUSE_OVER,this.B_g.mouseX=this.Q.mouseX,this.B_g.mouseY=this.Q.mouseY,this.B_g.target=i,this.B_g.currentTarget=e,this.B_g.lpos.copyFrom(n),this.B_g.wpos.copyFrom(l),this.B_e.getRay(this.B_g.raypv,this.B_g.raytv),s+=i.dispatchEvt(this.B_g)),s+=i.dispatchEvt(this.Q),this.B_o=i)}}else if(this.mouseOutEntity(t,null,null,null),this.mouseOutContainer(t,null,null,null),this.B_n=null,this.B_o=null,s+=this.mouseOutEventTarget(),null!=this.B_d)for(i=0;i<this.B_m;i++)switch(this.B_i[i]){case r.default.MOUSE_DOWN:this.B_d.mouseBgDown();break;case r.default.MOUSE_UP:this.B_d.mouseBgUp();break;case r.default.MOUSE_CLICK:this.B_d.mouseBgClick();break;default:break}if(null!=this.B_d){for(a.Eo=!1,i=0;i<this.B_m;i++)switch(this.B_i[i]){case r.default.MOUSE_DOWN:this.B_d.mouseDown(2);break;case r.default.MOUSE_UP:this.B_d.mouseUp(2);break;default:break}a.Eo=!0}}0==s&&null!=_&&(s=_.passTestPhase(t))}return s>0?1:0}mouseOutEntity(t,e,s,i){if(null!=this.B_n&&this.B_n!=e){let e=this.B_n.getEvtDispatcher(r.default.EventClassType);if(null!=e)return this.B_h.phase=t,this.B_h.type=r.default.MOUSE_OUT,this.B_h.mouseX=this.Q.mouseX,this.B_h.mouseY=this.Q.mouseY,this.B_h.target=this.B_n,this.B_g.currentTarget=this.B_n,null!=s&&this.B_h.lpos.copyFrom(s),null!=i&&this.B_h.wpos.copyFrom(i),this.B_e.getRay(this.B_h.raypv,this.B_h.raytv),e.dispatchEvt(this.B_h)}return 0}mouseOutContainer(t,e,s,i){return null!=this.B_o&&this.B_o!=e?(this.B_h.phase=t,this.B_h.type=r.default.MOUSE_OUT,this.B_h.mouseX=this.Q.mouseX,this.B_h.mouseY=this.Q.mouseY,this.B_h.target=this.B_o,this.B_h.currentTarget=null,null!=s&&this.B_h.lpos.copyFrom(s),null!=i&&this.B_h.wpos.copyFrom(i),this.B_e.getRay(this.B_h.raypv,this.B_h.raytv),this.B_o.dispatchEvt(this.B_h)):0}runEnd(){this.B_m=0,this.Q.type=0}reset(){this.B_m=0}getEvtType(){return this.Q.type}isSelected(){return null!=this.B_e.getSelectedNode()}lock(){this.B_f=!1}unlock(){this.B_f=!0}isUnlock(){return this.B_f}}a.Eo=!0,a.EM=0,e.default=a},7696:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("264c")),a=i(s("5f3c"));class h{constructor(t,e,s,i,r,a){this.A=-1,this.B_q=-1,this.B_r=0,this.As=!0,this.B_s=[],this.B_t=0,this.B_u=new Int8Array(h.Ep),this.B_v=h.Ep,this.An=null,this.A_G=null,this.z_=null,this.A_H=null,this.B_w=null,this.B_x=null,this.Ap=null,this.A_I=!0,this.A_J=!0,this.B_y=!1,this.B_z=0,this.uid=-1,this.An=t,this.A_G=e,this.z_=s,this.A_H=i,this.B_w=this.createBlock(),this.A_I=r,this.A_J=a;for(let h=0;h<this.B_v;++h)this.B_u[h]=-1}createBlock(){let t=new a.default(this.An);return t.rpoNodeBuilder=this.A_G,t.rpoUnitBuilder=this.z_,t.vtxResource=this.A_H,t}setRenderParam(t,e){this.B_t<1&&(this.A_I=t,this.A_J=e)}setRendererParam(t,e){this.AM=t,this.A=t.getRCUid(),this.B_q=e}getUid(){return this.uid}getRCUid(){return this.A}getRPIndex(){return this.B_q}hasSorter(){return null!=this.Ap}setSorter(t){this.Ap=t,null!=this.B_x&&this.B_x.setSorter(t)}setSortEnabled(t){this.B_r<1?this.B_y=t:null!=this.B_x&&(this.B_x.sortEnabled=t)}getSortEnabled(){return this.B_y}getUnitsTotal(){return this.B_r}addNodeToBlock(t){let e=null;if(t.shdUid>=h.Ep)throw Error("Shader uid >= "+h.Ep);this.B_u[t.shdUid]<0?(e=this.createBlock(),e.batchEnabled=this.A_I,e.fixedState=this.A_J,e.batchEnabled?e.fixedState?e.runMode=2:e.runMode=1:e.runMode=0,e.shdUid=t.shdUid,e.index=this.B_t,e.procuid=this.B_q,this.B_s.push(e),this.B_u[t.shdUid]=this.B_t,++this.B_t):e=this.B_s[this.B_u[t.shdUid]],t.index=e.index,e.addNode(t)}rejoinRunitForTro(t){let e=this.A_G.getNodeByUid(t.__$rpuid);null!=e&&(e.tro=t.tro,e.texMid=e.unit.texMid,this.B_s[e.index].rejoinNode(e))}rejoinRunitForVro(t){let e=this.A_G.getNodeByUid(t.__$rpuid);null!=e&&(e.drawMode=t.drawMode,e.ivsIndex=t.ivsIndex,e.ivsCount=t.ivsCount,e.insCount=t.insCount,t.drawOffset=t.ivsIndex*t.ibufStep,e.vtxUid=t.vtxUid,e.vro=t.vro,this.B_s[e.index].rejoinNode(e),this.B_z++)}addDisp(t){if(null!=t&&null!=t.__$$runit&&t.__$$runit.getRPROUid()<0&&t.__$$runit.getRPROUid()!=this.uid){let e=this.A_G.create();e.unit=this.z_.getNodeByUid(t.__$ruid),e.unit.shader=this.An,e.unit.__$rprouid=this.uid,t.__$rpuid=e.uid,e.__$ruid=t.__$ruid,e.unit.__$rpuid=e.uid,e.updateData(),++this.B_r,this.z_.setRPNodeParam(t.__$ruid,this.getUid(),e.uid),this.B_y?(null!=this.B_x||(this.B_x=new r.default(this.An),this.B_x.setSorter(this.Ap)),this.B_x.addNode(e)):this.addNodeToBlock(e),this.B_z++}}updateDispMateiral(t){if(null!=t.__$$runit){let e=t.__$$runit.getRPOUid(),s=this.A_G.getNodeByUid(e);s.shdUid=s.unit.shdUid,s.texMid=s.unit.texMid,s.tro=s.unit.tro;let i=this.B_s[s.index];i.removeNode(s),this.addNodeToBlock(s)}}removeDisp(t){if(null!=t&&null!=t.__$$runit){let e=t.__$$runit.getRPOUid(),s=this.A_G.getNodeByUid(e);if(null!=s){if(null==this.B_x){let t=this.B_s[s.index];t.removeNode(s)}else this.B_x.removeNode(s);this.z_.setRPNodeParam(t.__$ruid,this.getUid(),-1),--this.B_r;let e=s.unit;this.A_G.restore(s)&&this.z_.restore(e),this.A_H.__$detachRes(t.vbuf.getUid()),t.__$$runit=null,t.__$ruid=-1,this.B_z++}}}getStatus(){return this.B_z}removeDispUnit(t){if(null!=t&&t.__$ruid>-1){let e=t.__$$runit.getRPOUid(),s=this.A_G.getNodeByUid(e);if(null!=s){if(null==this.B_x){let t=this.B_s[s.index];t.removeNode(s)}else this.B_x.removeNode(s);this.z_.setRPNodeParam(t.__$ruid,this.B_q,-1),s.unit.__$rprouid=-1,--this.B_r,this.A_G.restore(s)}}}update(){this.As&&this.B_r>0&&null!=this.B_x&&this.B_x.update()}run(){if(this.As&&this.B_r>0){let t=this.AM;if(null==this.B_x)if(this.An.isUnLocked())for(let e=0;e<this.B_t;++e)this.B_s[e].run(t);else for(let e=0;e<this.B_t;++e)this.B_s[e].runLockMaterial(t);else this.An.isUnLocked()?this.B_x.run(t):this.B_x.runLockMaterial(t)}}drawDisp(t,e=!1,s=!0){if(null!=t){let i=t.__$$runit;null!=i&&(this.An.isUnLocked()?(s&&this.An.resetUniform(),this.B_w.drawUnit(this.AM,i,t)):this.B_w.drawLockMaterialByUnit(this.AM,i,t,e,s))}}drawLockMaterialByDisp(t,e=!1,s=!0){if(null!=t){let i=t.__$$runit;null!=i&&this.B_w.drawLockMaterialByUnit(this.AM,i,t,e,s)}}reset(){this.B_y=!1,this.B_r=0,this.uid=-1,this.B_q=-1,this.A=-1,this.B_q=-1;let t=0;for(;t<this.B_t;++t)this.B_s[t].reset();this.B_t=0,this.B_s=[],this.A_G=null,this.z_=null,this.A_H=null,this.AM=null,null!=this.B_x&&(this.B_x.clear(),this.B_x=null)}showInfo(){let t=0;for(;t<this.B_t;++t)this.B_s[t].showInfo()}destroy(){this.reset()}setEnabled(t){this.As=t}getEnabled(){return this.As}toString(){return"[RenderProcess(uid = "+this.B_q+")]"}}h.Ep=1024,e.default=h},"78e9":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("644c"));class a{constructor(){this.type=-1,this.typeName="",this.name="",this.isArray=!1,this.arrLength=0,this.isTex=!1,this.location=null}parseCode(t){const e=";";let s=t.indexOf(e);if(s<0)return!1;const i=" ";t=t.replace(/^\s*|\s*$/g,""),s>0&&(t=t.slice(0,s));let a=t.split(i);return this.typeName=a[a.length-2],this.name=a[a.length-1],s=this.name.indexOf("["),this.isArray=s>0,this.arrLength=0,this.isArray&&(this.arrLength=parseInt(this.name.slice(s+1,this.name.indexOf("]",s+1))),this.name=this.name.slice(0,s),this.typeName+="[]"),this.type=r.default.GetTypeByTypeNS(this.typeName),!(this.type<0)&&(this.isTex=this.type==r.default.SHADER_SAMPLER2D||this.type==r.default.SHADER_SAMPLERCUBE||this.type==r.default.SHADER_SAMPLER3D,!0)}}e.default=a},7918:function(t,e,s){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t["Default"]=0]="Default",t[t["Depth"]=1]="Depth",t[t["Wrapper"]=2]="Wrapper",t[t["RTT"]=3]="RTT",t[t["Image"]=4]="Image",t[t["Float"]=5]="Float",t[t["Uint16"]=6]="Uint16",t[t["FloatCube"]=7]="FloatCube",t[t["Bytes"]=8]="Bytes",t[t["BytesCube"]=9]="BytesCube",t[t["ImageCube"]=10]="ImageCube",t[t["Texture3D"]=11]="Texture3D"}(i||(i={})),e.TextureProxyType=i},"7b0e":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("bbf4"));class a{constructor(){this.uid=-1,this.rstatus=0,this.pcoEnabled=!1,this.drawEnabled=!0,this.prev=null,this.next=null,this.entity=null,this.bounds=null,this.rayTestState=0,this.rpoNode=null,this.spaceId=-1,this.camVisiSt=0,this.camVisi=r.default.CAMERA_VISIBLE_ENABLE}reset(){this.rayTestState=0,this.uid=-1,this.rstatus=0,this.pcoEnabled=!1,this.drawEnabled=!0,this.prev=null,this.next=null,this.entity=null,this.bounds=null,this.rpoNode=null,this.spaceId=-1,this.camVisi=0}static GetFreeId(){return a.Ag.length>0?a.Ag.pop():-1}static GetByUid(t){return t>-1&&t<a.B_1?a.B_0[t]:null}static SetCamVisiByUid(t,e){a.B_0[t].camVisi=e}static GetCamVisiByUid(t){return a.B_0[t].camVisi}static Create(){let t=null,e=a.GetFreeId();return e>=0?(t=a.B_0[e],t.uid=e,a.C_h[e]=a.EY):(t=new a,a.B_0.push(t),a.C_h.push(a.EY),t.uid=a.B_1,a.B_1++),t}static Restore(t){null!=t&&t.uid>=0&&a.C_h[t.uid]==a.EY&&(a.Ag.push(t.uid),a.C_h[t.uid]=a.Eq,t.reset())}}a.EY=1,a.Eq=0,a.B_1=0,a.B_0=[],a.C_h=[],a.Ag=[],e.default=a},"7c63":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("e08e");class r{constructor(){this.stencilMask=-1}}class a{constructor(){this.B_2=new Array(128),this.B_3=null,this.B_4=i.RenderBlendMode.NORMAL,this.B_5=i.CullFaceMode.NONE,this.B_6=i.DepthTestMode.DISABLE,this.B_7=!0,this.B_8=null,this.s=null,this.roColorMask=-11}reset(){this.roColorMask=-11}setRenderContext(t){this.B_8=t,this.s=t.getRC();let e=this.s.rcuid;this.B_3=this.B_2[e],null==this.B_3&&(this.B_3=this.B_2[e]=new r)}setColorMask(t,e,s,i){this.s.colorMask(t,e,s,i)}setStencilFunc(t,e,s){this.s.stencilFunc(t,e,s)}setStencilMask(t){this.B_3.stencilMask!=t&&t>=0&&(this.B_3.stencilMask=t,this.s.stencilMask(t))}setStencilOp(t,e,s){this.s.stencilOp(t,e,s)}setDepthTestEnable(t){t?this.s.enable(this.s.DEPTH_TEST):this.s.disable(this.s.DEPTH_TEST)}setCullFaceEnable(t){t?this.s.enable(this.s.CULL_FACE):this.s.disable(this.s.CULL_FACE)}setBlendEnable(t){t?this.s.enable(this.s.BLEND):this.s.disable(this.s.BLEND)}setCullFaceMode(t){this.B_5!=t&&(this.B_5=t,t!=i.CullFaceMode.NONE?(this.B_7&&(this.B_7=!1,this.s.enable(this.s.CULL_FACE)),this.s.cullFace(t)):this.B_7||(this.B_7=!0,this.s.disable(this.s.CULL_FACE)))}setBlendMode(t,e){this.B_4!=t&&(this.B_4=t,t>0?e[0]<1?(this.s.blendEquation(this.s.FUNC_ADD),this.s.blendFunc(this.s.ONE,this.s.ZERO),this.s.blendEquation(e[1]),this.s.blendFunc(e[3],e[4])):(this.s.blendEquationSeparate(e[1],e[2]),this.s.blendFuncSeparate(e[3],e[4],e[5],e[6])):this.s.disable(this.s.BLEND))}setDepthTestMode(t){if(this.B_6!=t)switch(this.B_6=t,t){case i.DepthTestMode.ALWAYS:this.s.depthMask(!1),this.s.depthFunc(this.s.ALWAYS);break;case i.DepthTestMode.SKY:this.s.depthMask(!0),this.s.depthFunc(this.s.LEQUAL);break;case i.DepthTestMode.OPAQUE:this.s.depthMask(!0),this.s.depthFunc(this.s.LESS);break;case i.DepthTestMode.OPAQUE_OVERHEAD:this.s.depthMask(!1),this.s.depthFunc(this.s.EQUAL);break;case i.DepthTestMode.DECALS:this.s.depthMask(!1),this.s.depthFunc(this.s.LEQUAL);break;case i.DepthTestMode.BLEND:this.s.depthMask(!1),this.s.depthFunc(this.s.LESS);break;case i.DepthTestMode.WIRE_FRAME:this.s.depthMask(!0),this.s.depthFunc(this.s.LEQUAL);break;case i.DepthTestMode.NEXT_LAYER:this.s.depthMask(!1),this.s.depthFunc(this.s.ALWAYS);break;case i.DepthTestMode.TRUE_EQUAL:this.s.depthMask(!0),this.s.depthFunc(this.s.EQUAL);break;case i.DepthTestMode.TRUE_GREATER:this.s.depthMask(!0),this.s.depthFunc(this.s.GREATER);break;case i.DepthTestMode.TRUE_GEQUAL:this.s.depthMask(!0),this.s.depthFunc(this.s.GEQUAL);break;case i.DepthTestMode.WIRE_FRAME_NEXT:break;default:break}}}e.RODrawState=a},8171:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t){this.B_9=null,this.B_9=t}setDepthTestEnable(t){this.B_9.setDepthTestEnable(t)}setStencilFunc(t,e,s){this.B_9.setStencilFunc(t,e,s)}setStencilMask(t){this.B_9.setStencilMask(t)}setStencilOp(t,e,s){this.B_9.setStencilOp(t,e,s)}}e.Stencil=i},"81ce":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static Es2VtxShderToES3(t){let e=t;const s="attribute",i="varying ";let r=e.indexOf(s),a=0;while(r>=0)e=e.slice(0,r)+"layout(location="+a+") in"+e.slice(r+9),r=e.indexOf(s),a++;let h=new RegExp(i,"g");return e=e.replace(h,"out "),"#version 300 es\n"+e}static Es2FragShderToES3(t){let e=t;const s="gl_FragColor",i="varying ";let r=e.indexOf(s),a=0,h="FragColorOut_"+a;r>=0&&(e=e.slice(0,r)+h+e.slice(r+12)),r=e.indexOf("void "),e=e.slice(0,r)+"out vec4 "+h+";\n"+e.slice(r);let n=new RegExp(i,"g");return e=e.replace(n,"in "),n=new RegExp(" texture2D","g"),e=e.replace(n," texture"),n=new RegExp(" textureCube","g"),e=e.replace(n," texture"),"#version 300 es\n"+e}static Es3VtxShaderToES2(t){const e=/^#.+(\bes|core\b)/;t=t.replace(e,"");const s=/\blayout\b.+\bin\b/g;t=t.replace(s,"attribute");const r=/\bout\b/g;t=t.replace(r,"varying");const a=/\btexture\b/g;t=t.replace(a,"texture2D"),t.indexOf("#version")>=0&&(t=t.replace("#version","//#version"));let h=0,n=0,l=t.indexOf("inverse(");l<0&&(l=t.indexOf("inverse ("));let _="",o=!1,m=!1;while(l>3){if(h=t.indexOf(")",l+2),_=t.slice(l+2,h),_.indexOf("mat3")>0)o=!0;else if(_=_.replace(/\s+/g,""),h=_.indexOf("("),_=_.slice(h+1),h=t.indexOf(_,1),n=t.lastIndexOf("mat",h),n>0)switch(_=t.slice(n,h),_=_.replace(/\s+/g,""),_){case"mat3":o=!0;break;case"mat4":m=!0;break}if(l=t.indexOf("inverse(",l+5),l<0&&(l=t.indexOf("inverse (",l+5)),o&&m)break}h=0,l=t.indexOf("transpose("),l<0&&(l=t.indexOf("transpose (")),_="";let u=!1,d=!1;while(l>3){if(h=t.indexOf(")",l+2),_=t.slice(l+2,h+1),_.indexOf("mat3")>0)u=!0;else if(_=_.replace(/\s+/g,""),h=_.indexOf("("),_=_.slice(h+1),h=t.indexOf(_,1),n=t.lastIndexOf("mat",h),n>0)switch(_=t.slice(n,h),_=_.replace(/\s+/g,""),_){case"mat3":u=!0;break;case"mat4":d=!0;break}if(l=t.indexOf("transpose(",l+5),l<0&&(l=t.indexOf("transpose (",l+5)),u&&d)break}return(o||m)&&(l=t.indexOf("void "),l>10&&(o&&m?t=t.slice(0,l)+i.__glslInverseMat3+i.__glslInverseMat4+t.slice(l):o?t=t.slice(0,l)+i.__glslInverseMat3+t.slice(l):m&&(t=t.slice(0,l)+i.__glslInverseMat4+t.slice(l)))),(u||d)&&(l=t.indexOf("void "),l>10&&(u&&d?t=t.slice(0,l)+i.__glslTransposeMat3+i.__glslTransposeMat4+t.slice(l):u?t=t.slice(0,l)+i.__glslTransposeMat3+t.slice(l):d&&(t=t.slice(0,l)+i.__glslTransposeMat4+t.slice(l)))),t}static Es3FragShaderToES2(t){const e=/^#.+(\bes|core\b)/;t=t.replace(e,"");const s=new RegExp(" in ","g");t=t.replace(s,"_fref_");const i=/\bin\b/g;t=t.replace(i,"varying");const r=new RegExp("_fref_","g");t=t.replace(r," in ");const a=/\btexture\b/g;t=t.replace(a,"texture2D");const h=/" "/g;let n=t;const l=";",_="layout";let o=n.indexOf(_),m=0,u=0,d="",c="",f=0,p=null,g=[],T=[];while(o>=0)m=n.indexOf(l,o+1),d=n.slice(o+1,m),c=d.slice(d.lastIndexOf(" ")+1),f=d.indexOf(")"),o=d.lastIndexOf("=",f)+1,d=d.slice(o+1,f),f=parseInt(d.replace(h,"")),g.push(c),T.push(f),o=n.indexOf(_,m);let E=g.length;if(E>0)if(p=/layout/g,t=t.replace(p,"//layout"),E>1){o=0;while(o<E)p=new RegExp(g[o],"g"),t=t.replace(p,"gl_FragData["+T[o]+"]"),++o}else p=new RegExp(c,"g"),t=t.replace(p,"gl_FragColor");else o=n.indexOf("out "),o>0&&(m=n.indexOf(l,o+1),d=n.slice(o+1,m),c=d.slice(d.lastIndexOf(" ")+1),p=new RegExp(c,"g"),t=t.replace(p,"gl_FragColor"),p=/\bout\b/g,t=t.replace(p,"//out"));E>1&&(t="#extension GL_EXT_draw_buffers: require\n"+t),t.indexOf("#version")>=0&&(t=t.replace("#version","//#version")),o=0;for(let x=0;x<16;++x){if(o=t.indexOf("samplerCube ",o),!(o>0))break;{m=t.indexOf(";",o),d=n.slice(o+12,m),c="";let e=d.split(" ");for(let t=0;t<16;++t)if(""!=e[t]){c=e[t];break}for(E=0;E<16;++E){if(m=t.indexOf(c,m+1),!(m>0))break;if(u=t.lastIndexOf("texture2D",m-1),u<0)break;d=t.slice(u,m),t=t.slice(0,u)+"textureCube("+t.slice(m),m+=2}}o+=4}return t}}i.__glslTransposeMat3="\n    mat3 transpose(mat3 m) {\n        return mat3(m[0][0],m[1][0],m[2][0],\n            m[0][1],m[1][1],m[2][1],\n            m[0][2],m[1][2],m[2][2]);\n    }\n    ",i.__glslTransposeMat4="\n    mat4 transpose(mat4 m) {\n        return mat4(m[0][0],m[1][0],m[2][0],m[3][0],\n            m[0][1],m[1][1],m[2][1],m[3][1],\n            m[0][2],m[1][2],m[2][2],m[3][2],\n            m[0][3],m[1][3],m[2][3],m[3][3]);\n    }\n    ",i.__glslInverseMat3="\n    mat3 inverse(mat3 m) {\n        float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n        float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n        float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];  \n        float b01 = a22 * a11 - a12 * a21;\n        float b11 = -a22 * a10 + a12 * a20;\n        float b21 = a21 * a10 - a11 * a20;  \n        float det = a00 * b01 + a01 * b11 + a02 * b21;  \n        return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n                    b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n                    b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n    }\n    ",i.__glslInverseMat4="\n    mat4 inverse(mat4 m) {\n        float\n            a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n            a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n            a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n            a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n            b00 = a00 * a11 - a01 * a10,\n            b01 = a00 * a12 - a02 * a10,\n            b02 = a00 * a13 - a03 * a10,\n            b03 = a01 * a12 - a02 * a11,\n            b04 = a01 * a13 - a03 * a11,\n            b05 = a02 * a13 - a03 * a12,\n            b06 = a20 * a31 - a21 * a30,\n            b07 = a20 * a32 - a22 * a30,\n            b08 = a20 * a33 - a23 * a30,\n            b09 = a21 * a32 - a22 * a31,\n            b10 = a21 * a33 - a23 * a31,\n            b11 = a22 * a33 - a23 * a32,\n            det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n        return mat4(\n            a11 * b11 - a12 * b10 + a13 * b09,\n            a02 * b10 - a01 * b11 - a03 * b09,\n            a31 * b05 - a32 * b04 + a33 * b03,\n            a22 * b04 - a21 * b05 - a23 * b03,\n            a12 * b08 - a10 * b11 - a13 * b07,\n            a00 * b11 - a02 * b08 + a03 * b07,\n            a32 * b02 - a30 * b05 - a33 * b01,\n            a20 * b05 - a22 * b02 + a23 * b01,\n            a10 * b10 - a11 * b08 + a13 * b06,\n            a01 * b08 - a00 * b10 - a03 * b06,\n            a30 * b04 - a31 * b02 + a33 * b00,\n            a21 * b02 - a20 * b04 - a23 * b00,\n            a11 * b07 - a10 * b09 - a12 * b06,\n            a00 * b09 - a01 * b07 + a02 * b06,\n            a31 * b01 - a30 * b03 - a32 * b00,\n            a20 * b03 - a21 * b01 + a22 * b00) / det;\n        }\n    ",e.default=i},8333:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.COLOR_BUFFER_BIT=131,i.DEPTH_BUFFER_BIT=132,i.STENCIL_BUFFER_BIT=133,e.default=i},"839a":function(t,e,s){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t["Default"]=1]="Default",t[t["FragColor"]=2]="FragColor",t[t["SpecularMapColor"]=3]="SpecularMapColor"}(i||(i={})),e.SpecularMode=i},"83d1":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("ab73"));class a{create(t,e){let s=r.default.StageParam;return e.hasUniformByName(s.name)?t.uniformContext.createShaderGlobalUniformFromProbe(t.getStage3D().uProbe,s.name,[s.name]):null}getIDNS(){return"StageParamUniformBuilder"}}e.default=a},"857b":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("ab73"));class a{create(t,e){let s=r.default.CameraPosParam;return e.hasUniformByName(s.name)?t.uniformContext.createShaderGlobalUniformFromProbe(t.getCamera().ucameraPosProbe,s.name,[s.name]):null}getIDNS(){return"CameraPosUniformBuilder"}}e.default=a},"85b6":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("7918"),a=i(s("0851"));class h extends a.default{constructor(t,e,s=!1){super(t,e,s),this.B_=null,this.j=r.TextureProxyType.Wrapper}getResUid(){return this.B_.getResUid()}getBufWidth(){return this.B_.getBufWidth()}getBufHeight(){return this.B_.getBufHeight()}getWidth(){return this.B_.getWidth()}getHeight(){return this.B_.getHeight()}isDirect(){return!1}getAttachTex(){return this.B_}attachTex(t){this.B_!=t&&(null!=this.B_&&this.B_.__$detachThis(),null!=t&&t.__$attachThis(),this.B_=t)}detachTex(){null!=this.B_&&this.B_.__$detachThis(),this.B_=null}__$attachThis(){super.__$attachThis(),null!=this.B_&&this.B_.__$attachThis()}__$detachThis(){super.__$detachThis(),null!=this.B_&&this.B_.__$detachThis()}__$$use(t){this.B_.__$$use(t)}isGpuEnabled(){return this.B_.isGpuEnabled()}getSampler(){return this.B_.getSampler()}__$updateToGpu(t){this.B_.__$updateToGpu(t)}__$$upload(t){this.B_.__$$upload(t)}__$destroy(){this.getAttachCount()<1&&(null!=this.B_&&this.B_.__$detachThis(),this.B_=null,super.__$destroy())}isDataEnough(){return this.B_.isDataEnough()}getTargetType(){return this.B_.getTargetType()}}e.default=h},8875:function(t,e,s){var i,r,a;(function(s,h){r=[],i=h,a="function"===typeof i?i.apply(e,r):i,void 0===a||(t.exports=a)})("undefined"!==typeof self&&self,(function(){function t(){var e=Object.getOwnPropertyDescriptor(document,"currentScript");if(!e&&"currentScript"in document&&document.currentScript)return document.currentScript;if(e&&e.get!==t&&document.currentScript)return document.currentScript;try{throw new Error}catch(d){var s,i,r,a=/.*at [^(]*\((.*):(.+):(.+)\)$/gi,h=/@([^@]*):(\d+):(\d+)\s*$/gi,n=a.exec(d.stack)||h.exec(d.stack),l=n&&n[1]||!1,_=n&&n[2]||!1,o=document.location.href.replace(document.location.hash,""),m=document.getElementsByTagName("script");l===o&&(s=document.documentElement.outerHTML,i=new RegExp("(?:[^\\n]+?\\n){0,"+(_-2)+"}[^<]*<script>([\\d\\D]*?)<\\/script>[\\d\\D]*","i"),r=s.replace(i,"$1").trim());for(var u=0;u<m.length;u++){if("interactive"===m[u].readyState)return m[u];if(m[u].src===l)return m[u];if(l===o&&m[u].innerHTML&&m[u].innerHTML.trim()===r)return m[u]}return null}}return t}))},"8a0a":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("ca6c"));class a{static ToGL(t,e){switch(e){case a.VTX_STATIC_DRAW:return t.STATIC_DRAW;case a.VTX_DYNAMIC_DRAW:return t.DYNAMIC_DRAW;case a.VTX_STREAM_DRAW:return t.STREAM_DRAW;case a.VTX_STATIC_READ:return t.STATIC_READ;case a.VTX_DYNAMIC_READ:return t.DYNAMIC_READ;case a.VTX_STREAM_READ:return t.STREAM_READ;case a.VTX_STATIC_COPY:return t.STATIC_COPY;case a.VTX_DYNAMIC_COPY:return t.DYNAMIC_COPY;case a.VTX_STREAM_COPY:return t.STREAM_COPY;default:break}return t.STATIC_DRAW}static GetVBufTypeByNS(t){switch(t){case a.VBUF_VS_NS:return a.VBUF_VS;case a.VBUF_UVS_NS:return a.VBUF_UVS;case a.VBUF_NVS_NS:return a.VBUF_NVS;case a.VBUF_CVS_NS:return a.VBUF_CVS;case a.VBUF_VS2_NS:return a.VBUF_VS2;case a.VBUF_UVS2_NS:return a.VBUF_UVS2;case a.VBUF_NVS2_NS:return a.VBUF_NVS2;case a.VBUF_CVS2_NS:return a.VBUF_CVS2;case a.VBUF_TVS_NS:return a.VBUF_TVS;case a.VBUF_TVS2_NS:return a.VBUF_TVS2;default:}return-1}static GetVBufNSByType(t){switch(t){case a.VBUF_VS:return a.VBUF_VS_NS;case a.VBUF_UVS:return a.VBUF_UVS_NS;case a.VBUF_NVS:return a.VBUF_NVS_NS;case a.VBUF_CVS:return a.VBUF_CVS_NS;case a.VBUF_VS2:return a.VBUF_VS2_NS;case a.VBUF_UVS2:return a.VBUF_UVS2_NS;case a.VBUF_NVS2:return a.VBUF_NVS2_NS;case a.VBUF_CVS2:return a.VBUF_CVS2_NS;case a.VBUF_TVS:return a.VBUF_TVS_NS;case a.VBUF_TVS2:return a.VBUF_TVS2_NS;default:}return""}static GetVBufAttributeTypeByNS(t){return a.GetVBufTypeByNS(t)-3e3}static GetVBufAttributeTypeByVBufType(t){return t-3e3}}a.VTXTYPE_GL_POINTS=101,a.VTXTYPE_GL_LINES=102,a.VTXTYPE_GL_LINE_STRIP=103,a.VTXTYPE_GL_TRIANGLES=111,a.VTX_STATIC_DRAW=0,a.VTX_DYNAMIC_DRAW=1,a.VTX_STREAM_DRAW=2,a.VTX_STATIC_READ=3,a.VTX_DYNAMIC_READ=4,a.VTX_STREAM_READ=5,a.VTX_STATIC_COPY=6,a.VTX_DYNAMIC_COPY=7,a.VTX_STREAM_COPY=8,a.VBUF_VS=3001,a.VBUF_UVS=3002,a.VBUF_NVS=3003,a.VBUF_CVS=3004,a.VBUF_TVS=3005,a.VBUF_VS2=3006,a.VBUF_UVS2=3007,a.VBUF_NVS2=3008,a.VBUF_CVS2=3009,a.VBUF_TVS2=3010,a.VBUF_VS_INDEX=r.default.BIT_ONE_0,a.VBUF_UVS_INDEX=r.default.BIT_ONE_1,a.VBUF_NVS_INDEX=r.default.BIT_ONE_2,a.VBUF_CVS_INDEX=r.default.BIT_ONE_3,a.VBUF_TVS_INDEX=r.default.BIT_ONE_4,a.VBUF_VS2_INDEX=r.default.BIT_ONE_5,a.VBUF_UVS2_INDEX=r.default.BIT_ONE_6,a.VBUF_NVS2_INDEX=r.default.BIT_ONE_7,a.VBUF_CVS2_INDEX=r.default.BIT_ONE_8,a.VBUF_TVS2_INDEX=r.default.BIT_ONE_9,a.VBUF_VS_NS="a_vs",a.VBUF_VS2_NS="a_vs2",a.VBUF_UVS_NS="a_uvs",a.VBUF_UVS2_NS="a_uvs2",a.VBUF_NVS_NS="a_nvs",a.VBUF_NVS2_NS="a_nvs2",a.VBUF_CVS_NS="a_cvs",a.VBUF_CVS2_NS="a_cvs2",a.VBUF_TVS_NS="a_tvs",a.VBUF_TVS2_NS="a_tvs2";class h{}h.FLAT=210,h.GOURAND=310,e.VtxNormalType=h,e.default=a},"8ae4":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.T=0,this.A_K=null,this.A_L=0,this.CA=null,this.CB=0,this.ibufStep=0,this.T=i.EM+1}getUid(){return this.T}getVtxUid(){return this.A_L}getGpuBuf(){return this.CA}getVTCount(){return this.CB}updateToGpu(t){if(null!=this.CA&&this.CB>0){let e=this.A_K;this.version!=e.indicesVer&&(this.CC=e.getIvsData(),t.bindEleBuf(this.CA),this.CB>=this.CC.length?t.eleBufSubData(this.CC,e.getBufDataUsage()):t.eleBufData(this.CC,e.getBufDataUsage()),this.CB=this.CC.length,this.version=e.indicesVer)}}initialize(t,e){if(null==this.CA&&null!=e.getIvsData())if(this.version=e.indicesVer,this.A_K=e,this.A_L=e.getUid(),this.CC=e.getIvsData(),this.CA=t.createBuf(),t.bindEleBuf(this.CA),null==e.bufData)t.eleBufData(this.CC,e.getBufDataUsage()),this.CB=this.CC.length;else{t.eleBufDataMem(e.bufData.getIndexDataTotalBytes(),e.getBufDataUsage());let s=null,i=0;this.CB=0;for(let r=0,a=e.bufData.getIndexDataTotal();r<a;++r)s=e.bufData.getIndexDataAt(r),t.eleBufSubData(s,i),i+=s.byteLength,this.CB+=s.length}}destroy(t){null!=this.CA&&(this.A_K=null,t.deleteBuf(this.CA),this.CA=null,this.CC=null,this.CB=0)}}i.EM=0,e.ROIndicesRes=i},"8d98":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=i(s("030e"));class h{static ToGL(t,e){switch(e){case h.RGBA:break;case h.R8:return t.R8;case h.RGB:return t.RGB;case h.RGB8:return t.RGB8;case h.RGBA8:return t.RGBA8;case h.ALPHA:return t.ALPHA;case h.RGB16F:return r.default.IsWebGL2()?t.RGB16F:t.RGB;case h.RGBA16F:return r.default.IsWebGL2()?t.RGBA16F:t.RGBA;case h.RGB32F:return r.default.IsWebGL2()&&t.RGB32F,t.RGB;case h.RGBA32F:return r.default.IsWebGL2()&&t.RGBA32F,t.RGBA;case h.RED:return t.RED;case h.DEPTH_COMPONENT:return t.DEPTH_COMPONENT;case h.DEPTH_STENCIL:return t.DEPTH_STENCIL;default:break}return t.RGBA}}h.R8=101,h.RGB=110,h.RED=111,h.RGBA=121,h.RGB8=122,h.RGBA8=123,h.ALPHA=132,h.RGB16F=331,h.RGBA16F=332,h.RGB32F=341,h.RGBA32F=342,h.DEPTH_COMPONENT=351,h.DEPTH_STENCIL=352,e.TextureFormat=h;class n{static ToGL(t,e){switch(e){case n.UNSIGNED_BYTE:return t.UNSIGNED_BYTE;case n.BYTE:return t.BYTE;case n.FLOAT:return t.FLOAT;case n.HALF_FLOAT:return t.HALF_FLOAT;case n.HALF_FLOAT_OES:return null!=a.default.OES_texture_half_float?a.default.OES_texture_half_float.HALF_FLOAT_OES:t.FLOAT;case n.UNSIGNED_SHORT:return t.UNSIGNED_SHORT;case n.UNSIGNED_INT:return t.UNSIGNED_INT;case n.UNSIGNED_SHORT_5_6_5:return t.UNSIGNED_SHORT_5_6_5;case n.UNSIGNED_SHORT_4_4_4_4:return t.UNSIGNED_SHORT_4_4_4_4;case n.UNSIGNED_SHORT_5_5_5_1:return t.UNSIGNED_SHORT_5_5_5_1;case n.UNSIGNED_INT_24_8_WEBGL:return a.default.WEBGL_depth_texture.UNSIGNED_INT_24_8_WEBGL;default:break}return t.UNSIGNED_BYTE}}n.UNSIGNED_BYTE=1108,n.UNSIGNED_SHORT=1109,n.UNSIGNED_INT=1110,n.BYTE=1111,n.FLOAT=1211,n.HALF_FLOAT=1212,n.HALF_FLOAT_OES=1213,n.UNSIGNED_SHORT_5_6_5=1214,n.UNSIGNED_SHORT_4_4_4_4=1215,n.UNSIGNED_SHORT_5_5_5_1=1216,n.UNSIGNED_INT_24_8_WEBGL=1217,e.TextureDataType=n;class l{static GetValue(t,e){switch(e){case l.TEXTURE_2D:return t.TEXTURE_2D;case l.TEXTURE_2D_ARRAY:return t.TEXTURE_2D_ARRAY;case l.TEXTURE_CUBE:return t.TEXTURE_CUBE_MAP;case l.TEXTURE_3D:return t.TEXTURE_3D;default:break}return t.TEXTURE_2D}}l.TEXTURE_2D=20,l.TEXTURE_2D_ARRAY=22,l.TEXTURE_SHADOW_2D=23,l.TEXTURE_CUBE=25,l.TEXTURE_3D=30,e.TextureTarget=l;class _{static GetConst(t,e){switch(e){case _.NEAREST:return t.NEAREST;case _.LINEAR:return t.LINEAR;case _.LINEAR_MIPMAP_LINEAR:return t.LINEAR_MIPMAP_LINEAR;case _.NEAREST_MIPMAP_NEAREST:return t.NEAREST_MIPMAP_NEAREST;case _.LINEAR_MIPMAP_NEAREST:return t.LINEAR_MIPMAP_NEAREST;case _.NEAREST_MIPMAP_LINEAR:return t.NEAREST_MIPMAP_LINEAR;case _.WRAP_REPEAT:return t.REPEAT;case _.WRAP_CLAMP_TO_EDGE:return t.CLAMP_TO_EDGE;case _.WRAP_MIRRORED_REPEAT:return t.MIRRORED_REPEAT;default:break}return-1}}_.WRAP_REPEAT=3001,_.WRAP_CLAMP_TO_EDGE=3002,_.WRAP_MIRRORED_REPEAT=3003,_.NEAREST=4001,_.LINEAR=4002,_.LINEAR_MIPMAP_LINEAR=4003,_.NEAREST_MIPMAP_NEAREST=4004,_.LINEAR_MIPMAP_NEAREST=4005,_.NEAREST_MIPMAP_LINEAR=4006,e.TextureConst=_},"8def":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("919c"));class a extends r.default{constructor(){super(),this.shdp=null,this.vbufs=null,this.vbuf=null,this.attribTypes=null,this.wholeOffsetList=null,this.attribTypesLen=0,this.updateUnlocked=!0,this.wholeStride=0,this.T=a.EM++}run(){this.AM.testVROUid(this.T)&&(null!=this.vbuf?this.AM.useVtxAttribsPtrTypeFloat(this.shdp,this.vbuf,this.attribTypes,this.attribTypesLen,this.wholeOffsetList,this.wholeStride):this.AM.useVtxAttribsPtrTypeFloatMulti(this.shdp,this.vbufs,this.attribTypes,this.attribTypesLen,this.wholeOffsetList,this.wholeStride),this.AM.testRIOUid(this.A_L)&&this.AM.bindEleBuf(this.ibuf))}__$destroy(){r.default.Er.delete(this.CD),this.CD=0,this.A_L=-1,this.AM=null,this.shdp=null,this.vbufs=null,this.vbuf=null,this.ibuf=null,this.attribTypes=null,this.attribTypesLen=0,this.wholeStride=0}restoreThis(){a.Restore(this)}toString(){return"VertexRenderObj(uid = "+this.T+", type="+this.CD+")"}static HasMid(t){return r.default.Er.has(t)}static GetByMid(t){return r.default.Er.get(t)}static GetFreeId(){return a.Es.length>0?a.Es.pop():-1}static Create(t,e,s){let i=null,h=a.GetFreeId();return h>=0?(i=a.Et[h],a.Eu[h]=a.EY,i.setMidAndBufUid(e,s)):(i=new a,i.setMidAndBufUid(e,s),a.Et.push(i),a.Eu.push(a.EY),a.Ev++),i.setRC(t),r.default.Er.set(e,i),i}static Restore(t){if(null!=t&&t.Y<1&&a.Eu[t.getUid()]==a.EY){let e=t.getUid();a.Es.push(e),a.Eu[e]=a.Eq,t.__$destroy()}}}a.EM=0,a.EY=1,a.Eq=0,a.Eu=[],a.Ev=0,a.Et=[],a.Es=[],e.default=a},"8e17":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=180/Math.PI,r=1e-5;class a{constructor(t=0,e=0,s=0,i=1){this.x=0,this.y=0,this.z=0,this.w=0,this.x=t,this.y=e,this.z=s,this.w=i}clone(){return new a(this.x,this.y,this.z,this.w)}setTo(t,e,s,i=1){this.x=t,this.y=e,this.z=s,this.w=i}setXYZ(t,e,s){this.x=t,this.y=e,this.z=s}copyFrom(t){this.x=t.x,this.y=t.y,this.z=t.z}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}multBy(t){this.x*=t.x,this.y*=t.y,this.z*=t.z}normalize(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);t>r&&(this.x/=t,this.y/=t,this.z/=t)}normalizeTo(t){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);e>r?(t.x=this.x/e,t.y=this.y/e,t.z=this.z/e):(t.x=this.x,t.y=this.y,t.z=this.z)}scaleVector(t){this.x*=t.x,this.y*=t.y,this.z*=t.z}scaleBy(t){this.x*=t,this.y*=t,this.z*=t}negate(){this.x=-this.x,this.y=-this.y,this.z=-this.z}equalsXYZ(t){return Math.abs(this.x-t.x)<r&&Math.abs(this.y-t.y)<r&&Math.abs(this.z-t.z)<r}equalsAll(t){return Math.abs(this.x-t.x)<r&&Math.abs(this.y-t.y)<r&&Math.abs(this.z-t.z)<r&&Math.abs(this.w-t.w)<r}project(){let t=1/this.w;this.x*=t,this.y*=t,this.z*=t}getLength(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}getLengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z}addBy(t){this.x+=t.x,this.y+=t.y,this.z+=t.z}subtractBy(t){this.x-=t.x,this.y-=t.y,this.z-=t.z}subtract(t){return new a(this.x-t.x,this.y-t.y,this.z-t.z)}add(t){return new a(this.x+t.x,this.y+t.y,this.z+t.z)}crossProduct(t){return new a(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}crossBy(t){let e=this.y*t.z-this.z*t.y,s=this.z*t.x-this.x*t.z,i=this.x*t.y-this.y*t.x;this.x=e,this.y=s,this.z=i}reflectBy(t){let e=2*(this.x*t.x+this.y*t.y+this.z*t.z);this.x=this.x-e*t.x,this.y=this.y-e*t.y,this.z=this.z-e*t.z}scaleVecTo(t,e){this.x=t.x*e,this.y=t.y*e,this.z=t.z*e}subVecsTo(t,e){this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z}addVecsTo(t,e){this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z}crossVecsTo(t,e){this.x=t.y*e.z-t.z*e.y,this.y=t.z*e.x-t.x*e.z,this.z=t.x*e.y-t.y*e.x}toString(){return"Vector3D("+this.x+this.y+this.z+")"}static Cross(t,e,s){s.x=t.y*e.z-t.z*e.y,s.y=t.z*e.x-t.x*e.z,s.z=t.x*e.y-t.y*e.x}static CrossSubtract(t,e,s,i,r){a.__vtor3Stv0.x=e.x-t.x,a.__vtor3Stv0.y=e.y-t.y,a.__vtor3Stv0.z=e.z-t.z,a.__vtor3Stv1.x=i.x-s.x,a.__vtor3Stv1.y=i.y-s.y,a.__vtor3Stv1.z=i.z-s.z,t=a.__vtor3Stv0,s=a.__vtor3Stv1,r.x=t.y*s.z-t.z*s.y,r.y=t.z*s.x-t.x*s.z,r.z=t.x*s.y-t.y*s.x}static Subtract(t,e,s){s.x=t.x-e.x,s.y=t.y-e.y,s.z=t.z-e.z}static DistanceSquared(t,e){return a.__vtor3Stv0.x=t.x-e.x,a.__vtor3Stv0.y=t.y-e.y,a.__vtor3Stv0.z=t.z-e.z,a.__vtor3Stv0.getLengthSquared()}static DistanceXYZ(t,e,s,i,r,h){return a.__vtor3Stv0.x=t-i,a.__vtor3Stv0.y=e-r,a.__vtor3Stv0.z=s-h,a.__vtor3Stv0.getLength()}static Distance(t,e){return a.__vtor3Stv0.x=t.x-e.x,a.__vtor3Stv0.y=t.y-e.y,a.__vtor3Stv0.z=t.z-e.z,a.__vtor3Stv0.getLength()}static AngleBetween(t,e){return t.normalizeTo(a.__vtor3Stv0),e.normalizeTo(a.__vtor3Stv1),Math.acos(a.__vtor3Stv0.dot(a.__vtor3Stv1))*i}static RadianBetween(t,e){return t.normalizeTo(a.__vtor3Stv0),e.normalizeTo(a.__vtor3Stv1),Math.acos(a.__vtor3Stv0.dot(a.__vtor3Stv1))}static RadianBetween2(t,e){let s=t.getLengthSquared(),i=e.getLengthSquared();return a.__vtor3Stv0.x=t.x-e.x,a.__vtor3Stv0.y=t.y-e.y,a.__vtor3Stv0.z=t.z-e.z,Math.acos((s+i-a.__vtor3Stv0.getLengthSquared())/(2*Math.sqrt(s)*Math.sqrt(i)))}static Reflect(t,e,s){let i=2*(t.x*e.x+t.y*e.y+t.z*e.z);s.x=t.x-i*e.x,s.y=t.y-i*e.y,s.z=t.z-i*e.z}}a.X_AXIS=new a(1,0,0),a.Y_AXIS=new a(0,1,0),a.Z_AXIS=new a(0,0,1),a.__vtor3Stv0=new a,a.__vtor3Stv1=new a,a.ZERO=new a,e.default=a},9156:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static SetTransUniform(t,e){i.Ew.set(t.getUid(),e)}static GetTransUniform(t){if(t.getUid()<0)throw Error("mat.getUid() < 0");return i.Ew.has(t.getUid())?i.Ew.get(t.getUid()):null}static HasTransUniform(t){return i.Ew.has(t.getUid())}static RemoveTransUniform(t){i.Ew.delete(t.getUid())}}i.Ew=new Map,e.default=i},"919c":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.T=0,this.CD=0,this.A_L=0,this.AM=null,this.indicesRes=null,this.ibuf=null,this.ibufStep=2,this.Y=0}getVTCount(){return null!=this.indicesRes?this.indicesRes.getVTCount():0}setRC(t){this.AM=t}setMidAndBufUid(t,e){this.CD=t,this.A_L=e,this.Y=0}getUid(){return this.T}getVtxUid(){return this.A_L}getMid(){return this.CD}run(){}__$attachThis(){++this.Y}__$detachThis(){--this.Y,this.Y<1&&(this.Y=0)}__$destroy(){i.Er.delete(this.CD),this.CD=0,this.A_L=-1,this.ibuf=null,this.AM=null,this.indicesRes=null}restoreThis(){}static HasMid(t){return i.Er.has(t)}static GetByMid(t){return i.Er.get(t)}__$resetVRO(){i.Ex=-1}}i.Ex=0,i.Er=new Map,e.default=i},9260:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("7045"));class a{static KeyDown(t){for(var e=a.CE.length,s=0;s<e;++s)a.CE[s].call(a.CG[s],t)}static KeyUp(t){let e=a.CF.length;for(let s=0;s<e;++s)a.CF[s].call(a.CH[s],t)}static RemoveEventListener(t,e){if(null!=e){let s;switch(t){case r.default.KEY_DOWN:for(s=a.CE.length-1;s>=0;--s)if(e===a.CE[s]){a.CG.splice(s,1),a.CE.splice(s,1);break}break;case r.default.KEY_UP:for(s=a.CF.length-1;s>=0;--s)if(e===a.CF[s]){a.CH.splice(s,1),a.CF.splice(s,1);break}break;default:break}}}}a.CG=[],a.CE=[],a.CH=[],a.CF=[],a.AddEventListener=function(t,e,s){if(null!=s){let i=0;switch(t){case r.default.KEY_DOWN:for(i=a.CE.length-1;i>=0;--i)if(s===a.CE[i])break;i<0&&(a.CG.push(e),a.CE.push(s));break;case r.default.KEY_UP:for(i=a.CF.length-1;i>=0;--i)if(s===a.CF[i])break;i<0&&(a.CH.push(e),a.CF.push(s));break;default:break}}},e.default=a},"955e":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("8e17")),h=i(s("c120")),n=s("e08e"),l=i(s("29ef")),_=i(s("3930")),o=i(s("e7ce")),m=s("e160");class u{constructor(){this.CI=new _.default,this.CJ=new o.default,this.B3=null,this.Ar=null,this.CK=null,this.CL=null,this.CM=new Uint8Array(256),this.CN=null,this.CO=null,this.CP=0,this.CQ=0,this.CR=new a.default,this.CS=new a.default,this.BS=null,this.BT=null,this.CT=new Uint8Array(4),this.CU=new a.default,this.CV=new a.default,this.CW=[null,null],this.CX=!0,this.CY=new Uint8Array(4),this.CZ=new Uint8Array(256)}setRenderer(t){this.B3=t}setRayTestMode(t){this.CQ=t}setRay(t,e){this.BS=t,this.BT=e}getRay(t,e){t.copyFrom(this.BS),e.copyFrom(this.BT)}setCamera(t){this.Ar=t}setCullingNodeHead(t){if(this.CK=t,null==this.CN){this.CN=[];let t=0;for(;t<256;++t)this.CN.push(new h.default)}}getSelectedNode(){return this.CO}getSelectedNodes(){return this.CN}getSelectedNodesTotal(){return this.CP}sorting(t,e){let s=this.CN;this.CL=s[t];while(t<e){while(t<e&&s[e].dis>=this.CL.dis)--e;s[t]=s[e];while(t<e&&s[t].dis<=this.CL.dis)++t;s[e]=s[t]}return s[t]=this.CL,t}snsort(t,e){if(t<e){let s=this.sorting(t,e);this.snsort(t,s-1),this.snsort(s+1,e)}}run(){let t=this.CK;if(null!=t){let e=0,s=this.BT,i=this.BS,a=this.CV,h=null,n=0;Math.abs(s.x)>r.default.MATH_MIN_POSITIVE?this.CU.x=1/s.x:this.CU.x=r.default.MATH_MAX_POSITIVE,Math.abs(s.y)>r.default.MATH_MIN_POSITIVE?this.CU.y=1/s.y:this.CU.y=r.default.MATH_MAX_POSITIVE,Math.abs(s.z)>r.default.MATH_MIN_POSITIVE?this.CU.z=1/s.z:this.CU.z=r.default.MATH_MAX_POSITIVE,this.CU.x<0?this.CT[0]=1:this.CT[0]=0,this.CU.y<0?this.CT[1]=1:this.CT[1]=0,this.CU.z<0?this.CT[2]=1:this.CT[2]=0;while(null!=t)t.drawEnabled&&t.entity.mouseEnabled&&(a.x=t.bounds.center.x-i.x,a.y=t.bounds.center.y-i.y,a.z=t.bounds.center.z-i.z,e=a.dot(s),a.x-=e*s.x,a.y-=e*s.y,a.z-=e*s.z,a.getLengthSquared()<=t.bounds.radius2&&t.rayTestState<1&&(this.CW[0]=t.bounds.min,this.CW[1]=t.bounds.max,m.AABBCalc.IntersectionRL3(this.CW,this.CT,this.CU,s,i,a)&&(h=this.CN[n],h.entity=t.entity,h.dis=this.CU.w,h.wpv.copyFrom(a),++n))),t=t.next;this.CO=null;let l=0;if(n>0){let t=this.CR,e=this.CS,r=null,h=0,_=0,o=null,m=null,u=s.dot(i),d=0,c=!this.CX,f=0;if(n>1){for(this.snsort(0,n-1),l=0;l<n;++l){if(m=this.CN[l],r=this.CN[l].entity,r.isPolyhedral()?c?(o=r.getInvMatrix(),o.transformOutVector3(i,t),o.deltaTransformOutVector(s,e),e.normalize(),h=r.testRay(t,e,a,!0)):(++f,h=0):(o=r.getInvMatrix(),o.transformOutVector3(i,t),o.deltaTransformOutVector(s,e),e.normalize(),h=r.testRay(t,e,a,!0)),h>0){if(m.lpv.copyFrom(a),r.getMatrix().transformOutVector3(a,m.wpv),m.dis=s.dot(m.wpv)-u,this.CM[_]=l,++_,m.dis>d){this.CO=m;break}}else if(h<0&&(this.CM[_]=l,++_,m.dis>d)){this.CO=m;break}d=m.dis}null==this.CO&&_>0&&(this.CO=this.CN[this.CM[0]])}else m=this.CN[0],r=this.CN[0].entity,o=r.getInvMatrix(),o.transformOutVector3(i,t),o.deltaTransformOutVector(s,e),e.normalize(),r.isPolyhedral()?c?h=r.testRay(t,e,a,!0):(++f,h=0):h=r.testRay(t,e,a,!0),h>0?(m.lpv.copyFrom(a),r.getMatrix().transformOutVector3(a,m.wpv),m.dis=s.dot(m.wpv)-u,this.CO=m):h<0&&(this.CO=m);f>0&&(this.CQ<1||null==this.CO||this.CO.entity.isPolyhedral())&&this.gpuPick(n)}for(l=n;l<this.CP;++l)this.CO!=this.CN[l]&&(this.CN[l].entity=null);this.CP=n}}gpuPick(t){let e=this.B3.getRendererContext(),s=this.B3.getRenderProxy(),i=s.getStage3D().mouseX,r=s.getStage3D().mouseY;e.vertexRenderBegin(),e.getClearRGBAColor4f(this.CI),e.setClearRGBAColor4f(0,0,0,0),e.setScissorEnabled(!0),e.setScissorRect(i,r,1,1),e.clearBackBuffer(),this.CY[3]=0,l.default.LockBlendMode(n.RenderBlendMode.OPAQUE),l.default.LockDepthTestMode(n.DepthTestMode.OPAQUE),e.unlockMaterial(),e.unlockRenderState(),e.useGlobalMaterial(this.CJ,!1,!1);let a=null,h=null,_=-1,o=0;for(;o<t;++o)a=this.CN[o],h=this.CN[o].entity,h.isPolyhedral()&&(++_,this.CJ.setIndex(_+2),this.CZ[_]=o,this.B3.updateMaterialUniformToCurrentShd(this.CJ),this.B3.drawEntity(h,!1,!0));if(_>-1&&s.readPixels(i,r,1,1,s.RGBA,s.UNSIGNED_BYTE,this.CY),l.default.UnlockBlendMode(),l.default.UnlockDepthTestMode(),this.CY[3]>1){o=this.CZ[this.CY[3]-2],a=this.CN[o];let t=(this.CY[0]<<8)+this.CY[1]+this.CY[2]/255;if(null!=this.CO){let e=this.CO.entity;this.CO==a||e.isPolyhedral()||this.CO.dis<t&&(o=-1)}o>-1&&(a.dis=t,this.getWorldPosByRayDistance(t,this.BT,this.Ar.getPosition(),a.wpv),this.CO=a)}e.setScissorEnabled(!1),e.unlockMaterial(),e.unlockRenderState(),l.default.UnlockBlendMode(),l.default.UnlockDepthTestMode(),e.setClearRGBAColor4f(this.CI.r,this.CI.g,this.CI.b,this.CI.a),e.resetState()}clear(){this.CO=null}getWorldPosByRayDistance(t,e,s,i){i.x=e.x*t+s.x,i.y=e.y*t+s.y,i.z=e.z*t+s.z}}e.default=u},9666:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=i(s("acfe"));class h{static CreateShdData(t,e,s,i,n){if(h.Ey.has(t))return h.Ey.get(t);let l=new a.default;return l.adaptationShaderVersion=i,l.preCompileInfo=n,l.initialize(t,e,s),h.Ez[l.getUid()]=l,++h.s_shdDataListLen,h.Ey.set(t,l),r.default.SHADERCODE_TRACE_ENABLED,l}static FindData(t){return h.Ey.has(t)?h.Ey.get(t):null}}h.Ey=new Map,h.Ez=[],h.s_shdDataListLen=0,e.default=h},"984e":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.waitDelTimes=0,this.rcuid=0,this.resUid=0,this.width=0,this.height=0,this.depth=0,this.sampler=0,this.texBuf=null,this.Y=0}__$attachThis(){++this.Y}__$detachThis(){--this.Y,this.Y<1&&(this.Y=0)}bindToGpu(t){t.bindTexture(this.sampler,this.texBuf)}getAttachCount(){return this.Y}}class r{constructor(t,e){this.B_U=new Map,this.B_V=new Map,this.Ca=0,this.B_Y=0,this.B_Z=128,this.A=0,this.s=null,this.texMid=-1,this.unlocked=!0,this.A=t,this.s=e}createBuf(){return this.s.createTexture()}createResByParams3(t,e,s,r){if(!this.B_U.has(t)){let a=new i;return a.rcuid=this.getRCUid(),a.resUid=t,a.width=e,a.height=s,a.sampler=r,a.texBuf=this.createBuf(),a.texBuf.resUid=t,this.addTextureRes(a),!0}return!1}getRCUid(){return this.A}getRC(){return this.s}hasResUid(t){return this.B_U.has(t)}renderBegin(){this.texMid=-1}getTextureResTotal(){return this.Ca}addTextureRes(t){this.B_U.has(t.resUid)||(t.waitDelTimes=0,this.B_U.set(t.resUid,t),this.Ca++)}getGpuBuffer(t){return this.B_U.has(t)?this.B_U.get(t).texBuf:null}bindToGpu(t){this.B_U.has(t)&&this.B_U.get(t).bindToGpu(this.s)}getAttachTotal(){return this.B_Y}__$attachRes(t){if(this.B_U.has(t)){this.B_Y++;let e=this.B_U.get(t);e.getAttachCount()<1&&this.B_V.has(t)&&this.B_V.delete(t),e.waitDelTimes=0,e.__$attachThis()}}__$detachRes(t){if(this.B_U.has(t)&&this.B_U.has(t)){let e=this.B_U.get(t);e.getAttachCount()>0&&(this.B_Y--,e.__$detachThis(),e.getAttachCount()<1&&this.B_V.set(t,e))}}update(){if(this.B_Z--,this.B_Z<1){this.B_Z=128;for(const[t,e]of this.B_V)e.waitDelTimes++,e.waitDelTimes>5&&(this.B_U.delete(e.resUid),this.B_V.delete(e.resUid),this.s.deleteTexture(e.texBuf),e.texBuf=null,this.Ca--)}}}e.default=r},"9c4d":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.prev=null,this.next=null,this.flag=0,this.target=null}reset(){this.flag=0,this.target=null}}class r{constructor(){this.Ah=null,this.Ai=null}destroy(){this.clear()}clear(){this.Ah=this.Ai=null}getBegin(){return this.Ah}isEmpty(){return this.Ah==this.Ai&&null==this.Ai}addNode(t){null==this.Ah?this.Ai=this.Ah=t:null!=this.Ai.prev?(this.Ai.next=t,t.prev=this.Ai,this.Ai=t):(this.Ah.next=t,t.prev=this.Ai,this.Ai=t),this.Ai.next=null}removeNode(t){t==this.Ah?t==this.Ai?this.Ah=this.Ai=null:(this.Ah=t.next,this.Ah.prev=null):t==this.Ai?(this.Ai=t.prev,this.Ai.next=null):(t.next.prev=t.prev,t.prev.next=t.next),t.prev=null,t.next=null}}class a{constructor(){this.Cb=new r,this.Cc=[],this.Cd=[new i]}getFreeId(){if(this.Cc.length>0)return this.Cc.pop();let t=new i;return t.flag=this.Cd.length,this.Cd.push(t),t.flag}addRunner(t){if(null!=t&&t.getRunFlag()<1){let e=this.getFreeId(),s=this.Cd[e];s.flag=e,s.target=t,t.setRunFlag(e),this.Cb.addNode(s)}}removeRunner(t){if(null!=t&&t.getRunFlag()>0){let e=t.getRunFlag();this.Cc.push(e);let s=this.Cd[e];s.flag=e,s.target=null,t.setRunFlag(0),this.Cb.removeNode(s)}}run(){let t=this.Cb.getBegin(),e=t;while(null!=e)t=e,e=t.next,t.target.isRunning()&&t.target.run()}}e.default=a},"9f3e":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("7918"),a=s("8d98"),h=i(s("df25"));class n extends h.default{constructor(t,e,s=!1){super(t,e,s),this.j=r.TextureProxyType.Uint16,this.minFilter=a.TextureConst.LINEAR,this.dataType=a.TextureDataType.UNSIGNED_SHORT}toHalfFloatOes(){this.srcFormat=a.TextureFormat.RGBA,this.internalFormat=a.TextureFormat.RGBA,this.unpackAlignment=4,this.dataType=a.TextureDataType.HALF_FLOAT_OES}toUShort565(){this.srcFormat=a.TextureFormat.RGB,this.internalFormat=a.TextureFormat.RGB,this.unpackAlignment=3,this.dataType=a.TextureDataType.UNSIGNED_SHORT_5_6_5}toUShort4444(){this.srcFormat=a.TextureFormat.RGBA,this.internalFormat=a.TextureFormat.RGBA,this.unpackAlignment=4,this.dataType=a.TextureDataType.UNSIGNED_SHORT_4_4_4_4}toUShort5551(){this.unpackAlignment=4,this.dataType=a.TextureDataType.UNSIGNED_SHORT_5_5_5_1}toUShort(){this.srcFormat=a.TextureFormat.RGBA,this.internalFormat=a.TextureFormat.RGBA,this.dataType=a.TextureDataType.UNSIGNED_SHORT}toAlphaFormat(){this.dataType==a.TextureDataType.UNSIGNED_SHORT&&(this.srcFormat=a.TextureFormat.ALPHA,this.internalFormat=a.TextureFormat.ALPHA,this.unpackAlignment=1)}toRedFormat(){this.dataType==a.TextureDataType.UNSIGNED_SHORT&&(this.srcFormat=a.TextureFormat.RED,this.internalFormat=a.TextureFormat.RED,this.unpackAlignment=1)}toRGBFormat(){this.dataType==a.TextureDataType.UNSIGNED_SHORT&&(this.srcFormat=a.TextureFormat.RGB,this.internalFormat=a.TextureFormat.RGB,this.unpackAlignment=3)}toRGBAFormat(){this.dataType==a.TextureDataType.UNSIGNED_SHORT&&(this.srcFormat=a.TextureFormat.RGBA,this.internalFormat=a.TextureFormat.RGBA,this.unpackAlignment=4)}uploadFromBytes(t,e=0,s=-1,i=-1,r=0,a=0,h=!1){super.setDataFromBytes(t,e,s,i,r,a,h)}setPartDataFromeBytes(t,e,s,i,r,a=0){super.setPartDataFromeBytes(t,e,s,i,r,a)}getPixels(t,e,s,i,r){super.getPixels(t,e,s,i,r)}toString(){return"[Uint16TextureProxy(width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=n},a156:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=i(s("20ef"));class h{constructor(t){this.Ce=new Map,this.Cf=[],this.Cg=0,this.Ch=[],this.A=-1,this.A=t}getRCUid(){return this.A}create(t){let e=t.getUniqueShaderName();if(this.Ce.has(e))return this.Ce.get(e);let s=new a.default(this.Cg);return s.setShdData(t),this.Cf[s.getUid()]=s,this.Ch[s.getUid()]=null,++this.Cg,this.Ce.set(e,s),r.default.SHADERCODE_TRACE_ENABLED,s}findShdProgramByUid(t){return this.Cf[t]}findShdProgram(t){return this.Ce.has(t)?this.Ce.get(t):null}findShdProgramByShdData(t){return null!=t&&this.Ce.has(t.getUniqueShaderName())?this.Ce.get(t.getUniqueShaderName()):null}hasUid(t){return null!=this.Cf[t]}getTotal(){return this.Cg}containsUid(t){return t>-1&&t<this.Cg}}e.ShaderProgramBuilder=h},a446:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("11e6")),a=s("cc48"),h=i(s("265e")),n=i(s("af68")),l=i(s("a80a"));class _{constructor(){this.T=-1,this.B3=null,this.Ar=null,this.Ci=null,this.Cj=new h.default,this.A_G=null,this.Ck=new n.default,this.Cl=new l.default,this.Cm=new l.default,this.Cn=null,this.B_e=null,this.Co=0,this.T=_.EM++,this.Ck.initialize(1)}getUid(){return this.T}initialize(t,e=null){null==this.B3&&(this.B3=t,this.Ci=t.getStage3D(),this.Ar=e,this.A_G=t.getRPONodeBuilder())}getStage3D(){return this.Ci}setCamera(t){this.Ar=t}getCamera(){return this.Ar}getMouseXYWorldRay(t,e){this.Ar.getWorldPickingRayByScreenXY(this.Ci.mouseX,this.Ci.mouseY,t,e)}setSpaceCullingor(t){this.Cn=t}setRaySelector(t){this.B_e=t,this.B_e.setRenderer(this.B3)}getRaySelector(){return this.B_e}addEntity(t){if(null!=t.getGlobalBounds()&&t.spaceCullMask>a.SpaceCullingMask.NONE&&r.default.TestSpaceEnabled(t.__$rseFlag)){t.update(),++this.Co;let e=this.Ck.addEntity(t);e.bounds=t.getGlobalBounds(),e.pcoEnabled=(t.spaceCullMask&a.SpaceCullingMask.POV)==a.SpaceCullingMask.POV;let s=t.isInRendererProcess()||null==t.getMaterial();s&&(t.spaceCullMask&a.SpaceCullingMask.POV)==a.SpaceCullingMask.POV?(e.rstatus=1,null==t.getMaterial()&&(e.rpoNode=this.Cj),null==e.rpoNode&&(e.rpoNode=this.A_G.getNodeByUid(t.getDisplay().__$rpuid)),this.Cm.addNode(e)):null==t.getMaterial()?(e.rstatus=1,e.rpoNode=this.Cj,this.Cm.addNode(e)):(e.rstatus=0,this.Cl.addNode(e))}}removeEntity(t){if(null!=t&&r.default.TestSpaceContains(t.__$rseFlag)){let e=this.Ck.getNodeByEntity(t);null!=e&&(e.rstatus>0?this.Cm.removeNode(e):this.Cl.removeNode(e),this.Ck.removeEntity(t),--this.Co)}}updateEntity(t){}update(){}runBegin(){}run(){let t=this.Cl.getBegin();if(null!=t){let e=null;while(null!=t)t.entity.isInRendererProcess()?(e=t,e.rstatus=1,t=t.next,this.Cl.removeNode(e),this.Cm.addNode(e),null==e.rpoNode&&(e.rpoNode=this.A_G.getNodeByUid(e.entity.getDisplay().__$rpuid))):t=t.next}if(t=this.Cm.getBegin(),null!=t)if(null!=this.Cn)this.Cn.setCamera(this.Ar),this.Cn.setCullingNodeHead(t),this.Cn.run();else{let e=null,s=this.Ar;while(null!=t)t.rpoNode.isVsible()&&t.entity.isDrawEnabled()?(e=t.bounds,t.drawEnabled=s.visiTestSphere2(e.center,e.radius),t.entity.drawEnabled=t.drawEnabled,t.rpoNode.drawEnabled=t.drawEnabled):(t.drawEnabled=!1,t.entity.drawEnabled=!1,t.rpoNode.drawEnabled=!1),t=t.next}}rayTest(t,e){null!=this.B_e&&(this.B_e.setCamera(this.Ar),this.B_e.setCullingNodeHead(this.Cm.getBegin()),this.B_e.setRay(t,e),this.B_e.run())}runEnd(){}getCullingNodeHead(){return this.Cm.getBegin()}toString(){return"[RendererSpace(uid = "+this.T+")]"}}_.EM=0,e.default=_},a46e:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17")),a=i(s("1710")),h=i(s("3b73"));class n{constructor(){this.Ar=null,this.Cp=!1,this.Cq=0,this.Cr=2,this.Cs=1,this.Ct=6,this.Cu=new r.default,this.Cv=new r.default,this.Cw=new r.default,this.Cx=new r.default,this.Cy=new r.default,this.Cz=new r.default,this.C0=new r.default,this.C1=0,this.C2=!0,this.C3=!0,this.C4=0,this.C5=0,this.C6=!0,this.syncLookAt=!1,this.C7=2,this.C6=!(h.default.IsMobileWeb()||h.default.IsSafariWeb())}setMobileZoomSpeed(t){this.Cr=t}seSlideSpeed(t){this.Cs=t}setMouseWheelZoomSpd(t){this.Ct=t}bindCamera(t){this.Ar=t}initialize(t){this.C2&&(this.C2=!1,t.addEventListener(a.default.MOUSE_WHEEL,this,this.mouseWheelListener,!0,!0),t.addEventListener(a.default.MOUSE_MULTI_MOVE,this,this.mouseMultiMoveListener,!0,!0),t.addEventListener(a.default.MOUSE_MULTI_UP,this,this.mouseMultiUpListener,!0,!0))}setLookAtCtrlEnabled(t){this.C3=t}mouseWheelListener(t){t.wheelDeltaY>0?this.C1+=this.Ct:this.C1-=this.Ct}mouseMultiMoveListener(t){this.setTouchPosArray(t.posArray)}mouseMultiUpListener(t){this.setTouchPosArray(t.posArray)}resetState(){this.C4=0,this.C5=0,this.C7=0}setTouchPosArray(t){if(null!=t&&t.length>1){let e=0;if(this.Cy.setXYZ(t[0].x,t[0].y,0),this.Cz.setXYZ(t[1].x,t[1].y,0),this.Cp){e=r.default.Distance(this.Cy,this.Cz),this.C7<1?(this.Cu.copyFrom(this.Cy),this.Cv.copyFrom(this.Cz),this.Cu.subVecsTo(this.Cy,this.Cw),this.Cv.subVecsTo(this.Cz,this.Cx),this.Cu.normalize(),this.Cv.normalize(),this.Cu.dot(this.Cv)>.9?this.C4++:this.C5++,(this.C4>3||this.C5>3)&&(this.C7=this.C4>this.C5?1:2)):this.Cu.subVecsTo(this.Cy,this.Cw);let t=Math.abs(this.Cq-e);t>.1&&(this.C1=(e-this.Cq)*this.Cr,this.Cq=e)}else this.Cp=!0,this.Cq=r.default.Distance(this.Cy,this.Cz),this.resetState()}else this.resetState(),this.Cp=!1;this.Cw.copyFrom(this.Cy),this.Cx.copyFrom(this.Cz)}run(t,e){let s=this.C3;if(null==t&&(t=this.C0),null!=this.Ar)if(this.syncLookAt&&this.Ar.setLookAtPosition(t),2==this.C7){if(Math.abs(this.C1)>.001){let i=r.default.Distance(this.Ar.getPosition(),this.Ar.getLookAtPosition()),a=this.C1;this.C1>0&&(i>e?(a=i-e,a>this.C1&&(a=this.C1)):a=0),Math.abs(a)>.1&&(this.Ar.forward(a),s&&this.Ar.setLookPosXYZFixUp(t.x,t.y,t.z)),this.C6?this.C1*=.95:this.C1=0}}else 1==this.C7&&this.Ar.slideViewOffsetXY(-this.Cu.x*this.Cs,this.Cu.y*this.Cs)}}e.default=n},a5ba:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("e08e");class r{constructor(t,e,s){this.T=-1,this.C8=0,this.B_4=0,this.C9=0,this.C_A=0,this.T=r.EM++,this.C8=t,this.B_4=e,this.C9=s}getUid(){return this.T}getCullFaceMode(){return this.C8}getDepthTestMode(){return this.C9}getBlendMode(){return this.B_4}use(){if(r.EH!=this.T){r.Rstate.setCullFaceMode(this.C8);r.E6[r.B_4];r.B_4<0?r.Rstate.setBlendMode(this.B_4,r.E6[this.B_4]):r.Rstate.setBlendMode(r.B_4,r.E6[r.B_4]),r.E4<0?r.Rstate.setDepthTestMode(this.C9):r.Rstate.setDepthTestMode(r.E4),r.EH=this.T}}static CreateBlendModeSeparate(t,e,s,a,h,n=0,l=0){if(null!=t&&""!=t){let _;if(r.E0.has(t))return _=r.E0.get(t),r.E1.get(_);n<1&&(n=i.GLBlendEquation.FUNC_ADD),l<1&&(l=i.GLBlendEquation.FUNC_ADD);let o=1;if(_=31,_=131*_+e,_=131*_+s,a>0&&h>0&&(_=131*_+a,_=131*_+h,o=1),r.E1.has(_))return r.E0.set(t,_),r.E1.get(_);let m=++r.E2;r.E0.set(t,_),r.E1.set(_,m);let u=[o,n,l,e,s,a,h];return r.E6[m]=u,m}return 0}static CreateBlendMode(t,e,s,a=0){if(null!=t&&""!=t){let h;if(r.E0.has(t))return h=r.E0.get(t),r.E1.get(h);a<1&&(a=i.GLBlendEquation.FUNC_ADD);let n=0;if(h=31,h=131*h+e,h=131*h+s,r.E1.has(h))return r.E1.get(h);let l=++r.E2;r.E0.set(t,h),r.E1.set(h,l);let _=[n,a,0,e,s,0,0];return r.E6[l]=_,l}return 0}static Create(t,e,s,i){if(r.EI.has(t)){let e=r.EI.get(t);return e.getUid()}let a=31;if(a=131*a+i,a=131*a+s,a=131*a+e,r.EJ.has(a)){let t=r.EJ.get(a);a=t.getUid()}else{let h=new r(e,s,i);a=h.getUid(),r.EJ.set(a,h),r.EI.set(t,h),r.EK.push(h),++r.EN}return a}static GetRenderStateByName(t){if(r.EI.has(t)){let e=r.EI.get(t);return e.getUid()}return-1}static UseRenderState(t){r.EL&&r.EH!=t&&t>-1&&t<r.EN&&r.EK[t].use()}static UseRenderStateByName(t){if(r.EL){let e=r.GetRenderStateByName(t);r.EH!=e&&e>-1&&e<r.EN&&r.EK[e].use()}}static UnlockBlendMode(){r.B_4=r.E3}static LockBlendMode(t){r.E3=r.B_4,r.B_4=t}static UnlockDepthTestMode(){r.E4=r.E5}static LockDepthTestMode(t){r.E5=r.E4,r.E4=t}static Lock(){r.EL=!1}static Unlock(){r.EL=!0}static Reset(){r.EH=-1}}r.EM=0,r.EH=-1,r.EK=[],r.EN=1,r.B_4=-1,r.E4=-1,r.EJ=new Map,r.EI=new Map,r.E0=new Map,r.E1=new Map,r.E2=0,r.E6=new Array(256),r.EL=!0,r.Rstate=null,r.E3=-1,r.E5=-1,e.RenderStateObject=r},a7ed:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("ab73"));class a{create(t,e){let s=r.default.FrustumParam;return e.hasUniformByName(s.name)?t.uniformContext.createShaderGlobalUniformFromProbe(t.getCamera().ufrustumProbe,s.name,[s.name]):null}getIDNS(){return"FrustumUniformBuilder"}}e.default=a},a80a:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.Ah=null,this.Ai=null}destroy(){this.clear()}clear(){this.Ah=this.Ai=null}getBegin(){return this.Ah}isEmpty(){return this.Ah==this.Ai&&null==this.Ai}addNode(t){null==this.Ah?this.Ai=this.Ah=t:null!=this.Ai.prev?(this.Ai.next=t,t.prev=this.Ai,this.Ai=t):(this.Ah.next=t,t.prev=this.Ai,this.Ai=t),this.Ai.next=null}removeNode(t){t==this.Ah?t==this.Ai?this.Ah=this.Ai=null:(this.Ah=t.next,this.Ah.prev=null):t==this.Ai?(this.Ai=t.prev,this.Ai.next=null):(t.next.prev=t.prev,t.prev.next=t.next),t.prev=null,t.next=null}}e.default=i},a996:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.uuid="",this.phase=0,this.type=i.RESIZE,this.target=null,this.currentTarget=null,this.data=null,this.__$preventBoo=!1}getClassType(){return i.EventClassType}preventDefault(){this.__$preventBoo=!0}reset(){this.__$preventBoo=!1}toString(){return"[EventBase]"}}i.EventClassType=1001,i.RESIZE=3001,i.ENTER_FRAME=3002,e.default=i},a9f4:function(t,e,s){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t["Default"]=1]="Default",t[t["VSM"]=1]="VSM"}(i||(i={})),e.ShadowMode=i},ab73:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.type="vec4",this.data=null,this.name="u_vsmParams",this.arrayLength=3}}class r{constructor(){this.type="vec4",this.data=new Float32Array([.1,.1,.1,1,1,.1,600,3500,.3,0,.9,5e-4,0,0,800,800,-500,-500,1e3,1e3]),this.name="u_envLightParams",this.arrayLength=5}}class a{constructor(){this.type="mat4",this.data=null,this.name="u_shadowMat",this.arrayLength=0}}class h{constructor(){this.type="vec4",this.data=null,this.name="u_stageParam",this.arrayLength=0}}class n{constructor(){this.type="vec4",this.data=null,this.name="u_viewParam",this.arrayLength=0}}class l{constructor(){this.type="vec4",this.data=null,this.name="u_frustumParam",this.arrayLength=0}}class _{constructor(){this.type="vec4",this.data=null,this.name="u_cameraPosition",this.arrayLength=0}}class o{constructor(){this.type="vec4",this.positionName="u_lightPositions",this.colorName="u_lightColors"}}class m{}m.LocalTransformMatUNS="u_objMat",m.CameraViewMatUNS="u_viewMat",m.CameraProjectiveMatUNS="u_projMat",m.FrustumParam=new l,m.CameraPosParam=new _,m.StageParam=new h,m.ViewportParam=new n,m.ShadowMatrix=new a,m.ShadowVSMParams=new i,m.GlobalLight=new o,m.EnvLightParams=new r,e.default=m},abdb:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.AXIS_ANGLE=0,i.QUATERNION=1,i.EULER_ANGLES=2,e.default=i},acaa:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("7918"),a=s("8d98"),h=i(s("cfaf"));class n extends h.default{constructor(t,e,s=!1){super(t,e,s),this.minFilter=a.TextureConst.NEAREST,this.magFilter=a.TextureConst.NEAREST,this.srcFormat=a.TextureFormat.DEPTH_COMPONENT,this.internalFormat=a.TextureFormat.DEPTH_COMPONENT,this.dataType=a.TextureDataType.UNSIGNED_SHORT,this.k=!1,this.i=!0,this.mipmapEnabled=!1,this.j=r.TextureProxyType.Depth}toDepthUnsignedInt(){this.minFilter=a.TextureConst.NEAREST,this.magFilter=a.TextureConst.NEAREST,this.srcFormat=a.TextureFormat.DEPTH_COMPONENT,this.internalFormat=a.TextureFormat.DEPTH_COMPONENT,this.dataType=a.TextureDataType.UNSIGNED_INT,this.k=!1,this.i=!0,this.mipmapEnabled=!1}toDepthUnsignedShort(){this.minFilter=a.TextureConst.NEAREST,this.magFilter=a.TextureConst.NEAREST,this.srcFormat=a.TextureFormat.DEPTH_COMPONENT,this.internalFormat=a.TextureFormat.DEPTH_COMPONENT,this.dataType=a.TextureDataType.UNSIGNED_SHORT,this.k=!1,this.i=!0,this.mipmapEnabled=!1}toDepthAndStencil(){this.minFilter=a.TextureConst.NEAREST,this.magFilter=a.TextureConst.NEAREST,this.srcFormat=a.TextureFormat.DEPTH_STENCIL,this.internalFormat=a.TextureFormat.DEPTH_STENCIL,this.dataType=a.TextureDataType.UNSIGNED_INT_24_8_WEBGL,this.k=!1,this.mipmapEnabled=!1,this.i=!0}uploadData(t){let e=t.getRC();e.texImage2D(this.h,0,a.TextureFormat.ToGL(e,this.internalFormat),this.c,this.d,0,a.TextureFormat.ToGL(e,this.srcFormat),a.TextureDataType.ToGL(e,this.dataType),null)}toString(){return"[DepthTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=n},acfe:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("ca6c")),a=i(s("8a0a")),h=i(s("3b73")),n=i(s("81ce")),l=i(s("fc07"));class _{constructor(){this.T=-1,this.adaptationShaderVersion=!0,this.preCompileInfo=null,this.C_B="",this.C_C="",this.AO="",this.AP=0,this.C_D=null,this.C_E=!1,this.C_F=null,this.AX=null,this.AR=null,this.AY=new Map,this.C_G=null,this.C_H=!1,this.C_I=0,this.CD=0,this.C_J=1,this.C_K=null,this.dataUniformEnabled=!1,this.T=_.EM++}getVSCodeStr(){return this.C_B}getFSCodeStr(){return this.C_C}getLocationTypes(){return this.C_G}getLayoutBit(){return this.C_I}getMid(){return this.CD}getFragOutputTotal(){return this.C_J}parseCode(t,e){_.E7.reset(),_.E7.parseVShaderCode(t),_.E7.parseFShaderCode(e),this.C_J=_.E7.fragOutputTotal,this.C_D=_.E7.uniforms}initialize(t,e,s){this.AO=t,this.adaptationShaderVersion&&null==this.preCompileInfo&&h.default.IsWebGL1()&&(e=n.default.Es3VtxShaderToES2(e),s=n.default.Es3FragShaderToES2(s)),this.preCompileInfo,this.parseCode(e,s);let i=_.E7.attributes,l=0,o=i.length,m=null;this.C_F=[],this.AX=[],this.C_I=0;let u=0,d=this.C_G=[];while(l<o){if(m=i[l],null!=m){this.C_F.push(m.name),this.AX.push(m.typeSize),u+=1;let t=a.default.GetVBufTypeByNS(m.name);switch(t){case a.default.VBUF_VS:this.C_I|=r.default.BIT_ONE_0;break;case a.default.VBUF_UVS:this.C_I|=r.default.BIT_ONE_1;break;case a.default.VBUF_NVS:this.C_I|=r.default.BIT_ONE_2;break;case a.default.VBUF_CVS:this.C_I|=r.default.BIT_ONE_3;break;case a.default.VBUF_TVS:this.C_I|=r.default.BIT_ONE_4;break;case a.default.VBUF_VS2:this.C_I|=r.default.BIT_ONE_5;break;case a.default.VBUF_UVS2:this.C_I|=r.default.BIT_ONE_6;break;case a.default.VBUF_NVS2:this.C_I|=r.default.BIT_ONE_7;break;case a.default.VBUF_CVS2:this.C_I|=r.default.BIT_ONE_8;break;case a.default.VBUF_TVS2:this.C_I|=r.default.BIT_ONE_9;break;default:u-=1,t=0;break}t>0&&d.push(a.default.GetVBufAttributeTypeByVBufType(t))}++l}let c=(u<<11)+this.C_I;_.Er.has(c)||(_.Er.set(c,_.Ex),_.Ex++),this.CD=_.Er.get(c),this.AP=_.E7.texTotal,this.C_E=this.AP>0,this.C_E&&(this.C_K=_.E7.texUniformNameListStr.split(",")),this.C_H=this.AP<this.C_D.length,this.C_B=e,this.C_C=s,this.AO=t}getAttriSizeList(){return this.AX}getTexUniformNames(){return this.C_K}getUniforms(){return this.C_D}haveCommonUniform(){return this.C_H}getAttriNSList(){return this.C_F}getUid(){return this.T}getTexTotal(){return this.AP}haveTexture(){return this.C_E}getLocationsTotal(){return this.AR.length}getUniformTypeNameByNS(t){let e=this.AY.get(t);return null!=e?e.typeName:""}getUniformTypeByNS(t){let e=this.AY.get(t);return null!=e?e.type:0}hasUniformByName(t){return this.AY.has(t)}getUniformLengthByNS(t){return this.AY.has(t)&&this.AY.get(t).arrLength,0}getUniqueShaderName(){return this.AO}destroy(){this.AP=0}}_.EM=0,_.E7=new l.default,_.Er=new Map,_.Ex=1,e.default=_},af29:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("722e")),a=i(s("8333")),h=s("8d98"),n=i(s("3930")),l=i(s("baae")),_=i(s("29ef"));class o{constructor(t,e){this.C_L=new n.default,this.K_=null,this.Z=null,this.c_=null,this.C_M=new n.default,this.B3=null,this.B_I=!0,this.f_=-1,this.g_=-1,this.C_N=128,this.C_O=128,this.C_P=!0,this.C_Q=!1,this.C_R=0,this.C_S=null,this.C_T=-1,this.C_U=-1,this.C_V=[],this.C_W=[null,null,null,null,null,null,null,null],this.C_X=null,this.C_Y=0,this.x_=!0,this.o_=1,this.l_=256,this.C_Z=!0,this.C_a=!0,this.C_b=!1,this.C_c=!1,this.C_d=!1,this.C_e=!1,this.uns="FBOInstance",this.B3=t,this.C_X=e,this.Z=t.getRenderProxy(),this.K_=this.Z.getRenderAdapter(),this.c_=t.getRendererContext()}getFBOUid(){return this.f_}setRProcessIDList(t){if(null!=t){if(t.length<1)throw Error("processIDlist.length < 1, but it must: processIDlist.length >= 1");this.C_V=t.slice(0)}}setRProcessList(t){if(t.length<1)throw Error("list.length < 1, but must: list.length >= 1");this.C_V=new Array(t.length);for(let e=0;e<t.length;++e)this.C_V[e]=t[e].getRPIndex()}getRProcessIDAt(t){return this.C_V[t]}getStage3D(){return this.Z.getStage3D()}getCamera(){return null!=this.Z?this.Z.getCamera():null}lockViewport(){this.C_c=!0}unlockViewport(){this.C_c=!1}updateCamera(){null!=this.Z&&this.Z.updateCamera()}updateCameraDataFromCamera(t){null!=this.Z&&this.Z.updateCameraDataFromCamera(t)}useGlobalRenderState(t){this.c_.useGlobalRenderState(t)}useGlobalRenderStateByName(t){this.c_.useGlobalRenderStateByName(t)}setGlobalRenderState(t){this.C_T=t}setGlobalRenderStateByName(t){this.C_T=this.c_.getRenderStateByName(t)}lockRenderState(t=-1){this.C_T>=0||t>=0?this.c_.useGlobalRenderState(t<0?this.C_T:t):this.Z.lockRenderState()}unlockRenderState(){this.Z.unlockRenderState()}useGlobalRenderColorMask(t){this.c_.useGlobalRenderColorMask(t)}useGlobalRenderColorMaskByName(t){this.c_.useGlobalRenderColorMaskByName(t)}setGlobalRenderColorMask(t){this.C_U=t}setGlobalRenderColorMaskByName(t){this.C_U=this.c_.getRenderColorMaskByName(t)}lockColorMask(t=-1){this.C_U>=0||t>=0?this.c_.useGlobalRenderColorMask(t<0?this.C_U:t):this.Z.lockRenderColorMask()}unlockRenderColorMask(){this.c_.useGlobalRenderColorMask(_.default.COLOR_MASK_ALL_TRUE),this.Z.unlockRenderColorMask()}useGlobalMaterial(t,e=!1,s=!1){this.C_d=e,this.C_e=s,this.c_.useGlobalMaterial(t,this.C_d,s)}setGlobalMaterial(t,e=!1,s=!1){this.C_d=e,this.C_e=s,this.C_S!=t&&(null!=this.C_S&&this.C_S.__$detachThis(),null!=t&&t.__$attachThis(),this.C_S=t)}lockMaterial(){null!=this.C_S?this.c_.useGlobalMaterial(this.C_S,this.C_d,this.C_e):this.c_.lockMaterial()}unlockMaterial(){this.c_.unlockMaterial()}updateGlobalMaterialUniform(){this.c_.updateMaterialUniform(this.C_S)}clearDepth(t=1){this.K_.clearFBODepthAt(this.f_,t)}synFBOSizeWithViewport(){this.x_=!0}asynFBOSizeWithViewport(){this.x_=!1}setFBOSizeFactorWithViewPort(t){this.o_=t}createViewportSizeFBOAt(t,e=!1,s=!1,i=0){this.f_<0&&(this.f_=t,this.g_=l.default.FRAMEBUFFER,this.C_N=this.K_.getViewportWidth(),this.C_O=this.K_.getViewportHeight(),this.C_P=e,this.C_Q=s,this.C_R=i,this.K_.createFBOAt(t,this.g_,this.C_N,this.C_O,e,s,i))}createFBO(t,e,s=0){this.C_P=t,this.C_Q=e,this.C_R=s,this.K_.createFBOAt(this.f_,this.g_,this.C_N,this.C_O,t,e,s)}createAutoSizeFBOAt(t,e=!1,s=!1,i=0){t>=0&&this.f_<0&&(this.g_=l.default.FRAMEBUFFER,this.C_N=512,this.C_O=512,this.f_=t,this.createFBO(e,s,i))}createFBOAt(t,e,s,i=!1,r=!1,a=0){t>=0&&this.f_<0&&(this.g_=l.default.FRAMEBUFFER,this.C_N=e,this.C_O=s,this.f_=t,this.C_N<1&&(this.C_N=this.K_.getRCanvasWidth()),this.C_O<1&&(this.C_O=this.K_.getRCanvasHeight()),this.createFBO(i,r,a))}createReadFBOAt(t,e,s,i=!1,r=!1,a=0){t>=0&&this.f_<0&&(this.g_=l.default.READ_FRAMEBUFFER,this.C_N=e,this.C_O=s,this.f_=t,this.C_N<1&&(this.C_N=this.K_.getRCanvasWidth()),this.C_O<1&&(this.C_O=this.K_.getRCanvasHeight()),this.createFBO(i,r,a))}createDrawFBOAt(t,e,s,i=!1,r=!1,a=0){t>=0&&this.f_<0&&(this.g_=l.default.DRAW_FRAMEBUFFER,this.C_N=e,this.C_O=s,this.f_=t,this.C_N<1&&(this.C_N=this.K_.getRCanvasWidth()),this.C_O<1&&(this.C_O=this.K_.getRCanvasHeight()),this.createFBO(i,r,a))}resizeFBO(t,e){this.C_N==t&&this.C_O==e||(this.C_N=t,this.C_O=e,this.K_.resizeFBOAt(this.f_,t,e))}getRTTAt(t){return this.C_W[t]}enableMipmapRTTAt(t){this.C_W[t].enableMipmap()}generateMipmapTextureAt(t){this.C_W[t].generateMipmap(this.Z.Texture)}setRenderToTexture(t,e=0){return 0==e?this.C_Y=1:this.C_Y<e+1&&(this.C_Y=e+1),this.C_W[e]=t,t}setRenderToRTTTextureAt(t,e=0){this.setRenderToTexture(this.C_X.getRTTTextureAt(t),e)}setRenderToFloatTextureAt(t,e=0){this.setRenderToTexture(this.C_X.getRTTFloatTextureAt(t),e)}setRenderToHalfFloatTexture(t,e=0){return null==t&&(t=this.C_X.createRTTTex2D(128,128,!1),t.__$setRenderProxy(this.Z),t.internalFormat=h.TextureFormat.RGBA16F,t.srcFormat=h.TextureFormat.RGBA,t.dataType=h.TextureDataType.FLOAT,t.minFilter=h.TextureConst.LINEAR,t.magFilter=h.TextureConst.LINEAR,t.__$setRenderProxy(this.Z)),this.setRenderToTexture(t,e)}setRenderToRGBATexture(t,e=0){return null==t&&(t=this.createRGBATexture()),this.setRenderToTexture(t,e)}setRenderToDepthTextureAt(t,e=0){return this.setRenderToTexture(this.C_X.getDepthTextureAt(t),e)}createRGBATexture(){let t=this.C_X.createRTTTex2D(32,32,!1);return t.internalFormat=h.TextureFormat.RGBA,t.srcFormat=h.TextureFormat.RGBA,t.dataType=h.TextureDataType.UNSIGNED_BYTE,t.minFilter=h.TextureConst.LINEAR,t.magFilter=h.TextureConst.LINEAR,t.__$setRenderProxy(this.Z),t}setClearState(t,e,s=!1){this.C_Z=t,this.C_a=e,this.C_b=s}setRenderToBackBuffer(){this.Z.setClearColor(this.C_L),this.c_.setRenderToBackBuffer()}setClearDepth(t){this.l_=t}getClearDepth(){return this.K_.getClearDepth()}getViewportX(){return this.K_.getViewportX()}getViewportY(){return this.K_.getViewportY()}getViewportWidth(){return this.K_.getViewportWidth()}getViewportHeight(){return this.K_.getViewportHeight()}getFBOWidth(){return this.K_.getFBOWidthAt(this.f_)}getFBOHeight(){return this.K_.getFBOHeightAt(this.f_)}resetAttachmentMask(t){this.K_.resetFBOAttachmentMask(t)}setAttachmentMaskAt(t,e){this.K_.setFBOAttachmentMaskAt(t,e)}setClearRGBColor3f(t,e,s){this.C_M.setRGB3f(t,e,s)}setClearColorEnabled(t){this.C_Z=t}setClearDepthEnabled(t){this.C_a=t}setClearStencilEnabled(t){this.C_b=t}setClearUint24Color(t,e=1){this.C_M.setRGBUint24(t),this.C_M.a=e}setClearRGBAColor4f(t,e,s,i){this.C_M.setRGBA4f(t,s,e,i)}blitFrom(t,e=a.default.COLOR_BUFFER_BIT,s=r.default.NEAREST,i=-1,h=0,n=null){this.f_>=0&&(this.K_.setBlitFboSrcRect(0,0,t.getFBOWidth(),t.getFBOHeight()),this.K_.setBlitFboSrcRect(0,0,this.getFBOWidth(),this.getFBOHeight()),this.K_.blitFBO(t.getFBOUid(),this.f_,e,s,i,h,n))}blitColorFrom(t,e=r.default.NEAREST,s=-1,i=0,h=null){this.f_>=0&&(this.K_.setBlitFboSrcRect(0,0,t.getFBOWidth(),t.getFBOHeight()),this.K_.setBlitFboSrcRect(0,0,this.getFBOWidth(),this.getFBOHeight()),this.K_.blitFBO(t.getFBOUid(),this.f_,a.default.COLOR_BUFFER_BIT,e,s,i,h))}blitDepthFrom(t,e=r.default.NEAREST,s=-1,i=0,h=null){this.f_>=0&&(this.K_.setBlitFboSrcRect(0,0,t.getFBOWidth(),t.getFBOHeight()),this.K_.setBlitFboSrcRect(0,0,this.getFBOWidth(),this.getFBOHeight()),this.K_.blitFBO(t.getFBOUid(),this.f_,a.default.COLOR_BUFFER_BIT|a.default.DEPTH_BUFFER_BIT,e,s,i,h))}blitColorAndDepthFrom(t,e=r.default.NEAREST,s=-1,i=0,h=null){this.f_>=0&&(this.K_.setBlitFboSrcRect(0,0,t.getFBOWidth(),t.getFBOHeight()),this.K_.setBlitFboSrcRect(0,0,this.getFBOWidth(),this.getFBOHeight()),this.K_.blitFBO(t.getFBOUid(),this.f_,a.default.COLOR_BUFFER_BIT|a.default.DEPTH_BUFFER_BIT,e,s,i,h))}blitStencilFrom(t,e=r.default.NEAREST,s=-1,i=0,h=null){this.f_>=0&&(this.K_.setBlitFboSrcRect(0,0,t.getFBOWidth(),t.getFBOHeight()),this.K_.setBlitFboSrcRect(0,0,this.getFBOWidth(),this.getFBOHeight()),this.K_.blitFBO(t.getFBOUid(),this.f_,a.default.STENCIL_BUFFER_BIT,e,s,i,h))}renderToTextureAt(t,e=0){this.K_.setRenderToTexture(this.C_W[t],this.C_P,this.C_Q,e),this.K_.useFBO(this.C_Z,this.C_a,this.C_b)}runBeginDo(){if(this.B_I){this.B_I=!1,this.Z.getClearRGBAColor4f(this.C_L),this.C_c?this.K_.lockViewport():this.K_.unlockViewport(),this.K_.bindFBOAt(this.f_,this.g_),this.x_?(this.K_.synFBOSizeWithViewport(),this.K_.setFBOSizeFactorWithViewPort(this.o_)):this.K_.asynFBOSizeWithViewport(),this.l_<128&&this.K_.setClearDepth(this.l_),this.Z.setClearColor(this.C_M);let t=0;for(;t<this.C_Y;++t)this.K_.setRenderToTexture(this.C_W[t],this.C_P,this.C_Q,t);this.K_.useFBO(this.C_Z,this.C_a,this.C_b),null!=this.C_S?this.c_.useGlobalMaterial(this.C_S,this.C_d,this.C_e):this.c_.unlockMaterial()}}run(t=!1,e=!1,s=!0,i=!0){if(t&&this.lockRenderState(),e&&!i&&this.lockMaterial(),this.f_>=0&&(i&&this.runBeginDo(),null!=this.C_V))for(let r=0,a=this.C_V.length;r<a;++r)this.B3.runAt(this.C_V[r]);t&&this.unlockRenderState(),e&&this.unlockMaterial(),s&&this.runEnd()}runAt(t,e=!0){this.f_>=0&&null!=this.C_V&&(0==t&&e?this.runBeginDo():this.B_I=!0,this.B3.runAt(this.C_V[t]))}drawEntity(t,e=!1,s=!0){this.B_I||this.B3.drawEntity(t,e,s)}runBegin(){this.f_>=0&&null!=this.C_V&&(this.B_I=!0,this.runBeginDo())}runEnd(){this.Z.setClearColor(this.C_L),this.B_I=!0,this.C_c&&this.K_.unlockViewport()}useCamera(t,e=!1){this.B3.useCamera(t,e)}useMainCamera(){this.B3.useMainCamera()}reset(){this.setGlobalMaterial(null);let t=0;for(;t<this.C_Y;++t)this.C_W[t]=null;this.B_I=!1,this.f_=-1,this.C_Y=0,this.C_V=[]}clone(){let t=new o(this.B3,this.C_X);t.o_=this.o_,t.C_M.copyFrom(this.C_M),t.f_=this.f_,t.g_=this.g_,t.l_=this.l_,t.C_Y=this.C_Y,t.C_P=this.C_P,t.C_Q=this.C_Q,t.x_=this.x_,t.C_N=this.C_N,t.C_O=this.C_O,t.C_R=this.C_R;let e=0;for(;e<this.C_Y;++e)t.C_W[e]=t.C_W[e];if(null!=this.C_V){let s=this.C_V.length,i=new Array(s);for(e=0;e<s;++e)i[e]=this.C_V[e];t.setRProcessIDList(i)}return t}}e.default=o},af68:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("11e6")),a=i(s("7b0e"));class h{constructor(){this.B_1=0,this.C_f=[],this.B_0=[],this.C_g=[],this.C_h=[],this.Ag=[]}getFreeId(){return this.Ag.length>0?this.Ag.pop():-1}createNode(){let t=this.getFreeId();if(t>=0)return this.C_h[t]=1,this.B_0[t];{t=this.B_1;let e=a.default.Create();return this.B_0.push(e),this.C_g.push(null),e.spaceId=t,this.C_h.push(1),this.C_f.push(t),this.C_h.push(1),this.B_1++,e}}restoreId(t){t>0&&1==this.C_h[t]&&(this.Ag.push(t),this.C_h[t]=0,this.C_g[t]=null)}addEntity(t){let e=this.createNode();return this.C_g[e.spaceId]=t,e.entity=t,t.__$rseFlag=r.default.AddSpaceUid(t.__$rseFlag,e.spaceId),e}initialize(t){if(t>0)for(let e=0;e<t;e++){let t=this.createNode();this.C_g[t.spaceId]=null}}getNodeByEntity(t){if(r.default.TestSpaceContains(t.__$rseFlag)){let e=r.default.GetSpaceUid(t.__$rseFlag);if(this.C_g[e]==t)return this.B_0[e]}return null}removeEntity(t){if(r.default.TestSpaceContains(t.__$rseFlag)){let e=r.default.GetSpaceUid(t.__$rseFlag);this.C_g[e]==t&&(this.B_0[e].entity=null,this.restoreId(e),t.__$rseFlag=r.default.RemoveSpaceUid(t.__$rseFlag))}}toString(){return"[EntityNodeQueue()]"}}e.default=h},b02c:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01"));class a{constructor(t,e){this.T=-1,this.CD=-1,this.AP=0,this.C_i=null,this.C_j=null,this.W_=null,this.A=0,this.A7=null,this.direct=!0,this.Y=0,this.A=t,this.T=a.EM++,this.CD=e}__$setParam(t,e){this.A=t,this.CD=e}getRCUid(){return this.A}getMid(){return this.CD}getTexTotal(){return this.AP}collectTexList(t,e,s){this.A7=t;let i=0;if(this.direct)if(this.AP<1&&e.length>0){let a,h=r.default.GetNearestCeilPow2(e.length);this.C_j=new Uint16Array(h),this.C_i=new Array(h),this.W_=e;while(i<s)a=e[i],a.__$attachThis(),a.__$$upload(t),this.C_j[i]=a.getSampler(),this.C_i[i]=this.A7.getGpuBuffer(a.getResUid()),this.A7.__$attachRes(a.getResUid()),i++;this.AP=i}else this.AP=0;else this.AP=s;while(i<e.length)e[i++].__$attachThis()}run(){if(this.A7.unlocked&&this.A7.texMid!=this.CD){this.A7.texMid=this.CD;let t=this.A7.getRC(),e=t.TEXTURE0;if(this.direct)for(let s=0;s<this.AP;++s)t.activeTexture(e++),t.bindTexture(this.C_j[s],this.C_i[s]);else{let s=this.W_;for(let i=0;i<this.AP;++i)t.activeTexture(e++),s[i].__$$use(this.A7)}}}getUid(){return this.T}__$attachThis(){++this.Y}__$detachThis(){--this.Y,this.Y<1&&(this.Y=0,a.Restore(this))}reset(){if(null!=this.W_)for(let t=0,e=this.W_.length;t<e;++t)this.W_[t].__$detachThis(),this.A7.__$detachRes(this.W_[t].getResUid()),this.C_i[t]=null;this.AP=0,this.W_=null,this.A7=null}toString(){return"TextureRenderObj(uid = "+this.T+", mid="+this.CD+")"}static Create(t,e,s){let i=e.length;if(i>0&&s>0){if(i<s)throw Error("There are fewer textures than in the shader : (need "+s+",but only have "+i+") !!!");let r=31,h=0,n=!0;while(h<s)r=131*r+e[h].getUid(),e[h].isDirect()||(n=!1),++h;let l=a.E9[t.getRCUid()],_=null;return l.has(r)?_=l.get(r):(_=a.E8.length<1?new a(t.getRCUid(),r):a.E8.pop(),_.collectTexList(t,e,s),l.set(r,_)),_.__$setParam(t.getRCUid(),r),_.direct=n,_}return null}static Restore(t){t.getMid()>-1&&(a.E9[t.getRCUid()].delete(t.getMid()),t.__$setParam(0,0),a.E8.push(t),t.reset())}static GetByMid(t,e){return a.E9[t].get(e)}}a.EM=0,a.E9=[new Map,new Map,new Map,new Map,new Map,new Map,new Map,new Map],a.E8=[],a.E_A=!0,a.E_B=-1,e.TextureRenderObj=a;class h{constructor(t){this.A7=null,this.A7=t}run(){this.A7.renderBegin()}getMid(){return 1}__$attachThis(){}__$detachThis(){}}e.EmptyTexRenderObj=h,e.default=a},b0ef:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.n=null,this.m=null,this.C_k=-1,this.C_l=-1,this.resized=!0}setDiv(t){this.m=t}createViewEle(t,e){null==this.m&&(this.m=document.getElementById("voxEngineDiv")),null==this.m&&(this.m=t.createElement("div"),this.m.style.width="400px",this.m.style.height="300px",document.body.appendChild(this.m)),this.m.style.display="bolck",this.m.style.position="absolute",""==this.m.style.left&&(this.m.style.left="0px",this.m.style.top="0px"),e&&(this.m.style.width="100%",this.m.style.height="100%"),null==this.n&&(this.n=document.createElement("canvas"),this.m.appendChild(this.n),this.n.width=800,this.n.height=600,this.n.style.display="bolck",this.n.style.left="0px",this.n.style.top="0px",this.n.style.position="absolute")}setDivStyleLeftAndTop(t,e){this.m.style.left=t+"px",this.m.style.top=e+"px"}setDivStyleSize(t,e){this.C_k==t&&this.C_l==e||(this.m.style.width=t+"px",this.m.style.height=e+"px",this.resized=!0)}getDiv(){return this.m}getCanvas(){return this.n}}e.default=i},b161:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17")),a=i(s("3806")),h=i(s("c51d")),n=i(s("c497")),l=i(s("af68")),_=i(s("a80a")),o=i(s("9c4d")),m=i(s("d958")),u=s("5d04"),d=i(s("a446")),c=i(s("c711")),f=i(s("955e")),p=i(s("765c")),g=i(s("af29")),T=i(s("d7e2")),E=i(s("70f2")),x=i(s("2139")),S=s("a156"),R=i(s("18c7"));class y{constructor(){this.T=-1,this.K_=null,this.Z=null,this.An=null,this.c_=null,this.B3=null,this.B5=new Uint8Array(128),this.B6=0,this.B7=null,this.B8=new r.default,this.B9=new r.default,this.B_A=null,this.B_B=!1,this.B_C=null,this.B_D=!0,this.B=0,this.C=0,this.D=800,this.E=800,this.B_E=null,this.B_F=null,this.C_m=null,this.C_n=[],this.C_o=0,this.B_I=-1,this.B_J=!0,this.C_p=!1,this.C_q=-1,this.B_H=null,this.As=!0,this.runnableQueue=new o.default,this.textureBlock=new u.TextureBlock,this.stage3D=null,this.materialBlock=null,this.entityBlock=null,this.B_L=[],this.B_M=0,this.C_r=null,this.B_N=!0,this.B_O=!0,this.B_P=!0,this.B_Q=!0,this.T=y.EM++}tickUpdate(){this.C_q>-1&&clearTimeout(this.C_q),this.C_q=setTimeout(this.tickUpdate.bind(this),this.B_H.getTickUpdateTime()),this.textureBlock.run()}enable(){this.As=!0}disable(){this.As=!1}isEnabled(){return this.As}getUid(){return this.T}getDiv(){return this.Z.getDiv()}getCanvas(){return this.Z.getCanvas()}getRPONodeBuilder(){return null}getRenderProxy(){return this.Z}setViewPort(t,e,s,i){null!=this.Z&&(this.B=t,this.C=e,this.D=s,this.E=i,this.Z.setViewPort(t,e,s,i))}setViewPortFromCamera(t){null!=this.Z&&null!=t&&(this.B=t.getViewX(),this.C=t.getViewY(),this.D=t.getViewWidth(),this.E=t.getViewHeight(),this.Z.setViewPort(this.B,this.C,this.D,this.E))}reseizeViewPort(){this.Z.reseizeRCViewPort()}lockViewport(){this.K_.lockViewport()}unlockViewport(){this.K_.unlockViewport()}getRendererAdapter(){return this.K_}getRenderer(){return this.B3}getRendererContext(){return this.c_}getStage3D(){return this.Z.getStage3D()}getRendererStatus(){return this.B3.getRendererStatus()}getViewWidth(){return this.Z.getStage3D().viewWidth}getViewHeight(){return this.Z.getStage3D().viewHeight}getCamera(){return this.Z.getCamera()}asynFBOSizeWithViewport(){this.c_.asynFBOSizeWithViewport()}synFBOSizeWithViewport(){this.c_.synFBOSizeWithViewport()}cameraLock(){this.Z.cameraLock()}cameraUnlock(){this.Z.cameraUnlock()}getMouseXYWorldRay(t,e){this.Z.getMouseXYWorldRay(t,e)}createCamera(){return new h.default}createFBOInstance(){return new g.default(this,this.textureBlock.getRTTStrore())}createMatrix4(){return new R.default}setClearUint24Color(t,e=1){this.Z.setClearUint24Color(t,e)}setClearRGBColor3f(t,e,s){this.Z.setClearRGBColor3f(t,e,s)}setClearRGBAColor4f(t,e,s,i){this.Z.setClearRGBAColor4f(t,e,s,i)}setClearColor(t){this.Z.setClearRGBAColor4f(t.r,t.g,t.b,t.a)}setRenderToBackBuffer(){this.c_.setRenderToBackBuffer()}drawBackBufferToCanvas(t){let e=this.getCanvas();var s=t.getContext("2d");s.drawImage(e,0,0,t.width,t.height)}updateRenderBufferSize(){this.K_.updateRenderBufferSize()}setEvt3DController(t){null!=t&&(t.initialize(this.getStage3D(),this.getStage3D()),t.setRaySelector(this.B7.getRaySelector())),this.B_C=t}isRayPickSelected(){return null!=this.B_C&&this.B_C.isSelected()}enableMouseEvent(t=!0){null==this.B_C&&(t?this.B7.setRaySelector(new f.default):this.B7.setRaySelector(new c.default),this.setEvt3DController(new p.default)),this.B_D=!0}disableMouseEvent(){this.B_D=!1}getEvt3DController(){return this.B_C}getSpace(){return this.B7}getDevicePixelRatio(){return this.K_.getDevicePixelRatio()}createSubScene(){if(null!=this.B3){let t=new E.default(this,this.B3,this.B_B);this.C_n.push(t),this.C_o++;let e=t;return e.textureBlock=this.textureBlock,t}return null}addEventListener(t,e,s,i=!0,r=!1){this.stage3D.addEventListener(t,e,s,i,r)}removeEventListener(t,e,s){this.stage3D.removeEventListener(t,e,s)}setAccessor(t){this.B_A=t}initialize(t=null,e=3){if(null==this.B3){null==t&&(t=new n.default),this.B_H=t;let s=this;s.stage3D=new a.default(this.getUid(),document),e<1&&(e=1),e>8&&(e=8),this.B_B=t.evtFlowEnabled,this.B3=new m.default,this.B3.__$setStage3D(this.stage3D),x.default.Allocate(t.getMatrix4AllocateSize());let i=new h.default;this.B3.initialize(t,i,new S.ShaderProgramBuilder(this.B3.getRCUid())),this.B5[0]=0,this.B6++;let r=null;for(;e>=0;)r=this.B3.appendProcess(t.batchEnabled,t.processFixedState),this.B5[this.B6]=r.getRPIndex(),this.B6++,--e;this.c_=this.B3.getRendererContext(),this.Z=this.c_.getRenderProxy(),this.K_=this.Z.getRenderAdapter();let l=this.Z.getStage3D();if(this.D=l.stageWidth,this.E=l.stageHeight,this.An=this.B3.getDataBuilder().getRenderShader(),this.textureBlock.setRenderer(this.Z),this.C_m=new T.default(this.Z),null==this.B7){let t=new d.default;t.initialize(this.B3,this.Z.getCamera()),this.B7=t}this.tickUpdate()}}setRendererProcessParam(t,e,s){this.B3.setRendererProcessParam(this.B5[t],e,s)}appendARendererProcess(t=!0,e=!1){let s=this.B3.appendProcess(t,e);this.B5[this.B6]=s.getRPIndex(),this.B6++}getRenderProcessAt(t){return this.B3.getProcessAt(this.B5[t])}addContainer(t,e=0){if(e<0&&(e=0),null!=t&&t.__$wuid<0&&t.__$contId<1){let s=0;for(;s<this.B_M;++s)if(this.B_L[s]==t)return;s>=this.B_M&&(t.__$wuid=this.T,t.wprocuid=e,t.__$setRenderer(this),this.B_L.push(t),this.B_M++)}}removeContainer(t){if(null!=t&&t.__$wuid==this.T&&t.getRenderer()==this.B3){let e=0;for(;e<this.B_M;++e)if(this.B_L[e]==t){t.__$wuid=-1,t.wprocuid=-1,t.__$setRenderer(null),this.B_L.splice(e,1),--this.B_M;break}}}setAutoRunningEnabled(t){this.B_J=t}setAutoRenderingSort(t){this.C_p=t}setProcessSortEnabledAt(t,e,s=null){if(this.B3.setProcessSortEnabledAt(t,e),e){let e=this.B3.getProcessAt(t);s=null!=s?s:this.C_m,null!=e&&e.setSorter(s)}}setProcessSortEnabled(t,e,s=null){this.B3.setProcessSortEnabled(t,e),e&&null!=t&&!t.hasSorter()&&(s=null!=s?s:this.C_m,t.setSorter(s))}moveEntityTo(t,e){this.B3.moveEntityToProcessAt(t,this.B5[e])}drawEntity(t,e=!1,s=!0){this.B3.drawEntity(t,e,s)}addEntity(t,e=0,s=!0){if(null!=t&&t.__$testSpaceEnabled())if(t.isPolyhedral())if(t.hasMesh())this.B3.addEntity(t,this.B5[e],s),null!=this.B7&&this.B7.addEntity(t);else{null==this.B_E&&(this.B_E=new _.default,this.B_F=new l.default);let s=this.B_F.addEntity(t);s.rstatus=e,this.B_E.addNode(s)}else this.B3.addEntity(t,this.B5[e],s),null!=this.B7&&this.B7.addEntity(t)}removeEntity(t){if(null!=t){let e=null;if(null!=this.B_E){let e=this.B_F.getNodeByEntity(t);null!=e&&(this.B_E.removeNode(e),this.B_F.removeEntity(t))}null==e&&(this.B3.removeEntity(t),null!=this.B7&&this.B7.removeEntity(t))}}updateMaterialUniformToCurrentShd(t){this.B3.updateMaterialUniformToCurrentShd(t)}showInfoAt(t){this.B3.showInfoAt(t)}getRenderUnitsTotal(){return this.B3.getRenderUnitsTotal()}useCamera(t,e=!1){this.C_r=t,e&&(this.Z.setRCViewPort(t.getViewX(),t.getViewY(),t.getViewWidth(),t.getViewHeight(),!0),this.Z.reseizeRCViewPort()),t.update(),this.c_.resetUniform(),this.Z.updateCameraDataFromCamera(t)}useMainCamera(){this.C_r=null;let t=this.Z.getCamera();this.Z.setRCViewPort(t.getViewX(),t.getViewY(),t.getViewWidth(),t.getViewHeight(),!0),this.Z.reseizeRCViewPort(),this.Z.updateCamera(),this.c_.resetUniform(),this.Z.updateCameraDataFromCamera(this.Z.getCamera())}updateCameraDataFromCamera(t){this.Z.updateCameraDataFromCamera(t)}resetState(){this.c_.resetState()}resetUniform(){this.c_.resetUniform()}enableSynViewAndStage(){this.Z.enableSynViewAndStage()}renderBegin(t=!0){if(null==this.C_r){if(this.K_.unlockViewport(),this.Z.isAutoSynViewAndStage()){let t=this.Z.testViewPortChanged(this.B,this.C,this.D,this.E);this.B=this.Z.getViewX(),this.C=this.Z.getViewY(),this.D=this.Z.getViewWidth(),this.E=this.Z.getViewHeight(),t&&(this.Z.setRCViewPort(this.B,this.C,this.D,this.E,!0),this.Z.reseizeRCViewPort())}else this.Z.setViewPort(this.B,this.C,this.D,this.E);this.Z.updateCamera(),this.Z.updateCameraDataFromCamera(this.Z.getCamera())}this.An.renderBegin(),t&&this.c_.renderBegin(null==this.C_r),this.C_r=null,null!=this.B_A&&this.B_A.renderBegin(this)}runBegin(t=!0,e=!0){t&&this.B_J&&(this.B_I>=0&&this.runEnd(),this.B_I=0);let s=this.C_r,i=null==s;this.renderBegin(e),null!=this.B7&&(this.B7.setCamera(i?this.Z.getCamera():s),this.B7.runBegin())}renderContextBegin(){this.c_.renderBegin()}setRayTestEanbled(t){this.B_Q=t}runMouseTest(t,e){let s=-1;if(null!=this.B_C&&this.B_D){if(this.B_P&&this.B_C.getEvtType()>0){let t=this.B7.getRaySelector();if(null!=t){this.B_Q?this.mouseRayTest():t.clear();let e=t.getSelectedNodesTotal();if(e>1){let s=0,i=t.getSelectedNodes(),r=null;for(;s<e;++s)r=i[s],r.entity.isPolyhedral()}}this.B_P=!1}s=this.B_C.run(t,e)}return this.B_N=!1,s}update(t=!0,e=!0){if(this.stage3D.enterFrame(),t&&this.B_J&&(0!=this.B_I&&this.runBegin(),this.B_I=1),this.B_N=!0,this.B_O=!0,this.B_P=!0,null!=this.B_E){let t=this.B_E.getBegin();if(null!=t){let e,s,i;while(null!=t)t.entity.hasMesh()?(e=t,t=t.next,s=e.entity,i=e.rstatus,this.B_E.removeNode(e),this.B_F.removeEntity(e.entity),this.addEntity(s,i)):t=t.next}}let s=0;for(;s<this.B_M;++s)this.B_L[s].update();this.B3.update(),null!=this.B7&&(this.B7.update(),this.B_O&&(null!=this.B_C||this.C_p||null!=this.B7.getRaySelector())&&this.B7.run()),this.C_p&&this.B3.updateAllProcess(),this.B_N&&!this.B_B&&(e?this.runMouseTest(1,0):null!=this.B_C&&this.B_C.mouseOutEventTarget())}cullingTest(){null!=this.B7&&this.B7.run(),this.B_O=!1}mouseRayTest(){null!=this.B7&&(this.Z.getMouseXYWorldRay(this.B9,this.B8),this.B7.rayTest(this.B9,this.B8))}run(t=!0){if(this.As){if(t&&this.B_J&&(1!=this.B_I&&this.update(),this.B_I=2),this.runnableQueue.run(),this.C_o>0)for(let t=0;t<this.B6;++t)this.B3.runAt(this.B5[t]);else this.B3.run();t&&this.runEnd()}}runAt(t){this.As&&this.B3.runAt(this.B5[t])}runEnd(){null!=this.B_C&&this.B_C.runEnd(),this.c_.runEnd(),null!=this.B7&&this.B7.runEnd(),this.B_J&&(this.B_I=-1),null!=this.B_A&&this.B_A.renderEnd(this)}renderFlush(){null!=this.Z&&this.Z.flush()}updateCamera(){null!=this.Z&&this.Z.updateCamera()}toString(){return"[RendererScene(uid = "+this.T+")]"}}y.EM=0,e.default=y},b30a:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("644c"));class a{constructor(t,e,s,i){this.Ch=[],this.C_s=!0,this.C_t=!1,this.C_u=-1,this.C_v=null,this.C_J=1,this.A=-1,this.AM=null,this.C_w=null,this.K_=null,this.C_x=null,this.A_9=null,this.C_y=null,this.C_z=null,this.drawFlag=-1,this.__$globalUniform=null,this.A=t,this.AM=e,this.K_=s,this.C_z=i}createResByParams3(t,e,s,i){return!1}getRC(){return this.AM}getGPUProgram(){return this.C_w}getRCUid(){return this.A}useTransUniform(t){this.C_y!=t&&(this.C_y=t,t.use(this))}useUniform(t){this.A_9!=t&&(this.A_9=t,t.use(this))}updateUniform(t){null!=t&&t.use(this)}unlock(){this.C_s=!0,this.__$globalUniform=null}isUnLocked(){return this.C_s}lock(){this.C_s=!1}textureUnlock(){this.C_t=!0}isTextureUnLocked(){return this.C_t}textureLock(){this.C_t=!1}setSharedUniformByShd(t,e){this.Ch[t.getUid()]=e}getSharedUniformByShd(t){return this.Ch[t.getUid()]}getCurrFragOutputTotal(){return this.C_J}hasResUid(t){return this.C_z.hasUid(t)}bindToGpu(t){if(this.C_s&&this.C_z.containsUid(t))if(this.C_u!=t){this.C_u=t;let e=this.C_z.findShdProgramByUid(t);this.C_J=e.getFragOutputTotal(),this.C_J,this.getActiveAttachmentTotal(),this.C_w=e.getGPUProgram(),this.AM.useProgram(this.C_w),e.useTexLocation();let s=this.Ch[e.getUid()];this.C_x=s;while(null!=s)s.use(this),s=s.next;this.C_v=e}else if(null==this.C_x&&null!=this.C_v){let t=this.Ch[this.C_v.getUid()];this.C_x=t;while(null!=t)t.use(this),t=t.next}}getGpuBuffer(t){return null}getCurrentShd(){return this.C_v}getCurrentShdUid(){return this.C_u}resetUniform(){this.A_9=null,this.C_y=null,this.C_x=null}renderBegin(){this.C_J=1,this.C_u=-1,this.C_v=null,this.drawFlag=-1}update(){}destroy(){this.AM=null,this.K_=null}useUniformToCurrentShd(t){this.A_9!=t&&(this.A_9,t.useByShd(this,this.C_v))}useUniform2ToCurrentShd(t,e){this.A_9!=t&&(this.A_9,t.useByShd(this,this.C_v)),this.C_y!=e&&(this.C_y,e.useByShd(this,this.C_v))}useUniformMat4(t,e){this.AM.uniformMatrix4fv(t,!1,e)}useUniformV2(t,e,s,i,a){switch(e){case r.default.SHADER_MAT4:this.AM.uniformMatrix4fv(t,!1,s,a,16*i);break;case r.default.SHADER_MAT3:this.AM.uniformMatrix3fv(t,!1,s,0,9*i);break;case r.default.SHADER_VEC4FV:this.AM.uniform4fv(t,s,a,4*i);break;case r.default.SHADER_VEC3FV:this.AM.uniform3fv(t,s,a,3*i);break;case r.default.SHADER_VEC4:this.AM.uniform4f(t,s[0],s[1],s[2],s[3]);break;case r.default.SHADER_VEC3:this.AM.uniform3f(t,s[0],s[1],s[2]);break;case r.default.SHADER_VEC2:this.AM.uniform2f(t,s[0],s[1]);break;default:break}}useUniformV1(t,e,s,i){switch(e){case r.default.SHADER_MAT4:this.AM.uniformMatrix4fv(t,!1,s);break;case r.default.SHADER_MAT3:this.AM.uniformMatrix3fv(t,!1,s);break;case r.default.SHADER_VEC4FV:this.AM.uniform4fv(t,s,4*i);break;case r.default.SHADER_VEC3FV:this.AM.uniform3fv(t,s,3*i);break;case r.default.SHADER_VEC4:this.AM.uniform4f(t,s[0],s[1],s[2],s[3]);break;case r.default.SHADER_VEC3:this.AM.uniform3f(t,s[0],s[1],s[2]);break;case r.default.SHADER_VEC2:this.AM.uniform2f(t,s[0],s[1]);break;default:break}}getActiveAttachmentTotal(){return this.K_.getActiveAttachmentTotal()}}e.default=a},b3bd:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.uns="",this.types=null,this.uniformSize=0,this.uniformNameList=null,this.locations=null,this.dataList=null,this.calcModels=null,this.always=!0,this.next=null}getDataRefFromUniformName(t){if(null!=this.uniformNameList){let e=this.uniformNameList,s=e.length;for(let i=0;i<s;++i)if(t==e[i])return this.dataList[i]}return null}setDataRefFromUniformName(t,e){if(null!=this.uniformNameList){let s=this.uniformNameList,i=s.length;for(let r=0;r<i;++r)if(t==s[r]){this.dataList[r]=e;break}}}copyDataFromProbe(t){this.types=[];for(let e=0;e<t.uniformsTotal;++e)this.types.push(t.uniformTypes[e]);this.uniformSize=t.uniformsTotal}destroy(){let t=0,e=this.dataList.length;for(;t<e;++t)this.dataList[t]=null;if(null!=this.calcModels)for(e=this.calcModels.length,t=0;t<e;++t)this.calcModels[t].destroy(),this.calcModels[t]=null;this.dataList=null,this.types=null,this.locations=null,this.calcModels=null}}e.default=i},baae:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.FRAMEBUFFER=71,i.DRAW_FRAMEBUFFER=72,i.READ_FRAMEBUFFER=73,e.default=i},badb:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("1710")),a=i(s("ee5a"));class h{constructor(){this.C_0=null,this.C_1=18,this.uuid="",this.data=null,this.C_1=r.default.GetMouseEvtTypeValuesTotal(),this.C_0=new Array(this.C_1)}getClassType(){return r.default.EventClassType}destroy(){for(let t=0;t<this.C_1;++t)null!=this.C_0[t]&&this.C_0[t].destroy()}dispatchEvt(t){if(null!=t){""!=this.uuid&&(t.uuid=this.uuid),null!=this.data&&(t.data=this.data);let e=t.type-r.default.GetMouseEvtTypeValueBase();if(e>=0&&e<r.default.GetMouseEvtTypeValuesTotal()&&null!=this.C_0[e])return this.C_0[e].dispatch(t)}return 0}passTestEvt(t){if(null!=t){let e=t.type-r.default.GetMouseEvtTypeValueBase();if(e>=0&&e<r.default.GetMouseEvtTypeValuesTotal())return this.C_0[e].passTestEvt(t)}return 0}passTestPhase(t){let e=r.default.GetMouseEvtTypeValuesTotal();for(let s=0;s<e;++s)if(null!=this.C_0[s]&&1==this.C_0[s].passTestPhase(t))return 1;return 0}addEventListener(t,e,s,i=!0,h=!1){if(null!=s&&null!=e){let n=t-r.default.GetMouseEvtTypeValueBase();if(n>=0&&n<r.default.GetMouseEvtTypeValuesTotal()){let t=0;i!=h&&(t=i?1:2),null!=this.C_0[n]||(this.C_0[n]=new a.default),this.C_0[n].addListener(e,s,t)}}}removeEventListener(t,e,s){if(null!=s&&null!=e){let i=t-r.default.GetMouseEvtTypeValueBase();i>=0&&i<r.default.GetMouseEvtTypeValuesTotal()&&null!=this.C_0[i]&&this.C_0[i].removeListener(e,s)}}}e.default=h},bbf4:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.CAMERA_VISIBLE_ENABLE=0,i.CAMERA_VISIBLE_DISABLE=1,e.default=i},bcac:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17"));class a{constructor(){this.Aq=null,this.Ar=null,this.H_=0,this.I_=0,this.As=!1,this.C_2=0,this.C_3=100,this.autoRotationEnabled=!1,this.autoRotationSpeed=.2,this.rotationAttenuationEnabled=!1,this.rotationSpeed=.2}initialize(t,e){null==this.Aq&&(this.Aq=t,this.Ar=e)}attach(){this.H_=this.Aq.mouseX,this.I_=this.Aq.mouseY,this.As=!0,this.C_3=100}detach(){this.As=!1}runWithYAxis(){if(this.As){let t=this.H_-this.Aq.mouseX,e=this.I_-this.Aq.mouseY,s=Math.abs(t),i=Math.abs(e);s>i?(this.C_2=t*this.rotationSpeed,s>.5&&this.Ar.swingHorizontalWithAxis(this.C_2,r.default.Y_AXIS)):(this.C_2=0,i>.5&&this.Ar.swingVertical(-e*this.rotationSpeed)),this.H_=this.Aq.mouseX,this.I_=this.Aq.mouseY}else this.autoRotationEnabled&&(this.C_3<0?this.Ar.swingHorizontalWithAxis(this.autoRotationSpeed,r.default.Y_AXIS):this.C_3--)}runWithZAxis(){if(this.As){let t=this.H_-this.Aq.mouseX,e=this.I_-this.Aq.mouseY,s=Math.abs(t),i=Math.abs(e);s>i?s>.5&&this.Ar.swingHorizontalWithAxis(.2*t,r.default.Z_AXIS):i>.5&&this.Ar.swingVertical(-.2*e),this.H_=this.Aq.mouseX,this.I_=this.Aq.mouseY}else this.autoRotationEnabled&&(this.C_3<0?this.Ar.swingHorizontalWithAxis(this.autoRotationSpeed,r.default.Z_AXIS):this.C_3--)}}e.CameraDragSwinger=a},c120:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17"));class a{constructor(){this.entity=null,this.lpv=new r.default,this.wpv=new r.default,this.dis=0,this.flag=0}}e.default=a},c164:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){}}i.BasePredefined="\n#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n",e.MathShaderCode=i;class r{constructor(){}}r.BasePredefined="\nvec4 localPosition = vec4(0.0,0.0,0.0,1.0);\nvec4 worldPosition = vec4(0.0,0.0,0.0,1.0);\n// view space position\nvec4 viewPosition = vec4(0.0,0.0,0.0,1.0);\nvec3 worldNormal = vec3(0.0, 0.0, 1.0);\n",r.FragPredefined="\n",r.FragDefined="\n",r.VertPredefined="\n// origin world position\nvec4 oWorldPosition = vec4(0.0,0.0,0.0,1.0);\n",r.VertDefined="\n",e.ShaderCode=r},c497:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17"));class a{constructor(t=null){this.C_4=8192,this.C_5=null,this.C_6={depth:!0,premultipliedAlpha:!1,alpha:!0,antialias:!1,stencil:!1,preserveDrawingBuffer:!0,powerPreference:"high-performance"},this.C_7=20,this.C_8=!1,this.C_9=!1,this.autoSyncRenderBufferAndWindowSize=!0,this.maxWebGLVersion=2,this.cameraPerspectiveEnabled=!0,this.evtFlowEnabled=!1,this.camProjParam=new r.default(45,10,5e3),this.camPosition=new r.default(2e3,2e3,2e3),this.camLookAtPos=new r.default(0,0,0),this.camUpDirect=new r.default(0,1,0),this.batchEnabled=!0,this.processFixedState=!1,this.C_5=t,this.autoSyncRenderBufferAndWindowSize=null==t}setTickUpdateTime(t){t=Math.round(t),this.C_7=t>5?t:5}getTickUpdateTime(){return this.C_7}setPolygonOffsetEanbled(t){this.C_8=t}getPolygonOffsetEanbled(){return this.C_8}setDitherEanbled(t){this.C_9=t}getDitherEanbled(){return this.C_9}getDiv(){return this.C_5}getRenderContextAttri(){return this.C_6}setAttriDepth(t){this.C_6.depth=t}setAttriStencil(t){this.C_6.stencil=t}setAttriAlpha(t){this.C_6.alpha=t}setAttriPremultipliedAlpha(t){this.C_6.premultipliedAlpha=t}setAttriAntialias(t){this.C_6.antialias=t}setAttripreserveDrawingBuffer(t){this.C_6.preserveDrawingBuffer=t}setAttriHightPowerPreference(t){this.C_6.powerPreference=t?"high-performance":"default"}setMatrix4AllocateSize(t){t<1024&&(t=1024),this.C_4=t}getMatrix4AllocateSize(){return this.C_4}setCamProject(t,e,s){if(e>=s)throw Error("Error Camera cear > far !!!");this.camProjParam.setTo(t,e,s)}setCamPosition(t,e,s){this.camPosition.setTo(t,e,s)}setCamLookAtPos(t,e,s){this.camLookAtPos.setTo(t,e,s)}setCamUpDirect(t,e,s){this.camUpDirect.setTo(t,e,s)}}e.default=a},c51d:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("8e17")),h=i(s("18c7")),n=i(s("e214")),l=i(s("fecb"));class _{constructor(){this.version=0,this.matUProbe=null,this.ufrustumProbe=null,this.uniformEnabled=!1,this.name="Camera",this.C_=new a.default,this.DA=new a.default,this.DB=new a.default,this.DC=new a.default,this.DD=!0,this.DE=new h.default,this.DF=new h.default,this.DG=new h.default,this.DH=new h.default,this.DI=new h.default,this.DJ=new h.default,this.DK=new a.default,this.DL=new a.default,this.DM=new a.default,this.DN=new a.default,this.DO=new a.default,this.DP=1,this.DQ=1,this.B=0,this.C=0,this.D=800,this.E=600,this.DR=400,this.DS=300,this.DT=0,this.DU=1,this.DV=.1,this.DW=1e3,this.DX=0,this.DY=0,this.DZ=0,this.Da=0,this.B_G=!1,this.Db=!1,this.Dc=!0,this.Dd=new a.default(0,0,0),this.De=1,this.Df=!0,this.Dg=!0,this.Dh=new a.default,this.Di=new a.default,this.Dj=new a.default,this.Dk=new a.default,this.Dl=new a.default,this.Dm=0,this.Dn=new a.default,this.Do=null,this.Dp=!1,this.Dq=new l.default,this.Dr=null,this.Ds=.5,this.Dt=.5,this.Du=new a.default,this.Dv=new a.default,this.Dw=new a.default,this.Dx=[new a.default,new a.default,new a.default,new a.default,new a.default,new a.default,new a.default,new a.default,null,null,null],this.Dy=[new n.default,new n.default,new n.default,new n.default,new n.default,new n.default],this.Dz=[new a.default,new a.default,new a.default,new a.default,new a.default,new a.default],this.D0=[0,0,0,0,0,0],this.D1=null}lock(){this.Dg=!1}unlock(){this.Dg=!0}lookAtLH(t,e,s){this.Dg&&(this.DK.copyFrom(t),this.DL.copyFrom(e),this.DM.copyFrom(s),this.DO.x=this.DL.x-this.DK.x,this.DO.y=this.DL.y-this.DK.y,this.DO.z=this.DL.z-this.DK.z,this.DD=!1,this.DN.copyFrom(this.DO),this.DN.normalize(),this.DC.copyFrom(s),this.DC.normalize(),a.default.Cross(this.DO,this.DM,this.DB),this.DB.normalize(),this.Df=!0)}lookAtRH(t,e,s){this.Dg&&(this.DK.copyFrom(t),this.DL.copyFrom(e),this.DO.x=this.DL.x-this.DK.x,this.DO.y=this.DL.y-this.DK.y,this.DO.z=this.DL.z-this.DK.z,this.DD=!0,this.DN.copyFrom(this.DO),this.DN.normalize(),a.default.Cross(this.DO,s,this.DB),a.default.Cross(this.DB,this.DO,this.DC),this.DC.normalize(),this.DB.normalize(),this.DM.copyFrom(this.DC),this.Df=!0)}getLookAtLHToCamera(t){t.lookAtLH(this.DK,this.DL,this.DM)}getLookAtRHToCamera(t){t.lookAtRH(this.DK,this.DL,this.DM)}perspectiveLH(t,e,s,i){this.Dg&&(this.Db=!1,this.DU=e,this.DT=t,this.DV=s,this.DW=i,this.DJ.perspectiveLH(t,e,s,i),this.De=Math.tan(.5*t),this.B_G=!0,this.Dc=!1,this.Df=!0)}perspectiveRH(t,e,s,i){this.Dg&&(this.DU=e,this.DT=t,this.DV=s,this.DW=i,this.DJ.perspectiveRH(t,e,s,i),this.De=Math.tan(.5*t),this.Db=!1,this.B_G=!0,this.Dc=!0,this.Df=!0)}perspectiveRH2(t,e,s,i,r){this.Dg&&(this.DU=e/s,this.DT=t,this.DV=i,this.DW=r,this.DJ.perspectiveRH2(t,e,s,i,r),this.De=Math.tan(.5*t),this.B_G=!0,this.Db=!0,this.Dc=!0,this.Df=!0)}getAspect(){return this.DU}getViewFieldZoom(){return this.De}orthoRH(t,e,s,i,r,a){this.Dg&&(this.DV=t,this.DW=e,this.DX=s,this.DY=i,this.DZ=r,this.Da=a,this.DJ.orthoRH(s,i,r,a,t,e),this.B_G=!1,this.Dc=!0,this.Df=!0)}orthoLH(t,e,s,i,r,a){this.Dg&&(this.DV=t,this.DW=e,this.DX=s,this.DY=i,this.DZ=r,this.Da=a,this.DJ.orthoLH(s,i,r,a,t,e),this.B_G=!1,this.Dc=!1,this.Df=!0)}isPerspectiveEnabled(){return this.B_G}isRightHandEnabled(){return this.Dc}setViewXY(t,e){this.Dg&&(this.B=t,this.C=e)}setViewSize(t,e){this.Dg&&(t==this.D&&e==this.E||(this.D=t,this.E=e,this.DR=.5*t,this.DS=.5*e,this.B_G?this.Db?this.Dc&&this.perspectiveRH2(this.DT,t,e,this.DV,this.DW):this.Dc?this.perspectiveRH(this.DT,t/e,this.DV,this.DW):this.perspectiveLH(this.DT,t/e,this.DV,this.DW):this.orthoRH(this.DV,this.DW,-.5*e,.5*e,-.5*t,.5*t)))}getViewX(){return this.B}getViewY(){return this.C}getViewWidth(){return this.D}getViewHeight(){return this.E}translation(t){this.Dg&&(this.DK.copyFrom(t),this.DL.x=t.x+this.DO.x,this.DL.y=t.y+this.DO.y,this.DL.z=t.z+this.DO.z,this.Df=!0)}translationXYZ(t,e,s){this.C_.setXYZ(t,e,s),this.Dg&&a.default.DistanceSquared(this.DK,this.C_)>1e-5&&(this.DK.setTo(t,e,s),this.DL.x=t+this.DO.x,this.DL.y=e+this.DO.y,this.DL.z=s+this.DO.z,this.Df=!0)}forward(t){this.Dg&&(this.DK.x+=this.DN.x*t,this.DK.y+=this.DN.y*t,this.DK.z+=this.DN.z*t,this.DL.x=this.DK.x+this.DO.x,this.DL.y=this.DK.y+this.DO.y,this.DL.z=this.DK.z+this.DO.z,this.Df=!0)}slideViewOffsetXY(t,e){if(this.Dg){this.C_.setXYZ(t,e,0),this.Dr.transformVectorSelf(this.C_),t=this.C_.x-this.DK.x,e=this.C_.y-this.DK.y;let s=this.C_.z-this.DK.z;this.DK.x+=t,this.DK.y+=e,this.DK.z+=s,this.DL.x+=t,this.DL.y+=e,this.DL.z+=s,this.Df=!0}}forwardFixPos(t,e){this.Dg&&(this.DK.x=e.x+this.DN.x*t,this.DK.y=e.y+this.DN.y*t,this.DK.z=e.z+this.DN.z*t,this.DL.x=this.DK.x+this.DO.x,this.DL.y=this.DK.y+this.DO.y,this.DL.z=this.DK.z+this.DO.z,this.Df=!0)}swingHorizontalWithAxis(t,e){this.Dg&&(this.DI.identity(),null!=e?this.DI.appendRotation(t*r.default.MATH_PI_OVER_180,e):this.DI.appendRotation(t*r.default.MATH_PI_OVER_180,a.default.Y_AXIS),this.DO.x=this.DK.x-this.DL.x,this.DO.y=this.DK.y-this.DL.y,this.DO.z=this.DK.z-this.DL.z,this.DI.transformVectorSelf(this.DO),this.DK.x=this.DO.x+this.DL.x,this.DK.y=this.DO.y+this.DL.y,this.DK.z=this.DO.z+this.DL.z,this.DO.x=this.DL.x-this.DK.x,this.DO.y=this.DL.y-this.DK.y,this.DO.z=this.DL.z-this.DK.z,this.DD=!0,this.DN.copyFrom(this.DO),this.DN.normalize(),this.DI.transformVectorSelf(this.DB),this.DB.normalize(),a.default.Cross(this.DB,this.DO,this.DM),this.DM.normalize(),this.Df=!0)}swingHorizontal(t){this.Dg&&(this.DI.identity(),this.DI.appendRotation(t*r.default.MATH_PI_OVER_180,this.DM),this.DO.x=this.DK.x-this.DL.x,this.DO.y=this.DK.y-this.DL.y,this.DO.z=this.DK.z-this.DL.z,this.DI.transformVectorSelf(this.DO),this.DK.x=this.DO.x+this.DL.x,this.DK.y=this.DO.y+this.DL.y,this.DK.z=this.DO.z+this.DL.z,this.DO.x=this.DL.x-this.DK.x,this.DO.y=this.DL.y-this.DK.y,this.DO.z=this.DL.z-this.DK.z,this.DD=!0,this.DN.copyFrom(this.DO),this.DN.normalize(),a.default.Cross(this.DO,this.DM,this.DB),this.DB.normalize(),this.Df=!0)}swingVertical(t){this.Dg&&(this.DI.identity(),this.DI.appendRotation(t*r.default.MATH_PI_OVER_180,this.DB),this.DO.x=this.DK.x-this.DL.x,this.DO.y=this.DK.y-this.DL.y,this.DO.z=this.DK.z-this.DL.z,this.DI.transformVectorSelf(this.DO),this.DK.x=this.DO.x+this.DL.x,this.DK.y=this.DO.y+this.DL.y,this.DK.z=this.DO.z+this.DL.z,this.DO.x=this.DL.x-this.DK.x,this.DO.y=this.DL.y-this.DK.y,this.DO.z=this.DL.z-this.DK.z,this.DD=!0,this.DN.copyFrom(this.DO),this.DN.normalize(),a.default.Cross(this.DB,this.DO,this.DM),this.DM.normalize(),this.DC.copyFrom(this.DM),this.Df=!0)}setPosition(t){if(this.Dg){a.default.Cross(this.DO,this.DM,this.C_);let e=this.C_.dot(this.DC);this.DA.copyFrom(this.DC),this.DA.scaleBy(e),this.C_.subtractBy(this.DA),this.DK.copyFrom(t),this.DO.x=this.DL.x-this.DK.x,this.DO.y=this.DL.y-this.DK.y,this.DO.z=this.DL.z-this.DK.z,this.DN.copyFrom(this.DO),this.DN.normalize(),a.default.Cross(this.C_,this.DO,this.DM),this.DM.normalize(),this.Df=!0}}setPositionXYZ(t,e,s){if(this.Dg){a.default.Cross(this.DO,this.DM,this.C_);var i=this.C_.dot(this.DC);this.DA.copyFrom(this.DC),this.DA.scaleBy(i),this.C_.subtractBy(this.DA),this.DK.setTo(t,e,s),this.DO.x=this.DL.x-this.DK.x,this.DO.y=this.DL.y-this.DK.y,this.DO.z=this.DL.z-this.DK.z,this.DN.copyFrom(this.DO),this.DN.normalize(),a.default.Cross(this.C_,this.DO,this.DM),this.DM.normalize(),this.Df=!0}}setLookPosXYZFixUp(t,e,s){this.Dg&&(this.DL.setTo(t,e,s),this.DO.x=this.DL.x-this.DK.x,this.DO.y=this.DL.y-this.DK.y,this.DO.z=this.DL.z-this.DK.z,this.DD=!0,this.DN.copyFrom(this.DO),this.DN.normalize(),a.default.Cross(this.DO,this.DM,this.DB),this.DB.normalize(),this.Df=!0)}setPositionXYZFixUp(t,e,s){this.Dg&&(this.DK.setTo(t,e,s),this.DO.x=this.DL.x-this.DK.x,this.DO.y=this.DL.y-this.DK.y,this.DO.z=this.DL.z-this.DK.z,this.DD=!0,this.DN.copyFrom(this.DO),this.DN.normalize(),a.default.Cross(this.DO,this.DM,this.DB),this.DB.normalize(),this.Df=!0)}setPositionFixUp(t){this.Dg&&(this.DK.copyFrom(t),this.DO.x=this.DL.x-this.DK.x,this.DO.y=this.DL.y-this.DK.y,this.DO.z=this.DL.z-this.DK.z,this.DD=!0,this.DN.copyFrom(this.DO),this.DN.normalize(),a.default.Cross(this.DO,this.DM,this.DB),this.DB.normalize(),this.Df=!0)}copyFrom(t){let e=t.getPosition();this.DK.copyFrom(e),e=t.getLookAtPosition(),this.DL.copyFrom(e),this.setZNear(t.getZNear()),this.setZFar(t.getZFar()),this.setNearPlaneWidth(t.getNearPlaneWidth()),this.setNearPlaneHeight(t.getNearPlaneHeight()),this.setPerspectiveEnabled(t.getPerspectiveEnabled()),this.DG.copyFrom(t.getViewInvMatrix())}getNV(){return this.Dh.copyFrom(this.DN),this.Dh}getUV(){return this.Di.copyFrom(this.DM),this.Di}getRV(){return this.Dj.copyFrom(this.DB),this.Dj}getPosition(){return this.Dk.copyFrom(this.DK),this.Dk}getLookAtPosition(){return this.Dl.copyFrom(this.DL),this.Dl}setLookAtPosition(t){this.Dg&&(this.DL.copyFrom(t),this.DO.x=this.DL.x-this.DK.x,this.DO.y=this.DL.y-this.DK.y,this.DO.z=this.DL.z-this.DK.z,this.DN.copyFrom(this.DO),this.DN.normalize(),this.Df=!0)}setLookAtXYZ(t,e,s){this.Dg&&(this.DL.setTo(t,e,s),this.DO.x=this.DL.x-this.DK.x,this.DO.y=this.DL.y-this.DK.y,this.DO.z=this.DL.z-this.DK.z,this.DN.copyFrom(this.DO),this.DN.normalize(),this.Df=!0)}getPerspectiveEnabled(){return this.B_G}setPerspectiveEnabled(t){this.B_G=t}appendRotationByAxis(t,e,s=null){this.Dg&&(this.Dm=t,this.Df=!0,this.Dn.copyFrom(e),this.Do=s,this.Dp=!0)}setRotationX(t){this.Dd.x=t,this.Df=!0,this.Dp=!1}getRotationX(){return this.Dd.x}setRotationY(t){this.Dd.y=t,this.Df=!0,this.Dp=!1}getRotationY(){return this.Dd.y}setRotationZ(t){this.Dd.z=t,this.Df=!0,this.Dp=!1}getRotationZ(){return this.Dd.z}setRotationXYZ(t,e,s){this.Dg&&(this.Dd.setXYZ(t,e,s),this.Df=!0,this.Dp=!1)}screenXYToViewXYZ(t,e,s){t-=this.B,e-=this.C,this.B_G&&(t=this.DP*(t-this.DR)/this.DR,e=this.DQ*(this.DS-e)/this.DS),s.setTo(t,e,-this.DV)}screenXYToWorldXYZ(t,e,s){t-=this.B,e-=this.C,this.B_G&&(t=.5*this.DP*(t-this.DR)/this.DR,e=.5*this.DQ*(this.DS-e)/this.DS),s.setTo(t,e,-this.DV),s.w=1,this.DG.transformVectorSelf(s)}getWorldPickingRayByScreenXY(t,e,s,i){t-=this.B,e-=this.C,this.B_G?(t=.5*this.DP*(t-this.DR)/this.DR,e=.5*this.DQ*(e-this.DS)/this.DS,s.setTo(t,e,-this.DV),s.w=1,this.DG.transformVectorSelf(s),i.copyFrom(s),i.subtractBy(this.DK),i.normalize()):(t-=this.DR,e-=this.DS,s.setTo(t,e,-this.DV),s.w=1,this.DG.transformVectorSelf(s),i.copyFrom(this.DN))}calcScreenNormalizeXYByWorldPos(t,e){e.copyFrom(t),this.DH.transformVectorSelf(e),e.x/=e.w,e.y/=e.w}worldPosToScreen(t){this.DF.transformVector3Self(t),this.DJ.transformVectorSelf(t),t.x/=t.w,t.y/=t.w,t.x*=this.DR,t.y*=this.DS,t.x+=this.B,t.y+=this.C}calcViewRectByWorldSphere(t,e,s){this.DF.transformVector3Self(t),e*=1.15,s.x=t.x-e,s.y=t.y-e,s.z=t.z,t.x+=e,t.y+=e,this.DJ.transformPerspV4Self(s),this.DJ.transformPerspV4Self(t),t.z=1/t.w,s.z=t.x*t.z,s.w=t.y*t.z,s.z*=this.DR,s.w*=this.DS,s.x*=t.z,s.y*=t.z,s.x*=this.DR,s.y*=this.DS,s.z=s.z-s.x,s.w=s.w-s.y,s.x+=this.B,s.y+=this.C}calcScreenRectByWorldSphere(t,e,s){this.DF.transformVector3Self(t),e*=1.15,s.x=t.x-e,s.y=t.y-e,t.x+=e,t.y+=e,this.DJ.transformPerspV4Self(s),this.DJ.transformPerspV4Self(t),t.z=1/t.w,s.z=t.x*t.z,s.w=t.y*t.z,s.x*=t.z,s.y*=t.z,s.z=s.z-s.x,s.w=s.w-s.y}getInvertViewMatrix(){return this.Dr}getZNear(){return this.DV}setZNear(t){this.DV=t}getZFar(){return this.DW}setZFar(t){this.DW=t}getNearPlaneWidth(){return this.DP}setNearPlaneWidth(t){this.DP=t}getNearPlaneHeight(){return this.DQ}setNearPlaneHeight(t){this.DQ=t}getFov(){return this.DT}__calcTestParam(){null==this.Dr&&(this.Dr=new h.default),this.Dr.copyFrom(this.DF),this.Dr.invert();let t=null,e=this.DS,s=this.DR,i=this.DS,r=this.DR;if(this.B_G){let t=Math.tan(.5*this.DT);e=this.DV*t,s=e*this.DU,i=this.DW*t,r=i*this.DU}this.Ds=s,this.Dt=e,this.Du.setTo(0,0,-this.DV),this.Dv.setTo(0,0,-this.DW),this.Dr.transformVectorSelf(this.Du),this.Dr.transformVectorSelf(this.Dv),this.Dw.x=this.Dv.x-this.Du.x,this.Dw.y=this.Dv.y-this.Du.y,this.Dw.z=this.Dv.z-this.Du.z,this.Dw.normalize(),t=this.Dy[0],t.nv.copyFrom(this.Dw),t.distance=t.nv.dot(this.Dv),t.position.copyFrom(this.Dv),t=this.Dy[1],t.nv.copyFrom(this.Dy[0].nv),t.distance=t.nv.dot(this.Du),t.position.copyFrom(this.Du),this.Dx[8]=this.Du,this.Dx[9]=this.Dv,this.Dx[11]=this.Dw,this.Dx[0].setTo(-r,-i,-this.DW),this.Dx[1].setTo(r,-i,-this.DW),this.Dx[2].setTo(r,i,-this.DW),this.Dx[3].setTo(-r,i,-this.DW),this.Dx[4].setTo(-s,-e,-this.DV),this.Dx[5].setTo(s,-e,-this.DV),this.Dx[6].setTo(s,e,-this.DV),this.Dx[7].setTo(-s,e,-this.DV),this.Dr.transformVectorSelf(this.Dx[0]),this.Dr.transformVectorSelf(this.Dx[1]),this.Dr.transformVectorSelf(this.Dx[2]),this.Dr.transformVectorSelf(this.Dx[3]),this.Dr.transformVectorSelf(this.Dx[4]),this.Dr.transformVectorSelf(this.Dx[5]),this.Dr.transformVectorSelf(this.Dx[6]),this.Dr.transformVectorSelf(this.Dx[7]),this.Dq.max.setTo(-9999999,-9999999,-9999999),this.Dq.min.setTo(9999999,9999999,9999999);for(let a=0;a<8;++a)this.Dq.addPosition(this.Dx[a]);this.Dq.updateFast();let n=this.Dx[0],l=this.Dx[4];this.C_.x=n.x-l.x,this.C_.y=n.y-l.y,this.C_.z=n.z-l.z,n=this.Dx[1],l=this.Dx[5],this.DA.x=n.x-l.x,this.DA.y=n.y-l.y,this.DA.z=n.z-l.z,t=this.Dy[3],a.default.Cross(this.DA,this.C_,t.nv),t.nv.normalize(),t.distance=t.nv.dot(n),t.position.copyFrom(n),n=this.Dx[3],l=this.Dx[7],this.C_.x=n.x-l.x,this.C_.y=n.y-l.y,this.C_.z=n.z-l.z,n=this.Dx[2],l=this.Dx[6],this.DA.x=n.x-l.x,this.DA.y=n.y-l.y,this.DA.z=n.z-l.z,t=this.Dy[2],a.default.Cross(this.DA,this.C_,t.nv),t.nv.normalize(),t.distance=t.nv.dot(n),t.position.copyFrom(n),n=this.Dx[0],l=this.Dx[4],this.C_.x=n.x-l.x,this.C_.y=n.y-l.y,this.C_.z=n.z-l.z,n=this.Dx[3],l=this.Dx[7],this.DA.x=n.x-l.x,this.DA.y=n.y-l.y,this.DA.z=n.z-l.z,t=this.Dy[4],a.default.Cross(this.C_,this.DA,t.nv),t.nv.normalize(),t.distance=t.nv.dot(n),t.position.copyFrom(n),n=this.Dx[1],l=this.Dx[5],this.C_.x=n.x-l.x,this.C_.y=n.y-l.y,this.C_.z=n.z-l.z,n=this.Dx[2],l=this.Dx[6],this.DA.x=n.x-l.x,this.DA.y=n.y-l.y,this.DA.z=n.z-l.z,t=this.Dy[5],a.default.Cross(this.C_,this.DA,t.nv),t.nv.normalize(),t.distance=t.nv.dot(n),t.position.copyFrom(n),this.Dz[0].copyFrom(this.Dy[0].nv),this.Dz[1].copyFrom(this.Dy[1].nv),this.Dz[1].scaleBy(-1),this.Dz[2].copyFrom(this.Dy[2].nv),this.Dz[3].copyFrom(this.Dy[3].nv),this.Dz[3].scaleBy(-1),this.Dz[4].copyFrom(this.Dy[4].nv),this.Dz[4].scaleBy(-1),this.Dz[5].copyFrom(this.Dy[5].nv),this.D0[0]=this.Dy[0].distance,this.D0[1]=-this.Dy[1].distance,this.D0[2]=this.Dy[2].distance,this.D0[3]=-this.Dy[3].distance,this.D0[4]=-this.Dy[4].distance,this.D0[5]=this.Dy[5].distance}getWordFrustumWAABB(){return this.Dq}getWordFrustumWAABBCenter(){return this.Dq.center}getWordFrustumVtxArr(){return this.Dx}getWordFrustumPlaneArr(){return this.Dy}visiTestSphere2(t,e){let s=this.Dz[0].dot(t)-this.D0[0]-e>r.default.MATH_MIN_POSITIVE;return!s&&(s=this.Dz[1].dot(t)-this.D0[1]-e>r.default.MATH_MIN_POSITIVE,!s&&(s=this.Dz[2].dot(t)-this.D0[2]-e>r.default.MATH_MIN_POSITIVE,!s&&(s=this.Dz[3].dot(t)-this.D0[3]-e>r.default.MATH_MIN_POSITIVE,!s&&(s=this.Dz[4].dot(t)-this.D0[4]-e>r.default.MATH_MIN_POSITIVE,!s&&(s=this.Dz[5].dot(t)-this.D0[5]-e>r.default.MATH_MIN_POSITIVE,!s)))))}visiTestSphere3(t,e,s){let i=this.Dz[0].dot(t)-this.D0[0]+s-e>r.default.MATH_MIN_POSITIVE;return!i&&(i=this.Dz[1].dot(t)-this.D0[1]-e>r.default.MATH_MIN_POSITIVE,!i&&(i=this.Dz[2].dot(t)-this.D0[2]-e>r.default.MATH_MIN_POSITIVE,!i&&(i=this.Dz[3].dot(t)-this.D0[3]-e>r.default.MATH_MIN_POSITIVE,!i&&(i=this.Dz[4].dot(t)-this.D0[4]-e>r.default.MATH_MIN_POSITIVE,!i&&(i=this.Dz[5].dot(t)-this.D0[5]-e>r.default.MATH_MIN_POSITIVE,!i)))))}visiTestPosition(t){let e=this.Dz[0].dot(t)-this.D0[0]>r.default.MATH_MIN_POSITIVE;return!e&&(e=this.Dz[1].dot(t)-this.D0[1]>r.default.MATH_MIN_POSITIVE,!e&&(e=this.Dz[2].dot(t)-this.D0[2]>r.default.MATH_MIN_POSITIVE,!e&&(e=this.Dz[3].dot(t)-this.D0[3]>r.default.MATH_MIN_POSITIVE,!e&&(e=this.Dz[4].dot(t)-this.D0[4]>r.default.MATH_MIN_POSITIVE,!e&&(e=this.Dz[5].dot(t)-this.D0[5]>r.default.MATH_MIN_POSITIVE,!e)))))}visiTestPlane(t,e){let s=t.dot(this.Dy[0].position)-e,i=s*(t.dot(this.Dy[1].position)-e);return i<r.default.MATH_MIN_POSITIVE||(i=s*(t.dot(this.Dy[2].position)-e),i<r.default.MATH_MIN_POSITIVE||(i=s*(t.dot(this.Dy[3].position)-e),i<r.default.MATH_MIN_POSITIVE||(i=s*(t.dot(this.Dy[4].position)-e),i<r.default.MATH_MIN_POSITIVE||(i=s*(t.dot(this.Dy[5].position)-e),i<r.default.MATH_MIN_POSITIVE))))}visiTestSphere(t,e){let s=this.Dq.sphereIntersect(t,e);if(s){let s=this.Dy[0].intersectSphere(t,e),i=this.Dy[1].intersectSphere(t,e);return!(s*i>=0&&!this.Dy[0].intersectBoo&&!this.Dy[1].intersectBoo)&&(s=this.Dy[2].intersectSphere(t,e),i=this.Dy[3].intersectSphere(t,e),!(s*i>=0&&!this.Dy[2].intersectBoo&&!this.Dy[3].intersectBoo)&&(s=this.Dy[4].intersectSphere(t,e),i=this.Dy[5].intersectSphere(t,e),!(s*i>=0&&!this.Dy[4].intersectBoo&&!this.Dy[5].intersectBoo)))}return!1}visiTestAABB(t){let e=t.center,s=t.radius,i=this.Dq.sphereIntersect(e,s);if(i){let t=this.Dy[0].intersectSphere(e,s),i=this.Dy[1].intersectSphere(e,s);return!(t*i>=0&&!this.Dy[0].intersectBoo&&!this.Dy[1].intersectBoo)&&(t=this.Dy[2].intersectSphere(e,s),i=this.Dy[3].intersectSphere(e,s),!(t*i>=0&&!this.Dy[2].intersectBoo&&!this.Dy[3].intersectBoo)&&(t=this.Dy[4].intersectSphere(e,s),i=this.Dy[5].intersectSphere(e,s),!(t*i>=0&&!this.Dy[4].intersectBoo&&!this.Dy[5].intersectBoo)))}return!1}setViewMatrix(t){this.D1=t,this.Df=!0}update(){this.Df&&(this.version++,this.Df=!1,null==this.D1?(this.Dp?this.DE.appendRotationPivot(this.Dm*r.default.MATH_PI_OVER_180,this.Dn,this.Do):(this.DE.identity(),this.DE.appendRotationEulerAngle(this.Dd.x*r.default.MATH_PI_OVER_180,this.Dd.y*r.default.MATH_PI_OVER_180,this.Dd.z*r.default.MATH_PI_OVER_180)),this.DD?this.DF.lookAtRH(this.DK,this.DL,this.DM):this.DF.lookAtLH(this.DK,this.DL,this.DM),this.DF.append(this.DE)):this.DF.copyFrom(this.D1),this.Db?(this.DP=this.DV*Math.tan(.5*this.DT)*2,this.DQ=this.DP/this.DU):(this.DQ=this.DV*Math.tan(.5*this.DT)*2,this.DP=this.DU*this.DQ),this.DG.copyFrom(this.DF),this.DG.invert(),this.DH.identity(),this.DH.copyFrom(this.DF),this.DH.append(this.DJ),this.__calcTestParam(),this.updateUniformData())}updateCamMatToUProbe(t){t.isEnabled()&&(t.update(),t.getFS32At(0).set(this.DF.getLocalFS32(),0),t.getFS32At(1).set(this.DJ.getLocalFS32(),0))}updateUniformData(){this.uniformEnabled&&(this.updateCamMatToUProbe(this.matUProbe),this.ufrustumProbe.setVec4DataAt(0,this.DV,this.DW,this.Ds,this.Dt),this.ufrustumProbe.update(),this.ucameraPosProbe.setVec4DataAt(0,this.DK.x,this.DK.y,this.DK.z,1),this.ucameraPosProbe.update())}destroy(){}lookRHEnabled(){return this.DD}lookLHEnabled(){return!this.DD}getVPMatrix(){return this.DH}getViewMatrix(){return this.DF}getViewInvMatrix(){return this.DG}getProjectMatrix(){return this.DJ}}e.default=_},c62b:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("e08e"),a=s("070b"),h=s("a5ba"),n=i(s("29ef"));class l{constructor(){this.uid=-1,this.value=-1,this.__$rpuid=-1,this.__$rprouid=-1,this.shader=null,this.pos=null,this.bounds=null,this.ibufType=0,this.ibufStep=2,this.ivsIndex=0,this.ivsCount=0,this.insCount=0,this.drawOffset=0,this.partTotal=0,this.partGroup=null,this.trisNumber=0,this.visible=!0,this.drawEnabled=!0,this.drawMode=0,this.renderState=0,this.rcolorMask=0,this.drawFlag=0,this.vro=null,this.transUniform=null,this.uniform=null,this.shdUid=-1,this.vtxUid=-1,this.tro=null,this.texMid=-1,this.ubo=null,this.polygonOffset=null}testDrawFlag(){this.shader.drawFlag!=this.drawFlag&&(this.shader.drawFlag=this.drawFlag,h.RenderStateObject.UseRenderState(this.renderState),a.RenderColorMask.UseRenderState(this.rcolorMask))}getUid(){return this.uid}getRPOUid(){return this.__$rpuid}getRPROUid(){return this.__$rprouid}getShaderUid(){return this.shdUid}setIvsParam(t,e){this.ivsIndex=t,this.ivsCount=e,this.drawOffset=t*this.ibufStep,this.drawEnabled=this.visible&&this.ivsCount>0}setVisible(t){this.visible=t,this.drawEnabled=t&&this.ivsCount>0}setDrawFlag(t,e){this.renderState=t,this.rcolorMask=e,this.drawFlag=(e<<10)+t}drawThis(t){++n.default.DrawCallTimes,n.default.DrawTrisNumber+=this.trisNumber;let e=this.indicesRes.getVTCount();switch(this.ivsCount<=e&&(e=this.ivsCount),null!=this.polygonOffset?t.setPolygonOffset(this.polygonOffset[0],this.polygonOffset[1]):t.resetPolygonOffset(),this.drawMode){case r.RenderDrawMode.ELEMENTS_TRIANGLES:t.RContext.drawElements(t.TRIANGLES,e,this.ibufType,this.drawOffset);break;case r.RenderDrawMode.ELEMENTS_LINES:t.RContext.drawElements(t.LINES,e,this.ibufType,this.drawOffset);break;case r.RenderDrawMode.ELEMENTS_TRIANGLE_STRIP:t.RContext.drawElements(t.TRIANGLE_STRIP,e,this.ibufType,this.drawOffset);break;case r.RenderDrawMode.ELEMENTS_INSTANCED_TRIANGLES:t.RContext.drawElementsInstanced(t.TRIANGLES,e,this.ibufType,this.drawOffset,this.insCount);break;case r.RenderDrawMode.ELEMENTS_TRIANGLE_FAN:t.RContext.drawElements(t.TRIANGLE_FAN,e,this.ibufType,this.drawOffset);break;case r.RenderDrawMode.ARRAYS_LINES:t.RContext.drawArrays(t.LINES,this.ivsIndex,this.ivsCount);break;case r.RenderDrawMode.ARRAYS_LINE_STRIP:t.RContext.drawArrays(t.LINE_STRIP,this.ivsIndex,this.ivsCount);break;default:break}}drawPart(t){++n.default.DrawCallTimes,n.default.DrawTrisNumber+=this.trisNumber;let e=this.indicesRes.getVTCount();this.ivsCount<=e&&(e=this.ivsCount),null!=this.polygonOffset?t.setPolygonOffset(this.polygonOffset[0],this.polygonOffset[1]):t.resetPolygonOffset();let s=0,i=t.RContext;switch(this.drawMode){case r.RenderDrawMode.ELEMENTS_TRIANGLES:for(;s<this.partTotal;)i.drawElements(t.TRIANGLES,this.partGroup[s++],this.ibufType,this.partGroup[s++]);break;case r.RenderDrawMode.ELEMENTS_LINES:for(;s<this.partTotal;)i.drawElements(t.LINES,this.partGroup[s++],this.ibufType,this.partGroup[s++]);break;case r.RenderDrawMode.ELEMENTS_TRIANGLE_STRIP:i.drawElements(t.TRIANGLE_STRIP,this.ivsCount,this.ibufType,this.drawOffset);break;case r.RenderDrawMode.ELEMENTS_INSTANCED_TRIANGLES:i.drawElementsInstanced(t.TRIANGLES,this.ivsCount,this.ibufType,this.drawOffset,this.insCount);break;case r.RenderDrawMode.ELEMENTS_TRIANGLE_FAN:i.drawElements(t.TRIANGLE_FAN,this.ivsCount,this.ibufType,this.drawOffset);break;case r.RenderDrawMode.ARRAYS_LINES:i.drawArrays(t.LINES,this.ivsIndex,this.ivsCount);break;case r.RenderDrawMode.ARRAYS_LINE_STRIP:i.drawArrays(t.LINE_STRIP,this.ivsIndex,this.ivsCount);break;default:break}}run2(t){null!=this.ubo&&this.ubo.run(t),this.shader.useTransUniform(this.transUniform),this.shader.useUniform(this.uniform),this.testDrawFlag()}run(t){null!=this.ubo&&this.ubo.run(t),this.vro.run(),this.tro.run(),this.shader.useTransUniform(this.transUniform),this.shader.useUniform(this.uniform),this.testDrawFlag()}runLockMaterial2(t){this.testDrawFlag(),this.shader.useUniform2ToCurrentShd(null==t?this.uniform:t,this.transUniform)}runLockMaterial(){this.vro.run(),this.testDrawFlag(),this.shader.useUniform2ToCurrentShd(this.uniform,this.transUniform)}reset(){this.indicesRes=null,this.polygonOffset=null,this.vro.__$detachThis(),this.vro=null,this.tro.__$detachThis(),this.tro=null,this.texMid=-1,this.__$rprouid=-1,this.ubo=null,this.shdUid=-1,this.vtxUid=-1,this.uniform=null,this.transUniform=null,this.partGroup=null,this.ivsIndex=0,this.ivsCount=0,this.insCount=0,this.partTotal=0,this.drawMode=0,this.drawFlag=0,this.renderState=0,this.rcolorMask=0,this.drawEnabled=!0,this.shader=null,this.bounds=null,this.pos=null}destroy(){this.reset()}toString(){return"[RPOUnit(uid = "+this.uid+")]"}}e.default=l},c711:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("8e17")),h=i(s("c120")),n=s("e160");class l{constructor(){this.B3=null,this.Ar=null,this.CK=null,this.CL=null,this.CM=new Uint8Array(256),this.CN=null,this.CO=null,this.CP=0,this.CQ=0,this.CR=new a.default,this.CS=new a.default,this.BS=null,this.BT=null,this.CT=new Uint8Array(4),this.CU=new a.default,this.CV=new a.default,this.CW=[null,null],this.CX=!1}setRenderer(t){this.B3=t}setRayTestMode(t){this.CQ=t}setRay(t,e){this.BS=t,this.BT=e}getRay(t,e){t.copyFrom(this.BS),e.copyFrom(this.BT)}setCamera(t){this.Ar=t}setCullingNodeHead(t){if(this.CK=t,null==this.CN){this.CN=[];let t=0;for(;t<256;++t)this.CN.push(new h.default)}}getSelectedNode(){return this.CO}getSelectedNodes(){return this.CN}getSelectedNodesTotal(){return this.CP}sorting(t,e){let s=this.CN;this.CL=s[t];while(t<e){while(t<e&&s[e].dis>=this.CL.dis)--e;s[t]=s[e];while(t<e&&s[t].dis<=this.CL.dis)++t;s[e]=s[t]}return s[t]=this.CL,t}snsort(t,e){if(t<e){let s=this.sorting(t,e);this.snsort(t,s-1),this.snsort(s+1,e)}}run(){let t=this.CK;if(null!=t){let e=0,s=this.BT,i=this.BS,h=this.CV,l=null,_=0;Math.abs(s.x)>r.default.MATH_MIN_POSITIVE?this.CU.x=1/s.x:this.CU.x=r.default.MATH_MAX_POSITIVE,Math.abs(s.y)>r.default.MATH_MIN_POSITIVE?this.CU.y=1/s.y:this.CU.y=r.default.MATH_MAX_POSITIVE,Math.abs(s.z)>r.default.MATH_MIN_POSITIVE?this.CU.z=1/s.z:this.CU.z=r.default.MATH_MAX_POSITIVE,this.CU.x<0?this.CT[0]=1:this.CT[0]=0,this.CU.y<0?this.CT[1]=1:this.CT[1]=0,this.CU.z<0?this.CT[2]=1:this.CT[2]=0;while(null!=t)t.drawEnabled&&t.entity.mouseEnabled&&(h.x=t.bounds.center.x-i.x,h.y=t.bounds.center.y-i.y,h.z=t.bounds.center.z-i.z,e=h.dot(s),h.x-=e*s.x,h.y-=e*s.y,h.z-=e*s.z,h.getLengthSquared()<=t.bounds.radius2&&t.rayTestState<1&&(this.CW[0]=t.bounds.min,this.CW[1]=t.bounds.max,n.AABBCalc.IntersectionRL3(this.CW,this.CT,this.CU,s,i,h)&&(l=this.CN[_],l.entity=t.entity,l.dis=this.CU.w,l.wpv.copyFrom(h),++_))),t=t.next;this.CO=null;let o=0;if(_>0){let t=this.CR,e=this.CS,n=null,l=0,m=0,u=null,d=null;if(_>1){let c=!this.CX;for(o=0;o<_;++o)d=this.CN[o],d.dis=r.default.MATH_MAX_POSITIVE,d.flag=0,n=this.CN[o].entity,n.isPolyhedral()?c?(u=n.getInvMatrix(),u.transformOutVector3(i,t),u.deltaTransformOutVector(s,e),e.normalize(),l=n.testRay(t,e,h,!0)):l=0:(u=n.getInvMatrix(),u.transformOutVector3(i,t),u.deltaTransformOutVector(s,e),e.normalize(),l=n.testRay(t,e,h,!0)),l>0?(d.flag=l,d.lpv.copyFrom(h),n.getMatrix().transformOutVector3(h,d.wpv),d.dis=a.default.Distance(d.wpv,i),this.CM[m]=o,++m):l<0&&(this.CM[m]=o,++m);for(this.snsort(0,_-1),o=0;o<_;++o)if(this.CN[o].flag>0){this.CO=this.CN[o];break}}else d=this.CN[0],d.dis=r.default.MATH_MAX_POSITIVE,n=this.CN[0].entity,u=n.getInvMatrix(),u.transformOutVector3(i,t),u.deltaTransformOutVector(s,e),e.normalize(),l=n.testRay(t,e,h,!0),l>0?(d.lpv.copyFrom(h),n.getMatrix().transformOutVector3(h,d.wpv),d.dis=a.default.Distance(d.wpv,i),this.CO=d):l<0&&(this.CO=d)}for(o=_;o<this.CP;++o)this.CO!=this.CN[o]&&(this.CN[o].entity=null);this.CP=_}}clear(){this.CO=null}}e.default=l},ca6c:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static PushThreeBitValueToInt(t,e){return(t<<3)+e}static PopThreeBitValueFromInt(t){return i.value=7&t,t>>3}static ContainsBit(t,e){return(e&t)>0}static RemoveBit(t,e){return~e&t}static AddBit(t,e){return e|t}static AssembleFromIntArray(t){let e=0,s=0,i=t.length;for(;e<i;++e)t[e]>0&&(s|=1<<e);return s}}i.BIT_ZERO=0,i.BIT_ONE_0=1,i.BIT_ONE_1=2,i.BIT_ONE_2=4,i.BIT_ONE_3=8,i.BIT_ONE_4=16,i.BIT_ONE_5=32,i.BIT_ONE_6=64,i.BIT_ONE_7=128,i.BIT_ONE_8=256,i.BIT_ONE_9=512,i.BIT_ONE_10=1024,i.BIT_ONE_11=2048,i.value=0,e.default=i},cc48:function(t,e,s){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t["NONE"]=0]="NONE",t[t["CAMERA"]=1]="CAMERA",t[t["POV"]=2]="POV",t[t["INNER_POV_PASS"]=3]="INNER_POV_PASS",t[t["CAMERA_AND_POV"]=4]="CAMERA_AND_POV"}(i||(i={})),e.SpaceCullingMask=i},ccdf:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("8d98"),a=i(s("cfaf")),h=i(s("acaa")),n=i(s("85b6")),l=i(s("3b73"));class _{constructor(t){this.Z=null,this.D2=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.D3=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.D4=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.D5=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.Z=t}getRenderProxy(){return this.Z}createWrapperTex(t,e,s=!1){let i=new n.default(t,e,s);return i}createRTTTex2D(t,e,s=!1){let i=new a.default(t,e,s);return i}createDepthTex2D(t,e,s=!1){let i=new h.default(t,e,s);return i}getCubeRTTTextureAt(t){return null!=this.D3[t]?(this.D3[t].__$setRenderProxy(this.Z),this.D3[t]):(this.D3[t]=this.createRTTTex2D(32,32),this.D3[t].toCubeTexture(),this.D3[t].name="sys_cube_rttTex_"+t,this.D3[t].minFilter=r.TextureConst.LINEAR,this.D3[t].magFilter=r.TextureConst.LINEAR,this.D3[t].__$setRenderProxy(this.Z),this.D3[t])}createCubeRTTTextureAt(t,e,s){return e=e>1?e:1,s=s>1?s:1,null!=this.D3[t]?(this.D3[t].__$setRenderProxy(this.Z),this.D3[t]):(this.D3[t]=this.createRTTTex2D(e,s),this.D3[t].toCubeTexture(),this.D3[t].name="sys_cube_rttTex_"+t,this.D3[t].minFilter=r.TextureConst.LINEAR,this.D3[t].magFilter=r.TextureConst.LINEAR,this.D3[t].__$setRenderProxy(this.Z),this.D3[t])}getRTTTextureAt(t){return null!=this.D2[t]?(this.D2[t].__$setRenderProxy(this.Z),this.D2[t]):(this.D2[t]=this.createRTTTex2D(32,32),this.D2[t].to2DTexture(),this.D2[t].name="sys_rttTex_"+t,this.D2[t].minFilter=r.TextureConst.LINEAR,this.D2[t].magFilter=r.TextureConst.LINEAR,this.D2[t].__$setRenderProxy(this.Z),this.D2[t])}createRTTTextureAt(t,e,s){return e=e>1?e:1,s=s>1?s:1,null!=this.D2[t]?(this.D2[t].__$setRenderProxy(this.Z),this.D2[t]):(this.D2[t]=this.createRTTTex2D(e,s),this.D2[t].to2DTexture(),this.D2[t].name="sys_rttTex_"+t,this.D2[t].minFilter=r.TextureConst.LINEAR,this.D2[t].magFilter=r.TextureConst.LINEAR,this.D2[t].__$setRenderProxy(this.Z),this.D2[t])}getDepthTextureAt(t){return null!=this.D5[t]?(this.D5[t].__$setRenderProxy(this.Z),this.D5[t]):(this.D5[t]=this.createDepthTex2D(64,64),this.D5[t].to2DTexture(),this.D5[t].name="sys_depthTex_"+t,this.D5[t].minFilter=r.TextureConst.NEAREST,this.D5[t].magFilter=r.TextureConst.NEAREST,this.D5[t].__$setRenderProxy(this.Z),this.D5[t])}createDepthTextureAt(t,e,s){return e=e>1?e:1,s=s>1?s:1,null!=this.D5[t]?(this.D5[t].__$setRenderProxy(this.Z),this.D5[t]):(this.D5[t]=this.createDepthTex2D(e,s),this.D5[t].to2DTexture(),this.D5[t].name="sys_depthTex_"+t,this.D5[t].__$setRenderProxy(this.Z),this.D5[t])}getRTTFloatTextureAt(t){if(null!=this.D4[t])return this.D4[t].__$setRenderProxy(this.Z),this.D4[t];let e=this.createRTTTex2D(64,64);return e.to2DTexture(),this.D4[t]=e,this.D4[t].name="sys_rttFloatTex_"+t,e.internalFormat=r.TextureFormat.RGBA16F,e.srcFormat=r.TextureFormat.RGBA,e.dataType=r.TextureDataType.FLOAT,e.minFilter=r.TextureConst.NEAREST,e.magFilter=r.TextureConst.NEAREST,l.default.IsWebGL1()&&(e.dataType=r.TextureDataType.HALF_FLOAT_OES),this.D4[t].__$setRenderProxy(this.Z),e}createRTTFloatTextureAt(t,e,s){if(e=e>1?e:1,s=s>1?s:1,null!=this.D4[t])return this.D4[t].__$setRenderProxy(this.Z),this.D4[t];let i=this.createRTTTex2D(e,s);return i.to2DTexture(),this.D4[t]=i,this.D4[t].name="sys_rttFloatTex_"+t,i.internalFormat=r.TextureFormat.RGBA16F,i.srcFormat=r.TextureFormat.RGBA,i.dataType=r.TextureDataType.FLOAT,i.minFilter=r.TextureConst.NEAREST,i.magFilter=r.TextureConst.NEAREST,l.default.IsWebGL1()&&(i.dataType=r.TextureDataType.HALF_FLOAT_OES),this.D4[t].__$setRenderProxy(this.Z),i}}e.RTTTextureStore=_},cfaf:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("7918"),a=s("8d98"),h=i(s("0851"));class n extends h.default{constructor(t,e,s=!1){super(t,e,s),this.j=r.TextureProxyType.RTT,this.minFilter=a.TextureConst.NEAREST,this.magFilter=a.TextureConst.NEAREST}to2DTexture(){this.g=a.TextureTarget.TEXTURE_2D}toCubeTexture(){this.g=a.TextureTarget.TEXTURE_CUBE}setSize(t,e){this.c=t,this.d=e}enableMipmap(){this.minFilter=a.TextureConst.LINEAR_MIPMAP_LINEAR,this.magFilter=a.TextureConst.LINEAR,this.mipmapEnabled=!0}disableMipmap(){this.minFilter=a.TextureConst.NEAREST,this.magFilter=a.TextureConst.NEAREST,this.mipmapEnabled=!1}uploadFromFbo(t,e,s){let i=t.getRC(),r=this.mipmapEnabled;this.mipmapEnabled=!1,t.hasResUid(this.getResUid())?this.getBufWidth()==e&&this.getBufHeight()==s||(t.bindToGpu(this.getResUid()),this.bindTexture(i,e,s),this.c=e,this.d=s,this.__$buildParam(i)):(this.h=a.TextureTarget.GetValue(i,this.g),this.createTexBuf(t),t.bindToGpu(this.getResUid()),this.bindTexture(i,e,s),this.i=!0,this.c=e,this.d=s,this.__$buildParam(i)),this.mipmapEnabled=r}bindTexture(t,e,s){let i=a.TextureFormat.ToGL(t,this.internalFormat),r=a.TextureFormat.ToGL(t,this.srcFormat),h=a.TextureDataType.ToGL(t,this.dataType);switch(this.g){case a.TextureTarget.TEXTURE_2D:t.texImage2D(t.TEXTURE_2D,0,i,e,s,0,r,h,null);break;case a.TextureTarget.TEXTURE_CUBE:for(let a=0;a<6;++a)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+a,0,i,e,s,0,r,h,null);break;case a.TextureTarget.TEXTURE_SHADOW_2D:t.texImage2D(t.TEXTURE_2D,0,t.DEPTH_COMPONENT16,e,s,0,t.DEPTH_COMPONENT,t.FLOAT,null);break;default:break}}toString(){return"[RTTTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=n},d314:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("7918"),a=s("8d98"),h=i(s("0851"));class n extends h.default{constructor(t,e){super(t,e,!1),this.BI=null,this.g=a.TextureTarget.TEXTURE_CUBE,this.j=r.TextureProxyType.ImageCube,this.internalFormat=a.TextureFormat.RGBA,this.srcFormat=a.TextureFormat.RGBA,this.dataType=a.TextureDataType.UNSIGNED_BYTE,this.mipmapEnabled=!0}setDataFromImageToFaceAt(t,e,s=0){null!=e&&(null==this.BI&&(this.BI=[null,null,null,null,null,null]),e.width>0&&e.height>0&&(0==t&&(this.c=e.width,this.d=e.height,this.b=s),this.BI[t]={imgData:e,miplevel:s},this.i=null!=this.BI[t]))}uploadData(t){let e=t.getRC(),s=null;for(let i=0;i<6;++i)s=this.BI[i],e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+i,this.b,a.TextureFormat.ToGL(e,this.internalFormat),a.TextureFormat.ToGL(e,this.srcFormat),a.TextureDataType.ToGL(e,this.dataType),s.imgData)}toString(){return"[ImageCubeTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}__$destroy(){if(this.getAttachCount()<1){if(null!=this.BI)for(let t=0;t<6;++t)null!=this.BI[t]&&(this.BI[t].imgData=null);super.__$destroy()}}}e.default=n},d53d:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.uns="",this.program=null,this.types=null,this.uniformSize=0,this.uniformNameList=null,this.locations=null,this.dataSizeList=null,this.dataList=null,this.calcModels=null,this.always=!0,this.next=null}getDataRefFromUniformName(t){if(null!=this.uniformNameList){let e=this.uniformNameList,s=e.length;for(let i=0;i<s;++i)if(t==e[i])return this.dataList[i]}return null}setDataRefFromUniformName(t,e){if(null!=this.uniformNameList){let s=this.uniformNameList,i=s.length;for(let r=0;r<i;++r)if(t==s[r]){this.dataList[r]=e;break}}}copyDataFromProbe(t){this.types=[],this.dataSizeList=[];for(let e=0;e<t.uniformsTotal;++e)this.types.push(t.uniformTypes[e]),this.dataSizeList.push(t.dataSizeList[e]);this.uniformSize=t.uniformsTotal}useByLocation(t,e,s,i){}useByShd(t,e){}use(t){}updateData(){}destroy(){}}e.ShaderUniform=i;class r extends i{constructor(){super()}use(t){let e=0;for(;e<this.uniformSize;++e)t.useUniformV1(this.locations[e],this.types[e],this.dataList[e],this.dataSizeList[e])}useByLocation(t,e,s,i){t.useUniformV1(s,e,this.dataList[i],this.dataSizeList[i])}useByShd(t,e){let s=0;for(;s<this.uniformSize;++s)t.useUniformV1(e.getUniformLocationByNS(this.uniformNameList[s]),this.types[s],this.dataList[s],this.dataSizeList[s])}updateData(){if(null!=this.calcModels){let t=this.calcModels.length,e=null;for(let s=0;s<t;++s)e=this.calcModels[s],e.buildData(),e.updateMaterialDataList(this.dataList),e.initializeParam()}}destroy(){let t=0,e=this.dataList.length;for(;t<e;++t)this.dataList[t]=null;if(null!=this.calcModels)for(e=this.calcModels.length,t=0;t<e;++t)this.calcModels[t].destroy(),this.calcModels[t]=null;this.dataList=null,this.types=null,this.locations=null,this.dataSizeList=null,this.calcModels=null}}e.ShaderUniformV1=r;class a extends i{constructor(){super()}use(t){let e=0;for(;e<this.uniformSize;++e)t.useUniformV2(this.locations[e],this.types[e],this.dataList[e],this.dataSizeList[e],0)}useByLocation(t,e,s,i){t.useUniformV2(s,e,this.dataList[i],this.dataSizeList[i],0)}useByShd(t,e){let s=0;for(;s<this.uniformSize;++s)t.useUniformV2(e.getUniformLocationByNS(this.uniformNameList[s]),this.types[s],this.dataList[s],this.dataSizeList[s],0)}updateData(){if(null!=this.calcModels){let t=this.calcModels.length,e=null;for(let s=0;s<t;++s)e=this.calcModels[s],e.buildData(),e.updateMaterialDataList(this.dataList),e.initializeParam()}}destroy(){let t=0,e=this.dataList.length;for(;t<e;++t)this.dataList[t]=null;if(null!=this.calcModels)for(e=this.calcModels.length,t=0;t<e;++t)this.calcModels[t].destroy(),this.calcModels[t]=null;this.dataList=null,this.types=null,this.locations=null,this.dataSizeList=null,this.calcModels=null,this.program=null}}e.ShaderUniformV2=a;class h extends i{constructor(){super()}use(t){t.useUniformMat4(this.locations[0],this.dataList[0])}useByLocation(t,e,s,i){t.useUniformMat4(s,this.dataList[0])}useByShd(t,e){t.useUniformMat4(e.getUniformLocationByNS(this.uniformNameList[0]),this.dataList[0])}destroy(){this.dataList[0]=null,this.dataList=null,this.types=null,this.locations=null,this.dataSizeList=null}}e.ShaderMat4Uniform=h,e.default=i},d7e2:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17"));class a{constructor(t){this.AM=null,this.AM=t}sortRODisplay(t,e){let s=this.AM.getCamera().getPosition();for(let i=0;i<e;++i)t[i].value=-r.default.DistanceSquared(t[i].bounds.center,s);return 0}}e.default=a},d872:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("5326"),a=i(s("3077")),h=i(s("3024")),n=i(s("7279"));class l{constructor(t,e=256){this.A=0,this.D6=null,this.A=t,this.D6=new r.UniformDataSlot(t,e)}getRCUid(){return this.A}createShaderUniformProbe(){let t=new a.default(this.D6);return t}createUniformVec4Probe(t){let e=new h.default(this.D6,t);return e}createGlobalUinformFromProbe(t,e=null){let s=this.createShaderGlobalUniform();return this.updateGlobalUinformDataFromProbe(s,t,e),s}updateGlobalUinformDataFromProbe(t,e,s=null){let i=t;i.uniformNameList=null!=s?s:e.uniformNames,i.copyDataFromProbe(e),e.update()}createShaderGlobalUniform(){let t=new n.default(this.D6);return t}createShaderGlobalUniformFromProbe(t,e,s=null){let i=new n.default(this.D6);return i.uns=e,i.uniformNameList=null!=s?s:t.uniformNames,i.copyDataFromProbe(t),t.update(),i}createShaderGlobalUniformFromProbeAt(t,e,s=null,i){let r=new n.default(this.D6);return r.uns=e,r.uniformNameList=null!=s?s:t.uniformNames,i<0?r.copyDataFromProbe(t):r.copyDataFromProbeAt(i,t),t.update(),r}cloneShaderGlobalUniform(t){let e=t;return e.clone()}}e.ShaderUniformContext=l},d958:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("11e6")),a=s("d872"),h=i(s("36cb")),n=i(s("c497")),l=i(s("3c81")),_=i(s("1e15")),o=s("0e01"),m=s("eca0"),u=i(s("442e")),d=i(s("1264"));class c{constructor(){this.___$$$$$$$Author="VilyLei(vily313@126.com)",this.T=-1,this.D7=null,this.D8=[],this.D9=0,this.D_A=[],this.D_B=0,this.Z=null,this.K_=null,this.AA=null,this.D_C=null,this.A_I=!0,this.D_D=!0,this.z_=new m.RPOUnitBuilder,this.A_G=new u.default,this.AB=new l.default,this.D_E=null,this.Aq=null,this.D_F=null,this.T=c.EM++,this.D_C=new o.RendererInstanceContext(this.T)}__$setStage3D(t){null!=t&&null==this.Aq&&(this.Aq=t)}getUid(){return this.T}getRCUid(){return this.T}getRPONodeBuilder(){return this.A_G}getDataBuilder(){return this.AA}getRendererContext(){return this.D_C}getRenderProxy(){return null!=this.Z||(this.Z=this.D_C.getRenderProxy()),this.Z}getStage3D(){return this.Z.getStage3D()}getViewX(){return this.K_.getViewportX()}getViewY(){return this.K_.getViewportY()}getViewWidth(){return this.K_.getViewportWidth()}getViewHeight(){return this.K_.getViewportHeight()}getCamera(){return this.D_C.getCamera()}createCamera(){return null}useCamera(t,e=!1){}useMainCamera(){}updateCamera(){null!=this.Z&&this.Z.updateCamera()}initialize(t=null,e=null,s=null){if(null==this.AA&&null!=e){null==t&&(t=new n.default),this.A_I=t.batchEnabled,this.D_D=t.processFixedState,this.Z=this.D_C.getRenderProxy(),this.T=this.Z.getUid(),this.AA=new h.default(s),this.D_E=new _.default,this.D_C.setCameraParam(t.camProjParam.x,t.camProjParam.y,t.camProjParam.z);let i=new o.RendererInstanceContextParam;i.uniformContext=new a.ShaderUniformContext(this.Z.getRCUid()),i.camera=e,i.stage=this.Aq,i.builder=this.AA,i.vtxBuilder=this.D_E,i.shaderProgramBuilder=s,this.D_C.initialize(t,e,i),this.K_=this.Z.getRenderAdapter(),this.AA.initialize(this.Z,this.z_,this.AB,this.D_E),this.D_C.initManager(this.AA),this.D7=new d.default(this.T,this.AA,this.z_,this.AB),this.D_F=this.createSeparatedProcess(),this.appendProcess(this.A_I,this.D_D)}}getRendererStatus(){return this.D7.version}update(){this.Z.Texture.update(),this.Z.Vertex.update(),this.D7.update()}updateAllProcess(){for(let t=0;t<this.D9;++t)this.D8[t].update()}updateProcessAt(t){t>-1&&t<this.D9&&this.D8[t].update()}setEntityManaListener(t){this.D7.setListener(t)}addEntity(t,e=0,s=!0){null!=t&&t.__$testRendererEnabled()&&e>-1&&e<this.D9&&this.D7.addEntity(t,this.D8[e].getUid(),s)}addEntityToProcess(t,e,s=!0){null!=e&&null!=t&&t.__$testRendererEnabled()&&e.getRCUid()==this.T&&this.D7.addEntity(t,e.getUid(),s)}moveEntityToProcessAt(t,e){if(null!=t&&t.getRendererUid()==this.T&&t.isInRendererProcess()&&e>-1&&e<this.D9){let s=t.getDisplay().__$$runit.getRPROUid(),i=this.AB.getNodeByUid(s),a=this.D8[e];i!=a&&(i.removeDispUnit(t.getDisplay()),t.__$rseFlag=a.getSortEnabled()?r.default.AddSortEnabled(t.__$rseFlag):r.default.RemoveSortEnabled(t.__$rseFlag),a.addDisp(t.getDisplay()))}}moveEntityToProcess(t,e){if(null!=e&&null!=t&&t.getRendererUid()==this.T&&t.isInRendererProcess()){let s=t.getDisplay().__$$runit.getRPROUid(),i=this.AB.getNodeByUid(s);if(i!=e){let s=e;i.removeDispUnit(t.getDisplay()),t.__$rseFlag=e.getSortEnabled()?r.default.AddSortEnabled(t.__$rseFlag):r.default.RemoveSortEnabled(t.__$rseFlag),s.addDisp(t.getDisplay())}}}removeEntity(t){null!=t&&t.getRendererUid()==this.T&&(this.D7.removeEntity(t),t.__$setRenderProxy(null))}removeEntityFromProcess(t,e){null!=e&&e.getRCUid()==this.T&&null!=t&&t.getRendererUid()==this.T&&(e.removeDisp(t.getDisplay()),t.__$setRenderProxy(null))}removeEntityByProcessIndex(t,e){e>=0&&e<this.D9&&null!=t&&t.getRendererUid()==this.T&&(this.D8[e].removeDisp(t.getDisplay()),t.__$setRenderProxy(null))}setProcessSortEnabledAt(t,e){t>=0&&t<this.D9&&this.D8[t].setSortEnabled(e)}setProcessSortEnabled(t,e){if(null!=t&&t.getRCUid()==this.T){let s=t;s.setSortEnabled(e)}}getRenderProcessAt(t){return this.D8[t]}appendProcess(t=!0,e=!1){this.AB.setCreateParams(this.AA.getRenderShader(),this.A_G,this.z_,this.Z.Vertex,t,e);let s=this.AB.create();return this.D8.push(s),s.setRendererParam(this.Z,this.D9),++this.D9,s}createSeparatedProcess(t=!0,e=!1){this.AB.setCreateParams(this.AA.getRenderShader(),this.A_G,this.z_,this.Z.Vertex,t,e);let s=this.AB.create();return this.D_A.push(s),s.setRendererParam(this.Z,this.D_B),s}setRendererProcessParam(t,e,s){t>-1&&t<this.D9&&this.D8[t].setRenderParam(e,s)}getProcessAt(t){return t>-1&&t<this.D9?this.D8[t]:null}showInfoAt(t){t>-1&&t<this.D9&&this.D8[t].showInfo()}getProcessesTotal(){return this.D9}updateMaterialUniformToCurrentShd(t){this.AA.getRenderShader().useUniformToCurrentShd(t.__$uniform)}drawEntityByLockMaterial(t,e=!1,s=!0){null!=t&&t.getVisible()&&t.getRendererUid()==this.T&&!this.Z.isContextLost()&&this.D_F.drawLockMaterialByDisp(t.getDisplay(),e,s)}drawEntity(t,e=!1,s=!0){null!=t&&t.getVisible()&&!this.Z.isContextLost()&&(t.getRendererUid()==this.T?this.D_F.drawDisp(t.getDisplay(),e,s):t.__$testRendererEnabled()&&this.D7.addEntity(t,this.D_F.getUid(),!1))}runAt(t){this.Z.isContextLost()||this.D8[t].run()}runProcess(t){t.getRCUid()!=this.T||this.Z.isContextLost()||t.run()}runFromIndexTo(t){if(!this.Z.isContextLost())for(let e=t;e<this.D9;++e)this.D8[e].run()}run(){if(this.D7.isHaveEntity()&&!this.Z.isContextLost())for(let t=0;t<this.D9;++t)this.D8[t].run()}getRenderUnitsTotal(){let t=0;for(let e=0;e<this.D9;++e)t+=this.D8[e].getUnitsTotal();return t}renderflush(){this.Z.flush()}toString(){return"[RendererInstance(uid = "+this.T+")]"}}c.EM=0,e.RendererInstance=c,e.default=c},da6a:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){if(this.Z_=null,this.D_G=null,this.D_H=0,this.D_I=new Map,this.B_V=new Map,this.D_J=0,this.D_K=[],null!=i.E_C)throw Error("This Class is a singleton class!!!");i.E_C=null}static GetInstance(){return null!=i.E_C||(i.E_C=new i),i.E_C}getFreeUid(){if(this.D_K.length>0)return this.D_K.pop();let t=this.D_J++;return t}__$$addTexture(t){null==t||this.D_I.has(t.getUid())||(this.D_I.set(t.getUid(),t),this.D_H++)}getTextureByUid(t){return this.D_I.get(t)}hasTextureByUid(t){return this.D_I.has(t)}removeTextureByUid(t){if(this.D_I.has(t)){let e=this.D_I.get(t);if(e.getAttachCount()<1)return this.B_V.has(t)&&this.B_V.delete(t),e.__$destroy(),e.__$$removeFromSlot(),this.D_I.delete(t),this.D_K.push(t),this.D_H--,e}return null}getTextureTotal(){return this.D_H}setRenderProxy(t){this.Z_=t.Texture}setBufferUpdater(t){this.D_G=t}getFreeResUidMap(){return this.B_V}isGpuEnabledByResUid(t){return this.Z_.hasResUid(t)}addRenderBuffer(t,e){null!=this.D_G&&this.D_G.__$addBuf(t,e)}addFreeUid(t){this.B_V.set(t,0)}removeFreeUid(t){this.B_V.has(t)&&this.B_V.delete(t)}}i.E_C=null,e.default=i},da82:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("f444")),a=i(s("a46e")),h=i(s("8e17")),n=i(s("53ea"));class l{constructor(){this.BD=null,this.stageDragCtrl=new r.default,this.cameraZoomController=new a.default,this.zoomLookAtPosition=null,this.zoomMinDistance=30,this.viewRay=new n.default,this.cameraCtrlEnabled=!0}initialize(t){null==this.BD&&(this.BD=t,this.viewRay.bindCameraAndStage(t.getCamera(),t.getStage3D()),this.viewRay.setPlaneParam(new h.default(0,1,0),0),t.enableMouseEvent(!0),this.stageDragCtrl.initialize(t.getStage3D(),t.getCamera()),this.cameraZoomController.bindCamera(t.getCamera()),this.cameraZoomController.initialize(t.getStage3D()),this.cameraZoomController.setLookAtCtrlEnabled(!1))}run(){this.cameraCtrlEnabled&&(this.cameraZoomController.run(this.zoomLookAtPosition,this.zoomMinDistance),this.stageDragCtrl.runWithYAxis())}}e.UserInteraction=l},de9d:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("8e17")),h=i(s("e2fe")),n=i(s("722e")),l=i(s("8333")),_=s("7c63"),o=s("070b"),m=s("a5ba"),u=i(s("090c")),d=i(s("1216")),c=i(s("56c5")),f=i(s("030e")),p=i(s("74c3")),g=i(s("984e")),T=i(s("29ef")),E=s("8171"),x=i(s("919c")),S=s("e602"),R=s("53d3");class y{constructor(){this.materialUpdater=null,this.vtxBufUpdater=null,this.vtxBuilder=null,this.uniformContext=null}}e.RenderProxyParam=y;class A{constructor(t){this.RGBA=0,this.UNSIGNED_BYTE=0,this.TRIANGLE_STRIP=0,this.TRIANGLE_FAN=0,this.TRIANGLES=0,this.LINES=0,this.LINE_STRIP=0,this.UNSIGNED_SHORT=0,this.UNSIGNED_INT=0,this.COLOR=0,this.DEPTH=0,this.STENCIL=0,this.DEPTH_STENCIL=0,this.MAX=0,this.MIN=0,this.RContext=null,this.RDrawState=null,this.Vertex=null,this.Texture=null,this.VtxBufUpdater=null,this.MaterialUpdater=null,this.uniformContext=null,this.adapter=null,this.stencil=null,this.renderingState=null,this.colorMask=null,this.T=0,this.D_L=null,this.K_=null,this.D_M=new u.default,this.AM=null,this.B_G=!0,this.u=new h.default(0,0,800,600),this.M_=.1,this.N_=5e3,this.O_=45,this.v=2,this.D_N=2,this.Ar=null,this.D_O=!1,this.D_P=!0,this.D_Q=!0,this.T=t}getRC(){return this.AM}getUid(){return this.T}getRCUid(){return this.T}isAutoSynViewAndStage(){return this.D_P}enableSynViewAndStage(){this.D_P=!0}lockViewport(){this.K_.lockViewport()}unlockViewport(){this.K_.unlockViewport()}getDiv(){return this.K_.getDiv()}getCanvas(){return this.K_.getCanvas()}cameraLock(){this.Ar.lock()}cameraUnlock(){this.Ar.unlock()}getCamera(){return this.Ar}updateCamera(){return this.Ar.update()}createCameraUBO(t){}updateCameraDataFromCamera(t){null!=t&&(this.D_O||t!=this.Ar)&&(this.D_O=t!=this.Ar,t.updateCamMatToUProbe(this.Ar.matUProbe),null!=this.D_L&&(this.D_L.setSubDataArrAt(0,t.matUProbe.getFS32At(0)),this.D_L.setSubDataArrAt(16,t.matUProbe.getFS32At(1))))}useCameraData(){null!=this.D_L&&this.D_L.run()}getActiveAttachmentTotal(){return this.K_.getActiveAttachmentTotal()}drawInstanced(t,e,s){2==this.D_N?this.AM.drawElementsInstanced(this.TRIANGLES,t,this.UNSIGNED_SHORT,e,s):f.default.ANGLE_instanced_arrays.drawElementsInstancedANGLE(this.TRIANGLES,t,e,s)}createUBOBufferByBytesCount(t){let e=this.AM.createBuffer();return this.AM.bindBuffer(this.AM.UNIFORM_BUFFER,e),this.AM.bufferData(this.AM.UNIFORM_BUFFER,t,this.AM.DYNAMIC_DRAW),e}createUBOBufferByDataArray(t){let e=this.AM.createBuffer();return this.AM.bindBuffer(this.AM.UNIFORM_BUFFER,e),this.AM.bufferData(this.AM.UNIFORM_BUFFER,t,this.AM.DYNAMIC_DRAW),e}bindUBOBuffer(t){this.AM.bindBuffer(this.AM.UNIFORM_BUFFER,t)}deleteUBOBuffer(t){this.AM.deleteBuffer(t)}bufferDataUBOBuffer(t){this.AM.bufferData(this.AM.UNIFORM_BUFFER,t,this.AM.STATIC_DRAW)}bindBufferBaseUBOBuffer(t,e){this.AM.bindBufferBase(this.AM.UNIFORM_BUFFER,t,e)}setWebGLMaxVersion(t){1!=t&&2!=t||(this.v=t)}getContext(){return this.D_M}getStage3D(){return this.D_M.getStage()}getRenderAdapter(){return this.K_}getRenderContext(){return this.K_.getRenderContext()}setCameraParam(t,e,s){this.O_=t,this.M_=e,this.N_=s}getMouseXYWorldRay(t,e){let s=this.D_M.getStage();this.Ar.getWorldPickingRayByScreenXY(s.mouseX,s.mouseY,t,e)}testViewPortChanged(t,e,s,i){return this.u.testEqualWithParams(t,e,s,i)}testRCViewPortChanged(t,e,s,i){return this.D_M.testViewPortChanged(t,e,s,i)}getViewX(){return this.u.x}getViewY(){return this.u.y}getViewWidth(){return this.u.width}getViewHeight(){return this.u.height}setViewPort(t,e,s,i){this.D_P=!1,this.u.setTo(t,e,s,i);let r=this.D_M.getStage();null!=r&&(r.setViewPort(s,e,s,i),this.updateCameraView()),this.D_M.setViewport(t,e,s,i)}setRCViewPort(t,e,s,i,r=!1){this.D_P=r,this.D_M.setViewport(t,e,s,i)}reseizeRCViewPort(){this.K_.unlockViewport(),this.K_.reseizeViewPort()}updateCameraView(){if(null!=this.Ar){let t=this.u;this.Ar.setViewXY(t.x,t.y),this.Ar.setViewSize(t.width,t.height)}}resizeCallback(){if(this.D_P){let t=this.u;t.setSize(this.D_M.getRCanvasWidth(),this.D_M.getRCanvasHeight()),this.createMainCamera(),this.D_M.setViewport(t.x,t.y,t.width,t.height),this.updateCameraView()}}createMainCamera(){if(this.D_Q){this.D_Q=!1,this.Ar.uniformEnabled=!0;let t=this.u;this.B_G?this.Ar.perspectiveRH(r.default.DegreeToRadian(this.O_),t.width/t.height,this.M_,this.N_):this.Ar.orthoRH(this.M_,this.N_,-.5*t.height,.5*t.height,-.5*t.width,.5*t.width),this.updateCameraView()}}readPixels(t,e,s,i,r,a,h){this.K_.readPixels(t,e,s,i,r,a,h)}getGLVersion(){return this.D_N}buildCameraParam(){let t=this.Ar;null==t.matUProbe&&(t.matUProbe=this.uniformContext.createShaderUniformProbe(),t.matUProbe.addMat4Data(new Float32Array(16),1),t.matUProbe.addMat4Data(new Float32Array(16),1)),null==t.ufrustumProbe&&(t.ufrustumProbe=this.uniformContext.createShaderUniformProbe(),t.ufrustumProbe.addVec4Data(new Float32Array([t.getZNear(),t.getZFar(),.5*t.getNearPlaneWidth(),.5*t.getNearPlaneHeight()]),1)),null==t.ucameraPosProbe&&(t.ucameraPosProbe=this.uniformContext.createShaderUniformProbe(),t.ucameraPosProbe.addVec4Data(new Float32Array([500,500,500,1]),1))}initialize(t,e,s,i){if(null!=this.AM)return;this.Ar=e;let r=t.camPosition,h=t.camLookAtPos,o=t.camUpDirect;null==r&&(r=new a.default(800,800,800)),null==h&&(h=new a.default(0,0,0)),null==o&&(o=new a.default(0,1,0)),null!=s&&(s.uProbe=i.uniformContext.createUniformVec4Probe(1)),this.B_G=t.cameraPerspectiveEnabled,this.D_M.autoSyncRenderBufferAndWindowSize=t.autoSyncRenderBufferAndWindowSize,this.D_M.setResizeCallback(this,this.resizeCallback),this.D_M.setWebGLMaxVersion(this.v),this.D_M.initialize(this.T,s,t.getDiv(),t.getRenderContextAttri()),this.D_N=this.D_M.getWebGLVersion(),this.AM=this.D_M.getRC();let m=this,u=this.AM,y=new p.default(this.T,u,i.vtxBuilder),A=new g.default(this.T,u);this.A6=y,m.Vertex=y,m.Texture=A,m.MaterialUpdater=i.materialUpdater,m.VtxBufUpdater=i.vtxBufUpdater,m.uniformContext=i.uniformContext;let v=new _.RODrawState;v.setRenderContext(this.D_M),T.default.Initialize(v,new x.default),m.RState=v,m.RContext=this.AM,m.stencil=new E.Stencil(v),m.renderingState=new R.RenderingState,m.colorMask=new S.RenderingColorMask,this.buildCameraParam();let b=this.u;if(b.setSize(this.D_M.getRCanvasWidth(),this.D_M.getRCanvasHeight()),this.K_=new d.default(this.T,A),this.K_.initialize(this.D_M,t,v,this.uniformContext.createUniformVec4Probe(1)),m.adapter=this.K_,this.D_P){let t=this.D_M.getStage();null!=t&&b.setSize(b.width,b.height)}this.createMainCamera(),this.D_M.setViewport(b.x,b.y,b.width,b.height),this.Ar.lookAtRH(r,h,o),this.Ar.update(),this.K_.bgColor.setRGB3f(0,0,0),m.RGBA=u.RGBA,m.UNSIGNED_BYTE=u.UNSIGNED_BYTE,m.TRIANGLE_STRIP=u.TRIANGLE_STRIP,m.TRIANGLE_FAN=u.TRIANGLE_FAN,m.TRIANGLES=u.TRIANGLES,m.LINES=this.AM.LINES,m.LINE_STRIP=u.LINE_STRIP,m.UNSIGNED_SHORT=u.UNSIGNED_SHORT,m.UNSIGNED_INT=u.UNSIGNED_INT,m.COLOR=u.COLOR,m.DEPTH=u.DEPTH,m.STENCIL=u.STENCIL,m.DEPTH_STENCIL=u.DEPTH_STENCIL,this.D_N>1?(m.MIN=u.MIN,m.MAX=u.MAX):(m.MIN=f.default.EXT_blend_minmax.MIN_EXT,m.MAX=f.default.EXT_blend_minmax.MAX_EXT);let L=n.default;L.NEAREST=u.NEAREST,L.LINEAR=u.LINEAR,L.LINEAR_MIPMAP_LINEAR=u.LINEAR_MIPMAP_LINEAR,L.NEAREST_MIPMAP_NEAREST=u.NEAREST_MIPMAP_NEAREST,L.LINEAR_MIPMAP_NEAREST=u.LINEAR_MIPMAP_NEAREST,L.NEAREST_MIPMAP_LINEAR=u.NEAREST_MIPMAP_LINEAR;let M=l.default;M.COLOR_BUFFER_BIT=u.COLOR_BUFFER_BIT,M.DEPTH_BUFFER_BIT=u.DEPTH_BUFFER_BIT,M.STENCIL_BUFFER_BIT=u.STENCIL_BUFFER_BIT,c.default.SetRenderer(this.D_M)}flush(){this.AM.flush()}setClearRGBColor3f(t,e,s){this.K_.bgColor.setRGB3f(t,e,s)}setClearColor(t){this.K_.bgColor.copyFrom(t)}setClearUint24Color(t,e){this.K_.bgColor.setRGBUint24(t),this.K_.bgColor.a=e}setClearRGBAColor4f(t,e,s,i){this.K_.bgColor.setRGBA4f(t,e,s,i)}getClearRGBAColor4f(t){t.copyFrom(this.K_.bgColor)}getViewportWidth(){return this.K_.getViewportWidth()}getViewportHeight(){return this.K_.getViewportHeight()}setRenderToBackBuffer(){this.K_.setRenderToBackBuffer()}clearBackBuffer(){this.K_.clear()}clearDepth(t=1){this.K_.clearDepth(t)}renderBegin(){this.Ar.update(),this.K_.renderBegin()}renderEnd(){}useRenderStateByName(t){m.RenderStateObject.UseRenderStateByName(t)}setScissorEnabled(t){this.D_M.setScissorEnabled(t)}setScissorRect(t,e,s,i){this.D_M.setScissorRect(t,e,s,i)}useRenderColorMask(t){o.RenderColorMask.UseRenderState(t)}unlockRenderColorMask(){o.RenderColorMask.Unlock()}lockRenderColorMask(){o.RenderColorMask.Lock()}useRenderState(t){m.RenderStateObject.UseRenderState(t)}unlockRenderState(){m.RenderStateObject.Unlock()}lockRenderState(){m.RenderStateObject.Lock()}setVtxUpdateTimesTotal(t){this.A6.setVtxUpdateTimesTotal(t)}setFrontFaceFlipped(t){this.K_.setFrontFaceFlipped(t)}enabledPolygonOffset(){this.K_.enabledPolygonOffset()}disabledPolygonOffset(){this.K_.disabledPolygonOffset()}setPolygonOffset(t,e=0){this.K_.setPolygonOffset(t,e)}resetPolygonOffset(){this.K_.resetPolygonOffset()}loseContext(){this.K_.loseContext()}isContextLost(){return this.K_.isContextLost()}setViewProbeValue(t,e,s,i){this.K_.setViewProbeValue(t,e,s,i)}toString(){return"[Object RenderProxy()]"}}e.RenderProxy=A,e.default=A},df25:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("8d98"),a=i(s("68aa")),h=i(s("0851"));class n extends h.default{constructor(t,e,s=!1){super(t,e,s),this.BW=null,this.D_R=null,this.Bf=0,this.Bd=null,this.Be=null,this.minFilter=r.TextureConst.LINEAR}setDataFromBytes(t,e=0,s=-1,i=-1,r=0,h=0,n=!1){if(null!=t&&s>0&&i>0){e<0&&(e=0),e>15&&(e=15),e>=this.Bf&&(this.Bf=e+1),this.i=!0;let l=this.Bd;null!=l?this.Bd.miplevel!=e&&(null==this.Be&&(this.Be=[this.Bd,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]),l=this.Be[e],null==l&&(l=a.default.Create(),l.miplevel=e,n=!0,this.Be[e]=l)):(this.Bd=l=a.default.Create(),l.miplevel=e,n=!0),l.data==t&&l.offsetx==r&&l.offsety==h||(0==e&&(this.c=s,this.d=i,this.BW=t),l.data=t,l.status=0,(l.width<s||l.height<i||n)&&(l.width=s,l.height=i,l.status=1),l.offsetx=r,l.offsety=h),this.version++}}uploadData(t){null!=this.Bd&&this.dataUploadToGpu(t.getRC(),this.Bd,this.Be,!0)}__$updateToGpu(t){if(this.version>0&&t.hasResUid(this.getResUid())){let e=t.getRC(),s=null!=this.D_R?this.D_R.length:0;if(this.__$updateToGpuBegin(t),s>0){let t=0,i=null,h=r.TextureFormat.ToGL(e,this.internalFormat),n=r.TextureFormat.ToGL(e,this.srcFormat),l=r.TextureDataType.ToGL(e,this.dataType);for(;t<s;++t)i=this.D_R.pop(),i.updateToGpu(e,this.h,h,n,l,!1),a.default.Restore(i)}null!=this.Bd&&(this.dataUploadToGpu(e,this.Bd,this.Be),this.__$buildParam(e),this.k=!0),this.__$updateToGpuEnd(e)}}setPartDataFromeBytes(t,e,s,i,r,h=0){null==this.D_R&&(this.D_R=[]);let n=a.default.Create();n.data=t,n.status=0,n.miplevel=h,n.offsetx=e,n.offsety=s,n.width=i,n.height=r,this.D_R.push(n),this.version++}getPixels(t,e,s,i,a){if(null!=this.BW&&null!=a){let h=this.unpackAlignment,n=s*i*h;if(a.length==n){let l=e,_=t,o=l+i,m=_+s,u=0;switch(this.srcFormat){case r.TextureFormat.ALPHA:for(;l<o;++l)for(_=t;_<m;++_)n=l*this.c+_,a[u]=this.BW[n],u++;break;case r.TextureFormat.RGBA:for(;l<o;++l)for(_=t;_<m;++_)n=(l*this.c+_)*h,a[u]=this.BW[n],a[u+1]=this.BW[n+1],a[u+2]=this.BW[n+2],a[u+3]=this.BW[n+3],u++;break;case r.TextureFormat.RGB:for(;l<o;++l)for(_=t;_<m;++_)n=(l*this.c+_)*h,a[u]=this.BW[n],a[u+1]=this.BW[n+1],a[u+2]=this.BW[n+2],u++;break;default:break}}}}__$destroy(){if(this.getAttachCount()<1){if(this.version=0,null!=this.Be){for(let t=0;t<this.Bf;++t)a.default.Restore(this.Be[t]);this.Bf=0,this.Be=null,this.Bd=null}null!=this.Bd&&(a.default.Restore(this.Bd),this.Bd=null),this.BW=null,super.__$destroy()}}toString(){return"[RawDataTextureProxy(width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=n},df9d:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.T=-1,this.Ah=null,this.Ai=null,this.D_S=new Map,this.D_T=new Map,this.D_U=1,this.D_V=0,this.D_W=[],this.D_X=[],this.D_Y=[],this.D_Z=[],this.D_a=0,this.D_b=[],this.D_c=[],this.D_d=[],this.W_=[],this.X_=0,this.T=i.EM++}getFreeVtxId(){return this.D_Y.length>0?this.D_Y.pop():-1}getVtxIndex(){let t=-1,e=this.getFreeVtxId();return e>=0?(t=e,this.D_Z[e]=0,this.D_W[e]=this.D_U):(t=this.D_a,this.D_Z.push(0),this.D_X.push(this.D_V),this.D_W.push(this.D_U),this.D_a++),t}restoreVtxIndex(t){this.D_W[t]==this.D_U&&(this.D_Y.push(t),this.D_W[t]=this.D_V,this.D_Z[t]=0)}attachVtxAt(t){++this.D_Z[t]}detachVtxAt(t){this.D_Z[t]>0&&(--this.D_Z[t],this.D_Z[t]<1&&this.restoreVtxIndex(t))}getVtxTotalAt(t){return this.D_Z[t]}getFreeTexId(){return this.D_d.length>0?this.D_d.pop():-1}getTexIndex(){let t=-1,e=this.getFreeTexId();return e>=0?(t=e,this.W_[e]=0,this.D_b[e]=this.D_U):(t=this.X_,this.W_.push(0),this.D_c.push(this.D_V),this.D_b.push(this.D_U),this.X_++),t}restoreTexIndex(t){this.D_b[t]==this.D_U&&(this.D_d.push(t),this.D_b[t]=this.D_V,this.W_[t]=0)}attachTexAt(t){++this.W_[t]}detachTexAt(t){this.W_[t]>0&&(--this.W_[t],this.W_[t]<1&&this.restoreTexIndex(t))}getTexTotalAt(t){return this.W_[t]}destroy(){this.clear()}clear(){this.Ah=this.Ai=null,this.D_S=new Map,this.D_T=new Map,this.D_W=[],this.D_X=[],this.D_Z=[],this.D_Y=[],this.D_a=0,this.D_b=[],this.D_c=[],this.W_=[],this.D_d=[],this.X_=0}getBegin(){return this.Ah}containsNode(t){let e=this.D_S.get(t.vtxUid);if(null!=e){let s=131*(31+e.rvroI);return s*=s+e.texMid,t.rtokey==s}return!1}addNodeAndSort(t){let e=this.D_S.get(t.vtxUid);if(null==e){this.D_S.set(t.vtxUid,t),t.rvroI=this.getVtxIndex(),this.attachVtxAt(t.rvroI);let e=131*(31+t.rvroI);e*=e+t.texMid,t.rtokey=e,t.rtroI=this.getTexIndex(),this.D_T.set(e,t.rtroI),this.attachTexAt(t.rtroI)}else{t.rvroI=e.rvroI,this.attachVtxAt(t.rvroI);let s=131*(31+t.rvroI);if(s*=s+t.texMid,this.D_T.has(s)?t.rtroI=this.D_T.get(s):(t.rtroI=this.getTexIndex(),this.D_T.set(s,t.rtroI)),t.rtokey=s,this.attachTexAt(t.rtroI),e!=this.Ai)if(e.texMid==t.texMid)e.next.prev=t,t.next=e.next,t.prev=e,e.next=t;else while(null!=e){if(e.vtxUid!=t.vtxUid){e=e.prev,e.next.prev=t,t.next=e.next,t.prev=e,e.next=t;break}if(e.texMid==t.texMid){e.next.prev=t,t.next=e.next,t.prev=e,e.next=t;break}if(e.next==this.Ai){this.Ai.vtxUid!=t.vtxUid?(e.next.prev=t,t.next=e.next,t.prev=e,e.next=t):e=null;break}e=e.next}else e=null}null==e&&(null==this.Ah?this.Ai=this.Ah=t:null!=this.Ai.prev?(this.Ai.next=t,t.prev=this.Ai,this.Ai=t):(this.Ah.next=t,t.prev=this.Ai,this.Ai=t),this.Ai.next=null)}showInfo(){let t=this.getBegin();if(null!=t){let e="",s="",i="";while(null!=t)e+=t.vtxUid+",",s+=t.texMid+",",i+=t.ivsCount+",",t=t.next}}removeNodeAndSort(t){let e=this.D_S.get(t.vtxUid);e!=t?e=null:(this.D_S.set(t.vtxUid,null),null!=t.next&&t.next.vtxUid==t.vtxUid?this.D_S.set(t.vtxUid,t.next):null!=t.prev&&t.prev.vtxUid==t.vtxUid?this.D_S.set(t.vtxUid,t.prev):this.D_S.delete(t.vtxUid)),t==this.Ah?t==this.Ai?this.Ah=this.Ai=null:(this.Ah=t.next,this.Ah.prev=null):t==this.Ai?(this.Ai=t.prev,this.Ai.next=null):(t.next.prev=t.prev,t.prev.next=t.next),this.detachVtxAt(t.rvroI),this.detachTexAt(t.rtroI),t.prev=null,t.next=null}addNode(t){null==this.Ah?this.Ai=this.Ah=t:null!=this.Ai.prev?(this.Ai.next=t,t.prev=this.Ai,this.Ai=t):(this.Ah.next=t,t.prev=this.Ai,this.Ai=t),this.Ai.next=null}removeNode(t){t==this.Ah?t==this.Ai?this.Ah=this.Ai=null:(this.Ah=t.next,this.Ah.prev=null):t==this.Ai?(this.Ai=t.prev,this.Ai.next=null):(t.next.prev=t.prev,t.prev.next=t.next),t.prev=null,t.next=null}}i.EM=0,e.default=i},e08e:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.ELEMENTS_TRIANGLES=1,i.ELEMENTS_TRIANGLE_STRIP=2,i.ELEMENTS_TRIANGLE_FAN=3,i.ELEMENTS_INSTANCED_TRIANGLES=4,i.ARRAYS_LINES=5,i.ARRAYS_LINE_STRIP=6,i.ARRAYS_POINTS=7,i.ELEMENTS_LINES=8,i.DISABLE=0,e.RenderDrawMode=i;class r{}r.NORMAL=1,r.OPAQUE=1,r.TRANSPARENT=2,r.ALPHA_ADD=3,r.ADD=4,r.ADD_LINEAR=5,r.INVERSE_ALPHA=6,r.BLAZE=7,r.OVERLAY=8,r.OVERLAY2=8,r.DISABLE=0,e.RenderBlendMode=r;class a{}a.NEVER=1,a.LESS=1,a.EQUAL=1,a.GREATER=1,a.NOTEQUAL=1,a.GEQUAL=1,a.ALWAYS=1,e.GLStencilFunc=a;class h{}h.KEEP=1,h.ZERO=1,h.REPLACE=1,h.INCR=1,h.INCR_WRAP=1,h.DECR=1,h.DECR_WRAP=1,h.INVERT=1,e.GLStencilOp=h;class n{}n.ZERO=1,n.ONE=1,n.SRC_COLOR=1,n.DST_COLOR=1,n.SRC_ALPHA=1,n.DST_ALPHA=1,n.ONE_MINUS_SRC_ALPHA=1,e.GLBlendMode=n;class l{}l.FUNC_ADD=1,l.FUNC_SUBTRACT=1,l.FUNC_REVERSE_SUBTRACT=1,l.MIN_EXT=1,l.MAX_EXT=1,l.MIN=1,l.MAX=1,e.GLBlendEquation=l;class _{}_.BACK=1,_.FRONT=2,_.FRONT_AND_BACK=3,_.NONE=0,_.DISABLE=0,e.CullFaceMode=_;class o{}o.NEVER=1,o.ALWAYS=2,o.SKY=3,o.TRUE_LESS_EQUAL=3,o.OPAQUE=4,o.TRUE_LESS=4,o.OPAQUE_OVERHEAD=5,o.FALSE_EQUAL=5,o.FALSE_LESS=6,o.BLEND=6,o.BLEND_SORT=6,o.TRANSPARENT_SORT=6,o.TRUE_LEQUAL=7,o.WIRE_FRAME=7,o.FALSE_LEQUAL=8,o.DECALS=8,o.NEXT_LAYER=11,o.WIRE_FRAME_NEXT=12,o.TRUE_EQUAL=13,o.TRUE_GREATER=14,o.TRUE_GEQUAL=15,o.DISABLE=0,e.DepthTestMode=o;class m{}m.SCENE_RO_FILTER_BEGIN=1<<19,m.SCENE_RO_FILTER_FINISH=2<<19,m.SCENE_RO_ERASE=0,e.RenderConst=m,function(t){t[t["NOT_IN_RENDERER"]=-1]="NOT_IN_RENDERER",t[t["GO_TO_RENDERER"]=1]="GO_TO_RENDERER",t[t["LIVE_IN_RENDERER"]=2]="LIVE_IN_RENDERER"}(e.DisplayRenderSign||(e.DisplayRenderSign={}))},e160:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{IntersectRL(t,e,s){let i=0,r=(s.min.x-e.x)/t.x,a=(s.max.x-e.x)/t.x;r>a&&(i=a,a=r,r=i);let h=(s.min.y-e.y)/t.y,n=(s.max.y-e.y)/t.y;if(h>n&&(i=n,n=h,h=i),r>n||h>a)return!1;h>r&&(r=h),n<a&&(a=n);let l=(s.min.z-e.z)/t.z,_=(s.max.z-e.z)/t.z;return l>_&&(i=_,_=l,l=i),!(r>_||l>a)&&(l>r&&(r=l),_<a&&(a=_),!0)}static IntersectionRL3(t,e,s,i,r,a){return s.w=(t[e[0]].x-r.x)*s.x,i.w=(t[1-e[0]].x-r.x)*s.x,a.x=(t[e[1]].y-r.y)*s.y,a.y=(t[1-e[1]].y-r.y)*s.y,!(s.w>a.y||a.x>i.w)&&(a.x>s.w&&(s.w=a.x),a.y<i.w&&(i.w=a.y),a.x=(t[e[2]].z-r.z)*s.z,a.y=(t[1-e[2]].z-r.z)*s.z,!(s.w>a.y||a.x>i.w)&&(a.x>s.w&&(s.w=a.x),a.y<i.w&&(i.w=a.y),a.copyFrom(i),a.scaleBy(s.w),a.addBy(r),i.w=1,!0))}static IntersectionRL1(t,e,s,i){let r=0,a=(s.min.x-e.x)/t.x,h=(s.max.x-e.x)/t.x;a>h&&(r=h,h=a,a=r);let n=(s.min.y-e.y)/t.y,l=(s.max.y-e.y)/t.y;if(n>l&&(r=l,l=n,n=r),a>l||n>h)return!1;n>a&&(a=n),l<h&&(h=l);let _=(s.min.z-e.z)/t.z,o=(s.max.z-e.z)/t.z;return _>o&&(r=o,o=_,_=r),!(a>o||_>h)&&(_>a&&(a=_),o<h&&(h=o),i.copyFrom(t),i.scaleBy(a),i.addBy(e),!0)}static IntersectionRL2(t,e,s,i){i.x=s.center.x-e.x,i.y=s.center.y-e.y,i.z=s.center.z-e.z;let r=i.dot(t);if(i.x-=r*t.x,i.y-=r*t.y,i.z-=r*t.z,i.getLengthSquared()>s.radius2)return!1;if(s.containsV(e))return i.copyFrom(e),!0;if(e.x<s.min.x){if(t.x>0&&(r=(s.min.x-e.x)/t.x,i.copyFrom(t),i.scaleBy(r),i.addBy(e),s.containsYZ(i.y,i.z)))return!0}else if(e.x>s.max.x&&t.x<0&&(r=(s.max.x-e.x)/t.x,i.copyFrom(t),i.scaleBy(r),i.addBy(e),s.containsYZ(i.y,i.z)))return!0;if(e.y<s.min.y){if(t.y>0&&(r=(s.min.y-e.y)/t.y,i.copyFrom(t),i.scaleBy(r),i.addBy(e),s.containsXZ(i.x,i.z)))return!0}else if(e.y>s.max.y&&t.y<0&&(r=s.max.y,r=(s.max.y-e.y)/t.y,i.copyFrom(t),i.scaleBy(r),i.addBy(e),s.containsXZ(i.x,i.z)))return!0;if(e.z<s.min.z){if(t.z>0&&(r=(s.min.z-e.z)/t.z,i.copyFrom(t),i.scaleBy(r),i.addBy(e),s.containsXY(i.x,i.y)))return!0}else if(e.z>s.max.z&&t.z<0&&(r=(s.max.z-e.z)/t.z,i.copyFrom(t),i.scaleBy(r),i.addBy(e),s.containsXY(i.x,i.y)))return!0;return!1}}e.AABBCalc=i},e214:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("8e17")),h=i(s("f48d"));class n extends h.default{constructor(){super(...arguments),this.nv=new a.default(0,1,0),this.distance=0,this.intersectBoo=!1}intersectStraightLinePos(t,e){let s=this.nv.dot(t.tv);if(s>r.default.MATH_MIN_POSITIVE||s<r.default.MATH_MAX_NEGATIVE){let i=this.nv.dot(t.position)-this.distance;return e.x=1e5*t.tv.x+t.position.x,e.y=1e5*t.tv.y+t.position.y,e.z=1e5*t.tv.z+t.position.z,s=this.nv.dot(e)-this.distance,s=i/(i-s),e.subtractBy(t.position),e.scaleBy(s),e.addBy(t.position),1}return s=this.nv.dot(t.position)-this.distance,s<=r.default.MATH_MIN_POSITIVE||s>=r.default.MATH_MAX_NEGATIVE?(e.copyFrom(t.position),2):0}intersectStraightLinePos2(t,e,s){let i=this.nv.dot(e);if(i>r.default.MATH_MIN_POSITIVE||i<r.default.MATH_MAX_NEGATIVE){let r=this.nv.dot(t)-this.distance;return s.x=1e5*e.x+t.x,s.y=1e5*e.y+t.y,s.z=1e5*e.z+t.z,i=this.nv.dot(s)-this.distance,i=r/(r-i),s.subtractBy(t),s.scaleBy(i),s.addBy(t),1}return i=this.nv.dot(t)-this.distance,i<=r.default.MATH_MIN_POSITIVE||i>=r.default.MATH_MAX_NEGATIVE?(s.copyFrom(t),2):0}intersectRadialLinePos(t,e){let s=this.nv.dot(t.position)-this.distance;if(s>r.default.MATH_MIN_POSITIVE){let s=this.nv.dot(t.tv);if(s<0)return this.intersectStraightLinePos2(t.position,t.tv,e)}else{if(!(s<r.default.MATH_MAX_NEGATIVE)){let s=this.nv.dot(t.tv);return s>r.default.MATH_MIN_POSITIVE||s<r.default.MATH_MAX_NEGATIVE?(e.copyFrom(t.position),1):(e.copyFrom(t.position),2)}{let s=this.nv.dot(t.tv);if(s>0)return this.intersectStraightLinePos2(t.position,t.tv,e)}}return-1}intersectRadialLinePos2(t,e,s){let i=this.nv.dot(t)-this.distance;if(i>r.default.MATH_MIN_POSITIVE){let i=this.nv.dot(e);if(i<0)return this.intersectStraightLinePos2(t,e,s)}else{if(!(i<r.default.MATH_MAX_NEGATIVE)){let i=this.nv.dot(e);return i>r.default.MATH_MIN_POSITIVE||i<r.default.MATH_MAX_NEGATIVE?(s.copyFrom(t),1):(s.copyFrom(t),2)}{let i=this.nv.dot(e);if(i>0)return this.intersectStraightLinePos2(t,e,s)}}return-1}containsPoint(t){let e=this.nv.dot(t)-this.distance;return e>r.default.MATH_MIN_POSITIVE?1:e<r.default.MATH_MAX_NEGATIVE?-1:0}intersectSphere(t,e){this.intersectBoo=!1;let s=this.nv.dot(t)-this.distance;return s>r.default.MATH_MIN_POSITIVE?(this.intersectBoo=s<=e,1):s<r.default.MATH_MAX_NEGATIVE?(this.intersectBoo=-s<=e,-1):0}intersectAABB(t,e){this.intersectBoo=!1;let s=h.default.__tV0;s.setXYZ(e.x,t.y,e.z);let i=this.containsPoint(s);return s.setXYZ(e.x,t.y,t.z),i+=this.containsPoint(s),s.setXYZ(t.x,t.y,t.z),i+=this.containsPoint(s),s.setXYZ(t.x,t.y,e.z),i+=this.containsPoint(s),s.setXYZ(e.x,e.y,e.z),i+=this.containsPoint(s),s.setXYZ(e.x,e.y,t.z),i+=this.containsPoint(s),s.setXYZ(t.x,e.y,t.z),i+=this.containsPoint(s),s.setXYZ(t.x,e.y,e.z),i+=this.containsPoint(s),this.intersectBoo=i<8,i<-7?-1:i>7?1:0}intersectSphNegSpace(t,e){this.intersectBoo=Math.abs(this.nv.dot(t)-this.distance)<e}update(){this.nv.normalize()}updateFast(){this.nv.normalize()}static PlaneIntersectSphere(t,e,s,i){n.IntersectBoo=!1,n.IntersectSatus=0,e=t.dot(s)-e,e>r.default.MATH_MIN_POSITIVE?(n.IntersectBoo=e<=i,n.IntersectSatus=1):e<r.default.MATH_MAX_NEGATIVE&&(n.IntersectBoo=-e<=i,n.IntersectSatus=-1)}static CalcPVCloseV(t,e,s){let i=t.distance-e.dot(t.nv);s.setTo(i*t.nv.x,i*t.nv.y,i*t.nv.z),s.addBy(e)}static CalcPVCloseV2(t,e,s,i){let r=e-s.dot(t);i.setTo(r*t.x,r*t.y,r*t.z),i.addBy(s)}static IntersectionSLV2(t,e,s,i,a){let h=t.dot(i);if(h>r.default.MATH_MIN_POSITIVE||h<r.default.MATH_MAX_NEGATIVE){let r=t.dot(s)-e;return a.x=1e5*i.x+s.x,a.y=1e5*i.y+s.y,a.z=1e5*i.z+s.z,h=t.dot(a)-e,h=r/(r-h),a.subtractBy(s),a.scaleBy(h),a.addBy(s),1}return h=t.dot(s)-e,h<=r.default.MATH_MIN_POSITIVE||h>=r.default.MATH_MAX_NEGATIVE?(a.copyFrom(s),2):0}toString(){return"Plane(position="+this.position.toString()+", nv="+this.nv.toString()+")"}}n.IntersectBoo=!1,n.IntersectSatus=0,e.default=n},e2fe:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t=0,e=0,s=100,i=100){this.D_e=100,this.D_f=100,this.x=0,this.y=0,this.width=100,this.height=100,this.x=t,this.y=e,this.width=s,this.height=i,this.update()}copyFrom(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.D_e=t.D_e,this.D_f=t.D_f}clone(){return new i(this.x,this.y,this.width,this.height)}containsXY(t,e){return!(t<this.x||t>this.D_e)&&!(e<this.y||e>this.D_f)}contains(t){return t.x>=this.x&&t.D_e<=this.D_e&&t.y>=this.y&&(t.D_f,this.D_f),!0}intersect(t){return!(t.x>this.D_e)&&(!(t.D_e<this.x)&&(!(t.y>this.D_f)&&!(t.D_f<this.y)))}setTo(t,e,s,i){this.x=t,this.y=e,this.width=s,this.height=i,this.D_e=this.width+this.x,this.D_f=this.height+this.y}setSize(t,e){this.width=t,this.height=e,this.D_e=this.width+this.x,this.D_f=this.height+this.y}testEqual(t){return this.x!=t.x||this.y!=t.y||this.width!=t.width||this.height!=t.height}testEqualWithParams(t,e,s,i){return this.x!=t||this.y!=e||this.width!=s||this.height!=i}update(){this.D_e=this.width+this.x,this.D_f=this.height+this.y}flipY(t){this.y=this.y,this.D_e=this.width+this.x,this.D_f=this.height+this.y}getX(){return this.x}getY(){return this.y}getRight(){return this.D_e}getTop(){return this.D_f}}e.default=i},e602:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("29ef"));class a{constructor(){this.ALL_TRUE=0,this.ALL_FALSE=1,this.RED_TRUE=2,this.GREEN_TRUE=3,this.BLUE_TRUE=4,this.ALPHA_TRUE=5,this.RED_FALSE=6,this.GREEN_FALSE=7,this.BLUE_FALSE=8,this.ALPHA_FALSE=9;let t=r.default,e=this;e.ALL_TRUE=t.COLOR_MASK_ALL_TRUE,e.ALL_FALSE=t.COLOR_MASK_ALL_FALSE,e.RED_TRUE=t.COLOR_MASK_RED_TRUE,e.GREEN_TRUE=t.COLOR_MASK_GREEN_TRUE,e.BLUE_TRUE=t.COLOR_MASK_BLUE_TRUE,e.ALPHA_TRUE=t.COLOR_MASK_ALPHA_TRUE,e.RED_FALSE=t.COLOR_MASK_RED_FALSE,e.GREEN_FALSE=t.COLOR_MASK_GREEN_FALSE,e.BLUE_FALSE=t.COLOR_MASK_BLUE_FALSE,e.ALPHA_FALSE=t.COLOR_MASK_ALPHA_FALSE}}e.RenderingColorMask=a},e7ce:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("faa5")),a=i(s("b3bd")),h=i(s("0fc4"));class n extends r.default{constructor(){super(),this.D_g=""}initialize(t){this.D_g="PixelPickIndexShd"}getFragShaderCode(){let t="#version 300 es\nprecision highp float;\nuniform vec4 u_param;\nin vec3 v_viewPos;\n//in float v_length;\nlayout(location = 0) out vec4 FragColor0;\nvoid main()\n{\nvec4 p = vec4(length(v_viewPos.xyz));\np.x = floor(p.x)/256.0;\np.y = floor(fract(p.x) * 256.0)/255.0;\np.x = floor(p.x) / 255.0;\np.z = fract(p.z);\nFragColor0 = vec4(p.xyz,u_param.w);\n}\n";return t}getVertShaderCode(){let t="#version 300 es\nprecision highp float;\nlayout(location = 0) in vec3 a_vs;\nuniform mat4 u_objMat;\nuniform mat4 u_viewMat;\nuniform mat4 u_projMat;\nout vec3 v_viewPos;\n//out float v_length;\nvoid main(){\nmat4 viewMat4 = u_viewMat * u_objMat;\nvec4 viewPos = viewMat4 * vec4(a_vs, 1.0);\nv_viewPos = viewPos.xyz;\n//v_length = length(viewPos.xyz);\ngl_Position = u_projMat * viewPos;\n}\n";return t}getUniqueShaderName(){return this.D_g}toString(){return"[PixelPickIndexShaderBuffer()]"}static GetInstance(){return n.E_D}}n.E_D=new n,e.PixelPickIndexShaderBuffer=n;class l extends h.default{constructor(){super(),this.D_h=new Float32Array([1,1,1,1]),this.D_i=1/255}getCodeBuf(){return n.GetInstance()}setIndex(t){this.D_h[3]=t*this.D_i}getIndex(){return this.D_h[3]/this.D_i}createSelfUniformData(){let t=new a.default;return t.uniformNameList=["u_param"],t.dataList=[this.D_h],t}}e.default=l},e87b:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("ab73"));class a{create(t,e){let s=r.default.ViewportParam;return e.hasUniformByName(s.name)?t.uniformContext.createShaderGlobalUniformFromProbe(t.getRenderAdapter().uViewProbe,s.name,[s.name]):null}getIDNS(){return"ViewParamUniformBuilder"}}e.default=a},eaee:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("7918"),a=s("8d98"),h=i(s("0851"));class n extends h.default{constructor(t,e){super(t,e,!1),this.BI=null,this.g=a.TextureTarget.TEXTURE_CUBE,this.j=r.TextureProxyType.FloatCube,this.internalFormat=a.TextureFormat.RGBA16F,this.dataType=a.TextureDataType.FLOAT,this.mipmapEnabled=!0}toAlphaFormat(){this.srcFormat=a.TextureFormat.ALPHA,this.internalFormat=a.TextureFormat.ALPHA,this.unpackAlignment=1}toRedFormat(){this.srcFormat=a.TextureFormat.RED,this.internalFormat=a.TextureFormat.RED,this.unpackAlignment=1}toRGBFormat(){this.unpackAlignment=1,this.srcFormat=a.TextureFormat.RGB,this.internalFormat=a.TextureFormat.RGB16F,this.minFilter=a.TextureConst.NEAREST,this.magFilter=a.TextureConst.NEAREST,this.mipmapEnabled=!1}toRGBAFormat(){this.unpackAlignment=4,this.srcFormat=a.TextureFormat.RGBA,this.internalFormat=a.TextureFormat.RGBA16F}toRGBFormatFloat32F(){this.unpackAlignment=1,this.srcFormat=a.TextureFormat.RGB,this.internalFormat=a.TextureFormat.RGB32F,this.minFilter=a.TextureConst.NEAREST,this.magFilter=a.TextureConst.NEAREST,this.mipmapEnabled=!1}toRGBAFormatFloat32F(){this.unpackAlignment=4,this.srcFormat=a.TextureFormat.RGBA,this.internalFormat=a.TextureFormat.RGBA32F}toRGBAFormatHalfFloat(){this.unpackAlignment=1,this.srcFormat=a.TextureFormat.RGBA,this.dataType=a.TextureDataType.HALF_FLOAT,this.internalFormat=a.TextureFormat.RGBA16F}setDataFromBytesToFaceAt(t,e,s,i,r=0){if(null==this.BI&&(this.BI=[null,null,null,null,null,null]),s>0&&i>0){0==t&&r<1&&(this.c=s,this.d=i,this.b=r),null==this.BI[t]&&(this.BI[t]=new Array(16));let a=this.BI[t];a[r]={width:s,height:i,imgData:e,miplevel:r},this.i=null!=a[r].imgData}}uploadData(t){let e,s,i=t.getRC(),r=null,h=this.getWidth(),n=this.getHeight();for(let l=0;l<6;++l){let t=this.BI[l];if(this.mipmapEnabled&&this.k)r=t[0],i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+l,0,a.TextureFormat.ToGL(i,this.internalFormat),h,n,0,a.TextureFormat.ToGL(i,this.srcFormat),a.TextureDataType.ToGL(i,this.dataType),r.imgData);else{e=h,s=n;let _=0;for(;e>0||s>0;)null!=t[_]&&(r=t[_],i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+l,_,a.TextureFormat.ToGL(i,this.internalFormat),e,s,0,a.TextureFormat.ToGL(i,this.srcFormat),a.TextureDataType.ToGL(i,this.dataType),r.imgData)),e>0&&(e>>=1),s>0&&(s>>=1),++_}}this.version=0}toString(){return"[FloatCubeTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}__$destroy(){if(this.getAttachCount()<1){if(null!=this.BI)for(let t=0;t<6;++t)null!=this.BI[t]&&(this.BI[t].imgData=null);super.__$destroy()}}}e.default=n},eca0:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("2be1")),a=i(s("c62b"));class h{constructor(){this.idsFlag=0,this.count=0,this.rprocessUid=-1}reset(){this.idsFlag=0}}h.RenerProcessMaxTotal=16,e.RCRPObj=h;class n extends r.default{constructor(){super(...arguments),this.D_j=[]}createNode(){let t=new h;return t.reset(),this.D_j.push(t),new a.default}restoreUid(t){this.D_j[t].reset()}testRPNodeExists(t,e){return(this.D_j[t].idsFlag&1<<e)>0}testRPNodeNotExists(t,e){return(this.D_j[t].idsFlag&1<<e)<1}setRPNodeParam(t,e,s){let i=this.D_j[t],r=1<<e;return s>-1?(i.idsFlag&r)<1&&(++i.count,i.rprocessUid=e,i.idsFlag=i.idsFlag|r):(i.idsFlag&r)>0&&(--i.count,i.idsFlag=i.idsFlag&~r),i.count}getRCRPObj(t){return this.D_j[t]}}e.RPOUnitBuilder=n},ee5a:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.type=0,this.D_k=[],this.D_l=[],this.D_m=[]}addListener(t,e,s){let i=this.D_l.length-1;for(;i>=0;--i)if(t===this.D_l[i])break;i<0&&(this.D_l.push(t),this.D_k.push(e),this.D_m.push(s))}removeListener(t,e){let s=this.D_l.length-1;for(;s>=0;--s)if(t===this.D_l[s]){this.D_l.splice(s,1),this.D_k.splice(s,1),this.D_m.splice(s,1);break}}dispatch(t){let e=0,s=this.D_l.length;for(let i=0;i<s;++i)(this.D_m[i]<1||t.phase==this.D_m[i])&&(this.D_k[i].call(this.D_l[i],t),e=1);return e}passTestEvt(t){let e=this.D_l.length;for(let s=0;s<e;++s)if(this.D_m[s]<1||t.phase==this.D_m[s])return 1;return 0}passTestPhase(t){let e=this.D_l.length;for(let s=0;s<e;++s)if(this.D_m[s]<1||t==this.D_m[s])return 1;return 0}destroy(){this.D_l=[],this.D_k=[],this.D_m=[]}}e.default=i},f208:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.info=""}}e.default=i},f3a2:function(t,e,s){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t["None"]="",t["Default"]="pbr",t["Lambert"]="lambert",t["PBR"]="pbr"}(i||(i={})),e.ShaderCodeUUID=i},f444:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("1710")),a=s("bcac"),h=s("278e");class n{constructor(){this.Aq=null,this.D_n=new a.CameraDragSwinger,this.D_o=new h.CameraDragSlide,this.D_p=!0}initialize(t,e){null==this.Aq&&(this.Aq=t,this.D_n.initialize(t,e),this.D_o.initialize(t,e),t.addEventListener(r.default.MOUSE_BG_DOWN,this,this.mouseDownListener,!0,!1),t.addEventListener(r.default.MOUSE_UP,this,this.mouseUpListener,!1,!0))}setSlideSpeed(t){this.D_o.slideSpeed=t}enableSwing(){this.D_p=!0}enableSlide(){this.D_p=!1}mouseDownListener(t){this.D_n.attach(),this.D_o.attach()}mouseUpListener(t){this.D_n.detach(),this.D_o.detach()}detach(){this.D_n.detach(),this.D_o.detach()}runWithYAxis(){this.D_p?this.D_n.runWithYAxis():this.D_o.run()}runWithZAxis(){this.D_p?this.D_n.runWithZAxis():this.D_o.run()}}e.default=n},f48d:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17"));class a{constructor(){this.id=-1,this.position=new r.default}update(){}updateFast(){}}a.__tV0=new r.default,a.__tV1=new r.default,a.__tV2=new r.default,e.AbsGeomBase=a,e.default=a},f63b:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=s("8d98"),h=i(s("3b73"));function n(t,e,s){var i=document.createElement("canvas");i.width=e,i.height=s,i.style.backgroundColor="transparent",i.style.display="block",i.style.left="0px",i.style.top="0px",i.style.position="absolute";let r=i.getContext("2d");return r.drawImage(t,0,0,t.width,t.height,0,0,i.width,i.height),{canvas:i,ctx2d:r}}function l(t,e,s){var i=document.createElement("canvas");i.width=e,i.height=s,i.style.backgroundColor="transparent",i.style.display="block",i.style.left="0px",i.style.top="0px",i.style.position="absolute";let r=i.getContext("2d");return r.globalCompositeOperation="destination-atop",r.fillStyle="rgba(255, 255, 255, 1.0)",r.rect(0,0,i.width,i.height),r.fill(),r.drawImage(t,0,0,t.width,t.height,0,0,i.width,i.height),{canvas:i,ctx2d:r}}class _{constructor(t,e){this.D_q="",this.D_r=null,this.D_s=!1,this.D_t=0,this.texture=null,this.bytesTex=null,this.powerOf2Fix=!1,this.offsetTex=null,this.premultipliedAlpha=!0,this.D_q=t,this.D_t=e}startLoad(){if(null==this.D_r){let t=this;this.D_r=new Image,this.D_r.onload=function(e){t.D_s=!0,t.buildTex()},this.D_r.addEventListener("error",e=>{t.D_q}),this.D_r.crossOrigin="",this.D_r.src=this.D_q}}buildTex(){let t=this.D_r;if(null!=t&&this.D_s){let e=this.texture,s=this.offsetTex,i=this.bytesTex,a=null,_=r.default.IsPowerOf2(t.width)&&r.default.IsPowerOf2(t.height),o=this.powerOf2Fix;if(h.default.IsWebGL1()&&(o=!0),!_&&o){let _=r.default.CalcCeilPowerOfTwo(t.width),o=r.default.CalcCeilPowerOfTwo(t.height);_>h.default.MAX_TEXTURE_SIZE&&(_=h.default.MAX_TEXTURE_SIZE),o>h.default.MAX_TEXTURE_SIZE&&(_=h.default.MAX_TEXTURE_SIZE);let m=n(t,_,o),u=this.D_t;if(null!=e&&(e.setDataFromImage(m.canvas,u),e.name=this.D_r.src,null!=s&&(m=l(t,_,o),s.setDataFromImage(m.canvas,u))),null!=i)if(this.premultipliedAlpha)a=m.ctx2d.getImageData(0,0,m.canvas.width,m.canvas.height),i.setDataFromBytes(a.data,u,m.canvas.width,m.canvas.height),i.name=this.D_r.src;else{a=m.ctx2d.getImageData(0,0,m.canvas.width,m.canvas.height);let e=a.data,s=l(t,_,o);a=s.ctx2d.getImageData(0,0,s.canvas.width,s.canvas.height);let r=a.data,h=0,n=0,d=0;for(;h<o;++h)for(n=0;n<_;++n)e[d]+=255-r[d],e[d+1]+=255-r[d+1],e[d+2]+=255-r[d+2],d+=4;i.setDataFromBytes(e,u,m.canvas.width,m.canvas.height),i.name=this.D_r.src}}else if(null!=e)this.powerOf2Fix,e.setDataFromImage(t,this.D_t),e.name=this.D_r.src;else if(null!=i){let e=r.default.CalcNearestCeilPow2(t.width),s=r.default.CalcNearestCeilPow2(t.height);e>2048&&(e=2048),s>2048&&(e=2048);let h=n(t,e,s),l=this.D_t;a=h.ctx2d.getImageData(0,0,h.canvas.width,h.canvas.height),i.setDataFromBytes(a.data,l,h.canvas.width,h.canvas.height),i.name=this.D_r.src}this.D_s=!0}}getURL(){return this.D_q}getImage(){return this.D_r}isLoaded(){return this.D_s}destroy(){this.D_s=!1,this.D_q="",this.texture=null,this.D_r.src="",this.D_r=null}}class o{constructor(t){this.D_u=null,this.D_v=[],this.D_w=0,this.D_s=!1,this.W_=[],this.D_x=[],this.D_u=t;var e=this;let s=0,i=null;for(;s<6;++s)i=new Image,i.onload=function(t){if(e.D_w++,e.D_w>=6){let t=0;for(t=0;t<6;++t)e.W_[0].setDataFromImageToFaceAt(t,e.D_v[t],e.D_x[0]);e.W_[0].name=e.D_v.src}},i.crossOrigin="",i.src=e.D_u[s],e.D_v.push(i)}addTex(t,e){this.W_.push(t),this.D_x.push(e)}getURLAt(t){return this.D_u[0]}getTexAt(t){return this.W_[t]}isLoaded(){return this.D_s}destroy(){}}class m{constructor(t){this.D_y=new Map,this.B_U=new Map,this.D_z=[],this.D_0=[],this.D_1=[],this.D_2=5,this.D_3=17,this.D_4=17,this.D_5=512,this.D_6=512,this.D_7=null,this.B_I=0,this.D_7=t,null!=t&&t.addTexLoader(this)}getTexByUrl(t,e=!0,s=!0,i=!1){let r=this.getImageTexByUrl(t,0,!1,i);return r.mipmapEnabled=s,e&&r.setWrap(a.TextureConst.WRAP_REPEAT),r}getBytesNoPremultipliedAlphaTexByUrl(t,e=0){if(""==t)return null;e<0&&(e=0);let s=this.B_U.get(t);if(null==s){s=new _(t,e),s.premultipliedAlpha=!1,this.B_U.set(t,s);let i=this.D_7.createBytesTex(1,1);return i.name=t,s.bytesTex=i,this.D_0.push(s),i}return s.bytesTex.isDestroyed()&&(s.bytesTex=this.D_7.createBytesTex(1,1)),s.bytesTex}getBytesTexByUrl(t,e=0){if(""==t)return null;e<0&&(e=0);let s=this.B_U.get(t);if(null==s){s=new _(t,e),this.B_U.set(t,s);let i=this.D_7.createBytesTex(1,1);return i.name=t,s.bytesTex=i,this.D_0.push(s),i}return s.bytesTex.isDestroyed()&&(s.bytesTex=this.D_7.createBytesTex(1,1)),s.bytesTex}getImageOffsetTexByUrl(t,e=0){if(""==t)return null;e<0&&(e=0);let s=this.B_U.get(t);return null!=s?s.offsetTex:null}getImageTexByUrl(t,e=0,s=!1,i=!1){if(""==t)return null;e<0&&(e=0);let r=this.B_U.get(t);if(null==r){r=new _(t,e),r.powerOf2Fix=i,s&&(r.offsetTex=this.D_7.createImageTex2D(1,1,!1)),this.B_U.set(t,r);let a=this.D_7.createImageTex2D(1,1,!1);return a.name=t,r.texture=a,this.D_0.push(r),a}return r.texture.isDestroyed()&&(r.texture=this.D_7.createImageTex2D(1,1,!1)),r.texture}getCubeTexAndLoadImg(t,e,s=0){if(""==t||null==e||e.length<6)return null;s<0&&(s=0);let i=this.D_y.get(t);if(null==i){i=new o(e),this.D_y.set(t,i);let r=this.D_7.createImageCubeTex(8,8);return i.addTex(r,s),r}return i.getTexAt(0)}setRunFlag(t){this.B_I=t}getRunFlag(){return this.B_I}isRunning(){return!0}isStopped(){return!1}run(){let t=0,e=null;if(--this.D_3,this.D_3<1){this.D_3=this.D_4;let s=this.D_1.length;if(s>0)for(;t<s;++t)this.D_1[t].isLoaded()&&(this.D_z.push(this.D_1[t]),this.D_1.splice(t,1),--t,--s);let i=this.D_0.length;if(i>0&&s<this.D_2)for(t=s;t<this.D_2;++t){if(!(this.D_0.length>0))break;e=this.D_0.pop(),this.D_1.push(e),e.startLoad()}}if(--this.D_5,this.D_5<1){this.D_5=this.D_6;let s=null,i=this.D_z.length;for(t=0;t<i;++t)e=this.D_z[t],s=null!=e.texture?e.texture:e.bytesTex,s.isDestroyed()&&(this.B_U.delete(e.getURL()),this.D_z.splice(t,1),e.destroy(),--t,--i)}}getWaitTotal(){return this.D_0.length}isLoadedAll(){return this.D_0.length<1}}e.default=m},f928:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("7918"),a=s("8d98"),h=i(s("df25"));class n extends h.default{constructor(t,e,s=!1){super(t,e,s),this.j=r.TextureProxyType.Float,this.minFilter=a.TextureConst.LINEAR,this.internalFormat=a.TextureFormat.RGBA16F,this.dataType=a.TextureDataType.FLOAT,this.unpackAlignment=4}toAlphaFormat(){this.srcFormat=a.TextureFormat.ALPHA,this.internalFormat=a.TextureFormat.ALPHA,this.unpackAlignment=1}toRedFormat(){this.srcFormat=a.TextureFormat.RED,this.internalFormat=a.TextureFormat.RED,this.unpackAlignment=1}toRGBFormat(){this.srcFormat=a.TextureFormat.RGB,this.internalFormat=a.TextureFormat.RGB16F,this.unpackAlignment=1}toRGBAFormat(){this.srcFormat=a.TextureFormat.RGBA,this.internalFormat=a.TextureFormat.RGBA,this.unpackAlignment=4}toRGBAFloatFormat(){this.srcFormat=a.TextureFormat.RGBA,this.internalFormat=a.TextureFormat.RGBA16F,this.unpackAlignment=4}setDataFromBytes(t,e=0,s=-1,i=-1,r=0,a=0,h=!1){super.setDataFromBytes(t,e,s,i,r,a,h)}setPartDataFromeBytes(t,e,s,i,r,a=0){super.setPartDataFromeBytes(t,e,s,i,r,a)}getPixels(t,e,s,i,r){super.getPixels(t,e,s,i,r)}toString(){return"[FloatTextureProxy(width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=n},fa60:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("919c"));class a extends r.default{constructor(){super(),this.vao=null,this.T=a.EM++}run(){this.AM.testVROUid(this.T)&&(this.AM.bindVertexArray(this.vao),(this.AM.testRIOUid(this.A_L)||r.default.Ex!=this.CD)&&(r.default.Ex=this.CD,this.AM.bindEleBuf(this.ibuf)))}__$destroy(){r.default.Er.delete(this.CD),this.CD=0,this.A_L=-1,this.ibuf=null,this.vao=null,this.AM=null}restoreThis(){null!=this.vao&&this.AM.deleteVertexArray(this.vao),a.Restore(this)}toString(){return"VaoVertexRenderObj(uid = "+this.T+", type="+this.CD+")"}static HasMid(t){return r.default.Er.has(t)}static GetByMid(t){return r.default.Er.get(t)}static GetFreeId(){return a.Es.length>0?a.Es.pop():-1}static Create(t,e,s){let i=null,h=a.GetFreeId();return h>=0?(i=a.Et[h],a.Eu[h]=a.EY,i.setMidAndBufUid(e,s)):(i=new a,i.setMidAndBufUid(e,s),a.Et.push(i),a.Eu.push(a.EY),a.Ev++),i.setRC(t),r.default.Er.set(e,i),i}static Restore(t){if(null!=t&&t.Y<1&&a.Eu[t.getUid()]==a.EY){let e=t.getUid();a.Es.push(e),a.Eu[e]=a.Eq,t.__$destroy()}}}a.EM=0,a.EY=1,a.Eq=0,a.Eu=[],a.Ev=0,a.Et=[],a.Es=[],e.default=a},faa5:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("f3a2"),a=i(s("4a54")),h=s("5216"),n=s("3113"),l=s("4efa");class _{constructor(){this.D_8=null,this.D_9=null,this.W_=null,this.D_=!0,this.pipeline=null,this.vertColorEnabled=!1,this.premultiplyAlpha=!1,this.shadowReceiveEnabled=!1,this.lightEnabled=!1,this.fogEnabled=!1,this.envAmbientLightEnabled=!1,this.brightnessOverlayEnabeld=!1,this.glossinessEnabeld=!0,this.pipeTypes=null,this.keysString="",this.adaptationShaderVersion=!0,null==_.E_F&&(_.E_E=new n.ShaderCodeUniform,_.E_F=new a.default(_.E_E),_.E_E.__$setCodeBuilder(_.E_F),_.E_G=new l.ShaderTextureBuilder(_.E_E))}reset(){this.D_8=_.E_F,this.A_9=_.E_E,this.EA=_.E_G,this.EB=this.A_9,this.D_8.reset(),this.W_=null,this.pipeTypes=null,this.vertColorEnabled=!1,this.premultiplyAlpha=!1,this.shadowReceiveEnabled=!1,this.lightEnabled=!1,this.fogEnabled=!1,this.envAmbientLightEnabled=!1,this.brightnessOverlayEnabeld=!1,this.glossinessEnabeld=!0,this.keysString=""}clear(){this.D_8=null}setShaderCodeObject(t){this.D_9=t}getShaderCodeObject(){return this.D_9}getShaderCodeObjectUUID(){return r.ShaderCodeUUID.None}getShaderCodeBuilder(){return _.E_F}static GetPreCompileInfo(){return _.E_F.getPreCompileInfo()}initialize(t){this.D_=t,this.bufInitWithPipeline()}buildDefine(){this.premultiplyAlpha&&(this.D_8.addDefine("VOX_PREMULTIPLY_ALPHA"),this.keysString+="A"),this.vertColorEnabled&&(this.D_8.addDefine("VOX_USE_VTX_COLOR"),this.keysString+="UVC"),this.brightnessOverlayEnabeld&&(this.D_8.addDefine("VOX_USE_BRIGHTNESS_OVERLAY_COLOR"),this.keysString+="UBOC"),this.glossinessEnabeld&&(this.D_8.addDefine("VOX_USE_GLOSSINESS"),this.keysString+="UG")}buildPipelineParams(){null!=this.pipeline&&null==this.pipeTypes&&(this.pipeTypes=[],this.lightEnabled&&this.pipeTypes.push(h.MaterialPipeType.GLOBAL_LIGHT),this.shadowReceiveEnabled&&this.pipeTypes.push(h.MaterialPipeType.VSM_SHADOW),this.fogEnabled&&this.pipeTypes.push(h.MaterialPipeType.FOG_EXP2),this.envAmbientLightEnabled&&this.pipeTypes.push(h.MaterialPipeType.ENV_AMBIENT_LIGHT))}getTexturesFromPipeline(t){null!=this.pipeline&&this.pipeline.getTextures(this.D_8,t,this.pipeTypes)}bufInitWithPipeline(){null!=this.pipeline&&(this.buildPipelineParams(),this.pipeline.buildSharedUniforms(this.pipeTypes),this.pipeline.createKeys(this.pipeTypes),this.keysString+=this.pipeline.getKeysString())}isTexEanbled(){return this.D_}setIRenderTextureList(t){this.W_=t}getIRenderTextureList(){return this.W_}buildShader(){}getFragShaderCode(){return this.D_8.buildFragCode()}getVertShaderCode(){return this.D_8.buildVertCode()}getUniqueShaderName(){throw Error("Illgel operation !!!")}toString(){return"[ShaderCodeBuffer()]"}}e.default=_},fb15:function(t,e,s){"use strict";s.r(e);s("1eb2");var i=s("50e8"),r=s.n(i);for(var a in i)["default"].indexOf(a)<0&&function(t){s.d(e,t,(function(){return i[t]}))}(a);e["default"]=r.a},fc07:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=i(s("2e8a")),h=i(s("78e9"));class n{constructor(){this.EC=new Map,this.attriNSList=null,this.attriSizeList=null,this.uniformNameListStr="",this.texUniformNameListStr="",this.attributes=[null,null,null,null,null,null,null,null,null,null,null,null],this.uniforms=null,this.texTotal=0,this.fragOutputTotal=0}reset(){this.attriNSList=null,this.uniformNameListStr="",this.texUniformNameListStr="";let t=0;for(;t<12;++t)this.attributes[t]=null;this.uniforms=null,this.EC.clear(),this.texTotal=0}parseVShaderCode(t){let e=new RegExp(";","g");t=t.replace(e,";\n"),t=t.replace("{","{\n"),t=t.replace("}","\n}");let s="\n",i=t.indexOf(s),r=0,n=[],l="",_="",o=new RegExp(" ","g");while(i>=0)l=t.slice(r,i),l.length>0&&(_=l.replace(o,""),0!=_.indexOf("//")&&n.push(l)),r=i+1,i=t.indexOf(s,r);l=t.slice(r,t.length),l.length>0&&(_=l.replace(o,""),0!=_.indexOf("//")&&n.push(l));let m="uniform ",u=n.length,d=null;for(i=0;i<12;++i)this.attributes[i]=null;this.attriNSList=[],this.attriSizeList=[];let c=null;null==this.uniforms&&(this.uniforms=[]),i=0;let f=!1,p=!1;while(i<u)l=n[i],f=l.indexOf("layout")>=0,p=l.indexOf("attribute ")>=0,f&&l.indexOf("location")>0||p?(d=new a.default,d.layoutEnabled=f,d.parseCode(l),this.attributes[d.attriType]=d,this.attriNSList.push(d.name),this.attriSizeList.push(d.typeSize)):l.indexOf(m)>=0&&(c=new h.default,c.parseCode(l)&&(this.uniforms.push(c),this.uniformNameListStr+=c.name+",",c.isTex&&!this.EC.has(c.name)&&(this.EC.set(c.name,1),this.texUniformNameListStr+=c.name+",",this.texTotal++))),++i}parseFShaderCode(t){let e=new RegExp(";","g");t=t.replace(e,";\n"),t=t.replace("{","{\n"),t=t.replace("}","\n}");let s="\n",i=t.indexOf(s),a=0,n=[],l="",_="",o=new RegExp(" ","g");while(i>=0)l=t.slice(a,i),l.length>0&&(_=l.replace(o,""),0!=_.indexOf("//")&&n.push(l)),a=i+1,i=t.indexOf(s,a);l=t.slice(a,t.length),l.length>0&&(_=_.replace(o,""),0!=_.indexOf("//")&&n.push(l));let m="uniform ",u=n.length,d=null;null==this.uniforms&&(this.uniforms=[]),i=0;while(i<u)l=n[i],l.indexOf(m)>=0&&this.uniformNameListStr.indexOf(m)<0&&(d=new h.default,d.parseCode(l)&&(this.uniforms.push(d),this.uniformNameListStr+=d.name+",",d.isTex&&!this.EC.has(d.name)&&(this.EC.set(d.name,1),this.texUniformNameListStr+=d.name+",",this.texTotal++))),++i;let c="layout";r.default.IsWebGL1()&&(c="gl_FragData"),i=t.indexOf(c),this.fragOutputTotal=0;while(i>0)this.fragOutputTotal++,i=t.indexOf(c,i+2);this.fragOutputTotal<1&&(this.fragOutputTotal=1)}}e.default=n},fe7f:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("7918"),a=s("8d98"),h=i(s("df25"));class n extends h.default{constructor(t,e,s=!1){super(t,e,s),this.j=r.TextureProxyType.Bytes}toAlphaFormat(){this.srcFormat=a.TextureFormat.ALPHA,this.internalFormat=a.TextureFormat.ALPHA,this.unpackAlignment=1}toRedFormat(){this.srcFormat=a.TextureFormat.RED,this.internalFormat=a.TextureFormat.RED,this.unpackAlignment=1}toRGBFormat(){this.srcFormat=a.TextureFormat.RGB,this.internalFormat=a.TextureFormat.RGB,this.unpackAlignment=3}toRGBAFormat(){this.srcFormat=a.TextureFormat.RGBA,this.internalFormat=a.TextureFormat.RGBA,this.unpackAlignment=4}setDataFromBytes(t,e=0,s=-1,i=-1,r=0,a=0,h=!1){super.setDataFromBytes(t,e,s,i,r,a,h)}setPartDataFromeBytes(t,e,s,i,r,a=0){super.setPartDataFromeBytes(t,e,s,i,r,a)}getPixels(t,e,s,i,r){super.getPixels(t,e,s,i,r)}toString(){return"[BytesTextureProxy(width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=n},fecb:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("8e17"));class h{constructor(){this.min=new a.default(r.default.MATH_MAX_POSITIVE,r.default.MATH_MAX_POSITIVE,r.default.MATH_MAX_POSITIVE),this.max=new a.default(r.default.MATH_MIN_NEGATIVE,r.default.MATH_MIN_NEGATIVE,r.default.MATH_MIN_NEGATIVE),this.version=-1,this.radius=50,this.radius2=2500,this.center=new a.default(0,0,0),this.ED=100,this.BQ=100,this.BR=100,this.EE=50,this.EF=50,this.EG=50,this.C_=new a.default}getLong(){return this.ED}getWidth(){return this.BQ}getHeight(){return this.BR}reset(){this.min.setXYZ(r.default.MATH_MAX_POSITIVE,r.default.MATH_MAX_POSITIVE,r.default.MATH_MAX_POSITIVE),this.max.setXYZ(r.default.MATH_MIN_NEGATIVE,r.default.MATH_MIN_NEGATIVE,r.default.MATH_MIN_NEGATIVE)}equals(t){return this.min.equalsXYZ(t.min)&&this.max.equalsXYZ(t.max)}setVolume(t,e,s){this.BQ=t,this.BR=e,this.ED=s,this.EE=.5*this.ED,this.EF=.5*this.BQ,this.EG=.5*this.BR,this.max.x=this.center.x+this.EF,this.max.y=this.center.y+this.EG,this.max.z=this.center.z+this.EE,this.min.x=this.center.x-this.EF,this.min.y=this.center.y-this.EG,this.min.z=this.center.z-this.EE,this.radius2=this.EF*this.EF+this.EG*this.EG+this.EE*this.EE,this.radius=Math.sqrt(this.radius2)}union(t){this.addPosition(t.min),this.addPosition(t.max)}addPosition(t){this.min.x>t.x&&(this.min.x=t.x),this.min.y>t.y&&(this.min.y=t.y),this.min.z>t.z&&(this.min.z=t.z),this.max.x<t.x&&(this.max.x=t.x),this.max.y<t.y&&(this.max.y=t.y),this.max.z<t.z&&(this.max.z=t.z)}addXYZ(t,e,s){this.min.x>t&&(this.min.x=t),this.min.y>e&&(this.min.y=e),this.min.z>s&&(this.min.z=s),this.max.x<t&&(this.max.x=t),this.max.y<e&&(this.max.y=e),this.max.z<s&&(this.max.z=s)}addXYZFloat32Arr(t,e=3){let s=t.length,i=0,r=0,a=0;for(let h=0;h<s;)i=t[h],r=t[h+1],a=t[h+2],h+=e,this.min.x>i&&(this.min.x=i),this.min.y>r&&(this.min.y=r),this.min.z>a&&(this.min.z=a),this.max.x<i&&(this.max.x=i),this.max.y<r&&(this.max.y=r),this.max.z<a&&(this.max.z=a)}addXYZFloat32AndIndicesArr(t,e){let s,i=e.length,r=0,a=0,h=0;for(let n=0;n<i;n++)s=3*n,r=t[s++],a=t[s++],h=t[s],this.min.x>r&&(this.min.x=r),this.min.y>a&&(this.min.y=a),this.min.z>h&&(this.min.z=h),this.max.x<r&&(this.max.x=r),this.max.y<a&&(this.max.y=a),this.max.z<h&&(this.max.z=h)}getClosePosition(t,e,s=0){e.copyFrom(t),e.x<this.min.x?e.x=this.min.x+s:e.x>this.max.x&&(e.x=this.max.x-s),e.y<this.min.y?e.y=this.min.y+s:e.y>this.max.y&&(e.y=this.max.y-s),e.z<this.min.z?e.z=this.min.z+s:e.z>this.max.z&&(e.z=this.max.z-s)}containsV(t){return!(t.x<this.max.x||t.x>this.max.x)&&(!(t.y<this.max.y||t.y>this.max.y)&&!(t.z<this.max.z||t.z>this.max.z))}containsXY(t,e){return!(t<this.min.x||t>this.max.x)&&!(e<this.min.y||e>this.max.y)}containsXZ(t,e){return!(t<this.min.x||t>this.max.x)&&!(e<this.min.z||e>this.max.z)}containsYZ(t,e){return!(t<this.min.y||t>this.max.y)&&!(e<this.min.z||e>this.max.z)}copyFrom(t){this.radius=t.radius,this.radius2=t.radius2,this.min.copyFrom(t.min),this.max.copyFrom(t.max),this.center.copyFrom(t.center),this.updateVolume()}expand(t){this.min.subtractBy(t),this.max.addBy(t)}updateVolume(){this.BQ=this.max.x-this.min.x,this.BR=this.max.y-this.min.y,this.ED=this.max.z-this.min.z,this.EE=.5*this.ED,this.EF=.5*this.BQ,this.EG=.5*this.BR,++this.version}updateThis(){this.center.x=.5*this.BQ,this.center.y=.5*this.BR,this.center.z=.5*this.ED,this.EE=this.center.z,this.EF=this.center.x,this.EG=this.center.y,this.radius2=this.EF*this.EF+this.EG*this.EG+this.EE*this.EE,this.radius=Math.sqrt(this.radius2),this.center.addBy(this.min),++this.version}update(){this.BQ=this.max.x,this.min.x>this.max.x&&(this.max.x=this.min.x,this.min.x=this.BQ),this.BQ=this.max.x-this.min.x,this.BR=this.max.y,this.min.y>this.max.y&&(this.max.y=this.min.y,this.min.y=this.BR),this.BR=this.max.y-this.min.y,this.ED=this.max.z,this.min.z>this.max.z&&(this.max.z=this.min.z,this.min.z=this.ED),this.ED=this.max.z-this.min.z,this.updateThis()}updateFast(){this.BQ=this.max.x-this.min.x,this.BR=this.max.y-this.min.y,this.ED=this.max.z-this.min.z,this.updateThis()}toString(){return"[AABB(min->"+this.min+",size("+this.BQ+","+this.BR+","+this.ED+"))]"}sphereIntersect(t,e){this.C_.x=this.center.x-t.x,this.C_.y=this.center.y-t.y,this.C_.z=this.center.z-t.z;let s=this.C_.getLengthSquared();return s<this.radius2||(e+=this.radius,e*=e,e>=s)}}e.default=h}})}));