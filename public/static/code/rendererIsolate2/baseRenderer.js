(function(t,e){"object"===typeof exports&&"object"===typeof module?module.exports=e():"function"===typeof define&&define.amd?define([],e):"object"===typeof exports?exports["VoxApp"]=e():t["VoxApp"]=e()})("undefined"!==typeof self?self:this,(function(){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(s,r,function(e){return t[e]}.bind(null,r));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s="fae3")}({"02ed":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8e17")),a=s(i("f48d")),h=s(i("d1a0"));class _ extends a.default{constructor(){super(...arguments),this.tv=new r.default(1,0,0)}update(){this.tv.normalize()}updateFast(){this.tv.normalize()}static CalcPVSquaredDis2(t,e,i){let s=_.__tAv;return s.x=i.x-e.x,s.y=i.y-e.y,s.z=i.z-e.z,s.w=s.dot(t),s.x-=s.w*t.x,s.y-=s.w*t.y,s.z-=s.w*t.z,s.getLengthSquared()}static CalcPVDis(t,e,i){let s=_.__tAv;s.x=i.x-e.x,s.y=i.y-e.y,s.z=i.z-e.z;let r=s.dot(t);return s.x=r*t.x+e.x,s.y=r*t.y+e.y,s.z=r*t.z+e.z,s.x=i.x-s.x,s.y=i.y-s.y,s.z=i.z-s.z,s.getLength()}static CalcPVCloseV2(t,e,i,s){s.x=i.x-t.x,s.y=i.y-t.y,s.z=i.z-t.z;let r=s.dot(e);s.x=r*e.x+t.x,s.y=r*e.y+t.y,s.z=r*e.z+t.z}static IntersectionCopSLV2(t,e,i,s,_){r.default.Cross(e,s,a.default.__tV1),r.default.Cross(e,a.default.__tV1,a.default.__tV2),a.default.__tV2.normalize(),h.default.IntersectionSLV2(a.default.__tV2,a.default.__tV2.dot(t),i,s,_)}static CalcTwoSLCloseV2(t,e,i,s,_){r.default.Cross(e,s,a.default.__tV1),r.default.Cross(e,a.default.__tV1,a.default.__tV2),a.default.__tV2.normalize(),h.default.IntersectionSLV2(a.default.__tV2,a.default.__tV2.dot(t),i,s,_),_.subtractBy(i),_.w=_.dot(s),_.x=_.w*s.x+i.x,_.y=_.w*s.y+i.y,_.z=_.w*s.z+i.z,_.w=1}static CalcTwoSLDualCloseV2(t,e,i,s,_,l){r.default.Cross(e,s,a.default.__tV1),r.default.Cross(e,a.default.__tV1,a.default.__tV2),a.default.__tV2.normalize(),h.default.IntersectionSLV2(a.default.__tV2,a.default.__tV2.dot(t),i,s,_),l.copyFrom(i),_.subtractBy(t),_.w=_.dot(e),_.x=_.w*e.x+t.x,_.y=_.w*e.y+t.y,_.z=_.w*e.z+t.z,_.w=1,l.subtractBy(_),l.w=l.dot(a.default.__tV1),l.x=l.w*a.default.__tV1.x+_.x,l.y=l.w*a.default.__tV1.y+_.y,l.z=l.w*a.default.__tV1.z+_.z,l.w=1}}_.__tAv=new r.default,e.StraightLine=_,e.default=_},"030e":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{static Initialize(t,e){let i=this;1==t?(i.OES_standard_derivatives=e.getExtension("OES_standard_derivatives"),i.OES_standard_derivatives,i.EXT_shader_texture_lod=e.getExtension("EXT_shader_texture_lod"),i.EXT_shader_texture_lod,i.WEBGL_draw_buffers=e.getExtension("WEBGL_draw_buffers"),i.WEBGL_draw_buffers,i.OES_vertex_array_object=e.getExtension("OES_vertex_array_object"),i.OES_vertex_array_object,i.ANGLE_instanced_arrays=e.getExtension("ANGLE_instanced_arrays"),i.ANGLE_instanced_arrays,i.EXT_color_buffer_float=e.getExtension("EXT_color_buffer_float"),i.EXT_color_buffer_float,i.EXT_color_buffer_half_float=e.getExtension("EXT_color_buffer_half_float"),i.EXT_color_buffer_half_float,i.OES_texture_half_float=e.getExtension("OES_texture_half_float"),i.OES_texture_half_float,i.OES_texture_half_float_linear=e.getExtension("OES_texture_half_float_linear"),i.OES_texture_half_float_linear,i.OES_texture_float=e.getExtension("OES_texture_float"),i.OES_texture_float,i.OES_element_index_uint=e.getExtension("OES_element_index_uint"),i.OES_element_index_uint,i.EXT_blend_minmax=e.getExtension("EXT_blend_minmax"),i.EXT_blend_minmax):(i.EXT_shader_texture_lod=e.getExtension("EXT_shader_texture_lod"),i.EXT_shader_texture_lod,i.EXT_color_buffer_half_float=e.getExtension("EXT_color_buffer_half_float"),i.EXT_color_buffer_half_float,i.OES_texture_half_float_linear=e.getExtension("OES_texture_half_float_linear"),i.OES_texture_half_float_linear,i.EXT_color_buffer_float=e.getExtension("EXT_color_buffer_float"),i.EXT_color_buffer_float),i.OES_texture_float_linear=e.getExtension("OES_texture_float_linear"),i.OES_texture_float_linear,i.WEBGL_depth_texture=e.getExtension("WEBGL_depth_texture"),i.WEBGL_depth_texture,i.WEBGL_debug_renderer_info=e.getExtension("WEBGL_debug_renderer_info"),i.WEBGL_debug_renderer_info}}s.OES_standard_derivatives=null,s.EXT_shader_texture_lod=null,s.WEBGL_draw_buffers=null,s.OES_vertex_array_object=null,s.ANGLE_instanced_arrays=null,s.EXT_color_buffer_float=null,s.EXT_color_buffer_half_float=null,s.OES_texture_float_linear=null,s.OES_texture_half_float_linear=null,s.OES_texture_half_float=null,s.OES_texture_float=null,s.OES_element_index_uint=null,s.EXT_blend_minmax=null,s.WEBGL_depth_texture=null,s.WEBGL_debug_renderer_info=null,e.default=s},"090c":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("3bda")),a=s(i("030e")),h=s(i("3b73")),_=s(i("b0ef")),l=s(i("0c85")),n=i("e08e");class o{constructor(){this.m_uid=o.s_uid++,this.m_mouseEvtDisplather=new l.default,this.m_div=null,this.m_canvas=null,this.m_document=null,this.m_scissorEnabled=!1,this.m_depthTestEnabled=!0,this.m_stencilTestEnabled=!0,this.m_offcanvas=null,this.m_gl=null,this.m_stage=null,this.m_viewX=0,this.m_viewY=0,this.m_viewWidth=800,this.m_viewHeight=600,this.m_maxWebGLVersion=2,this.m_webGLVersion=2,this.m_devicePixelRatio=1,this.m_viewEle=new _.default,this.autoSyncRenderBufferAndWindowSize=!0,this.offscreenRenderEnabled=!1,this.m_WEBGL_lose_context=null,this.m_displayWidth=0,this.m_displayHeight=0,this.m_rcanvasWidth=0,this.m_rcanvasHeight=0,this.m_resizeCallback=null,this.m_resizeCallbackTarget=null}contextrestoredHandler(t){}contextlostHandler(t){}setWebGLMaxVersion(t){1!=t&&2!=t||(this.m_maxWebGLVersion=t)}getWebGLVersion(){return this.m_webGLVersion}getDiv(){return this.m_div}setDivStyleLeftAndTop(t,e){this.m_viewEle.setDivStyleLeftAndTop(t,e)}setDivStyleSize(t,e){this.m_viewEle.setDivStyleSize(t,e)}getCanvas(){return this.m_canvas}isDepthTestEnabled(){return this.m_depthTestEnabled}isStencilTestEnabled(){return this.m_stencilTestEnabled}initialize(t,e,i,s=null){this.m_stage=e;var _=null,l=null;try{void 0!=document&&(_=document,l=window)}catch(m){}if(null!=_){this.m_viewEle.setDiv(i),this.m_viewEle.createViewEle(_,this.autoSyncRenderBufferAndWindowSize),this.m_div=i=this.m_viewEle.getDiv();let m=this.m_canvas=this.m_viewEle.getCanvas();this.m_devicePixelRatio=window.devicePixelRatio,this.m_mouseEvtDisplather.dpr=this.m_devicePixelRatio;let d=s;null==s?d={depth:this.m_depthTestEnabled,premultipliedAlpha:!1,alpha:!0,antialias:!1,stencil:this.m_stencilTestEnabled,preserveDrawingBuffer:!0,powerPreference:"default"}:(this.m_depthTestEnabled=d.depth,this.m_stencilTestEnabled=d.stencil);let u=null;if(this.offscreenRenderEnabled&&(u=m.transferControlToOffscreen()),this.m_offcanvas=u,2==this.m_maxWebGLVersion&&(this.m_gl=null==u?m.getContext("webgl2",d):u.getContext("webgl2",d),null!=this.m_gl&&(this.m_webGLVersion=2)),null==this.m_gl&&(this.m_gl=null==u?m.getContext("webgl",d)||m.getContext("experimental-webgl",d):u.getContext("webgl",d)||u.getContext("experimental-webgl",d),null!=this.m_gl&&(this.m_webGLVersion=1)),!this.m_gl)throw this.m_webGLVersion=-1,alert("Unable to initialize WebGL. Your browser or machine may not support it."),Error("WebGL initialization failure.");let c=this.m_gl;c.rcuid=t;let f=n.GLStencilFunc;f.NEVER=c.NEVER,f.LESS=c.LESS,f.EQUAL=c.EQUAL,f.GREATER=c.GREATER,f.NOTEQUAL=c.NOTEQUAL,f.GEQUAL=c.GEQUAL,f.ALWAYS=c.ALWAYS;let p=n.GLStencilOp;p.KEEP=c.KEEP,p.ZERO=c.ZERO,p.REPLACE=c.REPLACE,p.INCR=c.INCR,p.INCR_WRAP=c.INCR_WRAP,p.DECR=c.DECR,p.DECR_WRAP=c.DECR_WRAP,p.INVERT=c.INVERT;let g=n.GLBlendMode;g.ZERO=c.ZERO,g.ONE=c.ONE,g.SRC_COLOR=c.SRC_COLOR,g.DST_COLOR=c.DST_COLOR,g.SRC_ALPHA=c.SRC_ALPHA,g.DST_ALPHA=c.DST_ALPHA,g.ONE_MINUS_SRC_ALPHA=c.ONE_MINUS_SRC_ALPHA;let S=n.GLBlendEquation;S.FUNC_ADD=c.FUNC_ADD,S.FUNC_SUBTRACT=c.FUNC_SUBTRACT,S.FUNC_REVERSE_SUBTRACT=c.FUNC_REVERSE_SUBTRACT,S.MIN_EXT=c.MIN_EXT,S.MAX_EXT=c.MAX_EXT,S.MIN=c.MIN,S.MAX=c.MAX;let A=n.CullFaceMode;A.BACK=c.BACK,A.FRONT=c.FRONT,A.FRONT_AND_BACK=c.FRONT_AND_BACK;let E=h.default;E.MAX_TEXTURE_SIZE=this.m_gl.getParameter(this.m_gl.MAX_TEXTURE_SIZE),E.MAX_RENDERBUFFER_SIZE=this.m_gl.getParameter(this.m_gl.MAX_RENDERBUFFER_SIZE);let R=this.m_gl.getParameter(this.m_gl.MAX_VIEWPORT_DIMS);E.MAX_VIEWPORT_WIDTH=R[0],E.MAX_VIEWPORT_HEIGHT=R[1],a.default.Initialize(this.m_webGLVersion,this.m_gl),h.default.Initialize([this.m_webGLVersion]),null!=e&&this.m_mouseEvtDisplather.initialize(m,i,e);let T=a.default.WEBGL_debug_renderer_info;if(null!=T){let t=this.m_gl.getParameter(T.UNMASKED_VENDOR_WEBGL),e=this.m_gl.getParameter(T.UNMASKED_RENDERER_WEBGL);E.GPU_VENDOR=t,E.GPU_RENDERER=t,r.default.ShowLog("webgl_vendor: "+t),r.default.ShowLog("webgl_renderer: "+e)}var o=this;l.onresize=function(t){o.autoSyncRenderBufferAndWindowSize&&o.updateRenderBufferSize()},m.addEventListener("webglcontextrestored",this.contextrestoredHandler,!1),m.addEventListener("webglcontextlost",this.contextlostHandler,!1),this.updateRenderBufferSize()}}loseContext(){null==this.m_WEBGL_lose_context&&(this.m_WEBGL_lose_context=this.m_gl.getExtension("WEBGL_lose_context")),null==this.m_WEBGL_lose_context&&this.m_WEBGL_lose_context.loseContext()}isContextLost(){return this.m_gl.isContextLost()}getRC(){return this.m_gl}setScissorEnabled(t){t?this.m_scissorEnabled||(this.m_scissorEnabled=!0,this.m_gl.enable(this.m_gl.SCISSOR_TEST)):this.m_scissorEnabled&&(this.m_scissorEnabled=!1,this.m_gl.disable(this.m_gl.SCISSOR_TEST))}setScissorRect(t,e,i,s){this.m_gl.scissor(t,e,i,s)}setResizeCallback(t,e){this.m_resizeCallbackTarget=t,this.m_resizeCallback=e}getDevicePixelRatio(){return this.m_devicePixelRatio}resizeBufferSize(t,e){t=Math.floor(t),e=Math.floor(e);let i=window.devicePixelRatio,s=Math.abs(i-this.m_devicePixelRatio)>.02;this.m_devicePixelRatio=i,this.m_mouseEvtDisplather.dpr=i,h.default.SetDevicePixelRatio(this.m_devicePixelRatio),(this.m_displayWidth!=t||this.m_displayHeight!=e||s)&&(this.m_displayWidth=t,this.m_displayHeight=e,this.m_rcanvasWidth=Math.floor(t*i),this.m_rcanvasHeight=Math.floor(e*i),null==this.m_offcanvas?(this.m_canvas.width=this.m_rcanvasWidth,this.m_canvas.height=this.m_rcanvasHeight):(this.m_offcanvas.width=this.m_rcanvasWidth,this.m_offcanvas.height=this.m_rcanvasHeight),this.m_canvas.style.width=this.m_displayWidth+"px",this.m_canvas.style.height=this.m_displayHeight+"px",null!=this.m_stage&&(this.m_stage.stageWidth=this.m_rcanvasWidth,this.m_stage.stageHeight=this.m_rcanvasHeight,this.m_stage.viewWidth=this.m_displayWidth,this.m_stage.viewHeight=this.m_displayHeight,this.m_stage.pixelRatio=i,this.m_stage.update()),null!=this.m_resizeCallback&&this.m_resizeCallback.call(this.m_resizeCallbackTarget))}getStage(){return this.m_stage}getStageWidth(){return this.m_stage.stageWidth}getStageHeight(){return this.m_stage.stageHeight}getDisplayWidth(){return this.m_displayWidth}getDisplayHeight(){return this.m_displayHeight}setViewport(t,e,i,s){let r=this.m_viewX!=t||this.m_viewY!=e;(this.m_viewWidth!=i||this.m_viewHeight!=s||r)&&(this.m_viewX=t,this.m_viewY=e,this.m_viewWidth=i,this.m_viewHeight=s)}setViewportSize(t,e){this.m_viewWidth==t&&this.m_viewHeight==e||(this.m_viewWidth=t,this.m_viewHeight=e)}testViewPortChanged(t,e,i,s){return this.m_viewX!=t||this.m_viewY!=e||this.m_viewWidth!=i||this.m_viewHeight!=s}getViewportX(){return this.m_viewX}getViewportY(){return this.m_viewY}getViewportWidth(){return this.m_viewWidth}getViewportHeight(){return this.m_viewHeight}getFBOWidth(){return this.m_viewWidth<h.default.MAX_RENDERBUFFER_SIZE?this.m_viewWidth:h.default.MAX_RENDERBUFFER_SIZE}getFBOHeight(){return this.m_viewHeight<h.default.MAX_RENDERBUFFER_SIZE?this.m_viewHeight:h.default.MAX_RENDERBUFFER_SIZE}getRCanvasWidth(){return this.m_rcanvasWidth}getRCanvasHeight(){return this.m_rcanvasHeight}updateRenderBufferSize(){let t=this.m_div.getBoundingClientRect();this.resizeBufferSize(t.width,t.height)}}o.s_uid=0,e.default=o},"0c85":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("3b73"));class a{constructor(){this.m_singleDown=!1,this.dpr=1}initMobile(t,e,i){var s=null;try{void 0!=document&&(s=document,window)}catch(a){}if(null!=s){let t=this;if(e.addEventListener("touchstart",(function(e){let s=e.targetTouches,r=0,a=0;if(s.length<2)r=0|t.dpr*e.targetTouches[0].pageX,a=0|t.dpr*e.targetTouches[0].pageY,i.mouseX=r,i.mouseY=i.stageHeight-a,i.mouseViewX=r,i.mouseViewY=a,t.m_singleDown=!0,i.mouseDown(1);else{let h=[];for(let i=0;i<s.length;++i)r=0|t.dpr*e.targetTouches[i].pageX,a=0|t.dpr*e.targetTouches[i].pageY,h.push({x:r,y:a});i.mouseMultiDown(h),t.m_singleDown=!1}e.preventDefault()}),!1),e.addEventListener("touchend",(function(e){t.m_singleDown=!1;let s=e.targetTouches,r=0,a=0;if(s.length<1)i.mouseUp(1);else{let h=[];for(let i=0;i<s.length;++i)r=0|t.dpr*e.targetTouches[i].pageX,a=0|t.dpr*e.targetTouches[i].pageY,h.push({x:r,y:a});i.mouseMultiUp(h)}e.preventDefault()}),!1),e.addEventListener("touchcancel",(function(e){t.m_singleDown=!1;e.targetTouches;i.mouseCancel(),e.preventDefault()}),!1),e.addEventListener("touchmove",(function(e){e.preventDefault();let s=e.targetTouches,r=0,a=0;if(t.m_singleDown&&(r=0|t.dpr*s[0].pageX,a=0|t.dpr*s[0].pageY,i.mouseViewX=r,i.mouseViewY=a,i.mouseX=r,i.mouseY=i.stageHeight-a,i.mouseMove()),s.length>1){let h=[];for(let i=0;i<s.length;++i)r=0|t.dpr*e.targetTouches[i].pageX,a=0|t.dpr*e.targetTouches[i].pageY,h.push({x:r,y:a});i.mouseMultiMove(h)}}),{passive:!1},!1),r.default.IsIpadOS()){let t=document.createElement("meta");t.name="viewport",t.content="width=device-width,initial-scale=1.0,minimum-scale=1.0, maximum-scale=1.0, user-scalable=no",document.getElementsByTagName("head")[0].appendChild(t)}}}initialize(t,e,i){r.default.IsMobileWeb()||r.default.IsIpadOS()?this.initMobile(t,e,i):this.initPC(t,e,i)}initPC(t,e,i){var s=null;try{void 0!=document&&(s=document,window)}catch(r){}if(null!=s){let s=this;if(void 0==t.onmousewheel&&void 0!=t.addEventListener){let e=function(t){t.wheelDeltaY=-t.detail,i.mouseWheel(t)};t.addEventListener("DOMMouseScroll",e,!1)}t.onmousewheel=function(t){i.mouseWheel(t)},t.onmousedown=function(t){let r=e.getBoundingClientRect(),a=0|s.dpr*(t.clientX-r.left),h=0|s.dpr*(t.clientY-r.top);i.mouseX=a,i.mouseY=i.stageHeight-h,i.mouseViewX=a,i.mouseViewY=h,0==t.button?i.mouseDown(1):2==t.button&&i.mouseRightDown(1)},t.onmouseup=function(t){let r=e.getBoundingClientRect(),a=0|s.dpr*(t.clientX-r.left),h=0|s.dpr*(t.clientY-r.top);i.mouseX=a,i.mouseY=i.stageHeight-h,i.mouseViewX=a,i.mouseViewY=h,0==t.button?i.mouseUp(1):2==t.button&&i.mouseRightUp(1)},document.onmouseup=function(t){0==t.button?i.mouseWindowUp(1):2==t.button&&i.mouseWindowRightUp(1)},t.onmousemove=function(t){let r=e.getBoundingClientRect(),a=0|s.dpr*(t.clientX-r.left),h=0|s.dpr*(t.clientY-r.top);i.mouseX=a,i.mouseY=i.stageHeight-h,i.mouseViewX=a,i.mouseViewY=h,i.mouseMove()},t.onclick=function(t){let r=e.getBoundingClientRect(),a=0|s.dpr*(t.clientX-r.left),h=0|s.dpr*(t.clientY-r.top);i.mouseX=a,i.mouseY=i.stageHeight-h,i.mouseViewX=a,i.mouseViewY=h,0==t.button?i.mouseClick():2==t.button&&i.mouseRightClick()},t.ondblclick=function(t){let r=e.getBoundingClientRect(),a=0|s.dpr*(t.clientX-r.left),h=0|s.dpr*(t.clientY-r.top);i.mouseX=a,i.mouseY=i.stageHeight-h,i.mouseViewX=a,i.mouseViewY=h,0==t.button?i.mouseDoubleClick():t.button}}}}e.default=a},"0e01":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("5326")),a=s(i("29ef")),h=s(i("de9d")),_=s(i("4f27")),l=s(i("7499"));class n{constructor(t){this.m_adapter=null,this.m_renderProxy=null,this.m_materialProxy=null,this.m_Matrix4AllocateSize=0,this.m_cameraNear=.1,this.m_cameraFar=5e3,this.m_cameraFov=45,this.m_rcuid=0,this.m_rcuid=t,this.m_renderProxy=new h.default(t)}getRCUid(){return this.m_rcuid}getDiv(){return this.m_adapter.getDiv()}getCanvas(){return this.m_adapter.getCanvas()}getRenderAdapter(){return this.m_adapter}getRenderMaterialProxy(){return this.m_materialProxy}getRenderProxy(){return this.m_renderProxy}getTextureResTotal(){return this.m_renderProxy.Texture.getTextureResTotal()}getTextureAttachTotal(){return this.m_renderProxy.Texture.getAttachTotal()}getDevicePixelRatio(){return this.m_adapter.getDevicePixelRatio()}getStage3D(){return this.m_renderProxy.getStage3D()}getCamera(){return null!=this.m_renderProxy?this.m_renderProxy.getCamera():null}cameraLock(){this.m_renderProxy.cameraLock()}cameraUnlock(){this.m_renderProxy.cameraUnlock()}createCamera(){if(null==this.m_renderProxy)return this.m_renderProxy.createCamera()}updateCamera(){null!=this.m_renderProxy&&this.m_renderProxy.updateCamera()}updateCameraDataFromCamera(t){null!=this.m_renderProxy&&this.m_renderProxy.updateCameraDataFromCamera(t)}lockRenderColorMask(){null!=this.m_renderProxy&&this.m_renderProxy.lockRenderState()}unlockColorMask(){null!=this.m_renderProxy&&this.m_renderProxy.unlockRenderState()}useGlobalColorMask(t){null!=this.m_renderProxy&&(this.m_renderProxy.unlockRenderColorMask(),this.m_renderProxy.useRenderColorMask(t),this.m_renderProxy.lockRenderColorMask())}useGlobalRenderColorMaskByName(t){null!=this.m_renderProxy&&(this.m_renderProxy.unlockRenderColorMask(),this.m_renderProxy.useRenderColorMask(a.default.GetRenderColorMaskByName(t)),this.m_renderProxy.lockRenderColorMask())}lockRenderState(){null!=this.m_renderProxy&&this.m_renderProxy.lockRenderState()}unlockRenderState(){null!=this.m_renderProxy&&this.m_renderProxy.unlockRenderState()}useGlobalRenderState(t){null!=this.m_renderProxy&&(this.m_renderProxy.unlockRenderState(),this.m_renderProxy.useRenderState(t),this.m_renderProxy.lockRenderState())}useGlobalRenderStateByName(t){null!=this.m_renderProxy&&(this.m_renderProxy.unlockRenderState(),this.m_renderProxy.useRenderState(a.default.GetRenderStateByName(t)),this.m_renderProxy.lockRenderState())}lockMaterial(){null!=this.m_materialProxy&&this.m_materialProxy.lockMaterial()}unlockMaterial(){null!=this.m_materialProxy&&this.m_materialProxy.unlockMaterial()}isUnlockMaterial(){return this.m_materialProxy.isUnlockMatrial()}useGlobalMaterial(t,e=!1){null!=this.m_materialProxy&&(this.m_materialProxy.unlockMaterial(),e?this.m_materialProxy.unlockTexture():this.m_materialProxy.lockTexture(),this.m_materialProxy.useGlobalMaterial(t),this.m_materialProxy.lockMaterial())}clearBackBuffer(){this.m_renderProxy.clearBackBuffer()}setScissorRect(t,e,i,s){this.m_adapter.setScissorRect(t,e,i,s)}setScissorEnabled(t){this.m_adapter.setScissorEnabled(t)}setViewPort(t,e,i,s){this.m_renderProxy.setViewPort(t,e,i,s)}synFBOSizeWithViewport(){this.m_adapter.synFBOSizeWithViewport()}asynFBOSizeWithViewport(){this.m_adapter.asynFBOSizeWithViewport()}setFBOSizeFactorWithViewPort(t){this.m_adapter.setFBOSizeFactorWithViewPort(t)}createFBOAt(t,e,i,s,r=!1,a=!1,h=0){this.m_adapter.createFBOAt(t,e,i,s,r,a,h)}bindFBOAt(t,e){this.m_adapter.bindFBOAt(t,e)}setRenderToTexture(t,e=!1,i=!1,s=0){this.m_adapter.setRenderToTexture(t,e,i,s)}useFBO(t=!1,e=!1,i=!1){this.m_adapter.useFBO(t,e,i)}resetFBOAttachmentMask(t){this.m_adapter.resetFBOAttachmentMask(t)}setFBOAttachmentMaskAt(t,e){this.m_adapter.setFBOAttachmentMaskAt(t,e)}setRenderToBackBuffer(){null!=this.m_adapter&&(this.m_adapter.setRenderToBackBuffer(),this.m_materialProxy.renderBegin())}lockViewport(){this.m_adapter.lockViewport()}unlockViewport(){this.m_adapter.unlockViewport()}setClearDepth(t){this.m_adapter.setClearDepth(t)}getClearDepth(){return this.m_adapter.getClearDepth()}getViewportX(){return this.m_adapter.getViewportX()}getViewportY(){return this.m_adapter.getViewportY()}getViewportWidth(){return this.m_adapter.getViewportWidth()}getViewportHeight(){return this.m_adapter.getViewportHeight()}setContextViewSize(t,e){this.m_adapter.setContextViewSize(t,e)}setCameraParam(t,e,i){this.m_cameraFov=t,this.m_cameraNear=e,this.m_cameraFar=i,null!=this.m_renderProxy&&this.m_renderProxy.setCameraParam(t,e,i)}initialize(t,e,i,s){if(this.m_Matrix4AllocateSize,null==this.m_adapter){r.default.Initialize(this.m_renderProxy.getUid()),this.m_renderProxy.setCameraParam(this.m_cameraFov,this.m_cameraNear,this.m_cameraFar),this.m_renderProxy.setWebGLMaxVersion(t.maxWebGLVersion),this.m_renderProxy.initialize(t,e,i,i,s),this.m_rcuid=this.m_renderProxy.getRCUid(),s.initialize(this.m_rcuid,this.m_renderProxy.getRC(),this.m_renderProxy.getGLVersion()),this.m_adapter=this.m_renderProxy.getRenderAdapter(),this.m_adapter.bgColor.setRGBA4f(0,0,0,1);let a=this.m_renderProxy.getContext();a.setViewport(0,0,a.getRCanvasWidth(),a.getRCanvasHeight()),_.default.Initialize()}}initManager(t){null==this.m_materialProxy&&(this.m_materialProxy=new l.default,this.m_materialProxy.setDispBuilder(t))}setClearRGBColor3f(t,e,i){this.m_renderProxy.setClearRGBColor3f(t,e,i)}setClearRGBAColor4f(t,e,i,s){this.m_renderProxy.setClearRGBAColor4f(t,e,i,s)}getClearRGBAColor4f(t){t.copyFrom(this.m_adapter.bgColor)}updateRenderBufferSize(){this.m_adapter.updateRenderBufferSize()}vertexRenderBegin(){this.m_renderProxy.Vertex.renderBegin()}renderBegin(t=!0){null!=this.m_renderProxy&&(this.m_adapter.unlockViewport(),this.m_adapter.setClearDepth(1),this.m_renderProxy.Vertex.renderBegin(),this.m_materialProxy.renderBegin(),this.m_adapter.update(),this.m_adapter.setClearMaskClearAll(),this.m_adapter.renderBegin(),a.default.ResetInfo(),a.default.Reset(this.m_renderProxy.getRenderAdapter().getRenderContext()),t&&(this.m_renderProxy.useCameraData(),this.m_renderProxy.updateCameraDataFromCamera(this.m_renderProxy.getCamera())))}resetState(){a.default.ResetState(),this.m_materialProxy.renderBegin()}resetmaterial(){this.m_materialProxy.renderBegin()}resetUniform(){this.m_materialProxy.resetUniform()}runEnd(){}}e.default=n},"11e6":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{static AddContainerFlag(t){return 2147483648|t}static RemoveContainerFlag(t){return-2147483649&t}static AddSpaceUid(t,e){return-1048576&t|e}static RemoveSpaceUid(t){return-1048576&t}static GetSpaceUid(t){return 1048575&t}static AddRendererUid(t,e){return-133169153&t|e<<20}static RemoveRendererUid(t){return 133169152|t}static GetRendererUid(t){return(133169152&t)>>20}static AddSortEnabled(t){return 1073741824|t}static RemoveSortEnabled(t){return-1073741825&t}static TestSortEnabled(t){return 1073741824==(1073741824&t)}static AddRendererLoad(t){return 805306368|t}static RemoveRendererLoad(t){return-805306369&t}static TestSpaceContains(t){return(1048575&t)>0}static TestSpaceEnabled(t){return(1048575&t)<1}static TestSpaceEnabled2(t){return(1048575&t)<1&&2147483648!=(2147483648&t)}static TestContainerEnabled(t){return 133169152==(133169152&t)&&2147483648!=(2147483648&t)}static TestRendererEnabled(t){return 133169152==(938475520&t)&&2147483648!=(2147483648&t)}}s.DEFAULT=133169152,s.CONTAINER_FLAG=2147483648,s.CONTAINER_NOT_FLAG=-2147483649,s.SPACE_FLAT=1048575,s.SPACE_NOT_FLAT=-1048576,s.RENDERER_UID_FLAT=133169152,s.RENDERER_UID_NOT_FLAT=-133169153,s.SORT_FLAT=1073741824,s.SORT_NOT_FLAT=-1073741825,s.RENDERER_LOAD_FLAT=805306368,s.RENDERER_LOAD_NOT_FLAT=-805306369,s.RENDERER_ADN_LOAD_FLAT=938475520,e.default=s},1216:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8e17")),a=s(i("3930")),h=s(i("baae")),_=s(i("722e")),l=s(i("8333")),n=s(i("6d49")),o=i("e08e"),m=i("8d98"),d=i("7c63"),u=s(i("29ef")),c=s(i("3024"));class f{constructor(t,e){this.m_uid=f.s_uid++,this.m_rcuid=0,this.m_texResource=null,this.m_gl=null,this.m_fontFaceFlipped=!1,this.m_colorMask={mr:!0,mg:!0,mb:!0,ma:!0},this.m_rcontext=null,this.m_clearMask=0,this.m_fboBuf=null,this.m_fboIndex=0,this.m_fboType=h.default.FRAMEBUFFER,this.m_fboBufList=[null,null,null,null,null,null,null,null],this.m_fboClearBoo=!0,this.m_fboViewRectBoo=!1,this.m_viewX=0,this.m_viewY=0,this.m_viewWidth=800,this.m_viewHeight=600,this.m_clearDepth=1,this.m_preDepth=0,this.m_fboViewSize=new r.default(0,0,800,600),this.m_fboSizeFactor=1,this.m_clearStencil=0,this.m_fboBiltRect=new Uint16Array(8),this.m_fboViewRect=new Uint16Array(4),this.m_activeAttachmentTotal=1,this.m_scissorEnabled=!1,this.m_rState=null,this.m_webglVer=2,this.bgColor=new a.default,this.uViewProbe=null,this.m_polygonOffset=!1,this.m_devPRatio=1,this.m_viewportUnlock=!0,this.m_synFBOSizeWithViewport=!1,this.m_texResource=e,this.m_rcuid=t}initialize(t,e,i){if(null==this.m_rcontext&&(this.m_webglVer=t.getWebGLVersion(),this.m_rState=i,this.m_rcontext=t,this.m_gl=t.getRC(),this.m_gl.disable(this.m_gl.SCISSOR_TEST),t.isDepthTestEnabled()?this.m_gl.enable(this.m_gl.DEPTH_TEST):this.m_gl.disable(this.m_gl.DEPTH_TEST),t.isStencilTestEnabled()?this.m_gl.enable(this.m_gl.STENCIL_TEST):this.m_gl.disable(this.m_gl.STENCIL_TEST),this.m_gl.enable(this.m_gl.CULL_FACE),this.m_gl.cullFace(this.m_gl.BACK),this.m_gl.enable(this.m_gl.BLEND),e.getDitherEanbled()?this.m_gl.enable(this.m_gl.DITHER):this.m_gl.disable(this.m_gl.DITHER),this.m_gl.frontFace(this.m_gl.CCW),e.getPolygonOffsetEanbled()?this.m_gl.enable(this.m_gl.POLYGON_OFFSET_FILL):this.m_gl.disable(this.m_gl.POLYGON_OFFSET_FILL),this.m_clearMask=this.m_gl.COLOR_BUFFER_BIT|this.m_gl.DEPTH_BUFFER_BIT|this.m_gl.STENCIL_BUFFER_BIT,null==this.uViewProbe)){let t=this;t.uViewProbe=new c.default(1),this.uViewProbe.bindSlotAt(this.m_rcuid),this.uViewProbe.setVec4DataWithArr4([this.m_viewX,this.m_viewY,this.m_viewWidth,this.m_viewHeight])}}setFrontFaceFlipped(t){this.m_fontFaceFlipped!=t&&(t?this.m_gl.frontFace(this.m_gl.CW):this.m_gl.frontFace(this.m_gl.CCW),this.m_fontFaceFlipped=t)}setPolygonOffset(t,e=0){this.m_gl.polygonOffset(t,e),this.m_polygonOffset=!0}resetPolygonOffset(){this.m_polygonOffset&&(this.m_gl.polygonOffset(0,0),this.m_polygonOffset=!1)}getDiv(){return this.m_rcontext.getDiv()}getCanvas(){return this.m_rcontext.getCanvas()}setClearDepth(t){this.m_clearDepth=t}getClearDepth(){return this.m_clearDepth}setContextViewSize(t,e){this.m_rcontext.autoSyncRenderBufferAndWindowSize=!1,this.m_rcontext.resizeBufferSize(t,e)}getViewportX(){return this.m_rcontext.getViewportX()}getViewportY(){return this.m_rcontext.getViewportY()}getViewportWidth(){return this.m_rcontext.getViewportWidth()}getViewportHeight(){return this.m_rcontext.getViewportHeight()}getFBOFitWidth(){return this.m_rcontext.getFBOWidth()}getFBOFitHeight(){return this.m_rcontext.getFBOHeight()}getRCanvasWidth(){return this.m_rcontext.getRCanvasWidth()}getRCanvasHeight(){return this.m_rcontext.getRCanvasHeight()}setColorMask(t,e,i,s){this.m_colorMask.mr=t,this.m_colorMask.mg=e,this.m_colorMask.mb=i,this.m_colorMask.ma=s}setClearMaskClearAll(){this.m_clearMask=this.m_gl.COLOR_BUFFER_BIT|this.m_gl.DEPTH_BUFFER_BIT|this.m_gl.STENCIL_BUFFER_BIT}setClearMaskClearOnlyColor(){this.m_clearMask=this.m_gl.COLOR_BUFFER_BIT}setClearMaskClearOnlyDepthAndStencil(){this.m_clearMask=this.m_gl.DEPTH_BUFFER_BIT|this.m_gl.STENCIL_BUFFER_BIT}setScissorRect(t,e,i,s){this.m_scissorEnabled&&this.m_gl.scissor(t,e,i,s)}setScissorEnabled(t){t?this.m_scissorEnabled||(this.m_scissorEnabled=!0,this.m_gl.enable(this.m_gl.SCISSOR_TEST)):this.m_scissorEnabled&&(this.m_scissorEnabled=!1,this.m_gl.disable(this.m_gl.SCISSOR_TEST))}clear(){this.m_preDepth!==this.m_clearDepth&&(this.m_preDepth=this.m_clearDepth,this.m_gl.clearDepth(this.m_clearDepth)),this.m_rcontext.isStencilTestEnabled()&&this.m_gl.clearStencil(this.m_clearStencil),this.m_gl.clearColor(this.bgColor.r,this.bgColor.g,this.bgColor.b,this.bgColor.a),this.m_gl.clear(this.m_clearMask)}reset(){this.m_rState.setCullFaceMode(o.CullFaceMode.BACK),this.m_rState.setDepthTestMode(o.DepthTestMode.OPAQUE),u.default.Reset(this.m_gl)}getRenderContext(){return this.m_rcontext}renderBegin(){null!=this.m_rcontext&&(this.m_fboSizeFactor=1,this.reseizeViewPort(),d.RenderStateObject.Unlock(),d.RenderStateObject.UseRenderState(u.default.NORMAL_STATE),d.RenderColorMask.Unlock(),d.RenderColorMask.UseRenderState(d.RenderColorMask.ALL_TRUE_COLOR_MASK),this.clear())}reseizeViewPort(){if(this.m_viewportUnlock){let t=this.m_rcontext.getDevicePixelRatio(),e=this.m_viewX!=this.m_rcontext.getViewportX()||this.m_viewY!=this.m_rcontext.getViewportY();e=e||this.m_viewWidth!=this.m_rcontext.getViewportWidth(),e=e||this.m_viewHeight!=this.m_rcontext.getViewportHeight(),e=e||Math.abs(this.m_devPRatio-t)>.01,e&&(this.m_devPRatio=t,this.m_viewX=this.m_rcontext.getViewportX(),this.m_viewY=this.m_rcontext.getViewportY(),this.m_viewWidth=this.m_rcontext.getViewportWidth(),this.m_viewHeight=this.m_rcontext.getViewportHeight(),this.uViewProbe.setVec4Data(this.m_viewX,this.m_viewY,this.m_viewWidth,this.m_viewHeight),this.uViewProbe.update(),this.m_gl.viewport(this.m_viewX,this.m_viewY,this.m_viewWidth,this.m_viewHeight))}}reseizeFBOViewPort(){if(this.m_viewportUnlock){let t=this.m_rcontext.getDevicePixelRatio(),e=this.m_viewX!=this.m_fboViewSize.x||this.m_viewY!=this.m_fboViewSize.y;e=e||this.m_viewWidth!=this.m_fboViewSize.z,e=e||this.m_viewHeight!=this.m_fboViewSize.w,e=e||Math.abs(this.m_devPRatio-t)>.01,e&&(this.m_devPRatio=t,this.m_viewX=this.m_fboViewSize.x,this.m_viewY=this.m_fboViewSize.y,this.m_viewWidth=this.m_fboViewSize.z,this.m_viewHeight=this.m_fboViewSize.w,this.uViewProbe.setVec4Data(this.m_viewX,this.m_viewY,this.m_viewWidth,this.m_viewHeight),this.uViewProbe.update(),this.m_gl.viewport(this.m_viewX,this.m_viewY,this.m_viewWidth,this.m_viewHeight))}}setViewProbeValue(t,e,i,s){this.uViewProbe.setVec4Data(t,e,i,s),this.uViewProbe.update()}lockViewport(){this.m_viewportUnlock=!1}unlockViewport(){this.m_viewportUnlock=!0}renderEnd(){}update(){}updateRenderBufferSize(){this.m_rcontext.updateRenderBufferSize()}destroy(){this.m_rcontext=null,this.m_rState=null}getDevicePixelRatio(){return this.m_rcontext.getDevicePixelRatio()}loseContext(){this.m_rcontext.loseContext()}isContextLost(){return this.m_rcontext.isContextLost()}readPixels(t,e,i,s,r,a,h){this.m_gl.readPixels(t,e,i,s,m.TextureFormat.ToGL(this.m_gl,r),m.TextureDataType.ToGL(this.m_gl,a),h)}setFBOViewRect(t,e,i,s){this.m_fboViewRect[0]=t,this.m_fboViewRect[1]=e,this.m_fboViewRect[2]=i,this.m_fboViewRect[3]=s,this.m_fboViewRectBoo=!0}createFBOAt(t,e,i,s,r=!1,a=!1,h=0){null==this.m_fboBufList[t]&&(t>7&&(t=7),this.m_fboType=e,this.m_fboBuf=new n.default(this.m_rcuid,this.m_texResource,this.m_fboType),this.m_fboBuf.multisampleEnabled=h>0,this.m_fboBuf.multisampleLevel=h,this.m_fboBuf.writeDepthEnabled=r,this.m_fboBuf.writeStencilEnabled=a,this.m_fboBuf.initialize(this.m_gl,i,s),this.m_fboBufList[t]=this.m_fboBuf,this.m_fboBuf.sizeFixed=!0)}resizeFBOAt(t,e,i){t>7?t=7:t<0&&(t=0),null!=this.m_fboBufList[this.m_fboIndex]&&this.m_fboBufList[this.m_fboIndex].resize(e,i)}getFBOWidthAt(t){return null!=this.m_fboBufList[t]?this.m_fboBufList[t].getWidth():0}getFBOHeightAt(t){return null!=this.m_fboBufList[t]?this.m_fboBufList[t].getHeight():0}synFBOSizeWithViewport(){this.m_synFBOSizeWithViewport=!0}asynFBOSizeWithViewport(){this.m_synFBOSizeWithViewport=!1}setFBOSizeFactorWithViewPort(t){this.m_fboSizeFactor=t}bindFBOAt(t,e){if(t>7?t=7:t<0&&(t=0),this.m_fboBuf=this.m_fboBufList[t],null==this.m_fboBuf)throw Error("Fatal Error!!! this.m_fboBuf == null.");this.m_fboIndex=t,this.m_fboType=e,this.m_fboBuf.bind(e),this.m_fboClearBoo=!0}resetFBOAttachmentMask(t){null!=this.m_fboBuf&&this.m_fboBuf.resetAttachmentMask(t)}setFBOAttachmentMaskAt(t,e){null!=this.m_fboBuf&&this.m_fboBuf.setAttachmentMaskAt(t,e)}getFBOAttachmentTotal(){return null!=this.m_fboBuf?this.m_fboBuf.getAttachmentTotal():0}setRenderToTexture(t,e=!1,i=!1,s=0){(s<0||s>=8)&&(s=0),null==t&&0==s?this.setRenderToBackBuffer(h.default.FRAMEBUFFER):(0==s&&(null!=this.m_fboBuf&&(this.m_synFBOSizeWithViewport?this.m_fboBuf.initialize(this.m_gl,Math.floor(this.m_rcontext.getFBOWidth()*this.m_fboSizeFactor),Math.floor(this.m_rcontext.getFBOHeight()*this.m_fboSizeFactor)):this.m_fboViewRectBoo?this.m_fboBuf.initialize(this.m_gl,this.m_fboViewRect[2],this.m_fboViewRect[3]):this.m_fboBuf.sizeFixed||this.m_fboBuf.initialize(this.m_gl,t.getWidth(),t.getHeight())),this.m_fboIndex>=0&&null==this.m_fboBuf&&(this.m_fboBuf=new n.default(this.m_rcuid,this.m_texResource,this.m_fboType),this.m_fboBufList[this.m_fboIndex]=this.m_fboBuf,this.m_fboBuf.writeDepthEnabled=e,this.m_fboBuf.writeStencilEnabled=i,this.m_synFBOSizeWithViewport?this.m_fboBuf.initialize(this.m_gl,Math.floor(this.m_rcontext.getFBOWidth()*this.m_fboSizeFactor),Math.floor(this.m_rcontext.getFBOHeight()*this.m_fboSizeFactor)):this.m_fboViewRectBoo?this.m_fboBuf.initialize(this.m_gl,this.m_fboViewRect[2],this.m_fboViewRect[3]):this.m_fboBuf.initialize(this.m_gl,t.getWidth(),t.getHeight()))),null!=this.m_fboBuf&&this.m_fboBuf.renderToTexAt(this.m_gl,t,s),this.m_fboClearBoo=!0)}getActiveAttachmentTotal(){return this.m_activeAttachmentTotal}getAttachmentTotal(){return this.m_activeAttachmentTotal}useFBO(t=!1,e=!1,i=!1){null!=this.m_fboBuf&&this.m_fboClearBoo&&(this.m_fboClearBoo=!1,this.m_fboBuf.use(this.m_gl),this.m_activeAttachmentTotal=this.m_fboBuf.getActiveAttachmentTotal(),t&&this.m_fboBuf.clearOnlyColor(this.bgColor),this.m_fboBuf.writeDepthEnabled?this.m_fboBuf.writeStencilEnabled?e&&i?this.m_fboBuf.clearOnlyDepthAndStencil(this.m_clearDepth,4294967295):e?this.m_fboBuf.clearOnlyDepth(this.m_clearDepth):i&&this.m_fboBuf.clearOnlyStencil(255):e&&this.m_fboBuf.clearOnlyDepth(this.m_clearDepth):i&&this.m_fboBuf.writeStencilEnabled&&this.m_fboBuf.clearOnlyStencil(255),1==this.m_webglVer&&this.m_gl.clear(this.m_clearMask),this.m_fboBiltRect[4]=this.m_fboBiltRect[0]=this.m_viewX,this.m_fboBiltRect[5]=this.m_fboBiltRect[1]=this.m_viewY,this.m_fboBiltRect[6]=this.m_fboBiltRect[2]=this.m_viewX+this.m_viewWidth,this.m_fboBiltRect[7]=this.m_fboBiltRect[3]=this.m_viewY+this.m_viewHeight,this.m_fboViewRectBoo?(this.m_fboViewRectBoo=!1,this.m_fboViewSize.setTo(this.m_fboViewRect[0],this.m_fboViewRect[1],this.m_fboViewRect[2],this.m_fboViewRect[3]),this.reseizeFBOViewPort()):(this.m_synFBOSizeWithViewport?this.m_fboViewSize.setTo(0,0,Math.floor(this.m_rcontext.getFBOWidth()*this.m_fboSizeFactor),Math.floor(this.m_rcontext.getFBOHeight()*this.m_fboSizeFactor)):(this.m_fboBuf.isSizeChanged()&&this.m_fboBuf.initialize(this.m_gl,this.m_fboBuf.getWidth(),this.m_fboBuf.getHeight()),this.m_fboViewSize.setTo(0,0,this.m_fboBuf.getWidth(),this.m_fboBuf.getHeight())),this.reseizeFBOViewPort()))}setRenderToBackBuffer(t=h.default.FRAMEBUFFER){this.m_activeAttachmentTotal=1,n.default.BindToBackbuffer(this.m_gl,t),this.reseizeViewPort()}bindFBOToDraw(){null!=this.m_fboBuf&&this.m_fboBuf.bind(h.default.DRAW_FRAMEBUFFER)}bindFBOToWrite(){null!=this.m_fboBuf&&this.m_fboBuf.bind(h.default.READ_FRAMEBUFFER)}setBlitFboSrcRect(t,e,i,s){this.m_fboBiltRect[0]=t,this.m_fboBiltRect[1]=e,this.m_fboBiltRect[2]=t+i,this.m_fboBiltRect[3]=e+s}setBlitFboDstRect(t,e,i,s){this.m_fboBiltRect[4]=t,this.m_fboBiltRect[5]=e,this.m_fboBiltRect[6]=t+i,this.m_fboBiltRect[7]=e+s}blitFBO(t=0,e=0,i=l.default.COLOR_BUFFER_BIT,s=_.default.NEAREST,r=0,a=0,o=null){t>7&&(t=7),e>7&&(e=7),t>=0&&null!=this.m_fboBufList[t]?this.m_fboBufList[t].bind(h.default.READ_FRAMEBUFFER):n.default.BindToBackbuffer(this.m_gl,h.default.READ_FRAMEBUFFER),e>=0&&null!=this.m_fboBufList[e]?this.m_fboBufList[e].bind(h.default.DRAW_FRAMEBUFFER):n.default.BindToBackbuffer(this.m_gl,h.default.DRAW_FRAMEBUFFER),r>0&&(a<0&&(a=0),null==o&&(o=[0,0,0,1]),this.m_gl.clearBufferfv(r,a,o));let m=this.m_fboBiltRect;this.m_gl.blitFramebuffer(m[0],m[1],m[2],m[3],m[4],m[5],m[6],m[7],i,s)}}f.s_uid=0,e.default=f},1264:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("11e6")),a=i("e08e"),h=i("eca0");class _{constructor(t,e,i,s){this.m_rpoUnitBuilder=null,this.m_dataBuilder=null,this.m_processBuider=null,this.m_waitList=[],this.m_processUidList=[],this.m_rendererUid=-1,this.m_existencetotal=0,this.m_rprocess=null,this.entityManaListener=null,this.m_rendererUid=t,this.m_dataBuilder=e,this.m_rpoUnitBuilder=i,this.m_processBuider=s}isEmpty(){return this.m_existencetotal<1}isHaveEntity(){return this.m_existencetotal>0}removeEntity(t){this.m_existencetotal--;let e=t.getDisplay();if(null!=e&&null!=e.__$$runit){let t=e.__$ruid,i=this.m_rpoUnitBuilder.getRCRPObj(t);if(null!=i){if(i.count>0)if(i.count<2)i.rprocessUid>-1&&(this.m_rprocess=this.m_processBuider.getNodeByUid(i.rprocessUid),this.m_rprocess.removeDisp(e),i.rprocessUid=-1);else{let t=h.RCRPObj.RenerProcessMaxTotal;for(let s=0;s<t;++s)(i.idsFlag&1<<s)>0&&(this.m_rprocess=this.m_processBuider.getNodeByUid(s),this.m_rprocess.removeDisp(e))}}else this.m_rprocess=this.m_processBuider.getNodeByUid(e.__$$runit.getRPROUid()),this.m_rprocess.removeDisp(e);0==i.count&&(e.__$$rsign,a.DisplayRenderSign.LIVE_IN_WORLD,e.__$$rsign=a.DisplayRenderSign.NOT_IN_WORLD,this.m_rpoUnitBuilder.restoreByUid(t))}t.__$rseFlag=r.default.RemoveRendererUid(t.__$rseFlag),t.__$rseFlag=r.default.RemoveRendererLoad(t.__$rseFlag),t.__$rseFlag=r.default.RemoveSortEnabled(t.__$rseFlag),null!=this.entityManaListener&&this.entityManaListener.removeFromWorld(t,this.m_rendererUid,-1)}addEntity(t,e,i=!1){if(null!=t){let s=t.getDisplay();if(null!=s){if(s.__$$rsign==a.DisplayRenderSign.LIVE_IN_WORLD&&!this.m_rpoUnitBuilder.testRPNodeNotExists(s.__$ruid,e))return;this.m_rprocess=this.m_processBuider.getNodeByUid(e),t.__$rseFlag=this.m_rprocess.getSortEnabled()?r.default.AddSortEnabled(t.__$rseFlag):r.default.RemoveSortEnabled(t.__$rseFlag),i?(s.__$$rsign==a.DisplayRenderSign.NOT_IN_WORLD&&(s.__$$rsign=a.DisplayRenderSign.GO_TO_WORLD),t.__$rseFlag=r.default.AddRendererLoad(t.__$rseFlag),t.__$rseFlag=r.default.AddRendererUid(t.__$rseFlag,this.m_rendererUid),this.m_waitList.push(t),this.m_processUidList.push(e)):this.testValidData(t)?this.ensureAdd(t,s,e):(s.__$$rsign==a.DisplayRenderSign.NOT_IN_WORLD&&(s.__$$rsign=a.DisplayRenderSign.GO_TO_WORLD),t.__$rseFlag=r.default.AddRendererLoad(t.__$rseFlag),this.m_waitList.push(t),this.m_processUidList.push(e))}else t.__$rseFlag=r.default.AddRendererUid(t.__$rseFlag,this.m_rendererUid)}return!1}testValidData(t){if(null!=t.getMaterial()&&t.hasMesh()){if(t.getMaterial().hasShaderData())return!0;null!=t.getMaterial().getCodeBuf()&&t.activeDisplay()}return!1}ensureAdd(t,e,i){t.update(),t.__$rseFlag=r.default.AddRendererUid(t.__$rseFlag,this.m_rendererUid),t.__$rseFlag=r.default.RemoveRendererLoad(t.__$rseFlag),t.__$setRenderProxy(this.m_dataBuilder.getRenderProxy()),this.m_existencetotal++,e.__$$rsign==a.DisplayRenderSign.NOT_IN_WORLD&&(e.__$$rsign=a.DisplayRenderSign.GO_TO_WORLD),this.m_rprocess=this.m_processBuider.getNodeByUid(i),(e.__$ruid>-1||this.m_dataBuilder.buildGpuDisp(e))&&this.m_rprocess.addDisp(e),null!=this.entityManaListener&&this.entityManaListener.addToWorld(t,this.m_rendererUid,i),t.update()}updateWaitList(){let t=this.m_waitList.length,e=null,i=null;for(let s=0;s<t;++s)if(e=this.m_waitList[s],(r.default.RENDERER_LOAD_FLAT&e.__$rseFlag)==r.default.RENDERER_LOAD_FLAT){if(this.testValidData(e)){if(i=e.getDisplay(),i.__$$rsign==a.DisplayRenderSign.LIVE_IN_WORLD&&!this.m_rpoUnitBuilder.testRPNodeNotExists(i.__$ruid,this.m_processUidList[s])){this.m_waitList.splice(s,1),this.m_processUidList.splice(s,1),--t,--s;continue}this.ensureAdd(e,i,this.m_processUidList[s]),this.m_waitList.splice(s,1),this.m_processUidList.splice(s,1),--t,--s}}else i=e.getDisplay(),null!=i&&i.__$$rsign==a.DisplayRenderSign.GO_TO_WORLD&&(i.__$$rsign=a.DisplayRenderSign.NOT_IN_WORLD),e.__$rseFlag=r.default.RemoveRendererLoad(e.__$rseFlag),e.__$rseFlag=r.default.RemoveRendererUid(e.__$rseFlag),e.__$rseFlag=r.default.RemoveSortEnabled(e.__$rseFlag),this.m_waitList.splice(s,1),this.m_processUidList.splice(s,1),--t,--s,null!=this.entityManaListener&&this.entityManaListener.removeFromWorld(e,this.m_rendererUid,-1)}update(){this.m_waitList.length>0&&this.updateWaitList(),this.m_dataBuilder.update()}}e.default=_},1305:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8e17")),a=s(i("f48d"));class h extends a.default{constructor(){super(...arguments),this.radius=100}static IntersectionRLByV2(t,e,i,s,r){let a=h.__sphBv;if(a.copyFrom(i),a.subtractBy(t),s*=s,a.getLengthSquared()<=s)return r.copyFrom(t),!0;if(a.dot(e)>0){r.x=i.x-t.x,r.y=i.y-t.y,r.z=i.z-t.z;let h=r.dot(e);if(r.x=h*e.x+t.x,r.y=h*e.y+t.y,r.z=h*e.z+t.z,a.copyFrom(r),a.subtractBy(i),h=a.getLengthSquared(),h<=s)return a.copyFrom(e),h=Math.sqrt(s-h),a.scaleBy(h),r.subtractBy(a),!0}return!1}static IntersectionTwoRLByV2(t,e,i,s,r,a){let _=h.__sphBv;if(_.copyFrom(i),_.subtractBy(t),s*=s,_.getLengthSquared()<=s)return r.copyFrom(t),!0;if(_.dot(e)>0){r.x=i.x-t.x,r.y=i.y-t.y,r.z=i.z-t.z;let h=r.dot(e);if(r.x=h*e.x+t.x,r.y=h*e.y+t.y,r.z=h*e.z+t.z,_.copyFrom(r),_.subtractBy(i),h=_.getLengthSquared(),h<=s)return _.copyFrom(e),h=Math.sqrt(s-h),_.scaleBy(h),a.copyFrom(r),r.subtractBy(_),a.addBy(_),!0}return!1}}h.__sphAv=new r.default,h.__sphBv=new r.default,e.default=h},"18c7":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("6e01")),a=s(i("8e17")),h=s(i("abdb"));class _{constructor(t=null,e=0){this.m_uid=-1,this.m_index=0,this.m_fs32=null,this.m_localFS32=null,this.m_index=e,null!=t?(this.m_uid=_.s_uid++,this.m_fs32=t,this.m_localFS32=this.m_fs32.subarray(e,e+16)):(this.m_uid=_.s_isolatedUid++,this.m_fs32=new Float32Array(16),this.m_fs32.set(_.s_InitData,0),this.m_localFS32=this.m_fs32)}setData(t){16==t.length&&this.m_localFS32.set(t)}getCapacity(){return 16}GetMaxUid(){return _.s_uid}getUid(){return this.m_uid}getLocalFS32(){return this.m_localFS32}getFS32(){return this.m_fs32}getFSIndex(){return this.m_index}identity(){this.m_localFS32.set(_.s_InitData,0)}determinant(){return(this.m_localFS32[0]*this.m_localFS32[5]-this.m_localFS32[4]*this.m_localFS32[1])*(this.m_localFS32[10]*this.m_localFS32[15]-this.m_localFS32[14]*this.m_localFS32[11])-(this.m_localFS32[0]*this.m_localFS32[9]-this.m_localFS32[8]*this.m_localFS32[1])*(this.m_localFS32[6]*this.m_localFS32[15]-this.m_localFS32[14]*this.m_localFS32[7])+(this.m_localFS32[0]*this.m_localFS32[13]-this.m_localFS32[12]*this.m_localFS32[1])*(this.m_localFS32[6]*this.m_localFS32[11]-this.m_localFS32[10]*this.m_localFS32[7])+(this.m_localFS32[4]*this.m_localFS32[9]-this.m_localFS32[8]*this.m_localFS32[5])*(this.m_localFS32[2]*this.m_localFS32[15]-this.m_localFS32[14]*this.m_localFS32[3])-(this.m_localFS32[4]*this.m_localFS32[13]-this.m_localFS32[12]*this.m_localFS32[5])*(this.m_localFS32[2]*this.m_localFS32[11]-this.m_localFS32[10]*this.m_localFS32[3])+(this.m_localFS32[8]*this.m_localFS32[13]-this.m_localFS32[12]*this.m_localFS32[9])*(this.m_localFS32[2]*this.m_localFS32[7]-this.m_localFS32[6]*this.m_localFS32[3])}append(t){let e=t.getLocalFS32(),i=this.m_localFS32,s=i[0],r=i[4],a=i[8],h=i[12],_=i[1],l=i[5],n=i[9],o=i[13],m=i[2],d=i[6],u=i[10],c=i[14],f=i[3],p=i[7],g=i[11],S=i[15],A=e[0],E=e[4],R=e[8],T=e[12],x=e[1],M=e[5],b=e[9],y=e[13],L=e[2],F=e[6],B=e[10],v=e[14],N=e[3],w=e[7],P=e[11],D=e[15];i[0]=s*A+_*E+m*R+f*T,i[1]=s*x+_*M+m*b+f*y,i[2]=s*L+_*F+m*B+f*v,i[3]=s*N+_*w+m*P+f*D,i[4]=r*A+l*E+d*R+p*T,i[5]=r*x+l*M+d*b+p*y,i[6]=r*L+l*F+d*B+p*v,i[7]=r*N+l*w+d*P+p*D,i[8]=a*A+n*E+u*R+g*T,i[9]=a*x+n*M+u*b+g*y,i[10]=a*L+n*F+u*B+g*v,i[11]=a*N+n*w+u*P+g*D,i[12]=h*A+o*E+c*R+S*T,i[13]=h*x+o*M+c*b+S*y,i[14]=h*L+o*F+c*B+S*v,i[15]=h*N+o*w+c*P+S*D}append3x3(t){let e=t.getLocalFS32(),i=this.m_localFS32,s=i[0],r=i[4],a=i[8],h=i[1],_=i[5],l=i[9],n=i[2],o=i[6],m=i[10],d=e[0],u=e[4],c=e[8],f=e[1],p=e[5],g=e[9],S=e[2],A=e[6],E=e[10];i[0]=s*d+h*u+n*c,i[1]=s*f+h*p+n*g,i[2]=s*S+h*A+n*E,i[4]=r*d+_*u+o*c,i[5]=r*f+_*p+o*g,i[6]=r*S+_*A+o*E,i[8]=a*d+l*u+m*c,i[9]=a*f+l*p+m*g,i[10]=a*S+l*A+m*E}appendRotationPivot(t,e,i=null){null==i&&(i=a.default.Z_AXIS),_.s_tMat4.identity(),_.s_tMat4.getAxisRotation(e.x,e.y,e.z,t),_.s_tMat4.appendTranslationXYZ(i.x,i.y,i.z),this.append(_.s_tMat4)}appendRotation(t,e){_.s_tMat4.identity(),_.s_tMat4.getAxisRotation(e.x,e.y,e.z,t),this.append(_.s_tMat4)}appendRotationX(t){_.s_tMat4.rotationX(t),this.append3x3(_.s_tMat4)}appendRotationY(t){_.s_tMat4.rotationY(t),this.append3x3(_.s_tMat4)}appendRotationZ(t){_.s_tMat4.rotationZ(t),this.append3x3(_.s_tMat4)}appendRotationEulerAngle(t,e,i){_.s_tMat4.rotationY(e),this.append3x3(_.s_tMat4),_.s_tMat4.rotationX(t),this.append3x3(_.s_tMat4),_.s_tMat4.rotationZ(i),this.append3x3(_.s_tMat4)}setScaleXYZ(t,e,i){let s=this.m_localFS32;s[0]=t,s[5]=e,s[10]=i}setRotationEulerAngle(t,e,i){let s=this.m_localFS32,r=Math.cos(t),a=Math.sin(t),h=Math.cos(e),_=Math.sin(e),l=Math.cos(i),n=Math.sin(i),o=l*_,m=n*_,d=h*s[0],u=a*s[5],c=r*s[5],f=r*s[10],p=a*s[10];s[1]=n*d,s[2]=-_*s[0],s[0]=l*d,s[4]=o*u-n*c,s[8]=o*f+n*p,s[5]=m*u+l*c,s[9]=m*f-l*p,s[6]=h*u,s[10]=h*f}setRotationEulerAngle2(t,e,i,s,r,a){let h=this.m_localFS32,_=r*s,l=a*s,n=i*h[0],o=e*h[5],m=t*h[5],d=t*h[10],u=e*h[10];h[1]=a*n,h[2]=-s*h[0],h[0]=r*n,h[4]=_*o-a*m,h[8]=_*d+a*u,h[5]=l*o+r*m,h[9]=l*d-r*u,h[6]=i*o,h[10]=i*d}setTranslationXYZ(t,e,i){this.m_localFS32[12]=t,this.m_localFS32[13]=e,this.m_localFS32[14]=i}setTranslation(t){this.m_localFS32[12]=t.x,this.m_localFS32[13]=t.y,this.m_localFS32[14]=t.z}appendScaleXYZ(t,e,i){let s=this.m_localFS32;s[0]*=t,s[1]*=t,s[2]*=t,s[3]*=t,s[4]*=e,s[5]*=e,s[6]*=e,s[7]*=e,s[8]*=i,s[9]*=i,s[10]*=i,s[11]*=i}appendScaleXY(t,e){this.m_localFS32[0]*=t,this.m_localFS32[1]*=t,this.m_localFS32[2]*=t,this.m_localFS32[3]*=t,this.m_localFS32[4]*=e,this.m_localFS32[5]*=e,this.m_localFS32[6]*=e,this.m_localFS32[7]*=e}appendTranslationXYZ(t,e,i){this.m_localFS32[12]+=t,this.m_localFS32[13]+=e,this.m_localFS32[14]+=i}appendTranslation(t){this.m_localFS32[12]+=t.x,this.m_localFS32[13]+=t.y,this.m_localFS32[14]+=t.z}copyColumnFrom(t,e){switch(t){case 0:this.m_localFS32[0]=e.x,this.m_localFS32[1]=e.y,this.m_localFS32[2]=e.z,this.m_localFS32[3]=e.w;break;case 1:this.m_localFS32[4]=e.x,this.m_localFS32[5]=e.y,this.m_localFS32[6]=e.z,this.m_localFS32[7]=e.w;break;case 2:this.m_localFS32[8]=e.x,this.m_localFS32[9]=e.y,this.m_localFS32[10]=e.z,this.m_localFS32[11]=e.w;break;case 3:this.m_localFS32[12]=e.x,this.m_localFS32[13]=e.y,this.m_localFS32[14]=e.z,this.m_localFS32[15]=e.w;break;default:break}}copyColumnTo(t,e){t<<=2,e.x=this.m_localFS32[t],e.y=this.m_localFS32[1+t],e.z=this.m_localFS32[2+t],e.w=this.m_localFS32[3+t]}setF32ArrAndIndex(t,e=0){null!=t&&e>=0&&(this.m_fs32=t,this.m_index=e,this.m_localFS32=this.m_fs32.subarray(e,e+16))}setF32ArrIndex(t=0){t>=0&&(this.m_index=t,this.m_localFS32=this.m_fs32.subarray(t,t+16))}setF32Arr(t){null!=t&&(this.m_fs32=t)}copyFromF32Arr(t,e=0){let i=0;for(let s=e+16;e<s;e++)this.m_localFS32[i]=t[e],++i}copyToF32Arr(t,e=0){t.set(this.m_localFS32,e)}copyFrom(t){this.m_localFS32.set(t.m_localFS32,0)}copyTo(t){t.m_localFS32.set(this.m_localFS32,0)}copyRawDataFrom(t,e=16,i=0,s=!1){s&&this.transpose(),e-=i;let r=0;while(r<e)this.m_fs32[this.m_index+r]=t[r+i],++r;s&&this.transpose()}copyRawDataTo(t,e=16,i=0,s=!1){s&&this.transpose();let r=0;while(r<e)t[r+i]=this.m_fs32[this.m_index+r],++r;s&&this.transpose()}copyRowFrom(t,e){switch(t){case 0:this.m_localFS32[0]=e.x,this.m_localFS32[4]=e.y,this.m_localFS32[8]=e.z,this.m_localFS32[12]=e.w;break;case 1:this.m_localFS32[1]=e.x,this.m_localFS32[5]=e.y,this.m_localFS32[9]=e.z,this.m_localFS32[13]=e.w;break;case 2:this.m_localFS32[2]=e.x,this.m_localFS32[6]=e.y,this.m_localFS32[10]=e.z,this.m_localFS32[14]=e.w;break;case 3:this.m_localFS32[3]=e.x,this.m_localFS32[7]=e.y,this.m_localFS32[11]=e.z,this.m_localFS32[15]=e.w;break;default:break}}copyRowTo(t,e){e.x=this.m_localFS32[t],e.y=this.m_localFS32[4+t],e.z=this.m_localFS32[8+t],e.w=this.m_localFS32[12+t]}decompose(t){let e=[],i=_.s_tMat4,s=i.getFS32();i.copyFrom(this);let l=new a.default(s[12],s[13],s[14]),n=new a.default;n.x=Math.sqrt(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]),n.y=Math.sqrt(s[4]*s[4]+s[5]*s[5]+s[6]*s[6]),n.z=Math.sqrt(s[8]*s[8]+s[9]*s[9]+s[10]*s[10]),s[0]*(s[5]*s[10]-s[6]*s[9])-s[1]*(s[4]*s[10]-s[6]*s[8])+s[2]*(s[4]*s[9]-s[5]*s[8])<0&&(n.z=-n.z),s[0]/=n.x,s[1]/=n.x,s[2]/=n.x,s[4]/=n.y,s[5]/=n.y,s[6]/=n.y,s[8]/=n.z,s[9]/=n.z,s[10]/=n.z;let o=new a.default;switch(t){case h.default.AXIS_ANGLE:{o.w=r.default.SafeACos((s[0]+s[5]+s[10]-1)/2);let t=Math.sqrt((s[6]-s[9])*(s[6]-s[9])+(s[8]-s[2])*(s[8]-s[2])+(s[1]-s[4])*(s[1]-s[4]));t>r.default.MATH_MIN_POSITIVE?(o.x=(s[6]-s[9])/t,o.y=(s[8]-s[2])/t,o.z=(s[1]-s[4])/t):o.x=o.y=o.z=0}break;case h.default.QUATERNION:{let t=s[0]+s[5]+s[10];t>0?(o.w=Math.sqrt(1+t)/2,o.x=(s[6]-s[9])/(4*o.w),o.y=(s[8]-s[2])/(4*o.w),o.z=(s[1]-s[4])/(4*o.w)):s[0]>s[5]&&s[0]>s[10]?(o.x=Math.sqrt(1+s[0]-s[5]-s[10])/2,o.w=(s[6]-s[9])/(4*o.x),o.y=(s[1]+s[4])/(4*o.x),o.z=(s[8]+s[2])/(4*o.x)):s[5]>s[10]?(o.y=Math.sqrt(1+s[5]-s[0]-s[10])/2,o.x=(s[1]+s[4])/(4*o.y),o.w=(s[8]-s[2])/(4*o.y),o.z=(s[6]+s[9])/(4*o.y)):(o.z=Math.sqrt(1+s[10]-s[0]-s[5])/2,o.x=(s[8]+s[2])/(4*o.z),o.y=(s[6]+s[9])/(4*o.z),o.w=(s[1]-s[4])/(4*o.z))}break;case h.default.EULER_ANGLES:o.y=Math.asin(-s[2]),1!=s[2]&&-1!=s[2]?(o.x=Math.atan2(s[6],s[10]),o.z=Math.atan2(s[1],s[0])):(o.z=0,o.x=Math.atan2(s[4],s[5]));break;default:break}return e.push(l),e.push(o),e.push(n),i=null,e}invert(){let t=this.determinant(),e=Math.abs(t)>r.default.MATH_MIN_POSITIVE;if(e){let e=this.m_localFS32;t=1/t;let i=e[0],s=e[4],r=e[8],a=e[12],h=e[1],_=e[5],l=e[9],n=e[13],o=e[2],m=e[6],d=e[10],u=e[14],c=e[3],f=e[7],p=e[11],g=e[15];e[0]=t*(_*(d*g-u*p)-l*(m*g-u*f)+n*(m*p-d*f)),e[1]=-t*(h*(d*g-u*p)-l*(o*g-u*c)+n*(o*p-d*c)),e[2]=t*(h*(m*g-u*f)-_*(o*g-u*c)+n*(o*f-m*c)),e[3]=-t*(h*(m*p-d*f)-_*(o*p-d*c)+l*(o*f-m*c)),e[4]=-t*(s*(d*g-u*p)-r*(m*g-u*f)+a*(m*p-d*f)),e[5]=t*(i*(d*g-u*p)-r*(o*g-u*c)+a*(o*p-d*c)),e[6]=-t*(i*(m*g-u*f)-s*(o*g-u*c)+a*(o*f-m*c)),e[7]=t*(i*(m*p-d*f)-s*(o*p-d*c)+r*(o*f-m*c)),e[8]=t*(s*(l*g-n*p)-r*(_*g-n*f)+a*(_*p-l*f)),e[9]=-t*(i*(l*g-n*p)-r*(h*g-n*c)+a*(h*p-l*c)),e[10]=t*(i*(_*g-n*f)-s*(h*g-n*c)+a*(h*f-_*c)),e[11]=-t*(i*(_*p-l*f)-s*(h*p-l*c)+r*(h*f-_*c)),e[12]=-t*(s*(l*u-n*d)-r*(_*u-n*m)+a*(_*d-l*m)),e[13]=t*(i*(l*u-n*d)-r*(h*u-n*o)+a*(h*d-l*o)),e[14]=-t*(i*(_*u-n*m)-s*(h*u-n*o)+a*(h*m-_*o)),e[15]=t*(i*(_*d-l*m)-s*(h*d-l*o)+r*(h*m-_*o))}return e}pointAt(t,e,i){null!=e&&void 0!=e||(e=new a.default(0,0,-1)),null!=i&&void 0!=i||(i=new a.default(0,-1,0));let s=e.subtract(t),h=new a.default(i.x,i.y,i.z);s.normalize(),h.normalize();let _=new a.default(s.x,s.y,s.z);_.scaleBy(h.dot(s)),h.subtractBy(_),h.getLength()>r.default.MATH_MIN_POSITIVE?h.normalize():0!=s.x?h.setTo(-s.y,s.x,0):h.setTo(1,0,0);let l=h.crossProduct(s);l.normalize();let n=this.m_localFS32;n[0]=l.x,n[4]=l.y,n[8]=l.z,n[12]=0,n[1]=h.x,n[5]=h.y,n[9]=h.z,n[13]=0,n[2]=s.x,n[6]=s.y,n[10]=s.z,n[14]=0,n[3]=t.x,n[7]=t.y,n[11]=t.z,n[15]=1}prepend(t){let e=t.getLocalFS32(),i=this.m_localFS32,s=e[0],r=e[4],a=e[8],h=e[12],_=e[1],l=e[5],n=e[9],o=e[13],m=e[2],d=e[6],u=e[10],c=e[14],f=e[3],p=e[7],g=e[11],S=e[15],A=i[0],E=i[4],R=i[8],T=i[12],x=i[1],M=i[5],b=i[9],y=i[13],L=i[2],F=i[6],B=i[10],v=i[14],N=i[3],w=i[7],P=i[11],D=i[15];i[0]=s*A+_*E+m*R+f*T,i[1]=s*x+_*M+m*b+f*y,i[2]=s*L+_*F+m*B+f*v,i[3]=s*N+_*w+m*P+f*D,i[4]=r*A+l*E+d*R+p*T,i[5]=r*x+l*M+d*b+p*y,i[6]=r*L+l*F+d*B+p*v,i[7]=r*N+l*w+d*P+p*D,i[8]=a*A+n*E+u*R+g*T,i[9]=a*x+n*M+u*b+g*y,i[10]=a*L+n*F+u*B+g*v,i[11]=a*N+n*w+u*P+g*D,i[12]=h*A+o*E+c*R+S*T,i[13]=h*x+o*M+c*b+S*y,i[14]=h*L+o*F+c*B+S*v,i[15]=h*N+o*w+c*P+S*D}prepend3x3(t){let e=t.getLocalFS32(),i=this.m_localFS32,s=e[0],r=e[4],a=e[8],h=e[1],_=e[5],l=e[9],n=e[2],o=e[6],m=e[10],d=i[0],u=i[4],c=i[8],f=i[1],p=i[5],g=i[9],S=i[2],A=i[6],E=i[10];i[0]=s*d+h*u+n*c,i[1]=s*f+h*p+n*g,i[2]=s*S+h*A+n*E,i[4]=r*d+_*u+o*c,i[5]=r*f+_*p+o*g,i[6]=r*S+_*A+o*E,i[8]=a*d+l*u+m*c,i[9]=a*f+l*p+m*g,i[10]=a*S+l*A+m*E}prependRotationPivot(t,e,i){_.s_tMat4.identity(),_.s_tMat4.getAxisRotation(e.x,e.y,e.z,t),_.s_tMat4.appendTranslationXYZ(i.x,i.y,i.z),this.prepend(_.s_tMat4)}prependRotation(t,e){_.s_tMat4.identity(),_.s_tMat4.getAxisRotation(e.x,e.y,e.z,t),this.prepend(_.s_tMat4)}prependRotationX(t){_.s_tMat4.rotationX(t),this.prepend3x3(_.s_tMat4)}prependRotationY(t){_.s_tMat4.rotationY(t),this.prepend3x3(_.s_tMat4)}prependRotationZ(t){_.s_tMat4.rotationZ(t),this.prepend3x3(_.s_tMat4)}prependRotationEulerAngle(t,e,i){_.s_tMat4.rotationY(e),this.prepend3x3(_.s_tMat4),_.s_tMat4.rotationX(t),this.prepend3x3(_.s_tMat4),_.s_tMat4.rotationZ(i),this.prepend3x3(_.s_tMat4)}prependScale(t,e,i){let s=this.m_localFS32;s[0]*=t,s[1]*=e,s[2]*=i,s[4]*=t,s[5]*=e,s[6]*=i,s[8]*=t,s[9]*=e,s[10]*=i,s[12]*=t,s[13]*=e,s[14]*=i}prependScaleXY(t,e){this.m_localFS32[0]*=t,this.m_localFS32[1]*=e,this.m_localFS32[4]*=t,this.m_localFS32[5]*=e,this.m_localFS32[8]*=t,this.m_localFS32[9]*=e,this.m_localFS32[12]*=t,this.m_localFS32[13]*=e}prependTranslationXYZ(t,e,i){_.s_tMat4.identity(),this.prepend(_.s_tMat4)}prependTranslation(t){_.s_tMat4.identity(),this.prepend(_.s_tMat4)}recompose(t,e){if(t.length<3||0==t[2].x||0==t[2].y||0==t[2].z)return!1;this.identity();let i=_.s_tMat4.getFS32();i[0]=i[1]=i[2]=t[2].x,i[4]=i[5]=i[6]=t[2].y,i[8]=i[9]=i[10]=t[2].z;let s=this.m_localFS32;switch(e){case h.default.EULER_ANGLES:{let e=Math.cos(t[1].x),r=Math.cos(t[1].y),a=Math.cos(t[1].z),h=Math.sin(t[1].x),_=Math.sin(t[1].y),l=Math.sin(t[1].z);s[0]=r*a*i[0],s[1]=r*l*i[1],s[2]=-_*i[2],s[3]=0,s[4]=(h*_*a-e*l)*i[4],s[5]=(h*_*l+e*a)*i[5],s[6]=h*r*i[6],s[7]=0,s[8]=(e*_*a+h*l)*i[8],s[9]=(e*_*l-h*a)*i[9],s[10]=e*r*i[10],s[11]=0,s[12]=t[0].x,s[13]=t[0].y,s[14]=t[0].z,s[15]=1}break;default:{let r=t[1].x,a=t[1].y,_=t[1].z,l=t[1].w;if(e==h.default.AXIS_ANGLE){let t=.5*l;r*=Math.sin(t),a*=Math.sin(t),_*=Math.sin(t),l=Math.cos(t)}s[0]=(1-2*a*a-2*_*_)*i[0],s[1]=(2*r*a+2*l*_)*i[1],s[2]=(2*r*_-2*l*a)*i[2],s[3]=0,s[4]=(2*r*a-2*l*_)*i[4],s[5]=(1-2*r*r-2*_*_)*i[5],s[6]=(2*a*_+2*l*r)*i[6],s[7]=0,s[8]=(2*r*_+2*l*a)*i[8],s[9]=(2*a*_-2*l*r)*i[9],s[10]=(1-2*r*r-2*a*a)*i[10],s[11]=0,s[12]=t[0].x,s[13]=t[0].y,s[14]=t[0].z,s[15]=1}break}return 0==t[2].x&&(this.m_localFS32[0]=0),0==t[2].y&&(this.m_localFS32[5]=0),0==t[2].z&&(this.m_localFS32[10]=0),i=null,!0}deltaTransformVector(t){let e=t.x,i=t.y,s=t.z;return new a.default(e*this.m_localFS32[0]+i*this.m_localFS32[4]+s*this.m_localFS32[8],e*this.m_localFS32[1]+i*this.m_localFS32[5]+s*this.m_localFS32[9],e*this.m_localFS32[2]+i*this.m_localFS32[6]+s*this.m_localFS32[10],0)}deltaTransformVectorSelf(t){let e=this.m_localFS32,i=t.x,s=t.y,r=t.z;t.x=i*e[0]+s*e[4]+r*e[8],t.y=i*e[1]+s*e[5]+r*e[9],t.z=i*e[2]+s*e[6]+r*e[10]}deltaTransformOutVector(t,e){let i=this.m_localFS32;e.x=t.x*i[0]+t.y*i[4]+t.z*i[8],e.y=t.x*i[1]+t.y*i[5]+t.z*i[9],e.z=t.x*i[2]+t.y*i[6]+t.z*i[10]}transformVector(t){let e=this.m_localFS32,i=t.x,s=t.y,r=t.z;return new a.default(i*e[0]+s*e[4]+r*e[8]+e[12],i*e[1]+s*e[5]+r*e[9]+e[13],i*e[2]+s*e[6]+r*e[10]+e[14],i*e[3]+s*e[7]+r*e[11]+e[15])}transformOutVector(t,e){let i=t.x,s=t.y,r=t.z,a=this.m_localFS32;e.setTo(i*a[0]+s*a[4]+r*a[8]+a[12],i*a[1]+s*a[5]+r*a[9]+a[13],i*a[2]+s*a[6]+r*a[10]+a[14],i*a[3]+s*a[7]+r*a[11]+a[15])}transformOutVector3(t,e){let i=this.m_localFS32;e.x=t.x*i[0]+t.y*i[4]+t.z*i[8]+i[12],e.y=t.x*i[1]+t.y*i[5]+t.z*i[9]+i[13],e.z=t.x*i[2]+t.y*i[6]+t.z*i[10]+i[14]}transformVector3Self(t){let e=t.x,i=t.y,s=t.z,r=this.m_localFS32;t.x=e*r[0]+i*r[4]+s*r[8]+r[12],t.y=e*r[1]+i*r[5]+s*r[9]+r[13],t.z=e*r[2]+i*r[6]+s*r[10]+r[14]}transformVectorSelf(t){let e=t.x,i=t.y,s=t.z,r=this.m_localFS32;t.setTo(e*r[0]+i*r[4]+s*r[8]+r[12],e*r[1]+i*r[5]+s*r[9]+r[13],e*r[2]+i*r[6]+s*r[10]+r[14],e*r[3]+i*r[7]+s*r[11]+r[15])}transformVectors(t,e,i){let s,r,a,h=0,_=this.m_localFS32;e-=3;while(h<=e)s=t[h],r=t[h+1],a=t[h+2],i[h]=s*_[0]+r*_[4]+a*_[8]+_[12],i[h+1]=s*_[1]+r*_[5]+a*_[9]+_[13],i[h+2]=s*_[2]+r*_[6]+a*_[10]+_[14],h+=3}transformVectorsSelf(t,e){let i,s,r,a=0,h=this.m_localFS32;e-=3;while(a<=e)i=t[a],s=t[a+1],r=t[a+2],t[a]=i*h[0]+s*h[4]+r*h[8]+h[12],t[a+1]=i*h[1]+s*h[5]+r*h[9]+h[13],t[a+2]=i*h[2]+s*h[6]+r*h[10]+h[14],a+=3}transformVectorsRangeSelf(t,e,i){let s,r,a,h=e,_=this.m_localFS32;i-=3;while(h<=i)s=t[h],r=t[h+1],a=t[h+2],t[h]=s*_[0]+r*_[4]+a*_[8]+_[12],t[h+1]=s*_[1]+r*_[5]+a*_[9]+_[13],t[h+2]=s*_[2]+r*_[6]+a*_[10]+_[14],h+=3}transpose(){_.s_tMat4.copyFrom(this);let t=_.s_tMat4.getFS32(),e=this.m_localFS32;e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11]}interpolateTo(t,e){let i=t.getFS32(),s=t.getFSIndex(),r=0,a=this.m_index;while(r<16)this.m_fs32[a]+=(i[s+r]-this.m_fs32[a])*e,++a,++r}getAxisRotation(t,e,i,s){s=-s;let r=this.m_localFS32,a=Math.sin(s),h=Math.cos(s),_=1-h;r[0]=h+t*t*_,r[5]=h+e*e*_,r[10]=h+i*i*_;let l=t*e*_,n=i*a;r[4]=l+n,r[1]=l-n,l=t*i*_,n=e*a,r[8]=l-n,r[2]=l+n,l=e*i*_,n=t*a,r[9]=l+n,r[6]=l-n}rotationX(t){let e=Math.sin(t),i=Math.cos(t);this.m_localFS32[0]=1,this.m_localFS32[1]=0,this.m_localFS32[2]=0,this.m_localFS32[4]=0,this.m_localFS32[5]=i,this.m_localFS32[6]=e,this.m_localFS32[8]=0,this.m_localFS32[9]=-e,this.m_localFS32[10]=i}rotationY(t){let e=Math.sin(t),i=Math.cos(t);this.m_localFS32[0]=i,this.m_localFS32[1]=0,this.m_localFS32[2]=-e,this.m_localFS32[4]=0,this.m_localFS32[5]=1,this.m_localFS32[6]=0,this.m_localFS32[8]=e,this.m_localFS32[9]=0,this.m_localFS32[10]=i}rotationZ(t){let e=Math.sin(t),i=Math.cos(t);this.m_localFS32[0]=i,this.m_localFS32[1]=e,this.m_localFS32[2]=0,this.m_localFS32[4]=-e,this.m_localFS32[5]=i,this.m_localFS32[6]=0,this.m_localFS32[8]=0,this.m_localFS32[9]=0,this.m_localFS32[10]=1}toString(){let t="\n"+this.m_localFS32[0]+","+this.m_localFS32[1]+","+this.m_localFS32[2]+","+this.m_localFS32[3]+"\n";return t+=this.m_localFS32[4]+","+this.m_localFS32[5]+","+this.m_localFS32[6]+","+this.m_localFS32[7]+"\n",t+=this.m_localFS32[8]+","+this.m_localFS32[9]+","+this.m_localFS32[10]+","+this.m_localFS32[11]+"\n",t+=this.m_localFS32[12]+","+this.m_localFS32[13]+","+this.m_localFS32[14]+","+this.m_localFS32[15]+"\n",t}transformPerspV4Self(t){t.w=t.z,t.x*=this.m_localFS32[0],t.y*=this.m_localFS32[5],t.z*=this.m_localFS32[10],t.z+=this.m_localFS32[14],t.w*=this.m_localFS32[11],t.w+=this.m_localFS32[15]}perspectiveRH(t,e,i,s){let r=Math.tan(.5*t);this.identity(),this.m_localFS32[0]=1/(e*r),this.m_localFS32[5]=1/r,this.m_localFS32[10]=-(s+i)/(s-i),this.m_localFS32[11]=-1,this.m_localFS32[14]=-2*s*i/(s-i)}perspectiveRH2(t,e,i,s,r){let a=e/Math.tan(.5*t),h=a/e,_=a/i,l=-r/(r-s),n=-s*l;this.identity(),this.m_localFS32[0]=h,this.m_localFS32[5]=_,this.m_localFS32[10]=l,this.m_localFS32[11]=-1,this.m_localFS32[14]=n}orthoRH(t,e,i,s,r,a){this.identity(),this.m_localFS32[0]=2/(s-i),this.m_localFS32[5]=2/(e-t),this.m_localFS32[10]=-2/(a-r),this.m_localFS32[12]=-(s+i)/(s-i),this.m_localFS32[13]=-(e+t)/(e-t),this.m_localFS32[14]=-(a+r)/(a-r),this.m_localFS32[15]=1}perspectiveLH(t,e,i,s){let r=Math.tan(.5*t);this.identity(),this.m_localFS32[0]=1/(e*r),this.m_localFS32[5]=1/r,this.m_localFS32[10]=(s+i)/(s-i),this.m_localFS32[11]=1,this.m_localFS32[14]=2*s*i/(s-i)}orthoLH(t,e,i,s,r,a){this.identity(),this.m_localFS32[0]=2/(s-i),this.m_localFS32[5]=2/(e-t),this.m_localFS32[10]=2/(a-r),this.m_localFS32[12]=-(s+i)/(s-i),this.m_localFS32[13]=-(e+t)/(e-t),this.m_localFS32[14]=-(a+r)/(a-r),this.m_localFS32[15]=1}lookAtRH(t,e,i){this.identity();let s=e.subtract(t);s.normalize();let r=s.crossProduct(i);r.normalize();let a=r.crossProduct(s);r.w=-r.dot(t),a.w=-a.dot(t),s.w=s.dot(t),s.negate(),this.copyRowFrom(0,r),this.copyRowFrom(1,a),this.copyRowFrom(2,s)}lookAtLH(t,e,i){this.identity();let s=e.subtract(t);s.normalize();let r=s.crossProduct(i);r.normalize();let a=r.crossProduct(s);r.w=-r.dot(t),a.w=-a.dot(t),s.w=-s.dot(t),this.copyRowFrom(0,r),this.copyRowFrom(1,a),this.copyRowFrom(2,s)}destroy(){this.m_localFS32=null,this.m_fs32=null,this.m_index=-1}}_.s_InitData=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),_.s_uid=0,_.s_isolatedUid=327679,_.s_tMat4=new _,e.default=_},"1e15":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8a0a")),a=s(i("030e"));class h{constructor(){this.m_rcuid=0,this.m_glVer=2,this.m_rc=null,this.RGBA=0,this.UNSIGNED_BYTE=0,this.TRIANGLE_STRIP=0,this.TRIANGLE_FAN=0,this.TRIANGLES=0,this.LINES=0,this.LINE_STRIP=0,this.UNSIGNED_SHORT=0,this.UNSIGNED_INT=0,this.COLOR=0,this.DEPTH=0,this.STENCIL=0,this.DEPTH_STENCIL=0,this.MAX=0,this.MIN=0,this.RContext=null,this.vroUid=0,this.rioUid=0}getRC(){return this.m_rc}getRCUid(){return this.m_rcuid}createBuf(){return this.m_rc.createBuffer()}deleteBuf(t){this.m_rc.deleteBuffer(t)}bindArrBuf(t){this.m_rc.bindBuffer(this.m_rc.ARRAY_BUFFER,t)}bindEleBuf(t){this.m_rc.bindBuffer(this.m_rc.ELEMENT_ARRAY_BUFFER,t)}arrBufSubData(t,e){this.m_rc.bufferSubData(this.m_rc.ARRAY_BUFFER,e,t)}arrBufData(t,e){this.m_rc.bufferData(this.m_rc.ARRAY_BUFFER,t,r.default.ToGL(this.m_rc,e))}eleBufSubData(t,e){this.m_rc.bufferSubData(this.m_rc.ELEMENT_ARRAY_BUFFER,e,t)}eleBufData(t,e){this.m_rc.bufferData(this.m_rc.ELEMENT_ARRAY_BUFFER,t,r.default.ToGL(this.m_rc,e))}arrBufDataMem(t,e){this.m_rc.bufferData(this.m_rc.ARRAY_BUFFER,t,r.default.ToGL(this.m_rc,e))}eleBufDataMem(t,e){this.m_rc.bufferData(this.m_rc.ELEMENT_ARRAY_BUFFER,t,r.default.ToGL(this.m_rc,e))}useVtxAttribsPtrTypeFloat(t,e,i,s,r,a){this.m_rc.bindBuffer(this.m_rc.ARRAY_BUFFER,e);for(let h=0;h<s;++h)t.vertexAttribPointerTypeFloat(i[h],a,r[h])}useVtxAttribsPtrTypeFloatMulti(t,e,i,s,r,a){for(let h=0;h<s;++h)this.m_rc.bindBuffer(this.m_rc.ARRAY_BUFFER,e[h]),t.vertexAttribPointerTypeFloat(i[h],a,r[h])}createVertexArray(){let t=null;return t=2==this.m_glVer?this.m_rc.createVertexArray():a.default.OES_vertex_array_object.createVertexArrayOES(),t}bindVertexArray(t){return 2==this.m_glVer?this.m_rc.bindVertexArray(t):a.default.OES_vertex_array_object.bindVertexArrayOES(t),t}deleteVertexArray(t){2==this.m_glVer?this.m_rc.deleteVertexArray(t):a.default.OES_vertex_array_object.deleteVertexArrayOES(t)}testVROUid(t){return this.vroUid!=t&&(this.vroUid=t,!0)}testRIOUid(t){return this.rioUid!=t&&(this.rioUid=t,!0)}initialize(t,e,i){this.m_rc=e,this.m_rcuid=t,this.m_glVer=i;let s=this;s.RGBA=e.RGBA,s.UNSIGNED_BYTE=e.UNSIGNED_BYTE,s.TRIANGLE_STRIP=e.TRIANGLE_STRIP,s.TRIANGLE_FAN=e.TRIANGLE_FAN,s.TRIANGLES=e.TRIANGLES,s.LINES=this.m_rc.LINES,s.LINE_STRIP=e.LINE_STRIP,s.UNSIGNED_SHORT=e.UNSIGNED_SHORT,s.UNSIGNED_INT=e.UNSIGNED_INT,s.COLOR=e.COLOR,s.DEPTH=e.DEPTH,s.STENCIL=e.STENCIL,s.DEPTH_STENCIL=e.DEPTH_STENCIL,this.m_glVer>1?(s.MIN=e.MIN,s.MAX=e.MAX):(s.MIN=a.default.EXT_blend_minmax.MIN_EXT,s.MAX=a.default.EXT_blend_minmax.MAX_EXT),s.RContext=e}renderBegin(){this.vroUid=-2,this.rioUid=-3}toString(){return"[Object ROVtxBuilder()]"}}e.default=h},"1eb2":function(t,e,i){"use strict";if("undefined"!==typeof window){var s=window.document.currentScript,r=i("8875");s=r(),"currentScript"in document||Object.defineProperty(document,"currentScript",{get:r});var a=s&&s.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);a&&(i.p=a[1])}},2051:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8e17")),a=s(i("18c7")),h=s(i("6e01")),_=s(i("fecb")),l=s(i("1305")),n=s(i("e214")),o=s(i("38de")),m=s(i("81c4")),d=s(i("02ed")),u=s(i("3930")),c=s(i("d958")),f=s(i("c51d")),p=s(i("29ef")),g=s(i("3b73"));var S=window;void 0==S["VoxCore"]&&(S["VoxCore"]={});var A=S["VoxCore"];A["Vector3D"]=r.default,A["AABB"]=_.default,A["Vector3D"]=r.default,A["Matrix4"]=a.default,A["MathConst"]=h.default,A["Sphere"]=l.default,A["Plane"]=n.default,A["RadialLine"]=o.default,A["LineSegment"]=m.default,A["StraightLine"]=d.default,A["Color4"]=u.default,A["RendererDevice"]=g.default,A["RendererState"]=p.default,A["CameraBase"]=f.default,A["renderer"]=null,A["rendererContext"]=null;class E{constructor(){this.m_renderer=null,this.m_rcontext=null}getRenderer(){return this.m_renderer}getRendererContext(){return this.m_rcontext}initialize(){null==this.m_renderer&&(this.m_renderer=new c.default,this.m_renderer.initialize(),this.m_renderer.appendProcess(),this.m_renderer.appendProcess(),this.m_renderer.appendProcess(),this.m_rcontext=this.m_renderer.getRendererContext(),A["renderer"]=this.m_renderer,A["rendererContext"]=this.m_rcontext)}run(){this.m_rcontext.renderBegin(),this.m_renderer.update(),this.m_renderer.run(),this.m_rcontext.runEnd()}}e.BaseRenderer=E,e.default=E},"20ef":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("3b73")),a=s(i("8a0a"));class h{constructor(t){this.m_shdData=null,this.m_uid=-1,this.m_program=null,this.m_rcuid=-1,this.m_gl=null,this.m_shdUniqueName="",this.m_texTotal=0,this.m_aLocations=null,this.m_aLocationTypes=null,this.m_aLocationSizes=null,this.m_uLocations=null,this.m_texLocations=null,this.m_attribLIndexList=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],this.m_attribTypeSizeList=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],this.m_attriSizeList=null,this.m_uniformDict=new Map,this.m_uLocationDict=new Map,this.m_vtxShd=null,this.m_frgShd=null,this.dataUniformEnabled=!1,this.m_attrid=0,this.m_attridIndex=0,this.m_uLc=null,this.m_uIndex=0,this.m_uid=t}setShdData(t){this.m_shdData=t,this.m_shdUniqueName=t.getUniqueShaderName()}getUid(){return this.m_uid}getTexTotal(){return this.m_shdData.getTexTotal()}useTexLocation(){for(let t=0;t<this.m_texTotal;t++)this.m_gl.uniform1i(this.m_texLocations[t],t)}haveTexture(){return this.m_shdData.haveTexture()}createLocations(){let t=0,e=0,i=this.m_shdData.getAttriNSList();if(null!=i&&i.length>0&&null==this.m_aLocations){this.dataUniformEnabled=!1;let s=this.m_shdData.getAttriSizeList();this.m_aLocations=[],this.m_aLocationTypes=[],this.m_aLocationSizes=[],e=i.length;let h=0,_=0;while(t<e)_=this.m_gl.getAttribLocation(this.m_program,i[t]),this.m_aLocations.push(_),h=a.default.GetVBufAttributeTypeByNS(i[t]),this.m_aLocationTypes.push(h),this.m_aLocationSizes.push(s[t]),this.m_attribLIndexList[h]=_,this.m_attribTypeSizeList[h]=s[t],this.dataUniformEnabled=!0,++t;for(this.m_attriSizeList=[],t=0;t<this.m_attribTypeSizeList.length;++t)this.m_attribTypeSizeList[t]>0&&this.m_attriSizeList.push(this.m_attribTypeSizeList[t]);r.default.SHADERCODE_TRACE_ENABLED}if(this.m_shdData.haveCommonUniform()&&null==this.m_uLocations){let i=this.m_shdData.getUniforms();this.m_uLocations=[],e=i.length,t=0;let s=null,a="";while(t<e)i[t].isTex||(a=i[t].name,s=this.m_gl.getUniformLocation(this.m_program,a),r.default.SHADERCODE_TRACE_ENABLED,null!=s?(s.uniformName=a,s.uniqueName=this.m_shdUniqueName,i[t].location=s,this.m_uniformDict.set(a,i[t]),this.m_uLocationDict.set(a,s),this.m_uLocations.push(s),this.dataUniformEnabled=!0):r.default.SHADERCODE_TRACE_ENABLED),++t}if(this.m_texTotal=this.m_shdData.getTexTotal(),this.m_texTotal>0){this.m_texLocations=new Array(this.m_texTotal);let e=this.m_shdData.getTexUniformNames();for(t=0;t<this.m_texTotal;++t)e[t]="u_sampler"+t,this.m_texLocations[t]=this.m_gl.getUniformLocation(this.m_program,e[t])}}getLayoutBit(){return this.m_shdData.getLayoutBit()}getMid(){return this.m_shdData.getMid()}getFragOutputTotal(){return this.m_shdData.getFragOutputTotal()}getLocationsTotal(){return this.m_aLocationTypes.length}getLocationTypeByIndex(t){return this.m_aLocationTypes[t]}getLocationSizeByIndex(t){return this.m_aLocationSizes[t]}testVertexAttribPointerOffset(t){let e=!1;if(null!=t&&null!=this.m_attriSizeList&&t.length>=this.m_attriSizeList.length){let i=0,s=0;for(;s<this.m_attriSizeList.length;++s){if(i!=t[s])break;i+=4*this.m_attriSizeList[s]}e=s>=this.m_attriSizeList.length}if(!e)throw Error("Shader program vertx attributes layout can not match float attribute vertex data !!!");return e}vertexAttribPointerType(t,e,i,s,r,a){this.m_attrid=this.m_attribLIndexList[t],this.m_attrid>-1&&(this.m_gl.enableVertexAttribArray(this.m_attrid),this.m_gl.vertexAttribPointer(this.m_attrid,this.m_attribTypeSizeList[t],i,s,r,a))}vertexAttribPointerTypeFloat(t,e,i){this.m_attrid=this.m_attribLIndexList[t],this.m_attrid>-1&&(this.m_gl.enableVertexAttribArray(this.m_attrid),this.m_gl.vertexAttribPointer(this.m_attrid,this.m_attribTypeSizeList[t],this.m_gl.FLOAT,!1,e,i))}testVertexAttribPointerType(t){return this.m_attribLIndexList[t]>-1}getVertexAttribByTpye(t){return this.m_attribLIndexList[t]}vertexAttribPointerAt(t,e,i,s,r,a){this.m_attridIndex=t,this.m_attrid=this.m_aLocations[t],this.m_attrid>-1&&(this.m_gl.enableVertexAttribArray(this.m_attrid),this.m_gl.vertexAttribPointer(this.m_attrid,e,i,s,r,a))}vertexAttribPointerNext(t,e,i,s,r){this.m_attrid=this.m_aLocations[this.m_attridIndex],this.m_attrid>-1&&(this.m_gl.enableVertexAttribArray(this.m_attrid),this.m_gl.vertexAttribPointer(this.m_attrid,t,e,i,s,r)),this.m_attridIndex++}vertexAttribPointerFirst(t,e,i,s,r){this.m_attridIndex=1,this.m_attrid=this.m_aLocations[0],this.m_attrid>-1&&(this.m_gl.enableVertexAttribArray(this.m_attrid),this.m_gl.vertexAttribPointer(this.m_attrid,t,e,i,s,r))}getUniformLocationAt(t){return this.m_uIndex=t+1,this.m_uLocations[t]}getUniformLocationNext(){return this.m_uLc=this.m_uLocations[this.m_uIndex++],this.m_uLc}getUniformLocationFirst(){return this.m_uIndex=1,this.m_uLocations[0]}getUniformLocationByNS(t){return this.m_uLocationDict.get(t)}getUniformTypeNameByNS(t){return this.m_uniformDict.has(t)?this.m_uniformDict.get(t).typeName:""}getUniformTypeByNS(t){return this.m_uniformDict.has(t)?this.m_uniformDict.get(t).type:0}hasUniformByName(t){return this.m_uniformDict.has(t)}getUniformLengthByNS(t){return this.m_uniformDict.has(t)?this.m_uniformDict.get(t).arrLength:0}initShdProgram(){let t,e=this.m_shdData.getVSCodeStr(),i=this.m_shdData.getFSCodeStr();r.default.VERT_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED&&(e.indexOf(" mediump ")>=0&&(t=new RegExp(" mediump ","g"),e=e.replace(t," highp ")),e.indexOf(" lowp ")>=0&&(t=new RegExp(" lowp ","g"),e=e.replace(t," highp "))),r.default.SHADERCODE_TRACE_ENABLED;let s=this.loadShader(this.m_gl.VERTEX_SHADER,e);r.default.FRAG_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED&&(i.indexOf(" mediump ")>=0&&(t=new RegExp(" mediump ","g"),i=i.replace(t," highp ")),i.indexOf(" lowp ")>=0&&(t=new RegExp(" lowp ","g"),i=i.replace(t," highp "))),r.default.SHADERCODE_TRACE_ENABLED;let a=this.loadShader(this.m_gl.FRAGMENT_SHADER,i),h=this.m_gl.createProgram();return this.m_gl.attachShader(h,a),this.m_gl.attachShader(h,s),this.m_gl.linkProgram(h),this.m_gl.getProgramParameter(h,this.m_gl.LINK_STATUS)?(this.m_vtxShd=s,this.m_frgShd=a,h):(r.default.SHADERCODE_TRACE_ENABLED,null)}loadShader(t,e){let i=this.m_gl.createShader(t);return this.m_gl.shaderSource(i,e),this.m_gl.compileShader(i),this.m_gl.getShaderParameter(i,this.m_gl.COMPILE_STATUS)?i:(r.default.SHADERCODE_TRACE_ENABLED,this.m_gl.deleteShader(i),null)}getUniqueShaderName(){return this.m_shdUniqueName}enabled(){return null!=this.m_program}upload(t,e){null==this.m_program&&(this.m_rcuid=e,this.m_gl=t,this.m_program=this.initShdProgram(),this.m_program.uniqueName=this.m_shdUniqueName,null!=this.m_program&&this.createLocations())}getRCUid(){return this.m_rcuid}uniformBlockBinding(t,e){this.m_gl.uniformBlockBinding(this.m_program,this.m_gl.getUniformBlockIndex(this.m_program,t),e)}toString(){return"[ShdProgram(uniqueName = "+this.m_shdUniqueName+")]"}getGPUProgram(){return this.m_program}destroy(){this.m_aLocations=null,this.m_attriSizeList=null,this.m_texTotal>0&&(this.m_texLocations.fill(null),this.m_texTotal=0),null!=this.m_program&&(this.m_gl.deleteShader(this.m_vtxShd),this.m_gl.deleteShader(this.m_frgShd),this.m_vtxShd=null,this.m_frgShd=null,this.m_gl.deleteProgram(this.m_program),this.m_program=null),this.m_gl=null,this.m_shdData=null}}e.default=h},2560:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("ab73")),a=s(i("7279"));class h{create(t,e){let i=null,s=t.getCamera();return e.hasUniformByName(r.default.CameraViewMatUNS)&&e.hasUniformByName(r.default.CameraProjectiveMatUNS)?(i=new a.default,i.uns="u_viewAndProjMat",i.uniformNameList=[r.default.CameraViewMatUNS,r.default.CameraProjectiveMatUNS],i.copyDataFromProbe(s.matUProbe)):e.hasUniformByName(r.default.CameraViewMatUNS)?(i=new a.default,i.uns="u_viewMat",i.uniformNameList=[r.default.CameraViewMatUNS],i.copyDataFromProbeAt(0,s.matUProbe)):e.hasUniformByName(r.default.CameraProjectiveMatUNS)&&(i=new a.default,i.uns="u_projMat",i.uniformNameList=[r.default.CameraProjectiveMatUNS],i.copyDataFromProbeAt(1,s.matUProbe)),i}getIDNS(){return"CameraUniformBuilder"}}e.default=h},"264c":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(t){this.m_begin=null,this.m_end=null,this.m_next=null,this.m_node=null,this.m_nodes=[],this.m_nodesTotal=0,this.m_shader=null,this.m_renderTotal=0,this.m_sorter=null,this.sortEnabled=!0,this.m_shader=t}setSorter(t){this.m_sorter=t}showInfo(){let t="",e=this.m_begin;while(null!=e)t+=e.unit.value+",",e=e.next}clear(){if(null!=this.m_shader){this.m_nodes.length>0&&(this.m_nodes=[]);let t=this.m_begin,e=null;while(null!=t)e=t,t=t.next,e.prev=null,e.next=null;this.m_begin=this.m_end=null,this.m_nodesTotal=0,this.m_renderTotal=0,this.sortEnabled=!0,this.m_shader=null}this.m_sorter=null}update(){this.sortEnabled&&this.sort()}run(t){this.m_shader.resetUniform();let e=null,i=this.m_nodes;for(let s=0;s<this.m_renderTotal;++s)e=i[s],this.m_shader.bindToGpu(e.shdUid),e.run(t),e.partTotal<1?e.drawThis(t):e.drawPart(t)}runLockMaterial(t){this.m_shader.resetUniform();let e=null,i=this.m_nodes;for(let s=0;s<this.m_renderTotal;++s)e=i[s],this.m_shader.bindToGpu(e.shdUid),e.vro.run(),e.runLockMaterial2(null),e.partTotal<1?e.drawThis(t):e.drawPart(t)}sort(){if(this.m_nodesTotal>0){let t=this.m_begin;this.m_nodes.length<this.m_nodesTotal&&(this.m_nodes=new Array(Math.round(1.1*this.m_nodesTotal)+1));let e=0;while(null!=t)t.drawEnabled&&t.unit.drawEnabled&&(this.m_nodes[e]=t.unit,++e),t=t.next;this.m_renderTotal=e;let i=0;null!=this.m_sorter&&(i=this.m_sorter.sortRODisplay(this.m_nodes,e)),i<1&&this.snsort(0,e-1)}}sorting(t,e){let i=this.m_nodes;this.m_node=i[t];let s=this.m_node.value;while(t<e){while(t<e&&i[e].value>=s)--e;i[t]=i[e];while(t<e&&i[t].value<=s)++t;i[e]=i[t]}return i[t]=this.m_node,t}snsort(t,e){if(t<e){let i=this.sorting(t,e);this.snsort(t,i-1),this.snsort(i+1,e)}}getNodesTotal(){return this.m_nodesTotal}getBegin(){return this.m_next=this.m_begin,this.m_begin}getNext(){return null!=this.m_next&&(this.m_next=this.m_next.next),this.m_next}isEmpty(){return this.m_nodesTotal<1}addNode(t){null==t.prev&&null==t.next&&(null==this.m_begin?this.m_end=this.m_begin=t:null!=this.m_end.prev?(this.m_end.next=t,t.prev=this.m_end,this.m_end=t):(this.m_begin.next=t,t.prev=this.m_end,this.m_end=t),this.m_end.next=null,this.m_nodesTotal++)}removeNode(t){null==t.prev&&null==t.next&&t!=this.m_begin||(t==this.m_begin?t==this.m_end?this.m_begin=this.m_end=null:(this.m_begin=t.next,this.m_begin.prev=null):t==this.m_end?(this.m_end=t.prev,this.m_end.next=null):(t.next.prev=t.prev,t.prev.next=t.next),t.prev=null,t.next=null,this.m_nodesTotal--)}}e.default=s},"265e":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.__$ruid=-1,this.drawEnabled=!0,this.uid=-1,this.index=-1,this.drawMode=0,this.ivsIndex=0,this.ivsCount=0,this.insCount=0,this.shdUid=-1,this.vtxUid=-1,this.texMid=-1,this.rtokey=-1,this.prev=null,this.next=null,this.unit=null,this.vro=null,this.tro=null,this.rvroI=-1,this.rtroI=-1}setValue(t){this.unit.value=t}isVsible(){return null==this.unit||this.unit.drawEnabled}updateData(){let t=this.unit;this.drawMode=t.drawMode,this.ivsIndex=t.ivsIndex,this.ivsCount=t.ivsCount,this.insCount=t.insCount,t.drawOffset=t.ivsIndex*t.ibufStep,this.vtxUid=t.vtxUid,this.vro=t.vro,this.shdUid=t.shdUid,this.texMid=t.texMid,this.tro=t.tro}reset(){this.drawEnabled=!0,this.uid=-1,this.index=-1,this.drawMode=0,this.ivsIndex=0,this.ivsCount=0,this.insCount=0,this.shdUid=-1,this.vtxUid=-1,this.texMid=-1,this.rtokey=-1,this.unit=null,this.vro=null,this.tro=null,this.prev=null,this.next=null}toString(){return"[Object RPONode(uid = "+this.uid+", index = "+this.index+", shdUid = "+this.shdUid+", vtxUid = "+this.vtxUid+")]"}}e.default=s},"29ef":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("7c63"),r=i("e08e");class a{static Initialize(){if(a.s_initBoo){a.s_initBoo=!1;let t=a;t.Rstate=new s.RODrawState,s.RenderColorMask.Rstate=a.Rstate,s.RenderStateObject.Rstate=a.Rstate,t.COLOR_MASK_ALL_TRUE=s.RenderColorMask.Create("all_true",!0,!0,!0,!0),t.COLOR_MASK_ALL_FALSE=s.RenderColorMask.Create("all_false",!1,!1,!1,!1);let e=s.RenderStateObject,i=r.RenderBlendMode;i.NORMAL=e.CreateBlendMode("NORMAL",r.GLBlendMode.ONE,r.GLBlendMode.ZERO,r.GLBlendEquation.FUNC_ADD),i.OPAQUE=e.CreateBlendMode("OPAQUE",r.GLBlendMode.ONE,r.GLBlendMode.ZERO,r.GLBlendEquation.FUNC_ADD),i.TRANSPARENT=e.CreateBlendMode("TRANSPARENT",r.GLBlendMode.SRC_ALPHA,r.GLBlendMode.ONE_MINUS_SRC_ALPHA,r.GLBlendEquation.FUNC_ADD),i.ALPHA_ADD=e.CreateBlendMode("ALPHA_ADD",r.GLBlendMode.ONE,r.GLBlendMode.ONE_MINUS_SRC_ALPHA,r.GLBlendEquation.FUNC_ADD),i.ADD=e.CreateBlendMode("ADD",r.GLBlendMode.SRC_ALPHA,r.GLBlendMode.ONE,r.GLBlendEquation.FUNC_ADD),i.ADD_LINEAR=e.CreateBlendMode("ADD_LINEAR",r.GLBlendMode.ONE,r.GLBlendMode.ONE,r.GLBlendEquation.FUNC_ADD),i.INVERSE_ALPHA=e.CreateBlendMode("INVERSE_ALPHA",r.GLBlendMode.ONE,r.GLBlendMode.SRC_ALPHA,r.GLBlendEquation.FUNC_ADD),i.BLAZE=e.CreateBlendMode("BLAZE",r.GLBlendMode.SRC_COLOR,r.GLBlendMode.ONE,r.GLBlendEquation.FUNC_ADD),i.OVERLAY=e.CreateBlendMode("OVERLAY",r.GLBlendMode.DST_COLOR,r.GLBlendMode.DST_ALPHA,r.GLBlendEquation.FUNC_ADD),i.OVERLAY2=e.CreateBlendMode("OVERLAY2",r.GLBlendMode.DST_COLOR,r.GLBlendMode.SRC_ALPHA,r.GLBlendEquation.FUNC_ADD),t.NORMAL_STATE=e.Create("normal",r.CullFaceMode.BACK,r.RenderBlendMode.NORMAL,r.DepthTestMode.OPAQUE),t.BACK_CULLFACE_NORMAL_STATE=t.NORMAL_STATE,t.FRONT_CULLFACE_NORMAL_STATE=e.Create("front_normal",r.CullFaceMode.FRONT,r.RenderBlendMode.NORMAL,r.DepthTestMode.OPAQUE),t.NONE_CULLFACE_NORMAL_STATE=e.Create("none_normal",r.CullFaceMode.NONE,r.RenderBlendMode.NORMAL,r.DepthTestMode.OPAQUE),t.ALL_CULLFACE_NORMAL_STATE=e.Create("all_cull_normal",r.CullFaceMode.FRONT_AND_BACK,r.RenderBlendMode.NORMAL,r.DepthTestMode.OPAQUE),t.BACK_NORMAL_ALWAYS_STATE=e.Create("back_normal_always",r.CullFaceMode.BACK,r.RenderBlendMode.NORMAL,r.DepthTestMode.ALWAYS),t.BACK_TRANSPARENT_STATE=e.Create("back_transparent",r.CullFaceMode.BACK,r.RenderBlendMode.TRANSPARENT,r.DepthTestMode.TRANSPARENT_SORT),t.BACK_TRANSPARENT_ALWAYS_STATE=e.Create("back_transparent_always",r.CullFaceMode.BACK,r.RenderBlendMode.TRANSPARENT,r.DepthTestMode.ALWAYS),t.NONE_TRANSPARENT_STATE=e.Create("none_transparent",r.CullFaceMode.NONE,r.RenderBlendMode.TRANSPARENT,r.DepthTestMode.TRANSPARENT_SORT),t.NONE_TRANSPARENT_ALWAYS_STATE=e.Create("none_transparent_always",r.CullFaceMode.NONE,r.RenderBlendMode.TRANSPARENT,r.DepthTestMode.ALWAYS),t.FRONT_CULLFACE_GREATER_STATE=e.Create("front_greater",r.CullFaceMode.FRONT,r.RenderBlendMode.NORMAL,r.DepthTestMode.TRUE_GREATER),t.BACK_ADD_BLENDSORT_STATE=e.Create("back_add_blendSort",r.CullFaceMode.BACK,r.RenderBlendMode.ADD,r.DepthTestMode.TRANSPARENT_SORT),t.BACK_ADD_ALWAYS_STATE=e.Create("back_add_always",r.CullFaceMode.BACK,r.RenderBlendMode.ADD,r.DepthTestMode.ALWAYS),t.BACK_ALPHA_ADD_ALWAYS_STATE=e.Create("back_alpha_add_always",r.CullFaceMode.BACK,r.RenderBlendMode.ALPHA_ADD,r.DepthTestMode.ALWAYS),t.NONE_ADD_ALWAYS_STATE=e.Create("none_add_always",r.CullFaceMode.NONE,r.RenderBlendMode.ADD,r.DepthTestMode.ALWAYS),t.NONE_ADD_BLENDSORT_STATE=e.Create("none_add_blendSort",r.CullFaceMode.NONE,r.RenderBlendMode.ADD,r.DepthTestMode.TRANSPARENT_SORT),t.NONE_ALPHA_ADD_ALWAYS_STATE=e.Create("none_alpha_add_always",r.CullFaceMode.NONE,r.RenderBlendMode.ALPHA_ADD,r.DepthTestMode.ALWAYS),t.FRONT_ADD_ALWAYS_STATE=e.Create("front_add_always",r.CullFaceMode.FRONT,r.RenderBlendMode.ADD,r.DepthTestMode.ALWAYS),t.FRONT_TRANSPARENT_STATE=e.Create("front_transparent",r.CullFaceMode.FRONT,r.RenderBlendMode.TRANSPARENT,r.DepthTestMode.TRANSPARENT_SORT),t.FRONT_TRANSPARENT_ALWAYS_STATE=e.Create("front_transparent_always",r.CullFaceMode.FRONT,r.RenderBlendMode.TRANSPARENT,r.DepthTestMode.ALWAYS),t.NONE_CULLFACE_NORMAL_ALWAYS_STATE=e.Create("none_normal_always",r.CullFaceMode.NONE,r.RenderBlendMode.NORMAL,r.DepthTestMode.ALWAYS),t.BACK_ALPHA_ADD_BLENDSORT_STATE=e.Create("back_alpha_add_blendSort",r.CullFaceMode.BACK,r.RenderBlendMode.ALPHA_ADD,r.DepthTestMode.TRANSPARENT_SORT)}}static CreateBlendMode(t,e,i,r=0){return s.RenderStateObject.CreateBlendMode(t,e,i,r)}static CreateBlendModeSeparate(t,e,i,r=0,a=0,h=0){return s.RenderStateObject.CreateBlendModeSeparate(t,e,i,r,a,h)}static CreateRenderState(t,e,i,r){return s.RenderStateObject.Create(t,e,i,r)}static CreateRenderColorMask(t,e,i,r,a){return s.RenderColorMask.Create(t,e,i,r,a)}static GetRenderStateByName(t){return s.RenderStateObject.GetRenderStateByName(t)}static GetRenderColorMaskByName(t){return s.RenderColorMask.GetColorMaskByName(t)}static UnlockBlendMode(){s.RenderStateObject.UnlockBlendMode()}static LockBlendMode(t){s.RenderStateObject.LockBlendMode(t)}static UnlockDepthTestMode(){s.RenderStateObject.UnlockDepthTestMode()}static LockDepthTestMode(t){s.RenderStateObject.LockDepthTestMode(t)}static ResetState(){s.RenderColorMask.Reset(),s.RenderStateObject.Reset(),a.Rstate.reset()}static Reset(t){s.RenderColorMask.Reset(),s.RenderStateObject.Reset(),a.Rstate.setRenderContext(t),a.Rstate.reset()}static ResetInfo(){a.DrawCallTimes=0,a.DrawTrisNumber=0,a.POVNumber=0}static SetDepthTestEnable(t){a.Rstate.setDepthTestEnable(t)}static SetBlendEnable(t){a.Rstate.setBlendEnable(t)}static SetStencilFunc(t,e,i){a.Rstate.setStencilFunc(t,e,i)}static SetStencilMask(t){a.Rstate.setStencilMask(t)}static SetStencilOp(t,e,i){a.Rstate.setStencilOp(t,e,i)}}a.s_initBoo=!0,a.Rstate=null,a.DrawCallTimes=0,a.DrawTrisNumber=0,a.POVNumber=0,a.COLOR_MASK_ALL_TRUE=0,a.COLOR_MASK_ALL_FALSE=1,a.NORMAL_STATE=0,a.BACK_CULLFACE_NORMAL_STATE=0,a.FRONT_CULLFACE_NORMAL_STATE=1,a.NONE_CULLFACE_NORMAL_STATE=2,a.ALL_CULLFACE_NORMAL_STATE=3,a.BACK_NORMAL_ALWAYS_STATE=4,a.BACK_TRANSPARENT_STATE=5,a.BACK_TRANSPARENT_ALWAYS_STATE=6,a.NONE_TRANSPARENT_STATE=7,a.NONE_TRANSPARENT_ALWAYS_STATE=8,a.FRONT_CULLFACE_GREATER_STATE=9,a.BACK_ADD_BLENDSORT_STATE=10,a.BACK_ADD_ALWAYS_STATE=11,a.BACK_ALPHA_ADD_ALWAYS_STATE=12,a.NONE_ADD_ALWAYS_STATE=13,a.NONE_ADD_BLENDSORT_STATE=14,a.NONE_ALPHA_ADD_ALWAYS_STATE=15,a.FRONT_ADD_ALWAYS_STATE=16,a.FRONT_TRANSPARENT_STATE=17,a.FRONT_TRANSPARENT_ALWAYS_STATE=18,a.NONE_CULLFACE_NORMAL_ALWAYS_STATE=19,a.BACK_ALPHA_ADD_BLENDSORT_STATE=20,e.default=a},"2be1":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.m_nodesTotal=0,this.m_nodes=[],this.m_flags=[],this.m_freeIdList=[]}createNode(){return null}restoreUid(t){}getFreeId(){return this.m_freeIdList.length>0?this.m_freeIdList.pop():-1}getNodeByUid(t){return this.m_nodes[t]}create(){let t=null,e=this.getFreeId();return e>=0?(t=this.m_nodes[e],t.uid=e,this.m_flags[e]=s.S_BUSY):(t=this.createNode(),this.m_nodes.push(t),this.m_flags.push(s.S_BUSY),t.uid=this.m_nodesTotal,this.m_nodesTotal++),t}restore(t){return null!=t&&t.uid>=0&&this.m_flags[t.uid]==s.S_BUSY&&(this.restoreUid(t.uid),this.m_freeIdList.push(t.uid),this.m_flags[t.uid]=s.S_FREE,t.reset(),!0)}restoreByUid(t){return t>=0&&t<this.m_nodesTotal&&this.m_flags[t]==s.S_BUSY&&(this.restoreUid(t),this.m_freeIdList.push(t),this.m_flags[t]=s.S_FREE,this.m_nodes[t].reset(),!0)}}s.S_BUSY=1,s.S_FREE=0,e.default=s},3024:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("3077"));class a extends r.default{constructor(t){super(),this.m_datafs=new Float32Array(4),this.m_vec4Total=1,t<1&&(t=1),this.m_vec4Total=t}bindSlotAt(t){super.bindSlotAt(t),this.addVec4Data(this.m_datafs,this.m_vec4Total)}destroy(){super.destroy(),this.m_datafs=null}}e.default=a},3077:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("644c")),a=s(i("5326"));class h{constructor(){this.m_slot=null,this.m_fsList=null,this.m_fsIndex=0,this.m_slotBeginIndex=-1,this.rst=-1,this.uniformsTotal=0,this.uniformTypes=null,this.dataSizeList=null}getSlotBeginIndex(){return this.m_slotBeginIndex}getSlotUid(){return this.m_slot.getUid()}getFS32At(t){return this.m_fsList[t]}setFS32At(t,e){this.m_fsList[e]=t}setVec4DataAt(t,e,i,s,r){let a=this.m_fsList[t];a[0]=e,a[1]=i,a[2]=s,a[3]=r}setVec4Data(t,e,i,s){let r=this.m_fsList[0];r[0]=t,r[1]=e,r[2]=i,r[3]=s}setVec4DataAtWithArr4(t,e){this.m_fsList[t].set(e,0)}setVec4DataWithArr4(t){this.m_fsList[0].set(t,0)}addVec4Data(t,e){t.length,this.m_fsList.push(t),this.uniformTypes.push(r.default.SHADER_VEC4),this.dataSizeList.push(e),this.m_slot.dataList[this.m_fsIndex]=t,this.m_fsIndex++,this.uniformsTotal++,this.m_slot.index++}addMat4Data(t,e){this.m_fsList.push(t),this.uniformTypes.push(r.default.SHADER_MAT4),this.dataSizeList.push(e),this.m_slot.dataList[this.m_fsIndex]=t,this.m_fsIndex++,this.uniformsTotal++,this.m_slot.index++}isEnabled(){return this.rst>=0}bindSlotAt(t){let e=a.default.GetSlotAt(t);this.rst>=0&&this.reset(),null==this.m_fsList&&(this.m_fsList=[],this.uniformTypes=[],this.dataSizeList=[]),this.m_slot=e,this.rst=1,this.m_slotBeginIndex=e.index,this.m_fsIndex=e.index}update(){if(this.rst++,this.uniformsTotal<2)this.m_slot.flagList[this.m_slotBeginIndex]=this.rst;else for(let t=this.m_slotBeginIndex;t<=this.m_fsIndex;++t)this.m_slot.flagList[t]=this.rst}reset(){this.rst=-1,this.m_slotBeginIndex=-1,this.uniformsTotal=0,this.m_fsIndex=0,null!=this.m_fsList&&(this.m_fsList=null,this.uniformTypes=null,this.dataSizeList=null),this.m_slot=null}destroy(){this.reset()}}e.default=h},"36cb":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i("e08e"),a=s(i("ab73")),h=i("b02c"),_=s(i("4f27")),l=s(i("b30a")),n=s(i("9156")),o=i("74c3");class m{constructor(){this.m_emptyTRO=null,this.m_shader=null,this.m_rpoUnitBuilder=null,this.m_processBuider=null,this.m_roVtxBuild=null,this.m_rc=null,this.m_vtxRes=null,this.m_texRes=null,this.m_deferredVbufs=[],this.m_deferredTROs=[],this.m_deferredTextures=[],this.m_haveDeferredUpdate=!1}initialize(t,e,i,s){null==this.m_shader&&(this.m_rc=t,this.m_vtxRes=t.Vertex,this.m_texRes=t.Texture,this.m_shader=new l.default(t.getRCUid(),t.getRC(),t.getRenderAdapter()),this.m_rpoUnitBuilder=e,this.m_processBuider=i,this.m_roVtxBuild=s,this.m_emptyTRO=new h.EmptyTexRenderObj(this.m_texRes))}getRenderProxy(){return this.m_rc}getRenderShader(){return this.m_shader}getTextureResource(){return this.m_texRes}updateTextureData(t,e){this.m_texRes.hasResUid(t.getResUid())&&(e?(this.m_deferredTextures.push(t),this.m_haveDeferredUpdate=!0):t.__$updateToGpu(this.m_texRes))}updateDispTRO(t,e){t.__$ruid>-1&&(e?(this.m_deferredTROs.push(t),this.m_haveDeferredUpdate=!0):this.updateTextureTRO(t))}updateTextureTRO(t){if(null!=t.__$$runit){let e=t.getMaterial();if(null!=e){let i=this.m_texRes,s=t.__$$runit,r=h.TextureRenderObj.GetByMid(i.getRCUid(),e.__$troMid);if(null!=s.tro&&(null==r||s.tro.getMid()!=r.getMid())){let t=this.m_shader.findShdProgramByShdData(e.getShaderData());null!=t&&(t.getTexTotal()>0?(null==r&&(r=h.TextureRenderObj.Create(i,e.getTextureList(),t.getTexTotal())),s.tro!=r&&(null!=s.tro&&s.tro.__$detachThis(),s.tro=r,r.__$attachThis(),s.texMid=s.tro.getMid(),this.m_processBuider.rejoinRunitForTro(s),e.__$troMid=s.tro.getMid())):s.tro!=this.m_emptyTRO&&(null!=s.tro&&s.tro.__$detachThis(),s.tro=this.m_emptyTRO,s.texMid=s.tro.getMid(),this.m_processBuider.rejoinRunitForTro(s),e.__$troMid=s.texMid))}}}}updateDispMaterial(t,e){let i=null;if(e.__$ruid>=0){let s=this.m_rc,r=e.getMaterial();if(null!=r){if(null==r.getShaderData()){let t=r.getTextureList(),e=null!=t&&null!=t&&t.length>0;r.initializeByCodeBuf(e)}i=this.m_shader.create(r.getShaderData()),i.upload(s.RContext,s.getUid()),t.shdUid=i.getUid();let l=null;if(i.getTexTotal()>0?(l=h.TextureRenderObj.Create(this.m_texRes,r.getTextureList(),i.getTexTotal()),t.tro!=l&&(null!=t.tro&&t.tro.__$detachThis(),t.tro=l,l.__$attachThis(),t.texMid=t.tro.getMid(),t.__$rprouid>=0&&this.m_processBuider.rejoinRunitForTro(t),r.__$troMid=t.tro.getMid())):t.tro!=this.m_emptyTRO&&(null!=t.tro&&t.tro.__$detachThis(),t.tro=this.m_emptyTRO,t.texMid=t.tro.getMid(),t.__$rprouid>=0&&this.m_processBuider.rejoinRunitForTro(t),r.__$troMid=t.texMid),null==this.m_shader.getSharedUniformByShd(i)){let t=this.createsharedMList(r,i);if(null!=t)for(let e=0;e<t.length;++e)t[e].program=i.getGPUProgram();this.m_shader.setSharedUniformByShd(i,_.default.BuildShared(t,s,i))}let o=i.hasUniformByName(a.default.LocalTransformMatUNS);null==r.__$uniform&&(r.__$uniform=_.default.BuildLocalFromData(r.createSelfUniformData(),i)),o&&null!=e.getTransform()&&(t.transUniform=n.default.GetTransUniform(e.getTransform())),null==t.transUniform?(t.transUniform=_.default.BuildLocalFromTransformV(o?e.getMatrixFS32():null,i),n.default.SetTransUniform(e.getTransform(),t.transUniform)):t.transUniform=_.default.UpdateLocalFromTransformV(t.transUniform,o?e.getMatrixFS32():null,i),t.uniform=r.__$uniform}}return i}updateVtxDataToGpuByUid(t,e){this.m_vtxRes.updateDataToGpu(t,e)}updateDispVbuf(t,e){if(t.__$ruid>-1)if(e)this.m_deferredVbufs.push(t),this.m_haveDeferredUpdate=!0;else{let e=t.__$$runit;if(null!=e&&e.vtxUid!=t.vbuf.getUid()){let i=e.vtxUid,s=this.m_vtxRes;s.hasResUid(i)&&s.__$detachRes(i),e.vro.__$detachThis(),this.buildVtxRes(t,e,this.m_shader.findShdProgramByUid(e.shdUid)),e.__$rprouid>=0&&this.m_processBuider.rejoinRunitForVro(e)}}}buildVtxRes(t,e,i){if(null!=t.vbuf){let s=this.m_vtxRes;e.ivsIndex=t.ivsIndex,e.ivsCount=t.ivsCount,e.insCount=t.insCount,e.visible=t.visible,e.setVisible(t.visible),e.drawMode=t.drawMode,e.renderState=t.renderState,e.rcolorMask=t.rcolorMask,e.trisNumber=t.trisNumber;let r,a=t.vbuf.getUid(),h=!0;s.hasResUid(a)?(r=s.getVertexRes(a),h=r.version!=t.vbuf.version,h&&(s.destroyRes(a),r.rcuid=s.getRCUid(),r.resUid=a)):(r=new o.GpuVtxObect,r.rcuid=s.getRCUid(),r.resUid=a,s.addVertexRes(r)),h&&(r.indices.ibufStep=t.vbuf.getIBufStep(),r.indices.initialize(this.m_roVtxBuild,t.vbuf),r.vertex.initialize(this.m_roVtxBuild,i,t.vbuf),r.version=t.vbuf.version),s.__$attachRes(a),e.vro=r.createVRO(this.m_roVtxBuild,i,!0),e.vro.__$attachThis(),e.vtxUid=t.vbuf.getUid(),e.ibufStep=e.vro.ibufStep,e.ibufType=4!=e.ibufStep?this.m_rc.UNSIGNED_SHORT:this.m_rc.UNSIGNED_INT}}buildGpuDisp(t){if(t.__$ruid<0&&null!=t.getMaterial()){t.__$$rsign=r.DisplayRenderSign.LIVE_IN_WORLD;let e=this.m_rpoUnitBuilder.create();if(t.__$ruid=e.uid,t.__$$runit=e,null!=t.getPartGroup()){e.partGroup=t.getPartGroup().slice(0),e.partTotal=e.partGroup.length;let i=e.partGroup;for(let t=0,s=e.partTotal;t<s;)t++,i[t++]*=e.ibufStep}return e.setDrawFlag(t.renderState,t.rcolorMask),this.buildVtxRes(t,e,this.updateDispMaterial(e,t)),!0}return!1}update(){if(this.m_haveDeferredUpdate){this.m_haveDeferredUpdate=!1;let t=this.m_deferredVbufs.length,e=0;if(t>0){for(;e<t;++e)this.updateDispVbuf(this.m_deferredVbufs[e],!1);this.m_deferredVbufs=[]}if(t=this.m_deferredTROs.length,t>0){for(e=0;e<t;++e)this.updateTextureTRO(this.m_deferredTROs[e]);this.m_deferredTROs=[]}if(t=this.m_deferredTextures.length,t>0){for(e=0;e<t;++e)this.m_deferredTextures[e].__$updateToGpu(this.m_texRes);this.m_deferredTextures=[]}}}createsharedMList(t,e){let i=t.createSharedUniforms();if(null==i){let s=t.createSharedUniformsData();if(null!=s&&s.length>0){i=[];for(let t=0;t<s.length;++t)if(null!=s[t]){let r=_.default.BuildLocalFromData(s[t],e);i.push(r)}i.length<1&&(i=null)}}return i}updateGlobalMaterial(t){if(null!=t){let e=this.m_rc,i=null,s=null,r=null,a=!1;null==t.getShaderData()?(r=t.getTextureList(),a=null!=r&&r.length>0,t.initializeByCodeBuf(a)):r=t.getTextureList(),s=this.m_shader.create(t.getShaderData()),s.upload(e.RContext,e.getUid());let l=s.getTexTotal();if(l>0&&(i=h.TextureRenderObj.Create(this.m_texRes,r,l)),null==this.m_shader.getSharedUniformByShd(s)){let i=this.createsharedMList(t,s);if(null!=i)for(let t=0;t<i.length;++t)i[t].program=s.getGPUProgram();this.m_shader.setSharedUniformByShd(s,_.default.BuildShared(i,e,s))}null==t.__$uniform&&(t.__$uniform=_.default.BuildLocalFromData(t.createSelfUniformData(),s)),this.m_shader.__$globalUniform=t.__$uniform,this.m_shader.bindToGpu(s.getUid()),null!=i&&i.run()}}reset(){this.m_deferredVbufs=[],this.m_deferredTROs=[]}}e.default=m},"38de":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("6e01")),a=s(i("8e17")),h=s(i("f48d"));class _ extends h.default{constructor(){super(...arguments),this.tv=new a.default(1,0,0)}update(){this.tv.normalize()}updateFast(){this.tv.normalize()}static IntersectionTri(t,e,i,s,r,a){return 0}static IntersectionLS(t,e,i,s,r,l=1){let n=_.__tAv;if(n.copyFrom(s),n.subtractBy(i),n.normalize(),a.default.Cross(e,n,r),r.normalize(),n.w=r.dot(t)-r.dot(s),Math.abs(n.w)<=l){r.crossBy(e),r.normalize(),r.w=r.dot(t),n.w=(r.w-r.dot(i))/n.dot(r),r.copyFrom(n),r.scaleBy(n.w),r.addBy(i),n.copyFrom(r),n.subtractBy(i);let a=h.default.__tV1;if(a.copyFrom(r),a.subtractBy(s),n.dot(a)<=0)return 1}return 0}static IntersectioNearSphere2(t,e,i,s,a){let h=_.__tAv;if(h.x=i.x-t.x,h.y=i.y-t.y,h.z=i.z-t.z,h.w=h.dot(e),s*=s,h.w>r.default.MATH_MIN_POSITIVE){if(a.copyFrom(e),a.scaleBy(h.w),a.subtractBy(h),h.x=a.getLengthSquared(),h.x<=s)return h.w-=Math.sqrt(s-h.x),a.copyFrom(e),a.scaleBy(h.w),a.addBy(t),a.w=1,1}else if(h.getLengthSquared()<=s&&(a.copyFrom(e),a.scaleBy(h.w),a.subtractBy(h),h.x=a.getLengthSquared(),h.x<=s))return h.w+=Math.sqrt(s-h.x),a.copyFrom(e),a.scaleBy(h.w),a.addBy(t),a.w=1,1;return 0}static IntersectioNearSphere(t,e,i,s,a){let h=_.__tAv;if(h.x=i.x-t.x,h.y=i.y-t.y,h.z=i.z-t.z,h.w=h.dot(e),h.w>r.default.MATH_MIN_POSITIVE){if(a.x=h.x-h.w*e.x,a.y=h.y-h.w*e.y,a.z=h.z-h.w*e.z,a.x=a.getLengthSquared(),a.w=s*s,a.x<=a.w)return a.x=h.getLengthSquared(),a.z=a.w-a.x,h.normalize(),a.y=h.dot(e)*Math.sqrt(a.x),h.w=.5*(-a.y+Math.sqrt(a.y*a.y+4*a.z)),a.copyFrom(e),a.scaleBy(h.w),a.addBy(t),a.w=1,1}else if(a.x=h.getLengthSquared(),a.w=s*s,a.x<=a.w)return a.z=a.w-a.x,h.normalize(),a.y=h.dot(e)*Math.sqrt(a.x),h.w=.5*(-a.y+Math.sqrt(a.y*a.y+4*a.z)),a.copyFrom(e),a.scaleBy(h.w),a.addBy(t),a.w=1,1;return 0}static IntersectSphere(t,e,i,s){let a=_.__tAv;return a.x=i.x-t.x,a.y=i.y-t.y,a.z=i.z-t.z,a.w=a.dot(e),a.w<r.default.MATH_MIN_POSITIVE||(a.x-=a.w*e.x,a.y-=a.w*e.y,a.z-=a.w*e.z),a.getLengthSquared()<=s*s}}_.__tAv=new a.default,e.default=_},3930:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("6e01"));class a{constructor(t=1,e=1,i=1,s=1){this.r=1,this.g=1,this.b=1,this.a=1,this.r=t,this.g=e,this.b=i,this.a=s}setRGB3Bytes(t,e,i){this.r=t/255,this.g=e/255,this.b=i/255}setRGB3f(t,e,i){this.r=t,this.g=e,this.b=i}setRGBUint24(t){this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255}setRGBA4f(t,e,i,s){this.r=t,this.g=e,this.b=i,this.a=s}copyFrom(t){this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a}scaleBy(t){this.r*=t,this.g*=t,this.b*=t}inverseRGB(){this.r=1-this.r,this.g=1-this.g,this.b=1-this.b}randomRGB(t=1){this.r=Math.random()*t,this.g=Math.random()*t,this.b=Math.random()*t}normalizeRandom(t=1){this.r=Math.random(),this.g=Math.random(),this.b=Math.random();let e=Math.sqrt(this.r*this.r+this.g*this.g+this.b*this.b);e>r.default.MATH_MIN_POSITIVE&&(this.r=t*this.r/e,this.g=t*this.g/e,this.b=t*this.b/e)}normalize(t){void 0==t&&(t=1);let e=Math.sqrt(this.r*this.r+this.g*this.g+this.b*this.b);e>r.default.MATH_MIN_POSITIVE&&(this.r=t*this.r/e,this.g=t*this.g/e,this.b=t*this.b/e)}getCSSDecRGBAColor(){return"rgba("+Math.floor(255*this.r)+","+Math.floor(255*this.g)+","+Math.floor(255*this.b)+","+this.a.toFixed(4)+")"}getCSSHeXRGBColor(){let t="#",e=Math.floor(255*this.r);return t+=e<15?"0"+e.toString(16):""+e.toString(16),e=Math.floor(255*this.g),t+=e<15?"0"+e.toString(16):""+e.toString(16),e=Math.floor(255*this.b),t+=e<15?"0"+e.toString(16):""+e.toString(16),t}toString(){return"[Color4(r="+this.r+", g="+this.g+",b="+this.b+",a="+this.a+")]"}}e.default=a},"3b73":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{static SetLanguage(t){s.s_language=t}static GetLanguage(){return s.s_language}static SetThreadEnabled(t){s.s_threadEnabled=t}static GetThreadEnabled(){return s.s_threadEnabled}static GetDebugEnabled(){return s.s_debugEnabled}static SetDebugEnabled(t){s.s_debugEnabled=t}static SetDevicePixelRatio(t){s.s_devicePixelRatio=t}static GetDevicePixelRatio(){return s.s_devicePixelRatio}static Initialize(t){s.s_inited&&(s.s_inited=!1,s.s_WEBGL_VER=t[0],s.TestMobileWeb(),s.s_language=navigator.language+"")}static IsWebGL1(){return 1==s.s_WEBGL_VER}static IsWebGL2(){return 2==s.s_WEBGL_VER}static IsMobileWeb(){return s.s_mobileFlag>0?2==s.s_mobileFlag:s.TestMobileWeb()}static IsIOS(){if(s.s_IOS_Flag>0)return 2==s.s_IOS_Flag;let t=!1;return t=!!/iPad|iPhone|iPod/.test(navigator.platform)||void 0!=navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform),s.s_IOS_Flag=t?2:1,t}static IsIpadOS(){if(s.s_IPad_Flag>0)return 2==s.s_IPad_Flag;let t=navigator.maxTouchPoints>0&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform);return!t&&/iPod|iPad|iPadPro|iPodPro/i.test(navigator.userAgent)&&(t=!0),s.s_IPad_Flag=t?2:1,t}static IsAndroidOS(){if(s.s_Android_Flag>0)return 2==s.s_Android_Flag;let t=s.TestMobileWeb();return t=!(!t||!/Android|Linux/i.test(navigator.userAgent)),s.s_Android_Flag=t?2:1,t}static TestMobileWeb(){return s.s_mobileFlag>0?2==s.s_mobileFlag:/mobile/.test(location.href)?(s.s_mobileFlag=2,2==s.s_mobileFlag):/Android/i.test(navigator.userAgent)?/Mobile/i.test(navigator.userAgent)?(s.s_mobileFlag=2,2==s.s_mobileFlag):(s.s_mobileFlag=1,2==s.s_mobileFlag):/webOS|iPhone|iPod|iPad|iPodPro|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?(s.s_mobileFlag=2,2==s.s_mobileFlag):(s.s_mobileFlag=1,2==s.s_mobileFlag)}}s.s_inited=!0,s.s_WEBGL_VER=2,s.s_devicePixelRatio=1,s.s_mobileFlag=0,s.s_Android_Flag=0,s.s_IOS_Flag=0,s.s_IPad_Flag=0,s.s_language="zh-CN",s.s_debugEnabled=!0,s.GPU_VENDOR="unknown",s.GPU_RENDERER="unknown",s.MAX_TEXTURE_SIZE=4096,s.MAX_RENDERBUFFER_SIZE=4096,s.MAX_VIEWPORT_WIDTH=4096,s.MAX_VIEWPORT_HEIGHT=4096,s.SHOWLOG_ENABLED=!1,s.SHADERCODE_TRACE_ENABLED=!1,s.VERT_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED=!0,s.FRAG_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED=!0,s.s_threadEnabled=!0,e.default=s},"3bda":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{static SetDebugEnabled(t){s.s_debugEanbled=t}static ShowLog(t){s.s_debugEanbled&&(s.s_logStr.length>0?s.s_logStr+="<br/>"+t:s.s_logStr=t,s.UpdateDivText())}static GetLog(){return s.s_logStr}static ShowLogOnce(t){s.s_debugEanbled&&(s.s_logStr=t,s.UpdateDivText())}static ClearLog(t=""){s.s_debugEanbled&&(s.s_logStr=t,s.UpdateDivText())}static UpdateDivText(){if(s.s_debugEanbled)if(null!=s.s_infoDiv)s.s_infoDiv.innerHTML=s.s_logStr;else{var t=document.createElement("div");t.style.color="";var e=t;e.width=128,e.height=64,e.style.backgroundColor="#aa0033",e.style.left="0px",e.style.top="128px",e.style.position="absolute",document.body.appendChild(e),s.s_infoDiv=e,e.innerHTML=s.s_logStr}}}s.s_logStr="",s.s_infoDiv=null,s.s_debugEanbled=!1,e.default=s},"3c81":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("2be1")),a=s(i("7696"));class h extends r.default{setCreateParams(t,e,i,s,r,a){this.m_shader=t,this.m_rpoNodeBuilder=e,this.m_rpoUnitBuilder=i,this.m_vtxResource=s,this.m_batchEnabled=r,this.m_fixedState=a}createNode(){return new a.default(this.m_shader,this.m_rpoNodeBuilder,this.m_rpoUnitBuilder,this.m_vtxResource,this.m_batchEnabled,this.m_fixedState)}rejoinRunitForTro(t){this.getNodeByUid(t.__$rprouid).rejoinRunitForTro(t)}rejoinRunitForVro(t){this.getNodeByUid(t.__$rprouid).rejoinRunitForVro(t)}}e.default=h},"442e":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("2be1")),a=s(i("265e"));class h extends r.default{createNode(){return new a.default}}e.default=h},"4f27":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("3b73")),a=i("d53d"),h=s(i("2560")),_=s(i("83d1")),l=s(i("a7ed")),n=s(i("e87b"));class o extends a.ShaderUniform{use(t){}useByLocation(t,e,i,s){}useByShd(t,e){}updateData(){}destroy(){}}o.EmptyUniform=new o;class m{static Initialize(){if(m.s_initBoo){m.s_initBoo=!1;let t=new h.default;m.s_builders.push(t),m.s_uniformDict.set(t.getIDNS(),t),t=new _.default,m.s_builders.push(t),m.s_uniformDict.set(t.getIDNS(),t),t=new l.default,m.s_builders.push(t),m.s_uniformDict.set(t.getIDNS(),t),t=new n.default,m.s_builders.push(t),m.s_uniformDict.set(t.getIDNS(),t),m.s_buildersTot=m.s_builders.length}}static AddSharedUniformBuilder(t){null==t||m.s_uniformDict.has(t.getIDNS())||(m.s_builders.push(t),m.s_uniformDict.set(t.getIDNS(),t),++m.s_buildersTot)}static removeSharedUniformBuilder(t){if(null!=t&&m.s_uniformDict.has(t.getIDNS())){for(let e=0;e<m.s_buildersTot;++e)if(t==m.s_builders[e]){m.s_builders.splice(e,1),--m.s_buildersTot;break}m.s_uniformDict.delete(t.getIDNS())}}static removeSharedUniformBuilderByName(t){if(m.s_uniformDict.has(t)){let e=m.s_uniformDict.get(t);for(let t=0;t<m.s_buildersTot;++t)if(e==m.s_builders[t]){m.s_builders.splice(t,1),--m.s_buildersTot;break}m.s_uniformDict.delete(t)}}static BuildShared(t,e,i){let s,r=null,a=null,h=m.s_builders,_=0,l=m.s_buildersTot,n=null;for(;_<l;++_)n=h[_].create(e,i),null!=n&&(null!=a?a.next=n:null==r&&(r=n),a=n);if(null==t)s=r;else if(null!=r){for(let e=0;e<t.length;++e)a.next=t[e],a=a.next;s=r}if(null==s)s=o.EmptyUniform;else{let t=s,e=0;while(null!=t){if(null!=t.uniformNameList&&null==t.locations)for(t.types=[],t.locations=[],t.uniformSize=t.uniformNameList.length,e=0;e<t.uniformSize;++e)t.types.push(i.getUniformTypeByNS(t.uniformNameList[e])),t.locations.push(i.getUniformLocationByNS(t.uniformNameList[e]));t=t.next}}return s}static BuildLocalFromTransformV(t,e){if(null!=t){let i;return i=new a.ShaderMat4Uniform,i.uniformSize=0,i.uniformNameList=[],i.types=[],i.locations=[],i.dataList=[],i.dataSizeList=[],i.uniformSize+=1,i.uniformNameList.push("u_objMat"),i.types.push(e.getUniformTypeByNS("u_objMat")),i.locations.push(e.getUniformLocationByNS("u_objMat")),i.dataList.push(t),i.dataSizeList.push(1),i}return m.s_emptyUniform}static UpdateLocalFromTransformV(t,e,i){if(null!=e){let s,r=t;return null==r?(r=new a.ShaderMat4Uniform,s=r,s.uniformSize=0,s.uniformNameList=[],s.types=[],s.locations=[],s.dataList=[],s.dataSizeList=[],s.uniformSize+=1,s.uniformNameList.push("u_objMat"),s.types.push(i.getUniformTypeByNS("u_objMat")),s.locations.push(i.getUniformLocationByNS("u_objMat")),s.dataList.push(e),s.dataSizeList.push(1)):(s=r,s.locations=[],s.locations.push(i.getUniformLocationByNS("u_objMat"))),s}return m.s_emptyUniform}static BuildLocalFromData(t,e){if(null!=t){let i;i=r.default.IsWebGL1()?new a.ShaderUniformV1:new a.ShaderUniformV2,i.uns=t.uns,i.uniformNameList=[],i.types=[],i.locations=[],i.dataList=[],i.dataSizeList=[],i.uniformSize=0;let s=t,h=0;while(null!=s){if(null!=s.uniformNameList&&null==s.locations)for(i.uniformSize+=s.uniformNameList.length,h=0;h<i.uniformSize;++h)i.uniformNameList.push(s.uniformNameList[h]),i.types.push(e.getUniformTypeByNS(s.uniformNameList[h])),i.locations.push(e.getUniformLocationByNS(s.uniformNameList[h])),i.dataList.push(s.dataList[h]),i.dataSizeList.push(e.getUniformLengthByNS(s.uniformNameList[h]));s=s.next}return i}return o.EmptyUniform}static BuildLocal(t,e){let i=new a.ShaderUniform;i.uniformNameList=[],i.types=[],i.locations=[],i.dataList=[],i.dataSizeList=[],i.uniformSize=0;let s=t,r=0;while(null!=s){if(null!=s.uniformNameList&&null==s.locations)for(i.uniformSize+=s.uniformNameList.length,r=0;r<i.uniformSize;++r)i.uniformNameList.push(s.uniformNameList[r]),i.types.push(e.getUniformTypeByNS(s.uniformNameList[r])),i.locations.push(e.getUniformLocationByNS(s.uniformNameList[r])),i.dataList.push(s.dataList[r]),i.dataSizeList.push(e.getUniformLengthByNS(s.uniformNameList[r]));s=s.next}return i}}m.s_initBoo=!0,m.s_uniformDict=new Map,m.s_builders=[],m.s_buildersTot=0,m.s_emptyUniform=new a.ShaderUniform,e.default=m},5326:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(t){this.m_total=256,this.m_uid=0,this.index=0,this.dataList=[],this.flagList=null,this.m_uid=t}getUid(){return this.m_uid}static GetSlotAt(t){return s.s_slots[t]}static Initialize(t){let e=s.s_slots[t];if(null==e&&(e=new s(t),s.s_slots[t]=e),null==e.flagList){e.flagList=new Uint16Array(e.m_total);for(let t=0;t<e.m_total;++t)e.dataList.push(null),e.flagList[t]=0}}}s.s_slots=new Array(16),e.default=s},"56c5":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("030e"));class a{static SetRenderer(t){a.m_rc=t.getRC(),a.m_webGLVer=t.getWebGLVersion();let e=a;1==a.m_webGLVer&&null!=r.default.WEBGL_draw_buffers?e.COLOR_ATTACHMENT0=r.default.WEBGL_draw_buffers.COLOR_ATTACHMENT0_WEBGL:e.COLOR_ATTACHMENT0=a.m_rc.COLOR_ATTACHMENT0}static DrawBuffers(t){2==a.m_webGLVer?a.m_rc.drawBuffers(t):null!=r.default.WEBGL_draw_buffers&&r.default.WEBGL_draw_buffers.drawBuffersWEBGL(t)}}a.m_rc=null,a.m_webGLVer=2,a.COLOR_ATTACHMENT0=0,e.default=a},"5f3c":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("3b73")),a=s(i("df9d")),h=i("7c63");class _{constructor(t){this.m_uid=-1,this.m_nodeLinker=new a.default,this.index=-1,this.shdUid=-1,this.procuid=-1,this.batchEnabled=!0,this.fixedState=!0,this.runMode=0,this.rpoNodeBuilder=null,this.rpoUnitBuilder=null,this.vtxResource=null,this.m_shader=null,this.m_shader=t,this.m_uid=_.__s_uid++}showInfo(){this.m_nodeLinker.showInfo()}addNode(t){this.m_nodeLinker.addNodeAndSort(t)}rejoinNode(t){this.m_nodeLinker.containsNode(t)&&(this.m_nodeLinker.removeNodeAndSort(t),this.m_nodeLinker.addNodeAndSort(t))}removeNode(t){this.m_nodeLinker.removeNodeAndSort(t)}isEmpty(){return null==this.m_nodeLinker.getBegin()}run(t){switch(this.runMode){case 2:this.run2(t);break;case 1:this.run1(t);break;case 0:this.run0(t);break;default:break}}run0(t){let e=this.m_nodeLinker.getBegin();if(null!=e){this.m_shader.bindToGpu(this.shdUid),this.m_shader.resetUniform();let i=null;while(null!=e)e.drawEnabled&&(i=e.unit,i.drawEnabled&&(i.run(t),i.partTotal<1?i.drawThis(t):i.drawPart(t))),e=e.next}}run1(t){let e=this.m_nodeLinker.getBegin();if(null!=e){this.m_shader.bindToGpu(this.shdUid),this.m_shader.resetUniform();let i=null,s=this.m_nodeLinker.getVtxTotalAt(e.rvroI),r=this.m_nodeLinker.getTexTotalAt(e.rtroI),a=s>0,h=r>0;while(null!=e)s<1&&(s=this.m_nodeLinker.getVtxTotalAt(e.rvroI),a=!0),s--,r<1&&(r=this.m_nodeLinker.getTexTotalAt(e.rtroI),h=!0),r--,e.drawEnabled&&(i=e.unit,i.drawEnabled&&(a&&(e.vro.run(),a=!1),h&&(e.tro.run(),h=!1),i.run2(t),i.partTotal<1?i.drawThis(t):i.drawPart(t))),e=e.next}}run2(t){let e=this.m_nodeLinker.getBegin();if(null!=e){this.m_shader.bindToGpu(this.shdUid),this.m_shader.resetUniform();let i=null;h.RenderStateObject.UseRenderState(e.unit.renderState),h.RenderColorMask.UseRenderState(e.unit.rcolorMask);let s=this.m_nodeLinker.getVtxTotalAt(e.rvroI),r=this.m_nodeLinker.getTexTotalAt(e.rtroI),a=s>0,_=r>0;while(null!=e)s<0&&(s=this.m_nodeLinker.getVtxTotalAt(e.rvroI),a=!0),s--,r<0&&(r=this.m_nodeLinker.getTexTotalAt(e.rtroI),_=!0),r--,e.drawEnabled&&(i=e.unit,i.drawEnabled&&(a&&(e.vro.run(),a=!1),_&&(e.tro.run(),_=!1),null!=i.ubo&&i.ubo.run(t),this.m_shader.useTransUniform(i.transUniform),this.m_shader.useUniform(i.uniform),i.partTotal<1?i.drawThis(t):i.drawPart(t))),e=e.next}}runLockMaterial(t){let e=this.m_nodeLinker.getBegin();if(null!=e){this.m_shader.bindToGpu(this.shdUid),this.m_shader.resetUniform();let i=this.m_shader.isTextureUnLocked();t.Texture.unlocked=i;let s=null;if(this.batchEnabled){let r=this.m_nodeLinker.getVtxTotalAt(e.rvroI),a=r>0;while(null!=e)r<1&&(r=this.m_nodeLinker.getVtxTotalAt(e.rvroI),a=!0),r--,s=e.unit,e.drawEnabled&&s.drawEnabled&&(a&&(e.vro.run(),a=!1),i&&e.tro.run(),s.runLockMaterial2(null),s.partTotal<1?s.drawThis(t):s.drawPart(t)),e=e.next}else while(null!=e)s=e.unit,e.drawEnabled&&s.drawEnabled&&(s.runLockMaterial(),i&&e.tro.run(),s.partTotal<1?s.drawThis(t):s.drawPart(t)),e=e.next;t.Texture.unlocked=!1}}drawUnit(t,e,i){e.drawEnabled&&(this.m_shader.bindToGpu(e.shdUid),e.run(t),e.partTotal<1?e.drawThis(t):e.drawPart(t))}drawLockMaterialByUnit(t,e,i,s,a){if(e.drawEnabled){if(a&&this.m_shader.resetUniform(),r.default.IsMobileWeb()){let t=this.vtxResource.getVROByResUid(i.vbuf.getUid(),this.m_shader.getCurrentShd(),!0);t.run()}else e.vro.run();e.runLockMaterial2(s?this.m_shader.__$globalUniform:null),e.partTotal<1?e.drawThis(t):e.drawPart(t)}}reset(){let t=this.m_nodeLinker.getBegin(),e=null;if(null!=t){let i;while(null!=t)e=t,t=t.next,this.rpoUnitBuilder.setRPNodeParam(e.__$ruid,this.procuid,-1),e.reset(),i=e.unit,this.rpoNodeBuilder.restore(e)&&this.rpoUnitBuilder.restore(i)}this.index=-1,this.shdUid=-1,this.procuid=-1,this.m_nodeLinker.clear(),this.rpoNodeBuilder=null,this.rpoUnitBuilder=null,this.vtxResource=null}destroy(){this.reset()}getUid(){return this.m_uid}toString(){return"[RPOBlock(uid = "+this.m_uid+", index = "+this.index+", shdUid = "+this.shdUid+")]"}}_.__s_uid=0,e.default=_},"644c":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){}static GetTypeByTypeNS(t){switch(t){case"mat4":return s.SHADER_MAT4;case"mat3":return s.SHADER_MAT3;case"mat2":return s.SHADER_MAT2;case"float":return s.SHADER_FLOAT;case"int":return s.SHADER_INT;case"vec4":return s.SHADER_VEC4;case"vec3":return s.SHADER_VEC3;case"vec2":return s.SHADER_VEC2;case"vec4[]":return s.SHADER_VEC4FV;case"vec3[]":return s.SHADER_VEC3FV;case"vec2[]":return s.SHADER_VEC2FV;case"sampler2D":return s.SHADER_SAMPLER2D;case"sampler3D":return s.SHADER_SAMPLER3D;case"samplerCube":return s.SHADER_SAMPLERCUBE;default:break}return s.SHADER_UNDEFINED}static GetTypeNSByType(t){switch(t){case s.SHADER_MAT4:return"mat4";case s.SHADER_MAT3:return"mat3";case s.SHADER_MAT2:return"mat2";case s.SHADER_FLOAT:return"float";case s.SHADER_VEC4:return"vec4";case s.SHADER_VEC3:return"vec3";case s.SHADER_VEC2:return"vec2";case s.SHADER_SAMPLER2D:return"sampler2D";case s.SHADER_SAMPLER3D:return"sampler3D";case s.SHADER_SAMPLERCUBE:return"samplerCube";case s.SHADER_UNDEFINED:return"undefined";default:break}return""}}s.ATTRINS_VTX_VS="a_vs",s.ATTRINS_VTX_UVS="a_uvs",s.ATTRINS_VTX_NVS="a_nvs",s.ATTRINS_VTX_CVS="a_cvs",s.UNIFORMNS_OBJ_MAT_NS="u_objMat",s.UNIFORMNS_VIEW_MAT_NS="u_viewMat",s.UNIFORMNS_PROJ_MAT_NS="u_projMat",s.SHADER_UNDEFINED=3010,s.SHADER_VEC2=3011,s.SHADER_VEC3=3012,s.SHADER_VEC4=3013,s.SHADER_VEC2FV=3014,s.SHADER_VEC3FV=3015,s.SHADER_VEC4FV=3016,s.SHADER_MAT2=3017,s.SHADER_MAT3=3018,s.SHADER_MAT4=3019,s.SHADER_FLOAT=3020,s.SHADER_INT=3021,s.SHADER_MAT2FV=3022,s.SHADER_MAT3FV=3023,s.SHADER_MAT4FV=3024,s.SHADER_SAMPLER2D=3031,s.SHADER_SAMPLERCUBE=3032,s.SHADER_SAMPLER3D=3033,s.SHADER_PRECISION_LOWP=3101,s.SHADER_PRECISION_MEDIUMP=3111,s.SHADER_PRECISION_HIGHP=3121,s.UNIFORM_TEX_SAMPLER2D="sampler2D",s.UNIFORM_TEX_SAMPLERCUBE="samplerCube",s.UNIFORM_TEX_SAMPLER3D="sampler3D",s.UNIFORMNS_TEX_SAMPLER_0="u_sampler0",s.UNIFORMNS_TEX_SAMPLER_1="u_sampler1",s.UNIFORMNS_TEX_SAMPLER_2="u_sampler2",s.UNIFORMNS_TEX_SAMPLER_3="u_sampler3",s.UNIFORMNS_TEX_SAMPLER_4="u_sampler4",s.UNIFORMNS_TEX_SAMPLER_5="u_sampler5",s.UNIFORMNS_TEX_SAMPLER_6="u_sampler6",s.UNIFORMNS_TEX_SAMPLER_7="u_sampler7",s.UNIFORMNS_TEX_SAMPLER_LIST=[s.UNIFORMNS_TEX_SAMPLER_0,s.UNIFORMNS_TEX_SAMPLER_1,s.UNIFORMNS_TEX_SAMPLER_2,s.UNIFORMNS_TEX_SAMPLER_3,s.UNIFORMNS_TEX_SAMPLER_4,s.UNIFORMNS_TEX_SAMPLER_5,s.UNIFORMNS_TEX_SAMPLER_6,s.UNIFORMNS_TEX_SAMPLER_7],e.default=s},"6d49":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("3b73")),a=s(i("baae")),h=i("8d98"),_=s(i("56c5"));class l{constructor(t,e,i){this.m_uid=-1,this.m_rcuid=0,this.m_COLOR_ATTACHMENT0=0,this.m_fbo=null,this.m_depthStencilRBO=null,this.m_depthRBO=null,this.m_colorRBO=null,this.m_width=512,this.m_height=512,this.m_bufferLType=0,this.m_gl=null,this.m_fboTarget=0,this.m_texTargetTypes=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.m_attachmentMaskList=[!0,!0,!0,!0,!0,!0,!0,!0],this.m_preAttachTotal=0,this.m_preAttachIndex=0,this.m_activeAttachmentTotal=0,this.m_attachmentIndex=0,this.m_clearDepthArr=new Float32Array(1),this.m_clearColorArr=new Float32Array(4),this.m_stencilValueArr=new Int16Array(4),this.m_fboSizeChanged=!1,this.textureLevel=0,this.sizeFixed=!1,this.writeDepthEnabled=!0,this.writeStencilEnabled=!1,this.multisampleEnabled=!1,this.multisampleLevel=0,this.m_preAttachments=new Uint32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),this.m_preTragets=new Uint32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),this.m_preFTIndex=0,this.m_haveDepthTex=!1,this.m_resizeW=2,this.m_resizeH=2,this.toString=function(){switch(this.m_bufferLType){case a.default.DRAW_FRAMEBUFFER:return"[FrameBufferObject(DRAW_FRAMEBUFFER(uid="+this.m_uid+" width="+this.m_width+",height="+this.m_height+")]";case a.default.READ_FRAMEBUFFER:return"[FrameBufferObject(READ_FRAMEBUFFER(uid="+this.m_uid+" width="+this.m_width+",height="+this.m_height+")]";default:break}return"[FrameBufferObject(FRAMEBUFFER(uid="+this.m_uid+" width="+this.m_width+",height="+this.m_height+")]"},this.m_rcuid=t,this.m_texRes=e,this.m_bufferLType=i,this.m_uid=l.s_uid++}getUid(){return this.m_uid}resetAttachmentMask(t){let e=this.m_attachmentMaskList.length-1;while(e>=0)this.m_attachmentMaskList[e]=t,--e}setAttachmentMaskAt(t,e){this.m_attachmentMaskList[t]=e}getActiveAttachmentTotal(){return this.m_haveDepthTex?this.m_activeAttachmentTotal-1:this.m_activeAttachmentTotal}getAttachmentTotal(){return this.m_attachmentMaskList.length}bindToBackbuffer(t){switch(t){case a.default.DRAW_FRAMEBUFFER:this.m_gl.bindFramebuffer(this.m_gl.DRAW_FRAMEBUFFER,null);break;case a.default.READ_FRAMEBUFFER:this.m_gl.indFramebuffer(this.m_gl.READ_FRAMEBUFFER,null);break;default:this.m_gl.bindFramebuffer(this.m_gl.FRAMEBUFFER,null)}}bind(t){if(null!=this.m_fbo)switch(t){case a.default.DRAW_FRAMEBUFFER:this.m_gl.bindFramebuffer(this.m_gl.DRAW_FRAMEBUFFER,this.m_fbo);break;case a.default.READ_FRAMEBUFFER:this.m_gl.bindFramebuffer(this.m_gl.READ_FRAMEBUFFER,this.m_fbo);break;default:this.m_gl.bindFramebuffer(this.m_gl.FRAMEBUFFER,this.m_fbo)}}getFBO(){return this.m_fbo}getDepthStencilRBO(){return this.m_depthStencilRBO}getDepthRBO(){return this.m_depthRBO}getWidth(){return this.m_width}getHeight(){return this.m_height}getFramebufferType(){return this.m_bufferLType}renderToTexAt(t,e,i){let s=null!=e?e.internalFormat:-1;this.m_gl=t,0==i&&(this.m_preFTIndex=0,this.m_haveDepthTex=!1,this.m_gl.bindFramebuffer(this.m_fboTarget,this.m_fbo),s!=h.TextureFormat.DEPTH_COMPONENT&&s!=h.TextureFormat.DEPTH_STENCIL&&(this.m_activeAttachmentTotal=0,this.m_attachmentIndex=0));let r=-1,a=null;null!=e?(r=e.getTargetType(),a=this.m_texRes.getGpuBuffer(e.getResUid()),e.uploadFromFbo(this.m_texRes,this.m_width,this.m_height)):r=this.m_texTargetTypes[this.m_activeAttachmentTotal],this.framebufferTextureBind(t,r,s,a)}glFramebufferTex2D(t,e){let i=this.m_gl;i.framebufferTexture2D(this.m_fboTarget,t,i.TEXTURE_2D,e,0),this.m_preAttachments[this.m_preFTIndex]=t,this.m_preTragets[this.m_preFTIndex]=i.TEXTURE_2D,this.m_preFTIndex++}glFramebufferTexCube(t,e,i){let s=this.m_gl;s.framebufferTexture2D(this.m_fboTarget,t,s.TEXTURE_CUBE_MAP_POSITIVE_X+e,i,0),this.m_preAttachments[this.m_preFTIndex]=t,this.m_preTragets[this.m_preFTIndex]=s.TEXTURE_CUBE_MAP_POSITIVE_X+e,this.m_preFTIndex++}framebufferTexture2D(t,e,i,s){let r=-1;switch(i){case h.TextureFormat.DEPTH_COMPONENT:this.m_haveDepthTex=!0,r=this.m_gl.DEPTH_ATTACHMENT;break;case h.TextureFormat.DEPTH_STENCIL:this.m_haveDepthTex=!0,r=this.m_gl.DEPTH_STENCIL_ATTACHMENT;break;default:r=this.m_COLOR_ATTACHMENT0+this.m_attachmentIndex;break}r>0&&(this.m_attachmentMaskList[this.m_activeAttachmentTotal]?(this.glFramebufferTex2D(r,s),++this.m_attachmentIndex,this.m_texTargetTypes[this.m_activeAttachmentTotal]=null!=s?e:0):this.m_texTargetTypes[this.m_activeAttachmentTotal]=0,++this.m_activeAttachmentTotal)}framebufferTextureBind(t,e,i,s){switch(e){case h.TextureTarget.TEXTURE_2D:this.framebufferTexture2D(t,e,i,s);break;case h.TextureTarget.TEXTURE_CUBE:let r=0;for(let t=0;t<6;++t)this.m_attachmentMaskList[t]?(this.glFramebufferTexCube(this.m_COLOR_ATTACHMENT0+this.m_attachmentIndex,t,s),++this.m_attachmentIndex,this.m_texTargetTypes[this.m_activeAttachmentTotal+t]=null!=s?e:0,r++):this.m_texTargetTypes[this.m_activeAttachmentTotal+t]=0;r=r>0?r:6,this.m_activeAttachmentTotal+=r;break;case h.TextureTarget.TEXTURE_SHADOW_2D:this.m_attachmentMaskList[this.m_activeAttachmentTotal]?(this.glFramebufferTex2D(this.m_gl.DEPTH_ATTACHMENT,s),this.m_texTargetTypes[this.m_activeAttachmentTotal]=null!=s?e:0):this.m_texTargetTypes[this.m_activeAttachmentTotal]=0,++this.m_activeAttachmentTotal;break;default:break}}reset(){this.m_preAttachTotal=-1,this.m_preAttachIndex=-1}use(t){if(this.m_gl=t,null!=this.m_fbo){if(this.m_activeAttachmentTotal>1){if(this.m_preAttachIndex!=this.m_attachmentIndex){let t=[],e=0;for(;e<this.m_attachmentIndex;++e)t.push(this.m_COLOR_ATTACHMENT0+e);if(this.m_preAttachIndex>this.m_attachmentIndex)for(;e<this.m_preAttachIndex;++e)this.m_gl.framebufferTexture2D(this.m_fboTarget,this.m_preAttachments[e],this.m_preTragets[e],null,0);_.default.DrawBuffers(t),this.m_preAttachIndex=this.m_attachmentIndex}}else if(this.m_preAttachIndex!=this.m_attachmentIndex){if(this.m_preAttachIndex>this.m_attachmentIndex)for(let e=1;e<this.m_preAttachIndex;++e)this.m_gl.framebufferTexture2D(this.m_fboTarget,this.m_preAttachments[e],this.m_preTragets[e],null,0);let t=[this.m_COLOR_ATTACHMENT0];_.default.DrawBuffers(t),this.m_preAttachIndex=this.m_attachmentIndex}this.m_preAttachTotal=this.m_activeAttachmentTotal}}clearOnlyColor(t){if(null!=this.m_fbo)if(r.default.IsWebGL2())if(this.m_clearColorArr[0]=t.r,this.m_clearColorArr[1]=t.g,this.m_clearColorArr[2]=t.b,this.m_clearColorArr[3]=t.a,this.m_preAttachTotal>1)for(let e=0;e<this.m_preAttachTotal;++e)this.m_gl.clearBufferfv(this.m_gl.COLOR,e,this.m_clearColorArr);else this.m_gl.clearBufferfv(this.m_gl.COLOR,0,this.m_clearColorArr);else this.m_gl.clearColor(t.r,t.g,t.b,t.a)}clearOnlyDepth(t=1){r.default.IsWebGL2()?(this.m_clearDepthArr[0]=t,this.m_gl.clearBufferfv(this.m_gl.DEPTH,0,this.m_clearDepthArr)):this.m_gl.clearDepth(t)}clearOnlyStencil(t){this.m_stencilValueArr[0]=t,this.m_gl.clearBufferuiv(this.m_gl.STENCIL,0,this.m_stencilValueArr)}clearOnlyDepthAndStencil(t,e){this.m_gl.clearBufferfi(this.m_gl.DEPTH_STENCIL,0,t,e)}invalidateFramebuffer(){}resize(t,e){this.m_resizeW==t&&this.m_resizeH==e||(this.m_fboSizeChanged=!0,this.m_resizeW=t,this.m_resizeH=e)}initialize(t,e,i){this.m_gl=t,this.m_COLOR_ATTACHMENT0=_.default.COLOR_ATTACHMENT0,this.m_fboSizeChanged&&(e=this.m_resizeW,i=this.m_resizeH),null==this.m_fbo?this.createNewFBO(t,e,i):this.m_width==e&&this.m_height==i||this.createNewFBO(t,e,i),this.m_fboSizeChanged=!1}isSizeChanged(){return this.m_fboSizeChanged}destroy(t){null!=this.m_fbo&&(null!=this.m_depthStencilRBO&&(t.deleteFramebuffer(this.m_depthStencilRBO),this.m_depthStencilRBO=null),null!=this.m_depthRBO&&(t.deleteFramebuffer(this.m_depthRBO),this.m_depthRBO=null),null!=this.m_colorRBO&&(t.deleteFramebuffer(this.m_colorRBO),this.m_colorRBO=null),t.deleteFramebuffer(this.m_fbo),this.m_fbo=null),this.m_gl=null,this.m_fboTarget=0,this.m_fboSizeChanged=!1}buildDepthStencilRBO(t,e,i){null==this.m_depthStencilRBO&&(this.m_depthStencilRBO=t.createRenderbuffer()),this.multisampleEnabled?(t.bindRenderbuffer(t.RENDERBUFFER,this.m_depthStencilRBO),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.DEPTH_STENCIL,e,i),t.framebufferRenderbuffer(this.m_fboTarget,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this.m_depthStencilRBO),null==this.m_colorRBO&&(this.m_colorRBO=t.createRenderbuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.m_colorRBO),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.RGBA8,e,i),t.framebufferRenderbuffer(this.m_fboTarget,this.m_COLOR_ATTACHMENT0,t.RENDERBUFFER,this.m_colorRBO)):(t.bindRenderbuffer(t.RENDERBUFFER,this.m_depthStencilRBO),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,e,i),t.framebufferRenderbuffer(this.m_fboTarget,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this.m_depthStencilRBO))}buildDepthRBO(t,e,i){null==this.m_depthRBO&&(this.m_depthRBO=t.createRenderbuffer()),this.multisampleEnabled?(t.bindRenderbuffer(t.RENDERBUFFER,this.m_depthRBO),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.DEPTH_COMPONENT24,e,i),t.framebufferRenderbuffer(this.m_fboTarget,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.m_depthRBO),null==this.m_colorRBO&&(this.m_colorRBO=t.createRenderbuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.m_colorRBO),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.RGBA8,e,i),t.framebufferRenderbuffer(this.m_fboTarget,this.m_COLOR_ATTACHMENT0,t.RENDERBUFFER,this.m_colorRBO)):(t.bindRenderbuffer(t.RENDERBUFFER,this.m_depthRBO),r.default.IsWebGL2()?t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT24,e,i):t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,e,i),t.framebufferRenderbuffer(this.m_fboTarget,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.m_depthRBO))}buildStencilRBO(t,e,i){null==this.m_depthStencilRBO&&(null==this.m_depthStencilRBO&&(this.m_depthStencilRBO=t.createRenderbuffer()),this.multisampleEnabled?(t.bindRenderbuffer(t.RENDERBUFFER,this.m_depthStencilRBO),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.STENCIL_INDEX8,e,i),t.framebufferRenderbuffer(this.m_fboTarget,t.STENCIL_ATTACHMENT,t.RENDERBUFFER,this.m_depthStencilRBO),null==this.m_colorRBO&&(this.m_colorRBO=t.createRenderbuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.m_colorRBO),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.RGBA8,e,i),t.framebufferRenderbuffer(this.m_fboTarget,this.m_COLOR_ATTACHMENT0,t.RENDERBUFFER,this.m_colorRBO)):(t.bindRenderbuffer(t.RENDERBUFFER,this.m_depthStencilRBO),t.renderbufferStorage(t.RENDERBUFFER,t.STENCIL_INDEX8,e,i),t.framebufferRenderbuffer(this.m_fboTarget,t.STENCIL_ATTACHMENT,t.RENDERBUFFER,this.m_depthStencilRBO)))}buildColorRBO(t,e,i){this.multisampleEnabled&&(null==this.m_colorRBO&&(this.m_colorRBO=t.createRenderbuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.m_colorRBO),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.RGBA8,e,i),t.framebufferRenderbuffer(this.m_fboTarget,this.m_COLOR_ATTACHMENT0,t.RENDERBUFFER,this.m_colorRBO))}createNewFBO(t,e,i){let s=null==this.m_fbo;switch(this.m_preAttachTotal=this.m_activeAttachmentTotal=0,this.m_preAttachIndex=this.m_attachmentIndex=0,this.m_width=e,this.m_height=i,this.m_resizeW=e,this.m_resizeH=i,s&&(this.m_fbo=t.createFramebuffer()),this.m_bufferLType){case a.default.DRAW_FRAMEBUFFER:this.m_fboTarget=t.DRAW_FRAMEBUFFER;break;case a.default.READ_FRAMEBUFFER:this.m_fboTarget=t.READ_FRAMEBUFFER;break;default:this.m_fboTarget=t.FRAMEBUFFER;break}if(t.bindFramebuffer(this.m_fboTarget,this.m_fbo),this.writeDepthEnabled?this.writeStencilEnabled?null==this.m_depthStencilRBO&&this.buildDepthStencilRBO(t,e,i):this.buildDepthRBO(t,e,i):this.writeStencilEnabled?this.buildStencilRBO(t,e,i):this.buildColorRBO(t,e,i),s){t.checkFramebufferStatus(this.m_fboTarget);t.FRAMEBUFFER_COMPLETE}l.BindToBackbuffer(t,this.m_bufferLType)}static BindToBackbuffer(t,e){switch(e){case a.default.DRAW_FRAMEBUFFER:t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null);break;case a.default.READ_FRAMEBUFFER:t.indFramebuffer(t.READ_FRAMEBUFFER,null);break;default:t.bindFramebuffer(t.FRAMEBUFFER,null);break}}}l.s_uid=0,e.default=l},"6e01":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{static Clamp(t,e,i){return Math.max(Math.min(t,i),e)}static IsPowerOf2(t){return 0==(t&t-1)}static CalcCeilPowerOfTwo(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}static CalcNearestCeilPow2(t){return Math.pow(2,Math.round(Math.log(t)/Math.LN2))}static CalcFloorCeilPow2(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}static DegreeToRadian(t){return s.MATH_PI_OVER_180*t}static Log2(t){return Math.log(t)/Math.LN2}static GetMaxMipMapLevel(t,e){return Math.round(s.Log2(Math.max(t,e))+1)}static SafeACos(t){return t<=-1?s.MATH_PI:t>=1?0:Math.acos(t)}static GetNearestCeilPow2(t){let e=1;while(e<t)e<<=1;return e}static GetMinRadian(t,e){return e%=s.MATH_2PI,t%=s.MATH_2PI,e<t?(e=s.MATH_2PI-t+e,e>s.MATH_PI?e-s.MATH_2PI:e):e>t?(t=s.MATH_2PI-e+t,t>s.MATH_PI?s.MATH_2PI-t:-t):0}static GetMinDegree(t,e){let i=0;return e>=270&&t<90?i=(e-(t+360))%180:e<=90&&t>=270?i=(e+360-t)%180:(i=e-t,i>180?(i-=360,i%=360):i<-180&&(i+=360,i%=360)),i}static GetDegreeByXY(t,e){if(Math.abs(t)<1e-5)return e>=0?270:90;let i=180*Math.atan(e/t)/Math.PI;return e>0&&t>0?i:e<0&&t>=0?360+i:180+i}static GetRadianByXY(t,e){if(Math.abs(t)<s.MATH_MIN_POSITIVE)return e>=0?s.MATH_1PER2PI:s.MATH_3PER2PI;let i=Math.atan(e/t);return t>=0?i:s.MATH_PI+i}static GetRadianByCos(t,e,i){var r=Math.acos(t);return e>=0?r:s.MATH_PI+r}}s.MATH_MIN_POSITIVE=1e-5,s.MATH_MAX_NEGATIVE=-1e-5,s.MATH_MAX_POSITIVE=268435454,s.MATH_MIN_NEGATIVE=-268435454,s.MATH_1_OVER_255=1/255,s.MATH_PI=Math.PI,s.MATH_2PI=2*s.MATH_PI,s.MATH_3PER2PI=1.5*s.MATH_PI,s.MATH_1PER2PI=.5*s.MATH_PI,s.MATH_1_OVER_PI=1/s.MATH_PI,s.MATH_1_OVER_360=1/360,s.MATH_1_OVER_180=1/180,s.MATH_180_OVER_PI=180/s.MATH_PI,s.MATH_PI_OVER_180=s.MATH_PI/180,s.MATH_LN2=.6931471805599453,e.default=s},"722e":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{}s.NEAREST=4001,s.LINEAR=4002,s.LINEAR_MIPMAP_LINEAR=4003,s.NEAREST_MIPMAP_NEAREST=4004,s.LINEAR_MIPMAP_NEAREST=4005,s.NEAREST_MIPMAP_LINEAR=4006,e.default=s},7279:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("5326")),a=s(i("3b73")),h=s(i("d53d"));class _ extends h.default{constructor(){super(),this.slotId=0,this.slotIndex=0,this.uniformsTotal=0,this.locationIndexList=null,this.locations=null,this.rst=0,this.always=!1}clone(){let t=new _;return t.types=this.types.slice(0),t.uniformNameList=this.uniformNameList.slice(0),t.dataSizeList=this.dataSizeList.slice(0),t.slotIndex=this.slotIndex,t.uniformsTotal=this.uniformsTotal,t.slotId=this.slotId,t.always=this.always,t.rst=this.rst,t}copyDataFromProbe(t){this.types=t.uniformTypes.slice(0),this.dataSizeList=t.dataSizeList.slice(0),this.slotIndex=t.getSlotBeginIndex(),this.uniformsTotal=t.uniformsTotal,this.slotId=t.getSlotUid()}copyDataFromProbeAt(t,e){null==this.types&&(this.types=[],this.dataSizeList=[]),this.slotIndex=e.getSlotBeginIndex()+t,this.uniformsTotal=1,this.slotId=e.getSlotUid(),this.types[0]=e.uniformTypes[t],this.dataSizeList[0]=e.dataSizeList[t]}use(t){let e=r.default.GetSlotAt(t.getRCUid());if(this.always||this.rst!=e.flagList[this.slotIndex]){this.rst=e.flagList[this.slotIndex];let i=0;if(a.default.IsWebGL1())for(;i<this.uniformsTotal;++i)t.useUniformV1(this.locations[i],this.types[i],e.dataList[this.slotIndex+i],this.dataSizeList[i]);else for(;i<this.uniformsTotal;++i)t.useUniformV2(this.locations[i],this.types[i],e.dataList[this.slotIndex+i],this.dataSizeList[i],0)}}destroy(){this.types=null,this.dataSizeList=null,this.slotIndex=-1,this.uniformsTotal=0}}e.default=_},7499:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.m_dispBuilder=null,this.m_shader=null,this.m_texRes=null}setDispBuilder(t){null==this.m_dispBuilder&&(this.m_dispBuilder=t,this.m_shader=t.getRenderShader(),this.m_texRes=t.getTextureResource())}unlockMaterial(){this.m_shader.unlock(),this.m_texRes.unlocked=!0}lockMaterial(){this.m_shader.lock(),this.m_texRes.unlocked=!1}isUnlockMatrial(){return this.m_texRes.unlocked}unlockTexture(){this.m_shader.textureUnlock()}lockTexture(){this.m_shader.textureLock()}renderBegin(){this.m_shader.renderBegin(),this.m_texRes.renderBegin()}resetUniform(){this.m_shader.resetUniform()}useGlobalMaterial(t){this.m_dispBuilder.updateGlobalMaterial(t)}}e.default=s},"74c3":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8def")),a=s(i("fa60"));class h{constructor(){this.m_vtx=null,this.m_vtxUid=-1,this.m_gpuBufs=[],this.m_gpuBufsTotal=0,this.m_type=0,this.m_attribsTotal=0,this.m_wholeStride=0,this.m_typeList=null,this.m_offsetList=null,this.m_sizeList=null,this.m_vroList=[],this.m_vroListLen=0}updateToGpu(t){let e=this.m_gpuBufs.length;if(e>0){let i=this.m_vtx;if(this.version!=i.vertexVer){let s,r=i.getBufDataUsage(),a=this.m_sizeList;for(let h=0;h<e;++h)s=i.getF32DataAt(h),a[h]>=s.length?(t.bindArrBuf(this.m_gpuBufs[h]),t.arrBufSubData(s,0)):(t.bindArrBuf(this.m_gpuBufs[h]),t.arrBufData(s,r),a[h]=s.length);this.version=i.vertexVer}}}uploadCombined(t,e){let i=this.m_vtx,s=i.getF32DataAt(0);if(this.m_gpuBufs.push(t.createBuf()),t.bindArrBuf(this.m_gpuBufs[0]),t.arrBufData(s,i.getBufDataUsage()),this.m_gpuBufsTotal=1,this.m_sizeList=[s.length],null==this.m_typeList){this.m_wholeStride=0,this.m_typeList=new Array(this.m_attribsTotal),this.m_offsetList=new Array(this.m_attribsTotal);for(let t=0;t<this.m_attribsTotal;++t)this.m_offsetList[t]=this.m_wholeStride,this.m_wholeStride+=4*e.getLocationSizeByIndex(t),this.m_typeList[t]=e.getLocationTypeByIndex(t)}}uploadSeparated(t,e){let i=this.m_vtx,s=0,r=null,a=i.getBufDataUsage();if(this.m_gpuBufsTotal=this.m_vtx.getBuffersTotal(),this.m_sizeList=new Array(this.m_attribsTotal),null==i.bufData)for(;s<this.m_attribsTotal;++s)r=t.createBuf(),this.m_gpuBufs.push(r),t.bindArrBuf(r),t.arrBufData(i.getF32DataAt(s),a),this.m_sizeList[s]=i.getF32DataAt(s).length;else{let e=null,h=0,_=0,l=0,n=0;for(;s<this.m_attribsTotal;++s){for(r=t.createBuf(),this.m_gpuBufs.push(r),t.bindArrBuf(r),t.arrBufDataMem(i.bufData.getAttributeDataTotalBytesAt(s),a),l=0,n=0,_=i.bufData.getAttributeDataTotalAt(s),h=0;h<_;++h)e=i.bufData.getAttributeDataAt(s,h),n+=e.length,t.arrBufSubData(e,l),l+=e.byteLength;this.m_sizeList[s]=n}}if(null==this.m_typeList){this.m_typeList=new Array(this.m_attribsTotal),this.m_offsetList=new Array(this.m_attribsTotal);for(let t=0;t<this.m_attribsTotal;++t)this.m_offsetList[t]=this.m_wholeStride,this.m_wholeStride+=4*e.getLocationSizeByIndex(t),this.m_typeList[t]=e.getLocationTypeByIndex(t);this.m_wholeStride=0}}initialize(t,e,i){this.m_gpuBufs.length<1&&null!=i&&(this.version=i.vertexVer,this.m_vtx=i,this.m_vtxUid=i.getUid(),this.m_type=i.getType(),this.m_attribsTotal=e.getLocationsTotal(),this.m_type<1?this.uploadCombined(t,e):this.uploadSeparated(t,e))}getVROMid(t,e,i,s){let r=(131+t.getRCUid())*this.m_vtxUid;return i?(r=131*r+e.getMid(),r=131*r+3):r=131*r+e.getMid(),r=131*r+e.getLocationsTotal(),r=131*r+s,r}createVRO(t,e,i,s,h){let _=e.getLocationsTotal();if(this.m_attribsTotal*_>0&&_<=this.m_attribsTotal){let l=this.getVROMid(t,e,i,h),n=0,o=a.default.GetByMid(l);if(null!=o)return o;e.testVertexAttribPointerOffset(this.m_offsetList);if(i){let i=a.default.Create(t,l,this.m_vtx.getUid());if(i.vao=t.createVertexArray(),t.bindVertexArray(i.vao),this.m_type<1)for(t.bindArrBuf(this.m_gpuBufs[0]),n=0;n<_;++n)e.vertexAttribPointerTypeFloat(this.m_typeList[n],this.m_wholeStride,this.m_offsetList[n]);else for(n=0;n<_;++n)t.bindArrBuf(this.m_gpuBufs[n]),e.vertexAttribPointerTypeFloat(this.m_typeList[n],0,0);o=i,i.ibuf=s,t.bindVertexArray(null)}else{let i=r.default.Create(t,l,this.m_vtx.getUid());for(i.shdp=e,i.attribTypes=[],i.wholeOffsetList=[],i.wholeStride=this.m_wholeStride,this.m_type<1?i.vbuf=this.m_gpuBufs[0]:i.vbufs=this.m_gpuBufs,n=0;n<_;++n)e.testVertexAttribPointerType(this.m_typeList[n])&&(i.attribTypes.push(this.m_typeList[n]),i.wholeOffsetList.push(0));i.attribTypesLen=i.attribTypes.length,i.ibuf=s,o=i}return this.m_vroList.push(o),++this.m_vroListLen,o}return null}destroy(t){if(this.m_gpuBufs.length>0){this.m_type=-1;let e=0,i=null;for(;e<this.m_vroListLen;++e)i=this.m_vroList.pop(),i.restoreThis(),this.m_vroList[e]=null;for(this.m_vroListLen=0,e=0;e<this.m_attribsTotal;++e)t.deleteBuf(this.m_gpuBufs[e]),this.m_gpuBufs[e]=null;this.m_attribsTotal=0,this.m_gpuBufs=[]}}}class _{constructor(){this.m_uid=0,this.m_vtx=null,this.m_vtxUid=0,this.m_gpuBuf=null,this.m_ivsSize=0,this.ibufStep=0,this.m_uid=_.s_uid+1}getUid(){return this.m_uid}getVtxUid(){return this.m_vtxUid}getGpuBuf(){return this.m_gpuBuf}updateToGpu(t){if(null!=this.m_gpuBuf&&this.m_ivsSize>0){let e=this.m_vtx;this.version!=e.indicesVer&&(this.m_ivs=e.getIvsData(),t.bindEleBuf(this.m_gpuBuf),this.m_ivsSize>=this.m_ivs.length?t.eleBufSubData(this.m_ivs,e.getBufDataUsage()):t.eleBufData(this.m_ivs,e.getBufDataUsage()),this.m_ivsSize=this.m_ivs.length,this.version=e.indicesVer)}}initialize(t,e){if(null==this.m_gpuBuf&&null!=e.getIvsData())if(this.version=e.indicesVer,this.m_vtx=e,this.m_vtxUid=e.getUid(),this.m_ivs=e.getIvsData(),this.m_gpuBuf=t.createBuf(),t.bindEleBuf(this.m_gpuBuf),null==e.bufData)t.eleBufData(this.m_ivs,e.getBufDataUsage()),this.m_ivsSize=this.m_ivs.length;else{t.eleBufDataMem(e.bufData.getIndexDataTotalBytes(),e.getBufDataUsage());let i=null,s=0;this.m_ivsSize=0;for(let r=0,a=e.bufData.getIndexDataTotal();r<a;++r)i=e.bufData.getIndexDataAt(r),t.eleBufSubData(i,s),s+=i.byteLength,this.m_ivsSize+=i.length}}destroy(t){null!=this.m_gpuBuf&&(this.m_vtx=null,t.deleteBuf(this.m_gpuBuf),this.m_gpuBuf=null,this.m_ivs=null,this.m_ivsSize=0)}}_.s_uid=0;class l{constructor(){this.version=-1,this.waitDelTimes=0,this.rcuid=0,this.resUid=0,this.vertex=new h,this.indices=new _,this.m_attachCount=0}__$attachThis(){++this.m_attachCount}__$detachThis(){--this.m_attachCount,this.m_attachCount<1&&(this.m_attachCount=0)}getAttachCount(){return this.m_attachCount}createVRO(t,e,i){let s=this.vertex.createVRO(t,e,i,this.indices.getGpuBuf(),this.indices.getUid());return s.ibufStep=this.indices.ibufStep,s}updateToGpu(t){this.indices.updateToGpu(t),this.vertex.updateToGpu(t)}destroy(t){this.getAttachCount()<1&&this.resUid>=0&&(this.vertex.destroy(t),this.indices.destroy(t),this.resUid=-1)}}e.GpuVtxObect=l;class n{constructor(t,e,i){this.m_resMap=new Map,this.m_freeMap=new Map,this.m_updateIds=[],this.m_vtxResTotal=0,this.m_attachTotal=0,this.m_delay=128,this.m_haveDeferredUpdate=!1,this.m_rcuid=0,this.m_gl=null,this.m_vtxBuilder=null,this.unlocked=!0,this.m_rcuid=t,this.m_gl=e,this.m_vtxBuilder=i}createResByParams3(t,e,i,s){return!1}getRCUid(){return this.m_rcuid}getRC(){return this.m_gl}hasResUid(t){return this.m_resMap.has(t)}bindToGpu(t){}getGpuBuffer(t){return null}renderBegin(){this.m_vtxBuilder.renderBegin()}getVertexResTotal(){return this.m_vtxResTotal}updateDataToGpu(t,e){e?(this.m_updateIds.push(t),this.m_haveDeferredUpdate=!0):this.m_resMap.has(t)&&this.m_resMap.get(t).updateToGpu(this.m_vtxBuilder)}addVertexRes(t){this.m_resMap.has(t.resUid)||(t.waitDelTimes=0,this.m_resMap.set(t.resUid,t),this.m_vtxResTotal++)}getVertexRes(t){return this.m_resMap.get(t)}destroyRes(t){this.m_resMap.has(t)&&this.m_resMap.get(t).destroy(this.m_vtxBuilder)}__$attachRes(t){if(this.m_resMap.has(t)){this.m_attachTotal++;let e=this.m_resMap.get(t);e.getAttachCount()<1&&this.m_freeMap.has(t)&&this.m_freeMap.delete(t),e.waitDelTimes=0,e.__$attachThis()}}__$detachRes(t){if(this.m_resMap.has(t)&&this.m_resMap.has(t)){let e=this.m_resMap.get(t);e.getAttachCount()>0&&(this.m_attachTotal--,e.__$detachThis(),e.getAttachCount()<1&&this.m_freeMap.set(t,e))}}getVROByResUid(t,e,i){let s=this.m_resMap.get(t);return null!=s?s.createVRO(this.m_vtxBuilder,e,i):null}update(){if(this.m_haveDeferredUpdate){this.m_haveDeferredUpdate=!1;let t,e=this.m_updateIds.length;e=e>16?16:e;for(let i=0;i<e;++i)t=this.m_updateIds.shift(),this.m_resMap.has(t)&&this.m_resMap.get(t).updateToGpu(this.m_vtxBuilder)}if(this.m_delay--,this.m_delay<1){this.m_delay=128;for(const[t,e]of this.m_freeMap)e.waitDelTimes++,e.getAttachCount()<1?e.waitDelTimes>5&&(this.m_resMap.delete(e.resUid),this.m_freeMap.delete(e.resUid),e.destroy(this.m_vtxBuilder),this.m_vtxResTotal--):this.m_freeMap.delete(e.resUid)}}}e.ROVertexResource=n,e.default=n},7696:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("264c")),a=s(i("5f3c"));class h{constructor(t,e,i,s,r,a){this.m_rcuid=-1,this.m_rpIndex=-1,this.m_nodesLen=0,this.m_enabled=!0,this.m_blockList=[],this.m_blockListLen=0,this.m_blockFList=new Int8Array(h.s_max_shdTotal),this.m_blockFListLen=h.s_max_shdTotal,this.m_shader=null,this.m_rpoNodeBuilder=null,this.m_rpoUnitBuilder=null,this.m_vtxResource=null,this.m_fixBlock=null,this.m_sortBlock=null,this.m_sorter=null,this.m_batchEnabled=!0,this.m_fixedState=!0,this.m_sortEnabled=!1,this.uid=-1,this.m_shader=t,this.m_rpoNodeBuilder=e,this.m_rpoUnitBuilder=i,this.m_vtxResource=s,this.m_fixBlock=this.createBlock(),this.m_batchEnabled=r,this.m_fixedState=a;for(let h=0;h<this.m_blockFListLen;++h)this.m_blockFList[h]=-1}createBlock(){let t=new a.default(this.m_shader);return t.rpoNodeBuilder=this.m_rpoNodeBuilder,t.rpoUnitBuilder=this.m_rpoUnitBuilder,t.vtxResource=this.m_vtxResource,t}setRenderParam(t,e){this.m_blockListLen<1&&(this.m_batchEnabled=t,this.m_fixedState=e)}setRendererParam(t,e){this.m_rc=t,this.m_rcuid=t.getRCUid(),this.m_rpIndex=e}getUid(){return this.uid}getRCUid(){return this.m_rcuid}getRPIndex(){return this.m_rpIndex}hasSorter(){return null!=this.m_sorter}setSorter(t){this.m_sorter=t,null!=this.m_sortBlock&&this.m_sortBlock.setSorter(t)}setSortEnabled(t){this.m_nodesLen<1?this.m_sortEnabled=t:null!=this.m_sortBlock&&(this.m_sortBlock.sortEnabled=t)}getSortEnabled(){return this.m_sortEnabled}getUnitsTotal(){return this.m_nodesLen}addNodeToBlock(t){let e=null;if(t.shdUid>=h.s_max_shdTotal)throw Error("Shader uid >= "+h.s_max_shdTotal);this.m_blockFList[t.shdUid]<0?(e=this.createBlock(),e.batchEnabled=this.m_batchEnabled,e.fixedState=this.m_fixedState,e.batchEnabled?e.fixedState?e.runMode=2:e.runMode=1:e.runMode=0,e.shdUid=t.shdUid,e.index=this.m_blockListLen,e.procuid=this.m_rpIndex,this.m_blockList.push(e),this.m_blockFList[t.shdUid]=this.m_blockListLen,++this.m_blockListLen):e=this.m_blockList[this.m_blockFList[t.shdUid]],t.index=e.index,e.addNode(t)}rejoinRunitForTro(t){let e=this.m_rpoNodeBuilder.getNodeByUid(t.__$rpuid);null!=e&&(e.tro=t.tro,e.texMid=e.unit.texMid,this.m_blockList[e.index].rejoinNode(e))}rejoinRunitForVro(t){let e=this.m_rpoNodeBuilder.getNodeByUid(t.__$rpuid);null!=e&&(e.drawMode=t.drawMode,e.ivsIndex=t.ivsIndex,e.ivsCount=t.ivsCount,e.insCount=t.insCount,t.drawOffset=t.ivsIndex*t.ibufStep,e.vtxUid=t.vtxUid,e.vro=t.vro,this.m_blockList[e.index].rejoinNode(e))}addDisp(t){if(null!=t&&null!=t.__$$runit&&t.__$$runit.getRPROUid()<0&&t.__$$runit.getRPROUid()!=this.uid){let e=this.m_rpoNodeBuilder.create();e.unit=this.m_rpoUnitBuilder.getNodeByUid(t.__$ruid),e.unit.shader=this.m_shader,e.unit.__$rprouid=this.uid,t.__$rpuid=e.uid,e.__$ruid=t.__$ruid,e.unit.__$rpuid=e.uid,e.updateData(),++this.m_nodesLen,this.m_rpoUnitBuilder.setRPNodeParam(t.__$ruid,this.getUid(),e.uid),this.m_sortEnabled?(null!=this.m_sortBlock||(this.m_sortBlock=new r.default(this.m_shader),this.m_sortBlock.setSorter(this.m_sorter)),this.m_sortBlock.addNode(e)):this.addNodeToBlock(e)}}updateDispMateiral(t){if(null!=t.__$$runit){let e=t.__$$runit.getRPOUid(),i=this.m_rpoNodeBuilder.getNodeByUid(e);i.shdUid=i.unit.shdUid,i.texMid=i.unit.texMid,i.tro=i.unit.tro;let s=this.m_blockList[i.index];s.removeNode(i),this.addNodeToBlock(i)}}removeDisp(t){if(null!=t&&null!=t.__$$runit){let e=t.__$$runit.getRPOUid(),i=this.m_rpoNodeBuilder.getNodeByUid(e);if(null!=i){if(null==this.m_sortBlock){let t=this.m_blockList[i.index];t.removeNode(i)}else this.m_sortBlock.removeNode(i);this.m_rpoUnitBuilder.setRPNodeParam(t.__$ruid,this.getUid(),-1),--this.m_nodesLen;let e=i.unit;this.m_rpoNodeBuilder.restore(i)&&this.m_rpoUnitBuilder.restore(e),this.m_vtxResource.__$detachRes(t.vbuf.getUid()),t.__$$runit=null,t.__$ruid=-1}}}removeDispUnit(t){if(null!=t&&t.__$ruid>-1){let e=t.__$$runit.getRPOUid(),i=this.m_rpoNodeBuilder.getNodeByUid(e);if(null!=i){if(null==this.m_sortBlock){let t=this.m_blockList[i.index];t.removeNode(i)}else this.m_sortBlock.removeNode(i);this.m_rpoUnitBuilder.setRPNodeParam(t.__$ruid,this.m_rpIndex,-1),i.unit.__$rprouid=-1,--this.m_nodesLen,this.m_rpoNodeBuilder.restore(i)}}}update(){this.m_enabled&&this.m_nodesLen>0&&null!=this.m_sortBlock&&this.m_sortBlock.update()}run(){if(this.m_enabled&&this.m_nodesLen>0){let t=this.m_rc;if(null==this.m_sortBlock)if(this.m_shader.isUnLocked())for(let e=0;e<this.m_blockListLen;++e)this.m_blockList[e].run(t);else for(let e=0;e<this.m_blockListLen;++e)this.m_blockList[e].runLockMaterial(t);else this.m_shader.isUnLocked()?this.m_sortBlock.run(t):this.m_sortBlock.runLockMaterial(t)}}drawDisp(t,e=!1,i=!0){if(null!=t){let s=t.__$$runit;null!=s&&(this.m_shader.isUnLocked()?(i&&this.m_shader.resetUniform(),this.m_fixBlock.drawUnit(this.m_rc,s,t)):this.m_fixBlock.drawLockMaterialByUnit(this.m_rc,s,t,e,i))}}drawLockMaterialByDisp(t,e=!1,i=!0){if(null!=t){let s=t.__$$runit;null!=s&&this.m_fixBlock.drawLockMaterialByUnit(this.m_rc,s,t,e,i)}}reset(){this.m_sortEnabled=!1,this.m_nodesLen=0,this.uid=-1,this.m_rpIndex=-1,this.m_rcuid=-1,this.m_rpIndex=-1;let t=0;for(;t<this.m_blockListLen;++t)this.m_blockList[t].reset();this.m_blockListLen=0,this.m_blockList=[],this.m_rpoNodeBuilder=null,this.m_rpoUnitBuilder=null,this.m_vtxResource=null,this.m_rc=null,null!=this.m_sortBlock&&(this.m_sortBlock.clear(),this.m_sortBlock=null)}showInfo(){let t=0;for(;t<this.m_blockListLen;++t)this.m_blockList[t].showInfo()}destroy(){this.reset()}setEnabled(t){this.m_enabled=t}getEnabled(){return this.m_enabled}toString(){return"[RenderProcess(uid = "+this.m_rpIndex+")]"}}h.s_max_shdTotal=1024,e.default=h},"7c63":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("e08e");class r{constructor(t,e,i,s){this.m_uid=-1,this.m_rBoo=!0,this.m_gBoo=!0,this.m_bBoo=!0,this.m_aBoo=!0,this.m_uid=r.s_uid++,this.m_rBoo=t,this.m_gBoo=e,this.m_bBoo=i,this.m_aBoo=s}getUid(){return this.m_uid}getR(){return this.m_rBoo}getG(){return this.m_gBoo}getB(){return this.m_bBoo}getA(){return this.m_aBoo}use(){r.s_state!=this.m_uid&&(r.Rstate.setColorMask(this.m_rBoo,this.m_gBoo,this.m_bBoo,this.m_aBoo),r.s_state=this.m_uid)}static Create(t,e,i,s,a){if(r.s_stsNameMap.has(t)){let e=r.s_stsNameMap.get(t);return e.getUid()}let h=(e?64:32)|(i?16:8)|(s?4:2)|(a?1:0);if(r.s_stsMap.has(h)){let t=r.s_stsMap.get(h);h=t.getUid()}else{let _=new r(e,i,s,a);h=_.getUid(),r.s_stsMap.set(h,_),r.s_stsNameMap.set(t,_),r.s_states.push(_),++r.s_statesLen}return h}static GetColorMaskByName(t){if(r.s_stsNameMap.has(t)){let e=r.s_stsNameMap.get(t);return e.getUid()}return-1}static UseRenderState(t){r.s_unlocked&&r.Rstate.roColorMask!=t&&t>-1&&t<r.s_statesLen&&r.s_states[t].use()}static UseColorMaskByName(t){let e=r.GetColorMaskByName(t);r.s_unlocked&&r.Rstate.roColorMask!=e&&e>-1&&e<r.s_statesLen&&r.s_states[e].use()}static Lock(){r.s_unlocked=!1}static Unlock(){r.s_unlocked=!0}static Reset(){r.s_state=-1}}r.s_uid=0,r.s_state=-1,r.s_states=[],r.s_statesLen=1,r.s_stsMap=new Map,r.s_stsNameMap=new Map,r.s_unlocked=!0,r.ALL_TRUE_COLOR_MASK=0,r.ALL_FALSE_COLOR_MASK=1,r.Rstate=null,e.RenderColorMask=r;class a{constructor(t,e,i){this.m_uid=-1,this.m_cullFaceMode=0,this.m_blendMode=0,this.m_depthTestMode=0,this.m_shadowMode=0,this.m_uid=a.s_uid++,this.m_cullFaceMode=t,this.m_blendMode=e,this.m_depthTestMode=i}getUid(){return this.m_uid}getCullFaceMode(){return this.m_cullFaceMode}getDepthTestMode(){return this.m_depthTestMode}getBlendMode(){return this.m_blendMode}use(){if(a.s_state!=this.m_uid){a.Rstate.setCullFaceMode(this.m_cullFaceMode);a.s_blendModes[a.m_blendMode];a.m_blendMode<0?a.Rstate.setBlendMode(this.m_blendMode,a.s_blendModes[this.m_blendMode]):a.Rstate.setBlendMode(a.m_blendMode,a.s_blendModes[a.m_blendMode]),a.s_depthTestMode<0?a.Rstate.setDepthTestMode(this.m_depthTestMode):a.Rstate.setDepthTestMode(a.s_depthTestMode),a.s_state=this.m_uid}}static CreateBlendModeSeparate(t,e,i,r,h,_=0,l=0){if(null!=t&&""!=t){let n;if(a.s_blendModeNameMap.has(t))return n=a.s_blendModeNameMap.get(t),a.s_blendModeIndexMap.get(n);_<1&&(_=s.GLBlendEquation.FUNC_ADD),l<1&&(l=s.GLBlendEquation.FUNC_ADD);let o=1;if(n=31,n=131*n+e,n=131*n+i,r>0&&h>0&&(n=131*n+r,n=131*n+h,o=1),a.s_blendModeIndexMap.has(n))return a.s_blendModeNameMap.set(t,n),a.s_blendModeIndexMap.get(n);let m=++a.s_blendModeIndex;a.s_blendModeNameMap.set(t,n),a.s_blendModeIndexMap.set(n,m);let d=[o,_,l,e,i,r,h];return a.s_blendModes[m]=d,m}return 0}static CreateBlendMode(t,e,i,r=0){if(null!=t&&""!=t){let h;if(a.s_blendModeNameMap.has(t))return h=a.s_blendModeNameMap.get(t),a.s_blendModeIndexMap.get(h);r<1&&(r=s.GLBlendEquation.FUNC_ADD);let _=0;if(h=31,h=131*h+e,h=131*h+i,a.s_blendModeIndexMap.has(h))return a.s_blendModeIndexMap.get(h);let l=++a.s_blendModeIndex;a.s_blendModeNameMap.set(t,h),a.s_blendModeIndexMap.set(h,l);let n=[_,r,0,e,i,0,0];return a.s_blendModes[l]=n,l}return 0}static Create(t,e,i,s){if(a.s_stsNameMap.has(t)){let e=a.s_stsNameMap.get(t);return e.getUid()}let r=31;if(r=131*r+s,r=131*r+i,r=131*r+e,a.s_stsMap.has(r)){let t=a.s_stsMap.get(r);r=t.getUid()}else{let h=new a(e,i,s);r=h.getUid(),a.s_stsMap.set(r,h),a.s_stsNameMap.set(t,h),a.s_states.push(h),++a.s_statesLen}return r}static GetRenderStateByName(t){if(a.s_stsNameMap.has(t)){let e=a.s_stsNameMap.get(t);return e.getUid()}return-1}static UseRenderState(t){a.s_unlocked&&a.s_state!=t&&t>-1&&t<a.s_statesLen&&a.s_states[t].use()}static UseRenderStateByName(t){if(a.s_unlocked){let e=a.GetRenderStateByName(t);a.s_state!=e&&e>-1&&e<a.s_statesLen&&a.s_states[e].use()}}static UnlockBlendMode(){a.m_blendMode=a.s_preBlendMode}static LockBlendMode(t){a.s_preBlendMode=a.m_blendMode,a.m_blendMode=t}static UnlockDepthTestMode(){a.s_depthTestMode=a.s_preDepthTestMode}static LockDepthTestMode(t){a.s_preDepthTestMode=a.s_depthTestMode,a.s_depthTestMode=t}static Lock(){a.s_unlocked=!1}static Unlock(){a.s_unlocked=!0}static Reset(){a.s_state=-1}}a.s_uid=0,a.s_state=-1,a.s_states=[],a.s_statesLen=1,a.m_blendMode=-1,a.s_depthTestMode=-1,a.s_stsMap=new Map,a.s_stsNameMap=new Map,a.s_blendModeNameMap=new Map,a.s_blendModeIndexMap=new Map,a.s_blendModeIndex=0,a.s_blendModes=new Array(256),a.s_unlocked=!0,a.Rstate=null,a.s_preBlendMode=-1,a.s_preDepthTestMode=-1,e.RenderStateObject=a;class h{constructor(){this.stencilMask=-1}}class _{constructor(){this.m_units=new Array(128),this.m_unit=null,this.m_blendMode=s.RenderBlendMode.NORMAL,this.m_cullMode=s.CullFaceMode.NONE,this.m_depthTestType=s.DepthTestMode.DISABLE,this.m_cullDisabled=!0,this.m_context=null,this.m_gl=null,this.roColorMask=-11}reset(){this.roColorMask=-11}setRenderContext(t){this.m_context=t,this.m_gl=t.getRC();let e=this.m_gl.rcuid;this.m_unit=this.m_units[e],null==this.m_unit&&(this.m_unit=this.m_units[e]=new h)}setColorMask(t,e,i,s){this.m_gl.colorMask(t,e,i,s)}setStencilFunc(t,e,i){this.m_gl.stencilFunc(t,e,i)}setStencilMask(t){this.m_unit.stencilMask!=t&&t>=0&&(this.m_unit.stencilMask=t,this.m_gl.stencilMask(t))}setStencilOp(t,e,i){this.m_gl.stencilOp(t,e,i)}setDepthTestEnable(t){t?this.m_gl.enable(this.m_gl.DEPTH_TEST):this.m_gl.disable(this.m_gl.DEPTH_TEST)}setCullFaceEnable(t){t?this.m_gl.enable(this.m_gl.CULL_FACE):this.m_gl.disable(this.m_gl.CULL_FACE)}setBlendEnable(t){t?this.m_gl.enable(this.m_gl.BLEND):this.m_gl.disable(this.m_gl.BLEND)}setCullFaceMode(t){this.m_cullMode!=t&&(this.m_cullMode=t,t!=s.CullFaceMode.NONE?(this.m_cullDisabled&&(this.m_cullDisabled=!1,this.m_gl.enable(this.m_gl.CULL_FACE)),this.m_gl.cullFace(t)):this.m_cullDisabled||(this.m_cullDisabled=!0,this.m_gl.disable(this.m_gl.CULL_FACE)))}setBlendMode(t,e){this.m_blendMode!=t&&(this.m_blendMode=t,t>0?e[0]<1?(this.m_gl.blendEquation(this.m_gl.FUNC_ADD),this.m_gl.blendFunc(this.m_gl.ONE,this.m_gl.ZERO),this.m_gl.blendEquation(e[1]),this.m_gl.blendFunc(e[3],e[4])):(this.m_gl.blendEquationSeparate(e[1],e[2]),this.m_gl.blendFuncSeparate(e[3],e[4],e[5],e[6])):this.m_gl.disable(this.m_gl.BLEND))}setDepthTestMode(t){if(this.m_depthTestType!=t)switch(this.m_depthTestType=t,t){case s.DepthTestMode.ALWAYS:this.m_gl.depthMask(!1),this.m_gl.depthFunc(this.m_gl.ALWAYS);break;case s.DepthTestMode.SKY:this.m_gl.depthMask(!0),this.m_gl.depthFunc(this.m_gl.LEQUAL);break;case s.DepthTestMode.OPAQUE:this.m_gl.depthMask(!0),this.m_gl.depthFunc(this.m_gl.LESS);break;case s.DepthTestMode.OPAQUE_OVERHEAD:this.m_gl.depthMask(!1),this.m_gl.depthFunc(this.m_gl.EQUAL);break;case s.DepthTestMode.DECALS:this.m_gl.depthMask(!1),this.m_gl.depthFunc(this.m_gl.LEQUAL);break;case s.DepthTestMode.BLEND:this.m_gl.depthMask(!1),this.m_gl.depthFunc(this.m_gl.LESS);break;case s.DepthTestMode.WIRE_FRAME:this.m_gl.depthMask(!0),this.m_gl.depthFunc(this.m_gl.LEQUAL);break;case s.DepthTestMode.NEXT_LAYER:this.m_gl.depthMask(!1),this.m_gl.depthFunc(this.m_gl.ALWAYS);break;case s.DepthTestMode.TRUE_EQUAL:this.m_gl.depthMask(!0),this.m_gl.depthFunc(this.m_gl.EQUAL);break;case s.DepthTestMode.TRUE_GREATER:this.m_gl.depthMask(!0),this.m_gl.depthFunc(this.m_gl.GREATER);break;case s.DepthTestMode.TRUE_GEQUAL:this.m_gl.depthMask(!0),this.m_gl.depthFunc(this.m_gl.GEQUAL);break;case s.DepthTestMode.WIRE_FRAME_NEXT:break;default:break}}}e.RODrawState=_},"81c4":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8e17")),a=s(i("f48d")),h=s(i("d1a0"));class _ extends a.default{constructor(){super(...arguments),this.radiusSquared=2500,this.tv=new r.default(1,0,0),this.center=new r.default(50,0,0),this.anotherPosition=new r.default(100,0,0),this.length=100}intersectionCopSLV2(t,e,i){r.default.Cross(this.tv,e,a.default.__tV1),r.default.Cross(this.tv,a.default.__tV1,a.default.__tV2),a.default.__tV2.normalize(),h.default.IntersectionSLV2(a.default.__tV2,a.default.__tV2.dot(this.position),t,e,i),a.default.__tV2.x=i.x-this.position.x,a.default.__tV2.y=i.y-this.position.y,a.default.__tV2.z=i.z-this.position.z;let s=a.default.__tV2.dot(this.tv);s<0?i.copyFrom(this.position):s>this.length&&i.copyFrom(this.anotherPosition)}update(){this.tv.x=this.anotherPosition.x-this.position.x,this.tv.y=this.anotherPosition.y-this.position.y,this.tv.z=this.anotherPosition.z-this.position.z,this.length=this.tv.getLength(),this.tv.x*=.5,this.tv.y*=.5,this.tv.z*=.5,this.center.x=this.position.x+this.tv.x,this.center.y=this.position.y+this.tv.y,this.center.z=this.position.z+this.tv.z,this.radiusSquared=this.tv.getLengthSquared(),this.tv.normalize()}updateFast(){this.update()}}e.default=_},8333:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{}s.COLOR_BUFFER_BIT=131,s.DEPTH_BUFFER_BIT=132,s.STENCIL_BUFFER_BIT=133,e.default=s},"83d1":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("ab73")),a=s(i("7279"));class h{create(t,e){let i=null;return e.hasUniformByName(r.default.StageParam.name)&&(i=new a.default,i.uns=r.default.StageParam.name,i.uniformNameList=[r.default.StageParam.name],i.copyDataFromProbe(t.getStage3D().uProbe)),i}getIDNS(){return"StageParamUniformBuilder"}}e.default=h},8875:function(t,e,i){var s,r,a;(function(i,h){r=[],s=h,a="function"===typeof s?s.apply(e,r):s,void 0===a||(t.exports=a)})("undefined"!==typeof self&&self,(function(){function t(){var e=Object.getOwnPropertyDescriptor(document,"currentScript");if(!e&&"currentScript"in document&&document.currentScript)return document.currentScript;if(e&&e.get!==t&&document.currentScript)return document.currentScript;try{throw new Error}catch(u){var i,s,r,a=/.*at [^(]*\((.*):(.+):(.+)\)$/gi,h=/@([^@]*):(\d+):(\d+)\s*$/gi,_=a.exec(u.stack)||h.exec(u.stack),l=_&&_[1]||!1,n=_&&_[2]||!1,o=document.location.href.replace(document.location.hash,""),m=document.getElementsByTagName("script");l===o&&(i=document.documentElement.outerHTML,s=new RegExp("(?:[^\\n]+?\\n){0,"+(n-2)+"}[^<]*<script>([\\d\\D]*?)<\\/script>[\\d\\D]*","i"),r=i.replace(s,"$1").trim());for(var d=0;d<m.length;d++){if("interactive"===m[d].readyState)return m[d];if(m[d].src===l)return m[d];if(l===o&&m[d].innerHTML&&m[d].innerHTML.trim()===r)return m[d]}return null}}return t}))},"8a0a":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("ca6c"));class a{static ToGL(t,e){switch(e){case a.VTX_STATIC_DRAW:return t.STATIC_DRAW;case a.VTX_DYNAMIC_DRAW:return t.DYNAMIC_DRAW;case a.VTX_STREAM_DRAW:return t.STREAM_DRAW;case a.VTX_STATIC_READ:return t.STATIC_READ;case a.VTX_DYNAMIC_READ:return t.DYNAMIC_READ;case a.VTX_STREAM_READ:return t.STREAM_READ;case a.VTX_STATIC_COPY:return t.STATIC_COPY;case a.VTX_DYNAMIC_COPY:return t.DYNAMIC_COPY;case a.VTX_STREAM_COPY:return t.STREAM_COPY;default:break}return t.STATIC_DRAW}static GetVBufTypeByNS(t){switch(t){case a.VBUF_VS_NS:return a.VBUF_VS;case a.VBUF_UVS_NS:return a.VBUF_UVS;case a.VBUF_NVS_NS:return a.VBUF_NVS;case a.VBUF_CVS_NS:return a.VBUF_CVS;case a.VBUF_VS2_NS:return a.VBUF_VS2;case a.VBUF_UVS2_NS:return a.VBUF_UVS2;case a.VBUF_NVS2_NS:return a.VBUF_NVS2;case a.VBUF_CVS2_NS:return a.VBUF_CVS2;case a.VBUF_TVS_NS:return a.VBUF_TVS;case a.VBUF_TVS2_NS:return a.VBUF_TVS2;default:}return-1}static GetVBufNSByType(t){switch(t){case a.VBUF_VS:return a.VBUF_VS_NS;case a.VBUF_UVS:return a.VBUF_UVS_NS;case a.VBUF_NVS:return a.VBUF_NVS_NS;case a.VBUF_CVS:return a.VBUF_CVS_NS;case a.VBUF_VS2:return a.VBUF_VS2_NS;case a.VBUF_UVS2:return a.VBUF_UVS2_NS;case a.VBUF_NVS2:return a.VBUF_NVS2_NS;case a.VBUF_CVS2:return a.VBUF_CVS2_NS;case a.VBUF_TVS:return a.VBUF_TVS_NS;case a.VBUF_TVS2:return a.VBUF_TVS2_NS;default:}return""}static GetVBufAttributeTypeByNS(t){return a.GetVBufTypeByNS(t)-3e3}}a.VTXTYPE_GL_POINTS=101,a.VTXTYPE_GL_LINES=102,a.VTXTYPE_GL_LINE_STRIP=103,a.VTXTYPE_GL_TRIANGLES=111,a.VTX_STATIC_DRAW=0,a.VTX_DYNAMIC_DRAW=1,a.VTX_STREAM_DRAW=2,a.VTX_STATIC_READ=3,a.VTX_DYNAMIC_READ=4,a.VTX_STREAM_READ=5,a.VTX_STATIC_COPY=6,a.VTX_DYNAMIC_COPY=7,a.VTX_STREAM_COPY=8,a.VBUF_VS=3001,a.VBUF_UVS=3002,a.VBUF_NVS=3003,a.VBUF_CVS=3004,a.VBUF_TVS=3005,a.VBUF_VS2=3006,a.VBUF_UVS2=3007,a.VBUF_NVS2=3008,a.VBUF_CVS2=3009,a.VBUF_TVS2=3010,a.VBUF_VS_INDEX=r.default.BIT_ONE_0,a.VBUF_UVS_INDEX=r.default.BIT_ONE_1,a.VBUF_NVS_INDEX=r.default.BIT_ONE_2,a.VBUF_CVS_INDEX=r.default.BIT_ONE_3,a.VBUF_TVS_INDEX=r.default.BIT_ONE_4,a.VBUF_VS2_INDEX=r.default.BIT_ONE_5,a.VBUF_UVS2_INDEX=r.default.BIT_ONE_6,a.VBUF_NVS2_INDEX=r.default.BIT_ONE_7,a.VBUF_CVS2_INDEX=r.default.BIT_ONE_8,a.VBUF_TVS2_INDEX=r.default.BIT_ONE_9,a.VBUF_VS_NS="a_vs",a.VBUF_VS2_NS="a_vs2",a.VBUF_UVS_NS="a_uvs",a.VBUF_UVS2_NS="a_uvs2",a.VBUF_NVS_NS="a_nvs",a.VBUF_NVS2_NS="a_nvs2",a.VBUF_CVS_NS="a_cvs",a.VBUF_CVS2_NS="a_cvs2",a.VBUF_TVS_NS="a_tvs",a.VBUF_TVS2_NS="a_tvs2";class h{}h.FLAT=210,h.GOURAND=310,e.VtxNormalType=h,e.default=a},"8d98":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("3b73")),a=s(i("030e"));class h{static ToGL(t,e){switch(e){case h.RGBA:break;case h.R8:return t.R8;case h.RGB:return t.RGB;case h.RGB8:return t.RGB8;case h.RGBA8:return t.RGBA8;case h.ALPHA:return t.ALPHA;case h.RGB16F:return r.default.IsWebGL2()?t.RGB16F:t.RGB;case h.RGBA16F:return r.default.IsWebGL2()?t.RGBA16F:t.RGBA;case h.RGB32F:return r.default.IsWebGL2()&&t.RGB32F,t.RGB;case h.RGBA32F:return r.default.IsWebGL2()&&t.RGBA32F,t.RGBA;case h.RED:return t.RED;case h.DEPTH_COMPONENT:return t.DEPTH_COMPONENT;case h.DEPTH_STENCIL:return t.DEPTH_STENCIL;default:break}return t.RGBA}}h.R8=101,h.RGB=110,h.RED=111,h.RGBA=121,h.RGB8=122,h.RGBA8=123,h.ALPHA=132,h.RGB16F=331,h.RGBA16F=332,h.RGB32F=341,h.RGBA32F=342,h.DEPTH_COMPONENT=351,h.DEPTH_STENCIL=352,e.TextureFormat=h;class _{static ToGL(t,e){switch(e){case _.UNSIGNED_BYTE:return t.UNSIGNED_BYTE;case _.BYTE:return t.BYTE;case _.FLOAT:return t.FLOAT;case _.HALF_FLOAT:return t.HALF_FLOAT;case _.HALF_FLOAT_OES:return null!=a.default.OES_texture_half_float?a.default.OES_texture_half_float.HALF_FLOAT_OES:t.FLOAT;case _.UNSIGNED_SHORT:return t.UNSIGNED_SHORT;case _.UNSIGNED_INT:return t.UNSIGNED_INT;case _.UNSIGNED_SHORT_5_6_5:return t.UNSIGNED_SHORT_5_6_5;case _.UNSIGNED_SHORT_4_4_4_4:return t.UNSIGNED_SHORT_4_4_4_4;case _.UNSIGNED_SHORT_5_5_5_1:return t.UNSIGNED_SHORT_5_5_5_1;case _.UNSIGNED_INT_24_8_WEBGL:return a.default.WEBGL_depth_texture.UNSIGNED_INT_24_8_WEBGL;default:break}return t.UNSIGNED_BYTE}}_.UNSIGNED_BYTE=1108,_.UNSIGNED_SHORT=1109,_.UNSIGNED_INT=1110,_.BYTE=1111,_.FLOAT=1211,_.HALF_FLOAT=1212,_.HALF_FLOAT_OES=1213,_.UNSIGNED_SHORT_5_6_5=1214,_.UNSIGNED_SHORT_4_4_4_4=1215,_.UNSIGNED_SHORT_5_5_5_1=1216,_.UNSIGNED_INT_24_8_WEBGL=1217,e.TextureDataType=_;class l{static GetValue(t,e){switch(e){case l.TEXTURE_2D:return t.TEXTURE_2D;case l.TEXTURE_2D_ARRAY:return t.TEXTURE_2D_ARRAY;case l.TEXTURE_CUBE:return t.TEXTURE_CUBE_MAP;case l.TEXTURE_3D:return t.TEXTURE_3D;default:break}return t.TEXTURE_2D}}l.TEXTURE_2D=20,l.TEXTURE_2D_ARRAY=22,l.TEXTURE_SHADOW_2D=23,l.TEXTURE_CUBE=25,l.TEXTURE_3D=30,e.TextureTarget=l,function(t){t[t["Default"]=0]="Default",t[t["Depth"]=1]="Depth",t[t["Wrapper"]=2]="Wrapper",t[t["RTT"]=3]="RTT",t[t["Image"]=4]="Image",t[t["Float"]=5]="Float",t[t["Uint16"]=6]="Uint16",t[t["FloatCube"]=7]="FloatCube",t[t["Bytes"]=8]="Bytes",t[t["BytesCube"]=9]="BytesCube",t[t["ImageCube"]=10]="ImageCube",t[t["Texture3D"]=11]="Texture3D"}(e.TextureProxyType||(e.TextureProxyType={}));class n{static GetConst(t,e){switch(e){case n.NEAREST:return t.NEAREST;case n.LINEAR:return t.LINEAR;case n.LINEAR_MIPMAP_LINEAR:return t.LINEAR_MIPMAP_LINEAR;case n.NEAREST_MIPMAP_NEAREST:return t.NEAREST_MIPMAP_NEAREST;case n.LINEAR_MIPMAP_NEAREST:return t.LINEAR_MIPMAP_NEAREST;case n.NEAREST_MIPMAP_LINEAR:return t.NEAREST_MIPMAP_LINEAR;case n.WRAP_REPEAT:return t.REPEAT;case n.WRAP_CLAMP_TO_EDGE:return t.CLAMP_TO_EDGE;case n.WRAP_MIRRORED_REPEAT:return t.MIRRORED_REPEAT;default:break}return-1}}n.WRAP_REPEAT=3001,n.WRAP_CLAMP_TO_EDGE=3002,n.WRAP_MIRRORED_REPEAT=3003,n.NEAREST=4001,n.LINEAR=4002,n.LINEAR_MIPMAP_LINEAR=4003,n.NEAREST_MIPMAP_NEAREST=4004,n.LINEAR_MIPMAP_NEAREST=4005,n.NEAREST_MIPMAP_LINEAR=4006,e.TextureConst=n},"8def":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("919c"));class a extends r.default{constructor(){super(),this.shdp=null,this.vbufs=null,this.vbuf=null,this.attribTypes=null,this.wholeOffsetList=null,this.attribTypesLen=0,this.updateUnlocked=!0,this.wholeStride=0,this.m_uid=a.s_uid++}run(){this.m_rc.testVROUid(this.m_uid)&&(null!=this.vbuf?this.m_rc.useVtxAttribsPtrTypeFloat(this.shdp,this.vbuf,this.attribTypes,this.attribTypesLen,this.wholeOffsetList,this.wholeStride):this.m_rc.useVtxAttribsPtrTypeFloatMulti(this.shdp,this.vbufs,this.attribTypes,this.attribTypesLen,this.wholeOffsetList,this.wholeStride),this.m_rc.testRIOUid(this.m_vtxUid)&&this.m_rc.bindEleBuf(this.ibuf))}__$destroy(){r.default.s_midMap.delete(this.m_mid),this.m_mid=0,this.m_vtxUid=-1,this.m_rc=null,this.shdp=null,this.vbufs=null,this.vbuf=null,this.ibuf=null,this.attribTypes=null,this.attribTypesLen=0,this.wholeStride=0}restoreThis(){a.Restore(this)}toString(){return"VertexRenderObj(uid = "+this.m_uid+", type="+this.m_mid+")"}static HasMid(t){return r.default.s_midMap.has(t)}static GetByMid(t){return r.default.s_midMap.get(t)}static GetFreeId(){return a.s_freeIdList.length>0?a.s_freeIdList.pop():-1}static Create(t,e,i){let s=null,h=a.GetFreeId();return h>=0?(s=a.s_unitList[h],a.s_unitFlagList[h]=a.S_FLAG_BUSY,s.setMidAndBufUid(e,i)):(s=new a,s.setMidAndBufUid(e,i),a.s_unitList.push(s),a.s_unitFlagList.push(a.S_FLAG_BUSY),a.s_unitListLen++),s.setRC(t),r.default.s_midMap.set(e,s),s}static Restore(t){if(null!=t&&t.m_attachCount<1&&a.s_unitFlagList[t.getUid()]==a.S_FLAG_BUSY){let e=t.getUid();a.s_freeIdList.push(e),a.s_unitFlagList[e]=a.S_FLAG_FREE,t.__$destroy()}}}a.s_uid=0,a.S_FLAG_BUSY=1,a.S_FLAG_FREE=0,a.s_unitFlagList=[],a.s_unitListLen=0,a.s_unitList=[],a.s_freeIdList=[],e.default=a},"8e17":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("6e01"));class a{constructor(t=0,e=0,i=0,s=1){this.x=0,this.y=0,this.z=0,this.w=0,this.x=t,this.y=e,this.z=i,this.w=s}setTo(t,e,i,s=1){this.x=t,this.y=e,this.z=i,this.w=s}setXYZ(t,e,i){this.x=t,this.y=e,this.z=i}copyFrom(t){this.x=t.x,this.y=t.y,this.z=t.z}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}multBy(t){this.x*=t.x,this.y*=t.y,this.z*=t.z}normalize(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);t>r.default.MATH_MIN_POSITIVE&&(this.x/=t,this.y/=t,this.z/=t)}normalizeTo(t){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);e>r.default.MATH_MIN_POSITIVE?(t.x=this.x/e,t.y=this.y/e,t.z=this.z/e):(t.x=this.x,t.y=this.y,t.z=this.z)}scaleVector(t){this.x*=t.x,this.y*=t.y,this.z*=t.z}scaleBy(t){this.x*=t,this.y*=t,this.z*=t}negate(){this.x=-this.x,this.y=-this.y,this.z=-this.z}equalsXYZ(t){return Math.abs(this.x-t.x)<r.default.MATH_MIN_POSITIVE&&Math.abs(this.y-t.y)<r.default.MATH_MIN_POSITIVE&&Math.abs(this.z-t.z)<r.default.MATH_MIN_POSITIVE}equalsAll(t){return Math.abs(this.x-t.x)<r.default.MATH_MIN_POSITIVE&&Math.abs(this.y-t.y)<r.default.MATH_MIN_POSITIVE&&Math.abs(this.z-t.z)<r.default.MATH_MIN_POSITIVE&&Math.abs(this.w-t.w)<r.default.MATH_MIN_POSITIVE}project(){let t=1/this.w;this.x*=t,this.y*=t,this.z*=t}getLength(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}getLengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z}addBy(t){this.x+=t.x,this.y+=t.y,this.z+=t.z}subtractBy(t){this.x-=t.x,this.y-=t.y,this.z-=t.z}subtract(t){return new a(this.x-t.x,this.y-t.y,this.z-t.z)}add(t){return new a(this.x+t.x,this.y+t.y,this.z+t.z)}crossProduct(t){return new a(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}crossBy(t){let e=this.y*t.z-this.z*t.y,i=this.z*t.x-this.x*t.z,s=this.x*t.y-this.y*t.x;this.x=e,this.y=i,this.z=s}reflectBy(t){let e=2*(this.x*t.x+this.y*t.y+this.z*t.z);this.x=this.x-e*t.x,this.y=this.y-e*t.y,this.z=this.z-e*t.z}scaleVecTo(t,e){this.x=t.x*e,this.y=t.y*e,this.z=t.z*e}subVecsTo(t,e){this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z}addVecsTo(t,e){this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z}crossVecsTo(t,e){this.x=t.y*e.z-t.z*e.y,this.y=t.z*e.x-t.x*e.z,this.z=t.x*e.y-t.y*e.x}toString(){return"[Vector3D(x="+this.x+", y="+this.y+",z="+this.z+",w="+this.w+")]"}static Cross(t,e,i){i.x=t.y*e.z-t.z*e.y,i.y=t.z*e.x-t.x*e.z,i.z=t.x*e.y-t.y*e.x}static CrossSubtract(t,e,i,s,r){a.__vtor3Stv0.x=e.x-t.x,a.__vtor3Stv0.y=e.y-t.y,a.__vtor3Stv0.z=e.z-t.z,a.__vtor3Stv1.x=s.x-i.x,a.__vtor3Stv1.y=s.y-i.y,a.__vtor3Stv1.z=s.z-i.z,t=a.__vtor3Stv0,i=a.__vtor3Stv1,r.x=t.y*i.z-t.z*i.y,r.y=t.z*i.x-t.x*i.z,r.z=t.x*i.y-t.y*i.x}static Subtract(t,e,i){i.x=t.x-e.x,i.y=t.y-e.y,i.z=t.z-e.z}static DistanceSquared(t,e){return a.__vtor3Stv0.x=t.x-e.x,a.__vtor3Stv0.y=t.y-e.y,a.__vtor3Stv0.z=t.z-e.z,a.__vtor3Stv0.getLengthSquared()}static DistanceXYZ(t,e,i,s,r,h){return a.__vtor3Stv0.x=t-s,a.__vtor3Stv0.y=e-r,a.__vtor3Stv0.z=i-h,a.__vtor3Stv0.getLength()}static Distance(t,e){return a.__vtor3Stv0.x=t.x-e.x,a.__vtor3Stv0.y=t.y-e.y,a.__vtor3Stv0.z=t.z-e.z,a.__vtor3Stv0.getLength()}static AngleBetween(t,e){return t.normalizeTo(a.__vtor3Stv0),e.normalizeTo(a.__vtor3Stv1),Math.acos(a.__vtor3Stv0.dot(a.__vtor3Stv1))*r.default.MATH_180_OVER_PI}static RadianBetween(t,e){return t.normalizeTo(a.__vtor3Stv0),e.normalizeTo(a.__vtor3Stv1),Math.acos(a.__vtor3Stv0.dot(a.__vtor3Stv1))}static RadianBetween2(t,e){let i=t.getLengthSquared(),s=e.getLengthSquared();return a.__vtor3Stv0.x=t.x-e.x,a.__vtor3Stv0.y=t.y-e.y,a.__vtor3Stv0.z=t.z-e.z,Math.acos((i+s-a.__vtor3Stv0.getLengthSquared())/(2*Math.sqrt(i)*Math.sqrt(s)))}static Reflect(t,e,i){let s=2*(t.x*e.x+t.y*e.y+t.z*e.z);i.x=t.x-s*e.x,i.y=t.y-s*e.y,i.z=t.z-s*e.z}}a.X_AXIS=new a(1,0,0),a.Y_AXIS=new a(0,1,0),a.Z_AXIS=new a(0,0,1),a.__vtor3Stv0=new a,a.__vtor3Stv1=new a,a.ZERO=new a,e.default=a},9156:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{static SetTransUniform(t,e){s.s_transMap.set(t.getUid(),e)}static GetTransUniform(t){if(t.getUid()<0)throw Error("mat.getUid() < 0");return s.s_transMap.has(t.getUid())?s.s_transMap.get(t.getUid()):null}static HasTransUniform(t){return s.s_transMap.has(t.getUid())}static RemoveTransUniform(t){s.s_transMap.delete(t.getUid())}}s.s_transMap=new Map,e.default=s},"919c":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.m_uid=0,this.m_mid=0,this.m_vtxUid=0,this.m_rc=null,this.ibuf=null,this.ibufStep=2,this.m_attachCount=0}setRC(t){this.m_rc=t}setMidAndBufUid(t,e){this.m_mid=t,this.m_vtxUid=e,this.m_attachCount=0}getUid(){return this.m_uid}getVtxUid(){return this.m_vtxUid}getMid(){return this.m_mid}run(){}__$attachThis(){++this.m_attachCount}__$detachThis(){--this.m_attachCount,this.m_attachCount<1&&(this.m_attachCount=0)}__$destroy(){s.s_midMap.delete(this.m_mid),this.m_mid=0,this.m_vtxUid=-1,this.ibuf=null,this.m_rc=null}restoreThis(){}static HasMid(t){return s.s_midMap.has(t)}static GetByMid(t){return s.s_midMap.get(t)}}s.s_midMap=new Map,e.default=s},"984e":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.waitDelTimes=0,this.rcuid=0,this.resUid=0,this.width=0,this.height=0,this.depth=0,this.sampler=0,this.texBuf=null,this.m_attachCount=0}__$attachThis(){++this.m_attachCount}__$detachThis(){--this.m_attachCount,this.m_attachCount<1&&(this.m_attachCount=0)}bindToGpu(t){t.bindTexture(this.sampler,this.texBuf)}getAttachCount(){return this.m_attachCount}}class r{constructor(t,e){this.m_resMap=new Map,this.m_freeMap=new Map,this.m_texResTotal=0,this.m_attachTotal=0,this.m_delay=128,this.m_rcuid=0,this.m_gl=null,this.texMid=-1,this.unlocked=!0,this.m_rcuid=t,this.m_gl=e}createBuf(){return this.m_gl.createTexture()}createResByParams3(t,e,i,r){if(!this.m_resMap.has(t)){let a=new s;return a.rcuid=this.getRCUid(),a.resUid=t,a.width=e,a.height=i,a.sampler=r,a.texBuf=this.createBuf(),a.texBuf.resUid=t,this.addTextureRes(a),!0}return!1}getRCUid(){return this.m_rcuid}getRC(){return this.m_gl}hasResUid(t){return this.m_resMap.has(t)}renderBegin(){this.texMid=-1}getTextureResTotal(){return this.m_texResTotal}addTextureRes(t){this.m_resMap.has(t.resUid)||(t.waitDelTimes=0,this.m_resMap.set(t.resUid,t),this.m_texResTotal++)}getGpuBuffer(t){return this.m_resMap.has(t)?this.m_resMap.get(t).texBuf:null}bindToGpu(t){this.m_resMap.has(t)&&this.m_resMap.get(t).bindToGpu(this.m_gl)}getAttachTotal(){return this.m_attachTotal}__$attachRes(t){if(this.m_resMap.has(t)){this.m_attachTotal++;let e=this.m_resMap.get(t);e.getAttachCount()<1&&this.m_freeMap.has(t)&&this.m_freeMap.delete(t),e.waitDelTimes=0,e.__$attachThis()}}__$detachRes(t){if(this.m_resMap.has(t)&&this.m_resMap.has(t)){let e=this.m_resMap.get(t);e.getAttachCount()>0&&(this.m_attachTotal--,e.__$detachThis(),e.getAttachCount()<1&&this.m_freeMap.set(t,e))}}update(){if(this.m_delay--,this.m_delay<1){this.m_delay=128;for(const[t,e]of this.m_freeMap)e.waitDelTimes++,e.waitDelTimes>5&&(this.m_resMap.delete(e.resUid),this.m_freeMap.delete(e.resUid),this.m_gl.deleteTexture(e.texBuf),e.texBuf=null,this.m_texResTotal--)}}}e.default=r},a7ed:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("ab73")),a=s(i("7279"));class h{create(t,e){let i=null;return e.hasUniformByName(r.default.FrustumParam.name)&&(i=new a.default,i.uns=r.default.FrustumParam.name,i.uniformNameList=[r.default.FrustumParam.name],i.copyDataFromProbe(t.getCamera().ufrustumProbe)),i}getIDNS(){return"FrustumUniformBuilder"}}e.default=h},ab73:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.type="vec4",this.data=null,this.name="u_vsmParams",this.arrayLength=3}}class r{constructor(){this.type="vec4",this.data=new Float32Array([.1,.1,.1,1,1,.1,600,3500,.3,0,.9,5e-4]),this.name="u_envLightParams",this.arrayLength=3}}class a{constructor(){this.type="mat4",this.data=null,this.name="u_shadowMat",this.arrayLength=0}}class h{constructor(){this.type="vec4",this.data=null,this.name="u_stageParam",this.arrayLength=0}}class _{constructor(){this.type="vec4",this.data=null,this.name="u_viewParam",this.arrayLength=0}}class l{constructor(){this.type="vec4",this.data=null,this.name="u_frustumParam",this.arrayLength=0}}class n{constructor(){this.type="vec4",this.positionName="u_lightPositions",this.colorName="u_lightColors"}}class o{}o.LocalTransformMatUNS="u_objMat",o.CameraViewMatUNS="u_viewMat",o.CameraProjectiveMatUNS="u_projMat",o.FrustumParam=new l,o.StageParam=new h,o.ViewParam=new _,o.ShadowMatrix=new a,o.ShadowVSMParams=new s,o.GlobalLight=new n,o.EnvLightParams=new r,e.default=o},abdb:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{}s.AXIS_ANGLE=0,s.QUATERNION=1,s.EULER_ANGLES=2,e.default=s},b02c:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("6e01"));class a{constructor(t,e){this.m_uid=-1,this.m_mid=-1,this.m_texTotal=0,this.m_gtexList=null,this.m_samplers=null,this.m_texList=null,this.m_rcuid=0,this.m_texRes=null,this.direct=!0,this.m_attachCount=0,this.m_rcuid=t,this.m_uid=a.s_uid++,this.m_mid=e}__$setParam(t,e){this.m_rcuid=t,this.m_mid=e}getRCUid(){return this.m_rcuid}getMid(){return this.m_mid}getTexTotal(){return this.m_texTotal}collectTexList(t,e,i){this.m_texRes=t;let s=0;if(this.direct)if(this.m_texTotal<1&&e.length>0){let a,h=r.default.GetNearestCeilPow2(e.length);this.m_samplers=new Uint16Array(h),this.m_gtexList=new Array(h),this.m_texList=e;while(s<i)a=e[s],a.__$attachThis(),a.__$$upload(t),this.m_samplers[s]=a.getSampler(),this.m_gtexList[s]=this.m_texRes.getGpuBuffer(a.getResUid()),this.m_texRes.__$attachRes(a.getResUid()),s++;this.m_texTotal=s}else this.m_texTotal=0;else this.m_texTotal=i;while(s<e.length)e[s++].__$attachThis()}run(){if(this.m_texRes.unlocked&&this.m_texRes.texMid!=this.m_mid){this.m_texRes.texMid=this.m_mid;let t=this.m_texRes.getRC(),e=t.TEXTURE0;if(this.direct)for(let i=0;i<this.m_texTotal;++i)t.activeTexture(e++),t.bindTexture(this.m_samplers[i],this.m_gtexList[i]);else{let i=this.m_texList;for(let s=0;s<this.m_texTotal;++s)t.activeTexture(e++),i[s].__$$use(this.m_texRes)}}}getUid(){return this.m_uid}__$attachThis(){++this.m_attachCount}__$detachThis(){--this.m_attachCount,this.m_attachCount<1&&(this.m_attachCount=0,a.Restore(this))}reset(){if(null!=this.m_texList)for(let t=0,e=this.m_texList.length;t<e;++t)this.m_texList[t].__$detachThis(),this.m_texRes.__$detachRes(this.m_texList[t].getResUid()),this.m_gtexList[t]=null;this.m_texTotal=0,this.m_texList=null,this.m_texRes=null}toString(){return"TextureRenderObj(uid = "+this.m_uid+", mid="+this.m_mid+")"}static Create(t,e,i){let s=e.length;if(s>0&&i>0){if(s<i)throw Error("There are fewer textures than in the shader : (need "+i+",but only have "+s+") !!!");let r=31,h=0,_=!0;while(h<i)r=131*r+e[h].getUid(),e[h].isDirect()||(_=!1),++h;let l=a.s_troMaps[t.getRCUid()],n=null;return l.has(r)?n=l.get(r):(n=a.s_freeTROList.length<1?new a(t.getRCUid(),r):a.s_freeTROList.pop(),n.collectTexList(t,e,i),l.set(r,n)),n.__$setParam(t.getRCUid(),r),n.direct=_,n}return null}static Restore(t){t.getMid()>-1&&(a.s_troMaps[t.getRCUid()].delete(t.getMid()),t.__$setParam(0,0),a.s_freeTROList.push(t),t.reset())}static GetByMid(t,e){return a.s_troMaps[t].get(e)}}a.s_uid=0,a.s_troMaps=[new Map,new Map,new Map,new Map,new Map,new Map,new Map,new Map],a.s_freeTROList=[],a.s_unloacked=!0,a.s_preMid=-1,e.TextureRenderObj=a;class h{constructor(t){this.m_texRes=null,this.m_texRes=t}run(){this.m_texRes.renderBegin()}getMid(){return 1}__$attachThis(){}__$detachThis(){}}e.EmptyTexRenderObj=h,e.default=a},b0ef:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.m_canvas=null,this.m_div=null,this.m_divW=-1,this.m_divH=-1,this.resized=!0}setDiv(t){this.m_div=t}createViewEle(t,e){null==this.m_div&&(this.m_div=t.createElement("div"),this.m_div.style.width="400px",this.m_div.style.height="300px",document.body.appendChild(this.m_div)),this.m_div.style.display="bolck",this.m_div.style.position="absolute",""==this.m_div.style.left&&(this.m_div.style.left="0px",this.m_div.style.top="0px"),e&&(this.m_div.style.width="100%",this.m_div.style.height="100%"),null==this.m_canvas&&(this.m_canvas=document.createElement("canvas"),this.m_div.appendChild(this.m_canvas),this.m_canvas.width=800,this.m_canvas.height=600,this.m_canvas.style.display="bolck",this.m_canvas.style.left="0px",this.m_canvas.style.top="0px",this.m_canvas.style.position="absolute")}setDivStyleLeftAndTop(t,e){this.m_div.style.left=t+"px",this.m_div.style.top=e+"px"}setDivStyleSize(t,e){this.m_divW==t&&this.m_divH==e||(this.m_div.style.width=t+"px",this.m_div.style.height=e+"px",this.resized=!0)}getDiv(){return this.m_div}getCanvas(){return this.m_canvas}}e.default=s},b30a:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("3b73")),a=s(i("644c")),h=s(i("20ef"));class _{constructor(t,e,i){this.m_shdDict=new Map,this.m_shdList=[],this.m_shdListLen=0,this.m_sharedUniformList=[],this.m_unlocked=!0,this.m_texUnlocked=!1,this.m_preuid=-1,this.m_currShd=null,this.m_fragOutputTotal=1,this.m_rcuid=-1,this.m_rc=null,this.m_gpuProgram=null,this.m_adapter=null,this.m_guniform=null,this.m_uniform=null,this.m_transformUniform=null,this.drawFlag=-1,this.__$globalUniform=null,this.m_rcuid=t,this.m_adapter=i,this.m_rc=e}createResByParams3(t,e,i,s){return!1}getRC(){return this.m_rc}getGPUProgram(){return this.m_gpuProgram}getRCUid(){return this.m_rcuid}useTransUniform(t){this.m_transformUniform!=t&&(this.m_transformUniform=t,t.use(this))}useUniform(t){this.m_uniform!=t&&(this.m_uniform=t,t.use(this))}create(t){let e=t.getUniqueShaderName();if(this.m_shdDict.has(e))return this.m_shdDict.get(e);let i=new h.default(this.m_shdListLen);return i.setShdData(t),this.m_shdList[i.getUid()]=i,this.m_sharedUniformList[i.getUid()]=null,++this.m_shdListLen,this.m_shdDict.set(e,i),r.default.SHADERCODE_TRACE_ENABLED,i}findShdProgramByUid(t){return this.m_shdList[t]}findShdProgram(t){return this.m_shdDict.has(t)?this.m_shdDict.get(t):null}findShdProgramByShdData(t){return null!=t&&this.m_shdDict.has(t.getUniqueShaderName())?this.m_shdDict.get(t.getUniqueShaderName()):null}unlock(){this.m_unlocked=!0,this.__$globalUniform=null}isUnLocked(){return this.m_unlocked}lock(){this.m_unlocked=!1}textureUnlock(){this.m_texUnlocked=!0}isTextureUnLocked(){return this.m_texUnlocked}textureLock(){this.m_texUnlocked=!1}setSharedUniformByShd(t,e){this.m_sharedUniformList[t.getUid()]=e}getSharedUniformByShd(t){return this.m_sharedUniformList[t.getUid()]}getCurrFragOutputTotal(){return this.m_fragOutputTotal}hasResUid(t){return null!=this.m_shdList[t]}bindToGpu(t){if(this.m_unlocked&&t>-1&&t<this.m_shdListLen)if(this.m_preuid!=t){this.m_preuid=t;let e=this.m_shdList[t];this.m_fragOutputTotal=e.getFragOutputTotal(),this.m_fragOutputTotal,this.getActiveAttachmentTotal(),this.m_gpuProgram=e.getGPUProgram(),this.m_rc.useProgram(this.m_gpuProgram),e.useTexLocation();let i=this.m_sharedUniformList[e.getUid()];this.m_guniform=i;while(null!=i)i.use(this),i=i.next;this.m_currShd=e}else if(null==this.m_guniform&&null!=this.m_currShd){let t=this.m_sharedUniformList[this.m_currShd.getUid()];this.m_guniform=t;while(null!=t)t.use(this),t=t.next}}getGpuBuffer(t){return null}getCurrentShd(){return this.m_currShd}getCurrentShdUid(){return this.m_preuid}resetUniform(){this.m_uniform=null,this.m_transformUniform=null,this.m_guniform=null}renderBegin(){this.m_fragOutputTotal=1,this.m_preuid=-1,this.m_currShd=null,this.drawFlag=-1}update(){}destroy(){this.m_rc=null,this.m_adapter=null}useUniformToCurrentShd(t){this.m_uniform!=t&&(this.m_uniform,t.useByShd(this,this.m_currShd))}useUniform2ToCurrentShd(t,e){this.m_uniform!=t&&(this.m_uniform,t.useByShd(this,this.m_currShd)),this.m_transformUniform!=e&&(this.m_transformUniform,e.useByShd(this,this.m_currShd))}useUniformMat4(t,e){this.m_rc.uniformMatrix4fv(t,!1,e)}useUniformV2(t,e,i,s,r){switch(e){case a.default.SHADER_MAT4:r<1?this.m_rc.uniformMatrix4fv(t,!1,i):this.m_rc.uniformMatrix4fv(t,!1,i,r,16*s);break;case a.default.SHADER_MAT3:this.m_rc.uniformMatrix3fv(t,!1,i,0,9*s);break;case a.default.SHADER_VEC4FV:this.m_rc.uniform4fv(t,i,r,4*s);break;case a.default.SHADER_VEC3FV:this.m_rc.uniform3fv(t,i,r,3*s);break;case a.default.SHADER_VEC4:this.m_rc.uniform4f(t,i[0],i[1],i[2],i[3]);break;case a.default.SHADER_VEC3:this.m_rc.uniform3f(t,i[0],i[1],i[2]);break;case a.default.SHADER_VEC2:this.m_rc.uniform2f(t,i[0],i[1]);break;default:break}}useUniformV1(t,e,i,s){switch(e){case a.default.SHADER_MAT4:this.m_rc.uniformMatrix4fv(t,!1,i);break;case a.default.SHADER_MAT3:this.m_rc.uniformMatrix3fv(t,!1,i);break;case a.default.SHADER_VEC4FV:this.m_rc.uniform4fv(t,i,4*s);break;case a.default.SHADER_VEC3FV:this.m_rc.uniform3fv(t,i,3*s);break;case a.default.SHADER_VEC4:this.m_rc.uniform4f(t,i[0],i[1],i[2],i[3]);break;case a.default.SHADER_VEC3:this.m_rc.uniform3f(t,i[0],i[1],i[2]);break;case a.default.SHADER_VEC2:this.m_rc.uniform2f(t,i[0],i[1]);break;default:break}}getActiveAttachmentTotal(){return this.m_adapter.getActiveAttachmentTotal()}}e.default=_},b529:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=window;void 0==s["VoxCore"]&&(s["VoxCore"]={});var r=s["VoxCore"];const a=i("2051");r["BaseRenderer"]=a.BaseRenderer,s["VoxCore"]=r},baae:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{}s.FRAMEBUFFER=71,s.DRAW_FRAMEBUFFER=72,s.READ_FRAMEBUFFER=73,e.default=s},c497:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8e17"));class a{constructor(t=null){this.m_matrix4AllocateSize=8192,this.m_mainDiv=null,this.m_renderContextAttri={depth:!0,premultipliedAlpha:!1,alpha:!0,antialias:!1,stencil:!1,preserveDrawingBuffer:!0,powerPreference:"high-performance"},this.m_tickUpdateTime=20,this.m_polygonOffsetEnabled=!0,this.m_ditherEnabled=!1,this.autoSyncRenderBufferAndWindowSize=!0,this.maxWebGLVersion=2,this.cameraPerspectiveEnabled=!0,this.evtFlowEnabled=!1,this.camProjParam=new r.default(45,10,5e3),this.camPosition=new r.default(2e3,2e3,2e3),this.camLookAtPos=new r.default(0,0,0),this.camUpDirect=new r.default(0,1,0),this.batchEnabled=!0,this.processFixedState=!1,this.m_mainDiv=t}setTickUpdateTime(t){t=Math.round(t),this.m_tickUpdateTime=t>5?t:5}getTickUpdateTime(){return this.m_tickUpdateTime}setPolygonOffsetEanbled(t){this.m_polygonOffsetEnabled=t}getPolygonOffsetEanbled(){return this.m_polygonOffsetEnabled}setDitherEanbled(t){this.m_ditherEnabled=t}getDitherEanbled(){return this.m_ditherEnabled}getDiv(){return this.m_mainDiv}getRenderContextAttri(){return this.m_renderContextAttri}setAttriDepth(t){this.m_renderContextAttri.depth=t}setAttriStencil(t){this.m_renderContextAttri.stencil=t}setAttriAlpha(t){this.m_renderContextAttri.alpha=t}setAttriPremultipliedAlpha(t){this.m_renderContextAttri.premultipliedAlpha=t}setAttriAntialias(t){this.m_renderContextAttri.antialias=t}setAttripreserveDrawingBuffer(t){this.m_renderContextAttri.preserveDrawingBuffer=t}setAttriHightPowerPreference(t){this.m_renderContextAttri.powerPreference=t?"high-performance":"default"}setMatrix4AllocateSize(t){t<1024&&(t=1024),this.m_matrix4AllocateSize=t}getMatrix4AllocateSize(){return this.m_matrix4AllocateSize}setCamProject(t,e,i){if(e>=i)throw Error("Error Camera cear > far !!!");this.camProjParam.setTo(t,e,i)}setCamPosition(t,e,i){this.camPosition.setTo(t,e,i)}setCamLookAtPos(t,e,i){this.camLookAtPos.setTo(t,e,i)}setCamUpDirect(t,e,i){this.camUpDirect.setTo(t,e,i)}}e.default=a},c51d:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("6e01")),a=s(i("8e17")),h=s(i("18c7")),_=s(i("e214")),l=s(i("fecb")),n=s(i("3077"));class o{constructor(t){this.m_uslotIndex=0,this.version=0,this.matUProbe=null,this.ufrustumProbe=null,this.uniformEnabled=!1,this.name="Camera",this.m_tempV=new a.default,this.m_tempV1=new a.default,this.m_initRV=new a.default,this.m_initUP=new a.default,this.m_lookRHEnabled=!0,this.m_matrix=new h.default,this.m_viewMat=new h.default,this.m_viewInvertMat=new h.default,this.m_tempMat=new h.default,this.m_projMat=new h.default,this.m_camPos=new a.default,this.m_lookAtPos=new a.default,this.m_up=new a.default,this.m_lookDirectNV=new a.default,this.m_lookAtDirec=new a.default,this.m_nearPlaneWidth=1,this.m_nearPlaneHeight=1,this.m_viewX=0,this.m_viewY=0,this.m_viewW=800,this.m_viewH=600,this.m_viewHalfW=400,this.m_viewHalfH=300,this.m_fovy=0,this.m_aspect=1,this.m_zNear=.1,this.m_zFar=1e3,this.m_b=0,this.m_t=0,this.m_l=0,this.m_r=0,this.m_perspectiveEnabled=!1,this.m_project2Enabled=!1,this.m_rightHandEnabled=!0,this.m_rotV=new a.default(0,0,0),this.m_scaleV=new a.default(1,1,1),this.m_viewFieldZoom=1,this.m_changed=!0,this.m_unlock=!0,this.m_tempNV=new a.default,this.m_tempUPV=new a.default,this.m_tempRV=new a.default,this.m_tempCamPos=new a.default,this.m_tempLookAtPos=new a.default,this.m_rotDegree=0,this.m_rotAxis=new a.default,this.m_rotPivotPoint=null,this.m_axisRotEnabled=!1,this.m_frustumWAABB=new l.default,this.m_invViewMat=null,this.m_nearPlaneHalfW=.5,this.m_nearPlaneHalfH=.5,this.m_nearWCV=new a.default,this.m_farWCV=new a.default,this.m_wNV=new a.default,this.m_wFrustumVtxArr=[new a.default,new a.default,new a.default,new a.default,new a.default,new a.default,new a.default,new a.default,null,null,null],this.m_wFruPlaneList=[new _.default,new _.default,new _.default,new _.default,new _.default,new _.default],this.m_fpNVArr=[new a.default,new a.default,new a.default,new a.default,new a.default,new a.default],this.m_fpDisArr=[0,0,0,0,0,0],this.m_vpMat=new h.default,this.m_uslotIndex=t}lock(){this.m_unlock=!1}unlock(){this.m_unlock=!0}lookAtLH(t,e,i){this.m_unlock&&(this.m_camPos.copyFrom(t),this.m_lookAtPos.copyFrom(e),this.m_up.copyFrom(i),this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookRHEnabled=!1,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),this.m_initUP.copyFrom(i),this.m_initUP.normalize(),a.default.Cross(this.m_lookAtDirec,this.m_up,this.m_initRV),this.m_initRV.normalize(),this.m_changed=!0)}lookAtRH(t,e,i){this.m_unlock&&(this.m_camPos.copyFrom(t),this.m_lookAtPos.copyFrom(e),this.m_up.copyFrom(i),this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookRHEnabled=!0,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),this.m_initUP.copyFrom(i),this.m_initUP.normalize(),a.default.Cross(this.m_lookAtDirec,this.m_up,this.m_initRV),this.m_initRV.normalize(),this.m_changed=!0)}getLookAtLHToCamera(t){t.lookAtLH(this.m_camPos,this.m_lookAtPos,this.m_up)}getLookAtRHToCamera(t){t.lookAtRH(this.m_camPos,this.m_lookAtPos,this.m_up)}perspectiveLH(t,e,i,s){this.m_unlock&&(this.m_project2Enabled=!1,this.m_aspect=e,this.m_fovy=t,this.m_zNear=i,this.m_zFar=s,this.m_projMat.perspectiveLH(t,e,i,s),this.m_viewFieldZoom=Math.tan(.5*t),this.m_perspectiveEnabled=!0,this.m_rightHandEnabled=!1,this.m_changed=!0)}perspectiveRH(t,e,i,s){this.m_unlock&&(this.m_aspect=e,this.m_fovy=t,this.m_zNear=i,this.m_zFar=s,this.m_projMat.perspectiveRH(t,e,i,s),this.m_viewFieldZoom=Math.tan(.5*t),this.m_project2Enabled=!1,this.m_perspectiveEnabled=!0,this.m_rightHandEnabled=!0,this.m_changed=!0)}perspectiveRH2(t,e,i,s,r){this.m_unlock&&(this.m_aspect=e/i,this.m_fovy=t,this.m_zNear=s,this.m_zFar=r,this.m_projMat.perspectiveRH2(t,e,i,s,r),this.m_viewFieldZoom=Math.tan(.5*t),this.m_perspectiveEnabled=!0,this.m_project2Enabled=!0,this.m_rightHandEnabled=!0,this.m_changed=!0)}getAspect(){return this.m_aspect}getViewFieldZoom(){return this.m_viewFieldZoom}orthoRH(t,e,i,s,r,a){this.m_unlock&&(this.m_zNear=t,this.m_zFar=e,this.m_b=i,this.m_t=s,this.m_l=r,this.m_r=a,this.m_projMat.orthoRH(i,s,r,a,t,e),this.m_perspectiveEnabled=!1,this.m_rightHandEnabled=!0,this.m_changed=!0)}orthoLH(t,e,i,s,r,a){this.m_unlock&&(this.m_zNear=t,this.m_zFar=e,this.m_b=i,this.m_t=s,this.m_l=r,this.m_r=a,this.m_projMat.orthoLH(i,s,r,a,t,e),this.m_perspectiveEnabled=!1,this.m_rightHandEnabled=!1,this.m_changed=!0)}isPerspectiveEnabled(){return this.m_perspectiveEnabled}isRightHandEnabled(){return this.m_rightHandEnabled}setViewXY(t,e){this.m_unlock&&(this.m_viewX=t,this.m_viewY=e)}setViewSize(t,e){this.m_unlock&&(t==this.m_viewW&&e==this.m_viewH||(this.m_viewW=t,this.m_viewH=e,this.m_viewHalfW=.5*t,this.m_viewHalfH=.5*e,this.m_perspectiveEnabled?this.m_project2Enabled?this.m_rightHandEnabled&&this.perspectiveRH2(this.m_fovy,t,e,this.m_zNear,this.m_zFar):this.m_rightHandEnabled?this.perspectiveRH(this.m_fovy,t/e,this.m_zNear,this.m_zFar):this.perspectiveLH(this.m_fovy,t/e,this.m_zNear,this.m_zFar):this.orthoRH(this.m_zNear,this.m_zFar,-.5*e,.5*e,-.5*t,.5*t)))}getViewX(){return this.m_viewX}getViewY(){return this.m_viewY}getViewWidth(){return this.m_viewW}getViewHeight(){return this.m_viewH}translation(t){this.m_unlock&&(this.m_camPos.copyFrom(t),this.m_lookAtPos.x=t.x+this.m_lookAtDirec.x,this.m_lookAtPos.y=t.y+this.m_lookAtDirec.y,this.m_lookAtPos.z=t.z+this.m_lookAtDirec.z,this.m_changed=!0)}translationXYZ(t,e,i){this.m_tempV.setXYZ(t,e,i),this.m_unlock&&a.default.DistanceSquared(this.m_camPos,this.m_tempV)>.01&&(this.m_camPos.setTo(t,e,i),this.m_lookAtPos.x=t+this.m_lookAtDirec.x,this.m_lookAtPos.y=e+this.m_lookAtDirec.y,this.m_lookAtPos.z=i+this.m_lookAtDirec.z,this.m_changed=!0)}forward(t){this.m_unlock&&(this.m_camPos.x+=this.m_lookDirectNV.x*t,this.m_camPos.y+=this.m_lookDirectNV.y*t,this.m_camPos.z+=this.m_lookDirectNV.z*t,this.m_lookAtPos.x=this.m_camPos.x+this.m_lookAtDirec.x,this.m_lookAtPos.y=this.m_camPos.y+this.m_lookAtDirec.y,this.m_lookAtPos.z=this.m_camPos.z+this.m_lookAtDirec.z,this.m_changed=!0)}forwardFixPos(t,e){this.m_unlock&&(this.m_camPos.x=e.x+this.m_lookDirectNV.x*t,this.m_camPos.y=e.y+this.m_lookDirectNV.y*t,this.m_camPos.z=e.z+this.m_lookDirectNV.z*t,this.m_lookAtPos.x=this.m_camPos.x+this.m_lookAtDirec.x,this.m_lookAtPos.y=this.m_camPos.y+this.m_lookAtDirec.y,this.m_lookAtPos.z=this.m_camPos.z+this.m_lookAtDirec.z,this.m_changed=!0)}swingHorizontalWithAxis(t,e){this.m_unlock&&(this.m_tempMat.identity(),null!=e?this.m_tempMat.appendRotation(t*r.default.MATH_PI_OVER_180,e):this.m_tempMat.appendRotation(t*r.default.MATH_PI_OVER_180,a.default.Y_AXIS),this.m_lookAtDirec.x=this.m_camPos.x-this.m_lookAtPos.x,this.m_lookAtDirec.y=this.m_camPos.y-this.m_lookAtPos.y,this.m_lookAtDirec.z=this.m_camPos.z-this.m_lookAtPos.z,this.m_tempMat.transformVectorSelf(this.m_lookAtDirec),this.m_camPos.x=this.m_lookAtDirec.x+this.m_lookAtPos.x,this.m_camPos.y=this.m_lookAtDirec.y+this.m_lookAtPos.y,this.m_camPos.z=this.m_lookAtDirec.z+this.m_lookAtPos.z,this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookRHEnabled=!0,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),this.m_tempMat.transformVectorSelf(this.m_initRV),this.m_initRV.normalize(),a.default.Cross(this.m_initRV,this.m_lookAtDirec,this.m_up),this.m_up.normalize(),this.m_changed=!0)}swingHorizontal(t){this.m_unlock&&(this.m_tempMat.identity(),this.m_tempMat.appendRotation(t*r.default.MATH_PI_OVER_180,this.m_up),this.m_lookAtDirec.x=this.m_camPos.x-this.m_lookAtPos.x,this.m_lookAtDirec.y=this.m_camPos.y-this.m_lookAtPos.y,this.m_lookAtDirec.z=this.m_camPos.z-this.m_lookAtPos.z,this.m_tempMat.transformVectorSelf(this.m_lookAtDirec),this.m_camPos.x=this.m_lookAtDirec.x+this.m_lookAtPos.x,this.m_camPos.y=this.m_lookAtDirec.y+this.m_lookAtPos.y,this.m_camPos.z=this.m_lookAtDirec.z+this.m_lookAtPos.z,this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookRHEnabled=!0,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),a.default.Cross(this.m_lookAtDirec,this.m_up,this.m_initRV),this.m_initRV.normalize(),this.m_changed=!0)}swingVertical(t){this.m_unlock&&(this.m_tempMat.identity(),this.m_tempMat.appendRotation(t*r.default.MATH_PI_OVER_180,this.m_initRV),this.m_lookAtDirec.x=this.m_camPos.x-this.m_lookAtPos.x,this.m_lookAtDirec.y=this.m_camPos.y-this.m_lookAtPos.y,this.m_lookAtDirec.z=this.m_camPos.z-this.m_lookAtPos.z,this.m_tempMat.transformVectorSelf(this.m_lookAtDirec),this.m_camPos.x=this.m_lookAtDirec.x+this.m_lookAtPos.x,this.m_camPos.y=this.m_lookAtDirec.y+this.m_lookAtPos.y,this.m_camPos.z=this.m_lookAtDirec.z+this.m_lookAtPos.z,this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookRHEnabled=!0,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),a.default.Cross(this.m_initRV,this.m_lookAtDirec,this.m_up),this.m_up.normalize(),this.m_initUP.copyFrom(this.m_up),this.m_changed=!0)}setPosition(t){if(this.m_unlock){a.default.Cross(this.m_lookAtDirec,this.m_up,this.m_tempV);var e=this.m_tempV.dot(this.m_initUP);this.m_tempV1.copyFrom(this.m_initUP),this.m_tempV1.scaleBy(e),this.m_tempV.subtractBy(this.m_tempV1),this.m_camPos.copyFrom(t),this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),a.default.Cross(this.m_tempV,this.m_lookAtDirec,this.m_up),this.m_up.normalize(),this.m_changed=!0}}setPositionXYZ(t,e,i){if(this.m_unlock){a.default.Cross(this.m_lookAtDirec,this.m_up,this.m_tempV);var s=this.m_tempV.dot(this.m_initUP);this.m_tempV1.copyFrom(this.m_initUP),this.m_tempV1.scaleBy(s),this.m_tempV.subtractBy(this.m_tempV1),this.m_camPos.setTo(t,e,i),this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),a.default.Cross(this.m_tempV,this.m_lookAtDirec,this.m_up),this.m_up.normalize(),this.m_changed=!0}}setLookPosXYZFixUp(t,e,i){this.m_unlock&&(this.m_lookAtPos.setTo(t,e,i),this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookRHEnabled=!0,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),a.default.Cross(this.m_lookAtDirec,this.m_up,this.m_initRV),this.m_initRV.normalize(),this.m_changed=!0)}setPositionXYZFixUp(t,e,i){this.m_unlock&&(this.m_camPos.setTo(t,e,i),this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookRHEnabled=!0,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),a.default.Cross(this.m_lookAtDirec,this.m_up,this.m_initRV),this.m_initRV.normalize(),this.m_changed=!0)}setPositionFixUp(t){this.m_unlock&&(this.m_camPos.copyFrom(t),this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookRHEnabled=!0,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),a.default.Cross(this.m_lookAtDirec,this.m_up,this.m_initRV),this.m_initRV.normalize(),this.m_changed=!0)}copyFrom(t){let e=t.getPosition();this.m_camPos.copyFrom(e),e=t.getLookAtPosition(),this.m_lookAtPos.copyFrom(e),this.setZNear(t.getZNear()),this.setZFar(t.getZFar()),this.setNearPlaneWidth(t.getNearPlaneWidth()),this.setNearPlaneHeight(t.getNearPlaneHeight()),this.setPerspectiveEnabled(t.getPerspectiveEnabled()),this.m_viewInvertMat.copyFrom(t.getViewInvMatrix())}getNV(){return this.m_tempNV.copyFrom(this.m_lookDirectNV),this.m_tempNV}getUV(){return this.m_tempUPV.copyFrom(this.m_up),this.m_tempUPV}getRV(){return this.m_tempRV.copyFrom(this.m_initRV),this.m_tempRV}getPosition(){return this.m_tempCamPos.copyFrom(this.m_camPos),this.m_tempCamPos}getLookAtPosition(){return this.m_tempLookAtPos.copyFrom(this.m_lookAtPos),this.m_tempLookAtPos}setLookAtPosition(t,e,i){this.m_unlock&&(this.m_lookAtPos.setTo(t,e,i),this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),this.m_changed=!0)}getPerspectiveEnabled(){return this.m_perspectiveEnabled}setPerspectiveEnabled(t){this.m_perspectiveEnabled=t}appendRotationByAxis(t,e,i=null){this.m_unlock&&(this.m_rotDegree=t,this.m_changed=!0,this.m_rotAxis.copyFrom(e),this.m_rotPivotPoint=i,this.m_axisRotEnabled=!0)}setRotationX(t){this.m_rotV.x=t,this.m_changed=!0,this.m_axisRotEnabled=!1}getRotationX(){return this.m_rotV.x}setRotationY(t){this.m_rotV.y=t,this.m_changed=!0,this.m_axisRotEnabled=!1}getRotationY(){return this.m_rotV.y}setRotationZ(t){this.m_rotV.z=t,this.m_changed=!0,this.m_axisRotEnabled=!1}getRotationZ(){return this.m_rotV.z}setRotationXYZ(t,e,i){this.m_unlock&&(this.m_rotV.setXYZ(t,e,i),this.m_changed=!0,this.m_axisRotEnabled=!1)}setScaleX(t){this.m_scaleV.x=t,this.m_changed=!0,this.m_axisRotEnabled=!1}getScaleX(){return this.m_scaleV.x}setScaleY(t){this.m_scaleV.y=t,this.m_changed=!0,this.m_axisRotEnabled=!1}getScaleY(){return this.m_scaleV.y}setScaleZ(t){this.m_scaleV.z=t,this.m_changed=!0,this.m_axisRotEnabled=!1}getScaleZ(){return this.m_scaleV.z}setScaleXYZ(t,e,i){this.m_unlock&&(this.m_scaleV.setXYZ(t,e,i),this.m_changed=!0,this.m_axisRotEnabled=!1)}screenXYToViewXYZ(t,e,i){t-=this.m_viewX,e-=this.m_viewY,this.m_perspectiveEnabled&&(t=this.m_nearPlaneWidth*(t-this.m_viewHalfW)/this.m_viewHalfW,e=this.m_nearPlaneHeight*(this.m_viewHalfH-e)/this.m_viewHalfH),i.setTo(t,e,-this.m_zNear)}screenXYToWorldXYZ(t,e,i){t-=this.m_viewX,e-=this.m_viewY,this.m_perspectiveEnabled&&(t=.5*this.m_nearPlaneWidth*(t-this.m_viewHalfW)/this.m_viewHalfW,e=.5*this.m_nearPlaneHeight*(this.m_viewHalfH-e)/this.m_viewHalfH),i.setTo(t,e,-this.m_zNear),i.w=1,this.m_viewInvertMat.transformVectorSelf(i)}getWorldPickingRayByScreenXY(t,e,i,s){t-=this.m_viewX,e-=this.m_viewY,this.m_perspectiveEnabled?(t=.5*this.m_nearPlaneWidth*(t-this.m_viewHalfW)/this.m_viewHalfW,e=.5*this.m_nearPlaneHeight*(e-this.m_viewHalfH)/this.m_viewHalfH,i.setTo(t,e,-this.m_zNear),i.w=1,this.m_viewInvertMat.transformVectorSelf(i),s.copyFrom(i),s.subtractBy(this.m_camPos),s.normalize()):(t-=this.m_viewHalfW,e-=this.m_viewHalfH,i.setTo(t,e,-this.m_zNear),i.w=1,this.m_viewInvertMat.transformVectorSelf(i),s.copyFrom(this.m_lookDirectNV))}calcScreenNormalizeXYByWorldPos(t,e){e.copyFrom(t),this.m_vpMat.transformVectorSelf(e),e.x/=e.w,e.y/=e.w}worldPosToScreen(t){this.m_viewMat.transformVector3Self(t),this.m_projMat.transformVectorSelf(t),t.x/=t.w,t.y/=t.w,t.x*=this.m_viewHalfW,t.y*=this.m_viewHalfH,t.x+=this.m_viewX,t.y+=this.m_viewY}calcViewRectByWorldSphere(t,e,i){this.m_viewMat.transformVector3Self(t),e*=1.15,i.x=t.x-e,i.y=t.y-e,i.z=t.z,t.x+=e,t.y+=e,this.m_projMat.transformPerspV4Self(i),this.m_projMat.transformPerspV4Self(t),t.z=1/t.w,i.z=t.x*t.z,i.w=t.y*t.z,i.z*=this.m_viewHalfW,i.w*=this.m_viewHalfH,i.x*=t.z,i.y*=t.z,i.x*=this.m_viewHalfW,i.y*=this.m_viewHalfH,i.z=i.z-i.x,i.w=i.w-i.y,i.x+=this.m_viewX,i.y+=this.m_viewY}calcScreenRectByWorldSphere(t,e,i){this.m_viewMat.transformVector3Self(t),e*=1.15,i.x=t.x-e,i.y=t.y-e,t.x+=e,t.y+=e,this.m_projMat.transformPerspV4Self(i),this.m_projMat.transformPerspV4Self(t),t.z=1/t.w,i.z=t.x*t.z,i.w=t.y*t.z,i.x*=t.z,i.y*=t.z,i.z=i.z-i.x,i.w=i.w-i.y}getInvertViewMatrix(){return this.m_invViewMat}getZNear(){return this.m_zNear}setZNear(t){this.m_zNear=t}getZFar(){return this.m_zFar}setZFar(t){this.m_zFar=t}getNearPlaneWidth(){return this.m_nearPlaneWidth}setNearPlaneWidth(t){this.m_nearPlaneWidth=t}getNearPlaneHeight(){return this.m_nearPlaneHeight}setNearPlaneHeight(t){this.m_nearPlaneHeight=t}getFov(){return this.m_fovy}__calcTestParam(){null==this.m_invViewMat&&(this.m_invViewMat=new h.default),this.m_invViewMat.copyFrom(this.m_viewMat),this.m_invViewMat.invert();let t=null,e=this.m_viewHalfH,i=this.m_viewHalfW,s=this.m_viewHalfH,r=this.m_viewHalfW;if(this.m_perspectiveEnabled){let t=Math.tan(.5*this.m_fovy);e=this.m_zNear*t,i=e*this.m_aspect,s=this.m_zFar*t,r=s*this.m_aspect}this.m_nearPlaneHalfW=i,this.m_nearPlaneHalfH=e,this.m_nearWCV.setTo(0,0,-this.m_zNear),this.m_farWCV.setTo(0,0,-this.m_zFar),this.m_invViewMat.transformVectorSelf(this.m_nearWCV),this.m_invViewMat.transformVectorSelf(this.m_farWCV),this.m_wNV.x=this.m_farWCV.x-this.m_nearWCV.x,this.m_wNV.y=this.m_farWCV.y-this.m_nearWCV.y,this.m_wNV.z=this.m_farWCV.z-this.m_nearWCV.z,this.m_wNV.normalize(),t=this.m_wFruPlaneList[0],t.nv.copyFrom(this.m_wNV),t.distance=t.nv.dot(this.m_farWCV),t.position.copyFrom(this.m_farWCV),t=this.m_wFruPlaneList[1],t.nv.copyFrom(this.m_wFruPlaneList[0].nv),t.distance=t.nv.dot(this.m_nearWCV),t.position.copyFrom(this.m_nearWCV),this.m_wFrustumVtxArr[8]=this.m_nearWCV,this.m_wFrustumVtxArr[9]=this.m_farWCV,this.m_wFrustumVtxArr[11]=this.m_wNV,this.m_wFrustumVtxArr[0].setTo(-r,-s,-this.m_zFar),this.m_wFrustumVtxArr[1].setTo(r,-s,-this.m_zFar),this.m_wFrustumVtxArr[2].setTo(r,s,-this.m_zFar),this.m_wFrustumVtxArr[3].setTo(-r,s,-this.m_zFar),this.m_wFrustumVtxArr[4].setTo(-i,-e,-this.m_zNear),this.m_wFrustumVtxArr[5].setTo(i,-e,-this.m_zNear),this.m_wFrustumVtxArr[6].setTo(i,e,-this.m_zNear),this.m_wFrustumVtxArr[7].setTo(-i,e,-this.m_zNear),this.m_invViewMat.transformVectorSelf(this.m_wFrustumVtxArr[0]),this.m_invViewMat.transformVectorSelf(this.m_wFrustumVtxArr[1]),this.m_invViewMat.transformVectorSelf(this.m_wFrustumVtxArr[2]),this.m_invViewMat.transformVectorSelf(this.m_wFrustumVtxArr[3]),this.m_invViewMat.transformVectorSelf(this.m_wFrustumVtxArr[4]),this.m_invViewMat.transformVectorSelf(this.m_wFrustumVtxArr[5]),this.m_invViewMat.transformVectorSelf(this.m_wFrustumVtxArr[6]),this.m_invViewMat.transformVectorSelf(this.m_wFrustumVtxArr[7]),this.m_frustumWAABB.max.setTo(-9999999,-9999999,-9999999),this.m_frustumWAABB.min.setTo(9999999,9999999,9999999);for(let a=0;a<8;++a)this.m_frustumWAABB.addPosition(this.m_wFrustumVtxArr[a]);this.m_frustumWAABB.updateFast();let _=this.m_wFrustumVtxArr[0],l=this.m_wFrustumVtxArr[4];this.m_tempV.x=_.x-l.x,this.m_tempV.y=_.y-l.y,this.m_tempV.z=_.z-l.z,_=this.m_wFrustumVtxArr[1],l=this.m_wFrustumVtxArr[5],this.m_tempV1.x=_.x-l.x,this.m_tempV1.y=_.y-l.y,this.m_tempV1.z=_.z-l.z,t=this.m_wFruPlaneList[3],a.default.Cross(this.m_tempV1,this.m_tempV,t.nv),t.nv.normalize(),t.distance=t.nv.dot(_),t.position.copyFrom(_),_=this.m_wFrustumVtxArr[3],l=this.m_wFrustumVtxArr[7],this.m_tempV.x=_.x-l.x,this.m_tempV.y=_.y-l.y,this.m_tempV.z=_.z-l.z,_=this.m_wFrustumVtxArr[2],l=this.m_wFrustumVtxArr[6],this.m_tempV1.x=_.x-l.x,this.m_tempV1.y=_.y-l.y,this.m_tempV1.z=_.z-l.z,t=this.m_wFruPlaneList[2],a.default.Cross(this.m_tempV1,this.m_tempV,t.nv),t.nv.normalize(),t.distance=t.nv.dot(_),t.position.copyFrom(_),_=this.m_wFrustumVtxArr[0],l=this.m_wFrustumVtxArr[4],this.m_tempV.x=_.x-l.x,this.m_tempV.y=_.y-l.y,this.m_tempV.z=_.z-l.z,_=this.m_wFrustumVtxArr[3],l=this.m_wFrustumVtxArr[7],this.m_tempV1.x=_.x-l.x,this.m_tempV1.y=_.y-l.y,this.m_tempV1.z=_.z-l.z,t=this.m_wFruPlaneList[4],a.default.Cross(this.m_tempV,this.m_tempV1,t.nv),t.nv.normalize(),t.distance=t.nv.dot(_),t.position.copyFrom(_),_=this.m_wFrustumVtxArr[1],l=this.m_wFrustumVtxArr[5],this.m_tempV.x=_.x-l.x,this.m_tempV.y=_.y-l.y,this.m_tempV.z=_.z-l.z,_=this.m_wFrustumVtxArr[2],l=this.m_wFrustumVtxArr[6],this.m_tempV1.x=_.x-l.x,this.m_tempV1.y=_.y-l.y,this.m_tempV1.z=_.z-l.z,t=this.m_wFruPlaneList[5],a.default.Cross(this.m_tempV,this.m_tempV1,t.nv),t.nv.normalize(),t.distance=t.nv.dot(_),t.position.copyFrom(_),this.m_fpNVArr[0].copyFrom(this.m_wFruPlaneList[0].nv),this.m_fpNVArr[1].copyFrom(this.m_wFruPlaneList[1].nv),this.m_fpNVArr[1].scaleBy(-1),this.m_fpNVArr[2].copyFrom(this.m_wFruPlaneList[2].nv),this.m_fpNVArr[3].copyFrom(this.m_wFruPlaneList[3].nv),this.m_fpNVArr[3].scaleBy(-1),this.m_fpNVArr[4].copyFrom(this.m_wFruPlaneList[4].nv),this.m_fpNVArr[4].scaleBy(-1),this.m_fpNVArr[5].copyFrom(this.m_wFruPlaneList[5].nv),this.m_fpDisArr[0]=this.m_wFruPlaneList[0].distance,this.m_fpDisArr[1]=-this.m_wFruPlaneList[1].distance,this.m_fpDisArr[2]=this.m_wFruPlaneList[2].distance,this.m_fpDisArr[3]=-this.m_wFruPlaneList[3].distance,this.m_fpDisArr[4]=-this.m_wFruPlaneList[4].distance,this.m_fpDisArr[5]=this.m_wFruPlaneList[5].distance}getWordFrustumWAABB(){return this.m_frustumWAABB}getWordFrustumWAABBCenter(){return this.m_frustumWAABB.center}getWordFrustumVtxArr(){return this.m_wFrustumVtxArr}getWordFrustumPlaneArr(){return this.m_wFruPlaneList}visiTestSphere2(t,e){let i=this.m_fpNVArr[0].dot(t)-this.m_fpDisArr[0]-e>r.default.MATH_MIN_POSITIVE;return!i&&(i=this.m_fpNVArr[1].dot(t)-this.m_fpDisArr[1]-e>r.default.MATH_MIN_POSITIVE,!i&&(i=this.m_fpNVArr[2].dot(t)-this.m_fpDisArr[2]-e>r.default.MATH_MIN_POSITIVE,!i&&(i=this.m_fpNVArr[3].dot(t)-this.m_fpDisArr[3]-e>r.default.MATH_MIN_POSITIVE,!i&&(i=this.m_fpNVArr[4].dot(t)-this.m_fpDisArr[4]-e>r.default.MATH_MIN_POSITIVE,!i&&(i=this.m_fpNVArr[5].dot(t)-this.m_fpDisArr[5]-e>r.default.MATH_MIN_POSITIVE,!i)))))}visiTestSphere3(t,e,i){let s=this.m_fpNVArr[0].dot(t)-this.m_fpDisArr[0]+i-e>r.default.MATH_MIN_POSITIVE;return!s&&(s=this.m_fpNVArr[1].dot(t)-this.m_fpDisArr[1]-e>r.default.MATH_MIN_POSITIVE,!s&&(s=this.m_fpNVArr[2].dot(t)-this.m_fpDisArr[2]-e>r.default.MATH_MIN_POSITIVE,!s&&(s=this.m_fpNVArr[3].dot(t)-this.m_fpDisArr[3]-e>r.default.MATH_MIN_POSITIVE,!s&&(s=this.m_fpNVArr[4].dot(t)-this.m_fpDisArr[4]-e>r.default.MATH_MIN_POSITIVE,!s&&(s=this.m_fpNVArr[5].dot(t)-this.m_fpDisArr[5]-e>r.default.MATH_MIN_POSITIVE,!s)))))}visiTestPosition(t){let e=this.m_fpNVArr[0].dot(t)-this.m_fpDisArr[0]>r.default.MATH_MIN_POSITIVE;return!e&&(e=this.m_fpNVArr[1].dot(t)-this.m_fpDisArr[1]>r.default.MATH_MIN_POSITIVE,!e&&(e=this.m_fpNVArr[2].dot(t)-this.m_fpDisArr[2]>r.default.MATH_MIN_POSITIVE,!e&&(e=this.m_fpNVArr[3].dot(t)-this.m_fpDisArr[3]>r.default.MATH_MIN_POSITIVE,!e&&(e=this.m_fpNVArr[4].dot(t)-this.m_fpDisArr[4]>r.default.MATH_MIN_POSITIVE,!e&&(e=this.m_fpNVArr[5].dot(t)-this.m_fpDisArr[5]>r.default.MATH_MIN_POSITIVE,!e)))))}visiTestPlane(t,e){let i=t.dot(this.m_wFruPlaneList[0].position)-e,s=i*(t.dot(this.m_wFruPlaneList[1].position)-e);return s<r.default.MATH_MIN_POSITIVE||(s=i*(t.dot(this.m_wFruPlaneList[2].position)-e),s<r.default.MATH_MIN_POSITIVE||(s=i*(t.dot(this.m_wFruPlaneList[3].position)-e),s<r.default.MATH_MIN_POSITIVE||(s=i*(t.dot(this.m_wFruPlaneList[4].position)-e),s<r.default.MATH_MIN_POSITIVE||(s=i*(t.dot(this.m_wFruPlaneList[5].position)-e),s<r.default.MATH_MIN_POSITIVE))))}visiTestSphere(t,e){let i=this.m_frustumWAABB.sphereIntersect(t,e);if(i){let i=this.m_wFruPlaneList[0].intersectSphere(t,e),s=this.m_wFruPlaneList[1].intersectSphere(t,e);return!(i*s>=0&&!this.m_wFruPlaneList[0].intersectBoo&&!this.m_wFruPlaneList[1].intersectBoo)&&(i=this.m_wFruPlaneList[2].intersectSphere(t,e),s=this.m_wFruPlaneList[3].intersectSphere(t,e),!(i*s>=0&&!this.m_wFruPlaneList[2].intersectBoo&&!this.m_wFruPlaneList[3].intersectBoo)&&(i=this.m_wFruPlaneList[4].intersectSphere(t,e),s=this.m_wFruPlaneList[5].intersectSphere(t,e),!(i*s>=0&&!this.m_wFruPlaneList[4].intersectBoo&&!this.m_wFruPlaneList[5].intersectBoo)))}return!1}visiTestAABB(t){let e=t.center,i=t.radius,s=this.m_frustumWAABB.sphereIntersect(e,i);if(s){let t=this.m_wFruPlaneList[0].intersectSphere(e,i),s=this.m_wFruPlaneList[1].intersectSphere(e,i);return!(t*s>=0&&!this.m_wFruPlaneList[0].intersectBoo&&!this.m_wFruPlaneList[1].intersectBoo)&&(t=this.m_wFruPlaneList[2].intersectSphere(e,i),s=this.m_wFruPlaneList[3].intersectSphere(e,i),!(t*s>=0&&!this.m_wFruPlaneList[2].intersectBoo&&!this.m_wFruPlaneList[3].intersectBoo)&&(t=this.m_wFruPlaneList[4].intersectSphere(e,i),s=this.m_wFruPlaneList[5].intersectSphere(e,i),!(t*s>=0&&!this.m_wFruPlaneList[4].intersectBoo&&!this.m_wFruPlaneList[5].intersectBoo)))}return!1}update(){this.m_changed&&(this.version++,this.m_changed=!1,this.m_axisRotEnabled?this.m_matrix.appendRotationPivot(this.m_rotDegree*r.default.MATH_PI_OVER_180,this.m_rotAxis,this.m_rotPivotPoint):(this.m_matrix.identity(),this.m_matrix.appendScaleXYZ(this.m_scaleV.x,this.m_scaleV.y,this.m_scaleV.z),this.m_matrix.appendRotationEulerAngle(this.m_rotV.x*r.default.MATH_PI_OVER_180,this.m_rotV.y*r.default.MATH_PI_OVER_180,this.m_rotV.z*r.default.MATH_PI_OVER_180)),this.m_lookRHEnabled?this.m_viewMat.lookAtRH(this.m_camPos,this.m_lookAtPos,this.m_up):this.m_viewMat.lookAtLH(this.m_camPos,this.m_lookAtPos,this.m_up),this.m_project2Enabled?(this.m_nearPlaneWidth=this.m_zNear*Math.tan(.5*this.m_fovy)*2,this.m_nearPlaneHeight=this.m_nearPlaneWidth/this.m_aspect):(this.m_nearPlaneHeight=this.m_zNear*Math.tan(.5*this.m_fovy)*2,this.m_nearPlaneWidth=this.m_aspect*this.m_nearPlaneHeight),this.m_viewMat.append(this.m_matrix),this.m_viewInvertMat.copyFrom(this.m_viewMat),this.m_viewInvertMat.invert(),this.m_vpMat.identity(),this.m_vpMat.copyFrom(this.m_viewMat),this.m_vpMat.append(this.m_projMat),this.__calcTestParam(),this.updateUniformData())}updateCamMatToUProbe(t){t.isEnabled()&&(t.update(),t.getFS32At(0).set(this.m_viewMat.getLocalFS32(),0),t.getFS32At(1).set(this.m_projMat.getLocalFS32(),0))}updateUniformData(){this.uniformEnabled&&(null==this.matUProbe&&(this.matUProbe=new n.default,this.matUProbe.bindSlotAt(this.m_uslotIndex),this.matUProbe.addMat4Data(new Float32Array(16),1),this.matUProbe.addMat4Data(new Float32Array(16),1)),this.updateCamMatToUProbe(this.matUProbe),null==this.ufrustumProbe?(this.ufrustumProbe=new n.default,this.ufrustumProbe.bindSlotAt(this.m_uslotIndex),this.ufrustumProbe.addVec4Data(new Float32Array([this.m_zNear,this.m_zFar,this.m_nearPlaneHalfW,this.m_nearPlaneHalfH]),1)):this.ufrustumProbe.setVec4DataAt(0,this.m_zNear,this.m_zFar,this.m_nearPlaneHalfW,this.m_nearPlaneHalfH),this.ufrustumProbe.update())}destroy(){}lookRHEnabled(){return this.m_lookRHEnabled}lookLHEnabled(){return!this.m_lookRHEnabled}getVPMatrix(){return this.m_vpMat}getViewMatrix(){return this.m_viewMat}getViewInvMatrix(){return this.m_viewInvertMat}getProjectMatrix(){return this.m_projMat}toString(){return"[Object CameraBase()]"}}e.default=o},c62b:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8e17")),a=i("e08e"),h=i("7c63"),_=s(i("29ef"));class l{constructor(){this.uid=-1,this.value=-1,this.__$rpuid=-1,this.__$rprouid=-1,this.shader=null,this.pos=new r.default,this.bounds=null,this.ibufType=0,this.ibufStep=2,this.ivsIndex=0,this.ivsCount=0,this.insCount=0,this.drawOffset=0,this.partTotal=0,this.partGroup=null,this.trisNumber=0,this.visible=!0,this.drawEnabled=!0,this.drawMode=0,this.renderState=0,this.rcolorMask=0,this.drawFlag=0,this.vro=null,this.transUniform=null,this.uniform=null,this.shdUid=-1,this.vtxUid=-1,this.tro=null,this.texMid=-1,this.ubo=null}testDrawFlag(){this.shader.drawFlag!=this.drawFlag&&(this.shader.drawFlag=this.drawFlag,h.RenderStateObject.UseRenderState(this.renderState),h.RenderColorMask.UseRenderState(this.rcolorMask))}getUid(){return this.uid}getRPOUid(){return this.__$rpuid}getRPROUid(){return this.__$rprouid}getShaderUid(){return this.shdUid}setIvsParam(t,e){this.ivsIndex=t,this.ivsCount=e,this.drawOffset=t*this.ibufStep,this.drawEnabled=this.visible&&this.ivsCount>0}setVisible(t){this.visible=t,this.drawEnabled=t&&this.ivsCount>0}setDrawFlag(t,e){this.renderState=t,this.rcolorMask=e,this.drawFlag=(e<<10)+t}drawThis(t){switch(++_.default.DrawCallTimes,_.default.DrawTrisNumber+=this.trisNumber,this.drawMode){case a.RenderDrawMode.ELEMENTS_TRIANGLES:t.RContext.drawElements(t.TRIANGLES,this.ivsCount,this.ibufType,this.drawOffset);break;case a.RenderDrawMode.ELEMENTS_TRIANGLE_STRIP:t.RContext.drawElements(t.TRIANGLE_STRIP,this.ivsCount,this.ibufType,this.drawOffset);break;case a.RenderDrawMode.ELEMENTS_INSTANCED_TRIANGLES:t.RContext.drawElementsInstanced(t.TRIANGLES,this.ivsCount,this.ibufType,this.drawOffset,this.insCount);break;case a.RenderDrawMode.ELEMENTS_TRIANGLE_FAN:t.RContext.drawElements(t.TRIANGLE_FAN,this.ivsCount,this.ibufType,this.drawOffset);break;case a.RenderDrawMode.ARRAYS_LINES:t.RContext.drawArrays(t.LINES,this.ivsIndex,this.ivsCount);break;case a.RenderDrawMode.ARRAYS_LINE_STRIP:t.RContext.drawArrays(t.LINE_STRIP,this.ivsIndex,this.ivsCount);break;default:break}}drawPart(t){++_.default.DrawCallTimes,_.default.DrawTrisNumber+=this.trisNumber;let e=0,i=t.RContext;switch(this.drawMode){case a.RenderDrawMode.ELEMENTS_TRIANGLES:for(;e<this.partTotal;)i.drawElements(t.TRIANGLES,this.partGroup[e++],this.ibufType,this.partGroup[e++]);break;case a.RenderDrawMode.ELEMENTS_TRIANGLE_STRIP:i.drawElements(t.TRIANGLE_STRIP,this.ivsCount,this.ibufType,this.drawOffset);break;case a.RenderDrawMode.ELEMENTS_INSTANCED_TRIANGLES:i.drawElementsInstanced(t.TRIANGLES,this.ivsCount,this.ibufType,this.drawOffset,this.insCount);break;case a.RenderDrawMode.ELEMENTS_TRIANGLE_FAN:i.drawElements(t.TRIANGLE_FAN,this.ivsCount,this.ibufType,this.drawOffset);break;case a.RenderDrawMode.ARRAYS_LINES:i.drawArrays(t.LINES,this.ivsIndex,this.ivsCount);break;case a.RenderDrawMode.ARRAYS_LINE_STRIP:i.drawArrays(t.LINE_STRIP,this.ivsIndex,this.ivsCount);break;default:break}}run2(t){null!=this.ubo&&this.ubo.run(t),this.shader.useTransUniform(this.transUniform),this.shader.useUniform(this.uniform),this.testDrawFlag()}run(t){null!=this.ubo&&this.ubo.run(t),this.vro.run(),this.tro.run(),this.shader.useTransUniform(this.transUniform),this.shader.useUniform(this.uniform),this.testDrawFlag()}runLockMaterial2(t){this.testDrawFlag(),this.shader.useUniform2ToCurrentShd(null==t?this.uniform:t,this.transUniform)}runLockMaterial(){this.vro.run(),this.testDrawFlag(),this.shader.useUniform2ToCurrentShd(this.uniform,this.transUniform)}reset(){this.vro.__$detachThis(),this.vro=null,this.tro.__$detachThis(),this.tro=null,this.texMid=-1,this.__$rprouid=-1,this.ubo=null,this.shdUid=-1,this.vtxUid=-1,this.uniform=null,this.transUniform=null,this.partGroup=null,this.ivsIndex=0,this.ivsCount=0,this.insCount=0,this.partTotal=0,this.drawMode=0,this.drawFlag=0,this.renderState=0,this.rcolorMask=0,this.drawEnabled=!0,this.shader=null,this.bounds=null}destroy(){this.reset()}toString(){return"[RPOUnit(uid = "+this.uid+")]"}}e.default=l},ca6c:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{static PushThreeBitValueToInt(t,e){return(t<<3)+e}static PopThreeBitValueFromInt(t){return s.value=7&t,t>>3}static ContainsBit(t,e){return(e&t)>0}static RemoveBit(t,e){return~e&t}static AddBit(t,e){return e|t}static AssembleFromIntArray(t){let e=0,i=0,s=t.length;for(;e<s;++e)t[e]>0&&(i|=1<<e);return i}}s.BIT_ZERO=0,s.BIT_ONE_0=1,s.BIT_ONE_1=2,s.BIT_ONE_2=4,s.BIT_ONE_3=8,s.BIT_ONE_4=16,s.BIT_ONE_5=32,s.BIT_ONE_6=64,s.BIT_ONE_7=128,s.BIT_ONE_8=256,s.BIT_ONE_9=512,s.BIT_ONE_10=1024,s.BIT_ONE_11=2048,s.value=0,e.default=s},d1a0:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("6e01"));class a{static PlaneCalcIntersectSphere(t,e,i,s){a.IntersectBoo=!1,a.IntersectSatus=0,e=t.dot(i)-e,e>r.default.MATH_MIN_POSITIVE?(a.IntersectBoo=e<=s,a.IntersectSatus=1):e<r.default.MATH_MAX_NEGATIVE&&(a.IntersectBoo=-e<=s,a.IntersectSatus=-1)}static CalcPVCloseV(t,e,i,s){let r=e-i.dot(t);s.setTo(r*t.x,r*t.y,r*t.z),s.addBy(i)}static CalcPVCloseV2(t,e,i,s){let r=e-i.dot(t);s.setTo(r*t.x,r*t.y,r*t.z),s.addBy(i)}static IntersectionSLV2(t,e,i,s,a){let h=t.dot(s);if(h>r.default.MATH_MIN_POSITIVE||h<r.default.MATH_MAX_NEGATIVE){let r=t.dot(i)-e;return a.x=1e5*s.x+i.x,a.y=1e5*s.y+i.y,a.z=1e5*s.z+i.z,h=t.dot(a)-e,h=r/(r-h),a.subtractBy(i),a.scaleBy(h),a.addBy(i),1}return h=t.dot(i)-e,h<=r.default.MATH_MIN_POSITIVE||h>=r.default.MATH_MAX_NEGATIVE?(a.copyFrom(i),2):0}}a.IntersectBoo=!1,a.IntersectSatus=0,e.default=a},d53d:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.uns="",this.program=null,this.types=null,this.uniformSize=0,this.uniformNameList=null,this.locations=null,this.dataSizeList=null,this.dataList=null,this.calcModels=null,this.always=!0,this.next=null}getDataRefFromUniformName(t){if(null!=this.uniformNameList){let e=this.uniformNameList,i=e.length;for(let s=0;s<i;++s)if(t==e[s])return this.dataList[s]}return null}setDataRefFromUniformName(t,e){if(null!=this.uniformNameList){let i=this.uniformNameList,s=i.length;for(let r=0;r<s;++r)if(t==i[r]){this.dataList[r]=e;break}}}copyDataFromProbe(t){this.types=[],this.dataSizeList=[];for(let e=0;e<t.uniformsTotal;++e)this.types.push(t.uniformTypes[e]),this.dataSizeList.push(t.dataSizeList[e]);this.uniformSize=t.uniformsTotal}useByLocation(t,e,i,s){}useByShd(t,e){}use(t){}updateData(){}destroy(){}}e.ShaderUniform=s;class r extends s{constructor(){super()}use(t){let e=0;for(;e<this.uniformSize;++e)t.useUniformV1(this.locations[e],this.types[e],this.dataList[e],this.dataSizeList[e])}useByLocation(t,e,i,s){t.useUniformV1(i,e,this.dataList[s],this.dataSizeList[s])}useByShd(t,e){let i=0;for(;i<this.uniformSize;++i)t.useUniformV1(e.getUniformLocationByNS(this.uniformNameList[i]),this.types[i],this.dataList[i],this.dataSizeList[i])}updateData(){if(null!=this.calcModels){let t=this.calcModels.length,e=null;for(let i=0;i<t;++i)e=this.calcModels[i],e.buildData(),e.updateMaterialDataList(this.dataList),e.initializeParam()}}destroy(){let t=0,e=this.dataList.length;for(;t<e;++t)this.dataList[t]=null;if(null!=this.calcModels)for(e=this.calcModels.length,t=0;t<e;++t)this.calcModels[t].destroy(),this.calcModels[t]=null;this.dataList=null,this.types=null,this.locations=null,this.dataSizeList=null,this.calcModels=null}}e.ShaderUniformV1=r;class a extends s{constructor(){super()}use(t){let e=0;for(;e<this.uniformSize;++e)t.useUniformV2(this.locations[e],this.types[e],this.dataList[e],this.dataSizeList[e],0)}useByLocation(t,e,i,s){t.useUniformV2(i,e,this.dataList[s],this.dataSizeList[s],0)}useByShd(t,e){let i=0;for(;i<this.uniformSize;++i)t.useUniformV2(e.getUniformLocationByNS(this.uniformNameList[i]),this.types[i],this.dataList[i],this.dataSizeList[i],0)}updateData(){if(null!=this.calcModels){let t=this.calcModels.length,e=null;for(let i=0;i<t;++i)e=this.calcModels[i],e.buildData(),e.updateMaterialDataList(this.dataList),e.initializeParam()}}destroy(){let t=0,e=this.dataList.length;for(;t<e;++t)this.dataList[t]=null;if(null!=this.calcModels)for(e=this.calcModels.length,t=0;t<e;++t)this.calcModels[t].destroy(),this.calcModels[t]=null;this.dataList=null,this.types=null,this.locations=null,this.dataSizeList=null,this.calcModels=null,this.program=null}}e.ShaderUniformV2=a;class h extends s{constructor(){super()}use(t){t.useUniformMat4(this.locations[0],this.dataList[0])}useByLocation(t,e,i,s){t.useUniformMat4(i,this.dataList[0])}useByShd(t,e){t.useUniformMat4(e.getUniformLocationByNS(this.uniformNameList[0]),this.dataList[0])}destroy(){this.dataList[0]=null,this.dataList=null,this.types=null,this.locations=null,this.dataSizeList=null}}e.ShaderMat4Uniform=h,e.default=s},d958:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("11e6")),a=s(i("36cb")),h=s(i("c497")),_=s(i("3c81")),l=s(i("1e15")),n=s(i("0e01")),o=i("eca0"),m=s(i("442e")),d=s(i("1264"));class u{constructor(){this.___$$$$$$$Author="VilyLei(vily313@126.com)",this.m_uid=-1,this.m_entity3DMana=null,this.m_processes=[],this.m_processesLen=0,this.m_sprocesses=[],this.m_sprocessesLen=0,this.m_renderProxy=null,this.m_adapter=null,this.m_dataBuilder=null,this.m_renderInsContext=null,this.m_batchEnabled=!0,this.m_processFixedState=!0,this.m_rpoUnitBuilder=new o.RPOUnitBuilder,this.m_rpoNodeBuilder=new m.default,this.m_processBuider=new _.default,this.m_roVtxBuild=null,this.m_stage3D=null,this.m_fixProcess=null,this.m_uid=u.s_uid++,this.m_renderInsContext=new n.default(this.m_uid)}__$setStage3D(t){null!=t&&null==this.m_stage3D&&(this.m_stage3D=t)}getUid(){return this.m_uid}getRCUid(){return this.m_uid}getRPONodeBuilder(){return this.m_rpoNodeBuilder}getDataBuilder(){return this.m_dataBuilder}getRendererContext(){return this.m_renderInsContext}getRenderProxy(){return this.m_renderProxy}getStage3D(){return this.m_renderProxy.getStage3D()}getViewX(){return this.m_adapter.getViewportX()}getViewY(){return this.m_adapter.getViewportY()}getViewWidth(){return this.m_adapter.getViewportWidth()}getViewHeight(){return this.m_adapter.getViewportHeight()}getCamera(){return null==this.m_renderProxy?this.m_renderInsContext.getCamera():null}createCamera(){if(null==this.m_renderProxy)return this.m_renderProxy.createCamera()}useCamera(t,e=!1){}useMainCamera(){}updateCamera(){null!=this.m_renderProxy&&this.m_renderProxy.updateCamera()}initialize(t=null){null==this.m_renderProxy&&(null==t&&(t=new h.default),this.m_batchEnabled=t.batchEnabled,this.m_processFixedState=t.processFixedState,this.m_renderProxy=this.m_renderInsContext.getRenderProxy(),this.m_dataBuilder=new a.default,this.m_roVtxBuild=new l.default,this.m_renderInsContext.setCameraParam(t.camProjParam.x,t.camProjParam.y,t.camProjParam.z),this.m_renderInsContext.initialize(t,this.m_stage3D,this.m_dataBuilder,this.m_roVtxBuild),this.m_adapter=this.m_renderProxy.getRenderAdapter(),this.m_uid=this.m_renderProxy.getUid(),this.m_dataBuilder.initialize(this.m_renderProxy,this.m_rpoUnitBuilder,this.m_processBuider,this.m_roVtxBuild),this.m_renderInsContext.initManager(this.m_dataBuilder),this.m_entity3DMana=new d.default(this.m_uid,this.m_dataBuilder,this.m_rpoUnitBuilder,this.m_processBuider),this.m_fixProcess=this.createSeparatedProcess(),this.appendProcess(this.m_batchEnabled,this.m_processFixedState))}update(){this.m_renderProxy.Texture.update(),this.m_renderProxy.Vertex.update(),this.m_entity3DMana.update()}updateAllProcess(){for(let t=0;t<this.m_processesLen;++t)this.m_processes[t].update()}updateProcessAt(t){t>-1&&t<this.m_processesLen&&this.m_processes[t].update()}setEntityManaListener(t){this.m_entity3DMana.entityManaListener=t}addEntity(t,e=0,i=!0){null!=t&&t.__$testRendererEnabled()&&e>-1&&e<this.m_processesLen&&this.m_entity3DMana.addEntity(t,this.m_processes[e].getUid(),i)}addEntityToProcess(t,e,i=!0){null!=e&&null!=t&&t.__$testRendererEnabled()&&e.getRCUid()==this.m_uid&&this.m_entity3DMana.addEntity(t,e.getUid(),i)}moveEntityToProcessAt(t,e){if(null!=t&&t.getRendererUid()==this.m_uid&&t.isRenderEnabled()&&e>-1&&e<this.m_processesLen){let i=t.getDisplay().__$$runit.getRPROUid(),s=this.m_processBuider.getNodeByUid(i),a=this.m_processes[e];s!=a&&(s.removeDispUnit(t.getDisplay()),t.__$rseFlag=a.getSortEnabled()?r.default.AddSortEnabled(t.__$rseFlag):r.default.RemoveSortEnabled(t.__$rseFlag),a.addDisp(t.getDisplay()))}}moveEntityToProcess(t,e){if(null!=e&&null!=t&&t.getRendererUid()==this.m_uid&&t.isRenderEnabled()){let i=t.getDisplay().__$$runit.getRPROUid(),s=this.m_processBuider.getNodeByUid(i);if(s!=e){let i=e;s.removeDispUnit(t.getDisplay()),t.__$rseFlag=e.getSortEnabled()?r.default.AddSortEnabled(t.__$rseFlag):r.default.RemoveSortEnabled(t.__$rseFlag),i.addDisp(t.getDisplay())}}}removeEntity(t){null!=t&&t.getRendererUid()==this.m_uid&&(this.m_entity3DMana.removeEntity(t),t.__$setRenderProxy(null))}removeEntityFromProcess(t,e){null!=e&&e.getRCUid()==this.m_uid&&null!=t&&t.getRendererUid()==this.m_uid&&(e.removeDisp(t.getDisplay()),t.__$setRenderProxy(null))}removeEntityByProcessIndex(t,e){e>=0&&e<this.m_processesLen&&null!=t&&t.getRendererUid()==this.m_uid&&(this.m_processes[e].removeDisp(t.getDisplay()),t.__$setRenderProxy(null))}setProcessSortEnabledAt(t,e){t>=0&&t<this.m_processesLen&&this.m_processes[t].setSortEnabled(e)}setProcessSortEnabled(t,e){if(null!=t&&t.getRCUid()==this.m_uid){let i=t;i.setSortEnabled(e)}}appendProcess(t=!0,e=!1){this.m_processBuider.setCreateParams(this.m_dataBuilder.getRenderShader(),this.m_rpoNodeBuilder,this.m_rpoUnitBuilder,this.m_renderProxy.Vertex,t,e);let i=this.m_processBuider.create();return this.m_processes.push(i),i.setRendererParam(this.m_renderProxy,this.m_processesLen),++this.m_processesLen,i}createSeparatedProcess(t=!0,e=!1){this.m_processBuider.setCreateParams(this.m_dataBuilder.getRenderShader(),this.m_rpoNodeBuilder,this.m_rpoUnitBuilder,this.m_renderProxy.Vertex,t,e);let i=this.m_processBuider.create();return this.m_sprocesses.push(i),i.setRendererParam(this.m_renderProxy,this.m_sprocessesLen),i}setRendererProcessParam(t,e,i){t>-1&&t<this.m_processesLen&&this.m_processes[t].setRenderParam(e,i)}getProcessAt(t){return t>-1&&t<this.m_processesLen?this.m_processes[t]:null}showInfoAt(t){t>-1&&t<this.m_processesLen&&this.m_processes[t].showInfo()}getProcessesTotal(){return this.m_processesLen}updateMaterialUniformToCurrentShd(t){this.m_dataBuilder.getRenderShader().useUniformToCurrentShd(t.__$uniform)}drawEntityByLockMaterial(t,e=!1,i=!0){null!=t&&t.getVisible()&&t.getRendererUid()==this.m_uid&&!this.m_renderProxy.isContextLost()&&this.m_fixProcess.drawLockMaterialByDisp(t.getDisplay(),e,i)}drawEntity(t,e=!1,i=!0){null!=t&&t.getVisible()&&!this.m_renderProxy.isContextLost()&&(t.getRendererUid()==this.m_uid?this.m_fixProcess.drawDisp(t.getDisplay(),e,i):t.__$testRendererEnabled()&&this.m_entity3DMana.addEntity(t,this.m_fixProcess.getUid(),!1))}runAt(t){this.m_renderProxy.isContextLost()||this.m_processes[t].run()}runProcess(t){t.getRCUid()!=this.m_uid||this.m_renderProxy.isContextLost()||t.run()}runFromIndexTo(t){if(!this.m_renderProxy.isContextLost())for(let e=t;e<this.m_processesLen;++e)this.m_processes[e].run()}run(){if(this.m_entity3DMana.isHaveEntity()&&!this.m_renderProxy.isContextLost())for(let t=0;t<this.m_processesLen;++t)this.m_processes[t].run()}getRenderUnitsTotal(){let t=0;for(let e=0;e<this.m_processesLen;++e)t+=this.m_processes[e].getUnitsTotal();return t}renderflush(){this.m_renderProxy.flush()}toString(){return"[RendererInstance(uid = "+this.m_uid+")]"}}u.s_uid=0,e.RendererInstance=u,e.default=u},de9d:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("722e")),a=s(i("8333")),h=s(i("6e01")),_=s(i("8e17")),l=s(i("c51d")),n=i("7c63"),o=s(i("090c")),m=s(i("1216")),d=s(i("56c5")),u=s(i("030e")),c=s(i("74c3")),f=s(i("984e")),p=s(i("29ef"));class g{constructor(t){this.RGBA=0,this.UNSIGNED_BYTE=0,this.TRIANGLE_STRIP=0,this.TRIANGLE_FAN=0,this.TRIANGLES=0,this.LINES=0,this.LINE_STRIP=0,this.UNSIGNED_SHORT=0,this.UNSIGNED_INT=0,this.COLOR=0,this.DEPTH=0,this.STENCIL=0,this.DEPTH_STENCIL=0,this.MAX=0,this.MIN=0,this.RContext=null,this.RState=null,this.Vertex=null,this.Texture=null,this.VtxBufUpdater=null,this.MaterialUpdater=null,this.m_uid=0,this.m_camUBO=null,this.m_adapter=null,this.m_adapterContext=new o.default,this.m_rc=null,this.m_perspectiveEnabled=!0,this.m_viewX=0,this.m_viewY=0,this.m_viewW=800,this.m_viewH=600,this.m_cameraNear=.1,this.m_cameraFar=5e3,this.m_cameraFov=45,this.m_maxWebGLVersion=2,this.m_WEBGL_VER=2,this.m_camera=null,this.m_camSwitched=!1,this.m_autoSynViewAndStage=!0,this.m_uid=t}getRC(){return this.m_rc}getUid(){return this.m_uid}getRCUid(){return this.m_uid}isAutoSynViewAndStage(){return this.m_autoSynViewAndStage}enableSynViewAndStage(){this.m_autoSynViewAndStage=!0}lockViewport(){this.m_adapter.lockViewport()}unlockViewport(){this.m_adapter.unlockViewport()}getDiv(){return this.m_adapter.getDiv()}getCanvas(){return this.m_adapter.getCanvas()}cameraLock(){this.m_camera.lock()}cameraUnlock(){this.m_camera.unlock()}getCamera(){return this.m_camera}updateCamera(){return this.m_camera.update()}createCameraUBO(t){}updateCameraDataFromCamera(t){null!=t&&(this.m_camSwitched||t!=this.m_camera)&&(this.m_camSwitched=t!=this.m_camera,t.updateCamMatToUProbe(this.m_camera.matUProbe),null!=this.m_camUBO&&(this.m_camUBO.setSubDataArrAt(0,t.getViewMatrix().getLocalFS32()),this.m_camUBO.setSubDataArrAt(16,t.getProjectMatrix().getLocalFS32())))}useCameraData(){null!=this.m_camUBO&&this.m_camUBO.run()}getActiveAttachmentTotal(){return this.m_adapter.getActiveAttachmentTotal()}drawInstanced(t,e,i){2==this.m_WEBGL_VER?this.m_rc.drawElementsInstanced(this.TRIANGLES,t,this.UNSIGNED_SHORT,e,i):u.default.ANGLE_instanced_arrays.drawElementsInstancedANGLE(this.TRIANGLES,t,e,i)}createUBOBufferByBytesCount(t){let e=this.m_rc.createBuffer();return this.m_rc.bindBuffer(this.m_rc.UNIFORM_BUFFER,e),this.m_rc.bufferData(this.m_rc.UNIFORM_BUFFER,t,this.m_rc.DYNAMIC_DRAW),e}createUBOBufferByDataArray(t){let e=this.m_rc.createBuffer();return this.m_rc.bindBuffer(this.m_rc.UNIFORM_BUFFER,e),this.m_rc.bufferData(this.m_rc.UNIFORM_BUFFER,t,this.m_rc.DYNAMIC_DRAW),e}bindUBOBuffer(t){this.m_rc.bindBuffer(this.m_rc.UNIFORM_BUFFER,t)}deleteUBOBuffer(t){this.m_rc.deleteBuffer(t)}bufferDataUBOBuffer(t){this.m_rc.bufferData(this.m_rc.UNIFORM_BUFFER,t,this.m_rc.STATIC_DRAW)}bindBufferBaseUBOBuffer(t,e){this.m_rc.bindBufferBase(this.m_rc.UNIFORM_BUFFER,t,e)}setWebGLMaxVersion(t){1!=t&&2!=t||(this.m_maxWebGLVersion=t)}getContext(){return this.m_adapterContext}getStage3D(){return this.m_adapterContext.getStage()}getRenderAdapter(){return this.m_adapter}setCameraParam(t,e,i){this.m_cameraFov=t,this.m_cameraNear=e,this.m_cameraFar=i}getMouseXYWorldRay(t,e){let i=this.m_adapterContext.getStage();this.m_camera.getWorldPickingRayByScreenXY(i.mouseX,i.mouseY,t,e)}testViewPortChanged(t,e,i,s){return this.m_viewX!=t||this.m_viewY!=e||this.m_viewW!=i||this.m_viewH!=s}testRCViewPortChanged(t,e,i,s){return this.m_adapterContext.testViewPortChanged(t,e,i,s)}getViewX(){return this.m_viewX}getViewY(){return this.m_viewY}getViewWidth(){return this.m_viewW}getViewHeight(){return this.m_viewH}setViewPort(t,e,i,s){this.m_autoSynViewAndStage=!1,this.m_viewX=t,this.m_viewY=e,this.m_viewW=i,this.m_viewH=s;let r=this.m_adapterContext.getStage();null!=r&&(r.setViewPort(i,e,i,s),null!=this.m_camera&&(this.m_camera.setViewXY(this.m_viewX,this.m_viewY),this.m_camera.setViewSize(this.m_viewW,this.m_viewH))),this.m_adapterContext.setViewport(this.m_viewX,this.m_viewY,this.m_viewW,this.m_viewH)}setRCViewPort(t,e,i,s,r=!1){this.m_autoSynViewAndStage=r,this.m_adapterContext.setViewport(t,e,i,s)}reseizeRCViewPort(){this.m_adapter.unlockViewport(),this.m_adapter.reseizeViewPort()}resizeCallback(){this.m_autoSynViewAndStage&&(this.m_viewX=0,this.m_viewY=0,this.m_viewW=this.m_adapterContext.getRCanvasWidth(),this.m_viewH=this.m_adapterContext.getRCanvasHeight(),null==this.m_camera&&this.createMainCamera(),this.m_adapterContext.setViewport(this.m_viewX,this.m_viewY,this.m_viewW,this.m_viewH),this.m_camera.setViewXY(this.m_viewX,this.m_viewY),this.m_camera.setViewSize(this.m_viewW,this.m_viewH))}createMainCamera(){this.m_camera=new l.default(this.m_uid),this.m_camera.uniformEnabled=!0,this.m_perspectiveEnabled?this.m_camera.perspectiveRH(h.default.DegreeToRadian(this.m_cameraFov),this.m_viewW/this.m_viewH,this.m_cameraNear,this.m_cameraFar):this.m_camera.orthoRH(this.m_cameraNear,this.m_cameraFar,-.5*this.m_viewH,.5*this.m_viewH,-.5*this.m_viewW,.5*this.m_viewW),this.m_camera.setViewXY(this.m_viewX,this.m_viewY),this.m_camera.setViewSize(this.m_viewW,this.m_viewH)}readPixels(t,e,i,s,r,a,h){this.m_adapter.readPixels(t,e,i,s,r,a,h)}getGLVersion(){return this.m_WEBGL_VER}initialize(t,e,i,s,h){if(null!=this.m_rc)return;let l=t.camPosition,n=t.camLookAtPos,o=t.camUpDirect;null==l&&(l=new _.default(500,500,500)),null==n&&(n=new _.default(0,0,0)),null==o&&(o=new _.default(0,1,0)),this.m_perspectiveEnabled=t.cameraPerspectiveEnabled,this.m_adapterContext.autoSyncRenderBufferAndWindowSize=t.autoSyncRenderBufferAndWindowSize,this.m_adapterContext.setResizeCallback(this,this.resizeCallback),this.m_adapterContext.setWebGLMaxVersion(this.m_maxWebGLVersion),this.m_adapterContext.initialize(this.m_uid,e,t.getDiv(),t.getRenderContextAttri()),this.m_WEBGL_VER=this.m_adapterContext.getWebGLVersion(),this.m_rc=this.m_adapterContext.getRC(),p.default.Initialize(),p.default.Rstate.setRenderContext(this.m_adapterContext);let g=this,S=this.m_rc,A=new c.default(this.m_uid,S,h),E=new f.default(this.m_uid,S);if(g.Vertex=A,g.Texture=E,g.MaterialUpdater=i,g.VtxBufUpdater=s,this.m_viewW=this.m_adapterContext.getViewportWidth(),this.m_viewH=this.m_adapterContext.getViewportHeight(),this.m_adapter=new m.default(this.m_uid,E),this.m_adapter.initialize(this.m_adapterContext,t,p.default.Rstate),this.m_autoSynViewAndStage){let t=this.m_adapterContext.getStage();null!=t&&(this.m_viewW=t.stageWidth,this.m_viewH=t.stageHeight)}null==this.m_camera&&this.createMainCamera(),this.m_adapterContext.setViewport(this.m_viewX,this.m_viewY,this.m_viewW,this.m_viewH),this.m_camera.lookAtRH(l,n,o),this.m_camera.update(),this.m_adapter.bgColor.setRGB3f(0,0,0),g.RGBA=S.RGBA,g.UNSIGNED_BYTE=S.UNSIGNED_BYTE,g.TRIANGLE_STRIP=S.TRIANGLE_STRIP,g.TRIANGLE_FAN=S.TRIANGLE_FAN,g.TRIANGLES=S.TRIANGLES,g.LINES=this.m_rc.LINES,g.LINE_STRIP=S.LINE_STRIP,g.UNSIGNED_SHORT=S.UNSIGNED_SHORT,g.UNSIGNED_INT=S.UNSIGNED_INT,g.COLOR=S.COLOR,g.DEPTH=S.DEPTH,g.STENCIL=S.STENCIL,g.DEPTH_STENCIL=S.DEPTH_STENCIL,this.m_WEBGL_VER>1?(g.MIN=S.MIN,g.MAX=S.MAX):(g.MIN=u.default.EXT_blend_minmax.MIN_EXT,g.MAX=u.default.EXT_blend_minmax.MAX_EXT);let R=r.default;R.NEAREST=S.NEAREST,R.LINEAR=S.LINEAR,R.LINEAR_MIPMAP_LINEAR=S.LINEAR_MIPMAP_LINEAR,R.NEAREST_MIPMAP_NEAREST=S.NEAREST_MIPMAP_NEAREST,R.LINEAR_MIPMAP_NEAREST=S.LINEAR_MIPMAP_NEAREST,R.NEAREST_MIPMAP_LINEAR=S.NEAREST_MIPMAP_LINEAR;let T=a.default;T.COLOR_BUFFER_BIT=S.COLOR_BUFFER_BIT,T.DEPTH_BUFFER_BIT=S.DEPTH_BUFFER_BIT,T.STENCIL_BUFFER_BIT=S.STENCIL_BUFFER_BIT,d.default.SetRenderer(this.m_adapterContext),g.RState=p.default.Rstate,g.RContext=this.m_rc}flush(){this.m_rc.flush()}createCamera(){return new l.default(this.m_uid)}setClearRGBColor3f(t,e,i){this.m_adapter.bgColor.setRGB3f(t,e,i)}setClearColor(t){this.m_adapter.bgColor.copyFrom(t)}setClearUint24Color(t,e){this.m_adapter.bgColor.setRGBUint24(t),this.m_adapter.bgColor.a=e}setClearRGBAColor4f(t,e,i,s){this.m_adapter.bgColor.setRGBA4f(t,e,i,s)}getClearRGBAColor4f(t){t.copyFrom(this.m_adapter.bgColor)}getViewportWidth(){return this.m_adapter.getViewportWidth()}getViewportHeight(){return this.m_adapter.getViewportHeight()}setRenderToBackBuffer(){this.m_adapter.setRenderToBackBuffer()}clearBackBuffer(){this.m_adapter.clear()}renderBegin(){this.m_camera.update(),this.m_adapter.renderBegin()}renderEnd(){}useRenderStateByName(t){n.RenderStateObject.UseRenderStateByName(t)}setScissorEnabled(t){this.m_adapterContext.setScissorEnabled(t)}setScissorRect(t,e,i,s){this.m_adapterContext.setScissorRect(t,e,i,s)}useRenderColorMask(t){n.RenderColorMask.UseRenderState(t)}unlockRenderColorMask(){n.RenderColorMask.Unlock()}lockRenderColorMask(){n.RenderColorMask.Lock()}useRenderState(t){n.RenderStateObject.UseRenderState(t)}unlockRenderState(){n.RenderStateObject.Unlock()}lockRenderState(){n.RenderStateObject.Lock()}setFrontFaceFlipped(t){this.m_adapter.setFrontFaceFlipped(t)}setPolygonOffset(t,e=0){this.m_adapter.setPolygonOffset(t,e)}resetPolygonOffset(){this.m_adapter.resetPolygonOffset()}loseContext(){this.m_adapter.loseContext()}isContextLost(){return this.m_adapter.isContextLost()}setViewProbeValue(t,e,i,s){this.m_adapter.setViewProbeValue(t,e,i,s)}toString(){return"[Object RenderProxy()]"}}e.default=g},df9d:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.m_uid=-1,this.m_begin=null,this.m_end=null,this.m_unitMap=new Map,this.m_unitTexMap=new Map,this.m_FLAG_BUSY=1,this.m_FLAG_FREE=0,this.m_vtxFlagList=[],this.m_vtxIndexFlagList=[],this.m_vtxfreeIList=[],this.m_vtxList=[],this.m_vtxListLen=0,this.m_texFlagList=[],this.m_texIndexFlagList=[],this.m_texfreeIList=[],this.m_texList=[],this.m_texListLen=0,this.m_uid=s.s_uid++}getFreeVtxId(){return this.m_vtxfreeIList.length>0?this.m_vtxfreeIList.pop():-1}getVtxIndex(){let t=-1,e=this.getFreeVtxId();return e>=0?(t=e,this.m_vtxList[e]=0,this.m_vtxFlagList[e]=this.m_FLAG_BUSY):(t=this.m_vtxListLen,this.m_vtxList.push(0),this.m_vtxIndexFlagList.push(this.m_FLAG_FREE),this.m_vtxFlagList.push(this.m_FLAG_BUSY),this.m_vtxListLen++),t}restoreVtxIndex(t){this.m_vtxFlagList[t]==this.m_FLAG_BUSY&&(this.m_vtxfreeIList.push(t),this.m_vtxFlagList[t]=this.m_FLAG_FREE,this.m_vtxList[t]=0)}attachVtxAt(t){++this.m_vtxList[t]}detachVtxAt(t){this.m_vtxList[t]>0&&(--this.m_vtxList[t],this.m_vtxList[t]<1&&this.restoreVtxIndex(t))}getVtxTotalAt(t){return this.m_vtxList[t]}getFreeTexId(){return this.m_texfreeIList.length>0?this.m_texfreeIList.pop():-1}getTexIndex(){let t=-1,e=this.getFreeTexId();return e>=0?(t=e,this.m_texList[e]=0,this.m_texFlagList[e]=this.m_FLAG_BUSY):(t=this.m_texListLen,this.m_texList.push(0),this.m_texIndexFlagList.push(this.m_FLAG_FREE),this.m_texFlagList.push(this.m_FLAG_BUSY),this.m_texListLen++),t}restoreTexIndex(t){this.m_texFlagList[t]==this.m_FLAG_BUSY&&(this.m_texfreeIList.push(t),this.m_texFlagList[t]=this.m_FLAG_FREE,this.m_texList[t]=0)}attachTexAt(t){++this.m_texList[t]}detachTexAt(t){this.m_texList[t]>0&&(--this.m_texList[t],this.m_texList[t]<1&&this.restoreTexIndex(t))}getTexTotalAt(t){return this.m_texList[t]}destroy(){this.clear()}clear(){this.m_begin=this.m_end=null,this.m_unitMap=new Map,this.m_unitTexMap=new Map,this.m_vtxFlagList=[],this.m_vtxIndexFlagList=[],this.m_vtxList=[],this.m_vtxfreeIList=[],this.m_vtxListLen=0,this.m_texFlagList=[],this.m_texIndexFlagList=[],this.m_texList=[],this.m_texfreeIList=[],this.m_texListLen=0}getBegin(){return this.m_begin}containsNode(t){let e=this.m_unitMap.get(t.vtxUid);if(null!=e){let i=131*(31+e.rvroI);return i*=i+e.texMid,t.rtokey==i}return!1}addNodeAndSort(t){let e=this.m_unitMap.get(t.vtxUid);if(null==e){this.m_unitMap.set(t.vtxUid,t),t.rvroI=this.getVtxIndex(),this.attachVtxAt(t.rvroI);let e=131*(31+t.rvroI);e*=e+t.texMid,t.rtokey=e,t.rtroI=this.getTexIndex(),this.m_unitTexMap.set(e,t.rtroI),this.attachTexAt(t.rtroI)}else{t.rvroI=e.rvroI,this.attachVtxAt(t.rvroI);let i=131*(31+t.rvroI);if(i*=i+t.texMid,this.m_unitTexMap.has(i)?t.rtroI=this.m_unitTexMap.get(i):(t.rtroI=this.getTexIndex(),this.m_unitTexMap.set(i,t.rtroI)),t.rtokey=i,this.attachTexAt(t.rtroI),e!=this.m_end)if(e.texMid==t.texMid)e.next.prev=t,t.next=e.next,t.prev=e,e.next=t;else while(null!=e){if(e.vtxUid!=t.vtxUid){e=e.prev,e.next.prev=t,t.next=e.next,t.prev=e,e.next=t;break}if(e.texMid==t.texMid){e.next.prev=t,t.next=e.next,t.prev=e,e.next=t;break}if(e.next==this.m_end){this.m_end.vtxUid!=t.vtxUid?(e.next.prev=t,t.next=e.next,t.prev=e,e.next=t):e=null;break}e=e.next}else e=null}null==e&&(null==this.m_begin?this.m_end=this.m_begin=t:null!=this.m_end.prev?(this.m_end.next=t,t.prev=this.m_end,this.m_end=t):(this.m_begin.next=t,t.prev=this.m_end,this.m_end=t),this.m_end.next=null)}showInfo(){let t=this.getBegin();if(null!=t){let e="",i="",s="";while(null!=t)e+=t.vtxUid+",",i+=t.texMid+",",s+=t.ivsCount+",",t=t.next}}removeNodeAndSort(t){let e=this.m_unitMap.get(t.vtxUid);e!=t?e=null:(this.m_unitMap.set(t.vtxUid,null),null!=t.next&&t.next.vtxUid==t.vtxUid?this.m_unitMap.set(t.vtxUid,t.next):null!=t.prev&&t.prev.vtxUid==t.vtxUid?this.m_unitMap.set(t.vtxUid,t.prev):this.m_unitMap.delete(t.vtxUid)),t==this.m_begin?t==this.m_end?this.m_begin=this.m_end=null:(this.m_begin=t.next,this.m_begin.prev=null):t==this.m_end?(this.m_end=t.prev,this.m_end.next=null):(t.next.prev=t.prev,t.prev.next=t.next),this.detachVtxAt(t.rvroI),this.detachTexAt(t.rtroI),t.prev=null,t.next=null}addNode(t){null==this.m_begin?this.m_end=this.m_begin=t:null!=this.m_end.prev?(this.m_end.next=t,t.prev=this.m_end,this.m_end=t):(this.m_begin.next=t,t.prev=this.m_end,this.m_end=t),this.m_end.next=null}removeNode(t){t==this.m_begin?t==this.m_end?this.m_begin=this.m_end=null:(this.m_begin=t.next,this.m_begin.prev=null):t==this.m_end?(this.m_end=t.prev,this.m_end.next=null):(t.next.prev=t.prev,t.prev.next=t.next),t.prev=null,t.next=null}}s.s_uid=0,e.default=s},e08e:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{}s.ELEMENTS_TRIANGLES=1,s.ELEMENTS_TRIANGLE_STRIP=2,s.ELEMENTS_TRIANGLE_FAN=3,s.ELEMENTS_INSTANCED_TRIANGLES=4,s.ARRAYS_LINES=5,s.ARRAYS_LINE_STRIP=6,s.ARRAYS_POINTS=7,s.DISABLE=0,e.RenderDrawMode=s;class r{}r.NORMAL=1,r.OPAQUE=1,r.TRANSPARENT=2,r.ALPHA_ADD=3,r.ADD=4,r.ADD_LINEAR=5,r.INVERSE_ALPHA=6,r.BLAZE=7,r.OVERLAY=8,r.OVERLAY2=8,r.DISABLE=0,e.RenderBlendMode=r;class a{}a.NEVER=1,a.LESS=1,a.EQUAL=1,a.GREATER=1,a.NOTEQUAL=1,a.GEQUAL=1,a.ALWAYS=1,e.GLStencilFunc=a;class h{}h.KEEP=1,h.ZERO=1,h.REPLACE=1,h.INCR=1,h.INCR_WRAP=1,h.DECR=1,h.DECR_WRAP=1,h.INVERT=1,e.GLStencilOp=h;class _{}_.ZERO=1,_.ONE=1,_.SRC_COLOR=1,_.DST_COLOR=1,_.SRC_ALPHA=1,_.DST_ALPHA=1,_.ONE_MINUS_SRC_ALPHA=1,e.GLBlendMode=_;class l{}l.FUNC_ADD=1,l.FUNC_SUBTRACT=1,l.FUNC_REVERSE_SUBTRACT=1,l.MIN_EXT=1,l.MAX_EXT=1,l.MIN=1,l.MAX=1,e.GLBlendEquation=l;class n{}n.BACK=1,n.FRONT=2,n.FRONT_AND_BACK=3,n.NONE=0,n.DISABLE=0,e.CullFaceMode=n;class o{}o.NEVER=1,o.ALWAYS=2,o.SKY=3,o.TRUE_LESS_EQUAL=3,o.OPAQUE=4,o.TRUE_LESS=4,o.OPAQUE_OVERHEAD=5,o.FALSE_EQUAL=5,o.FALSE_LESS=6,o.BLEND=6,o.BLEND_SORT=6,o.TRANSPARENT_SORT=6,o.TRUE_LEQUAL=7,o.WIRE_FRAME=7,o.FALSE_LEQUAL=8,o.DECALS=8,o.NEXT_LAYER=11,o.WIRE_FRAME_NEXT=12,o.TRUE_EQUAL=13,o.TRUE_GREATER=14,o.TRUE_GEQUAL=15,o.DISABLE=0,e.DepthTestMode=o;class m{}m.SCENE_RO_FILTER_BEGIN=1<<19,m.SCENE_RO_FILTER_FINISH=2<<19,m.SCENE_RO_ERASE=0,e.RenderConst=m,function(t){t[t["NOT_IN_WORLD"]=-1]="NOT_IN_WORLD",t[t["GO_TO_WORLD"]=1]="GO_TO_WORLD",t[t["LIVE_IN_WORLD"]=2]="LIVE_IN_WORLD"}(e.DisplayRenderSign||(e.DisplayRenderSign={}))},e214:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("6e01")),a=s(i("8e17")),h=s(i("f48d")),_=s(i("81c4"));class l extends h.default{constructor(){super(...arguments),this.nv=new a.default(0,1,0),this.distance=0,this.intersectBoo=!1}intersectStraightLinePos(t,e){let i=this.nv.dot(t.tv);if(i>r.default.MATH_MIN_POSITIVE||i<r.default.MATH_MAX_NEGATIVE){let s=this.nv.dot(t.position)-this.distance;return e.x=1e5*t.tv.x+t.position.x,e.y=1e5*t.tv.y+t.position.y,e.z=1e5*t.tv.z+t.position.z,i=this.nv.dot(e)-this.distance,i=s/(s-i),e.subtractBy(t.position),e.scaleBy(i),e.addBy(t.position),1}return i=this.nv.dot(t.position)-this.distance,i<=r.default.MATH_MIN_POSITIVE||i>=r.default.MATH_MAX_NEGATIVE?(e.copyFrom(t.position),2):0}intersectStraightLinePos2(t,e,i){let s=this.nv.dot(e);if(s>r.default.MATH_MIN_POSITIVE||s<r.default.MATH_MAX_NEGATIVE){let r=this.nv.dot(t)-this.distance;return i.x=1e5*e.x+t.x,i.y=1e5*e.y+t.y,i.z=1e5*e.z+t.z,s=this.nv.dot(i)-this.distance,s=r/(r-s),i.subtractBy(t),i.scaleBy(s),i.addBy(t),1}return s=this.nv.dot(t)-this.distance,s<=r.default.MATH_MIN_POSITIVE||s>=r.default.MATH_MAX_NEGATIVE?(i.copyFrom(t),2):0}intersectRadialLinePos(t,e){let i=this.nv.dot(t.position)-this.distance;if(i>r.default.MATH_MIN_POSITIVE){let i=this.nv.dot(t.tv);if(i<0)return this.intersectStraightLinePos2(t.position,t.tv,e)}else{if(!(i<r.default.MATH_MAX_NEGATIVE)){let i=this.nv.dot(t.tv);return i>r.default.MATH_MIN_POSITIVE||i<r.default.MATH_MAX_NEGATIVE?(e.copyFrom(t.position),1):(e.copyFrom(t.position),2)}{let i=this.nv.dot(t.tv);if(i>0)return this.intersectStraightLinePos2(t.position,t.tv,e)}}return-1}intersectRadialLinePos2(t,e,i){let s=this.nv.dot(t)-this.distance;if(s>r.default.MATH_MIN_POSITIVE){let s=this.nv.dot(e);if(s<0)return this.intersectStraightLinePos2(t,e,i)}else{if(!(s<r.default.MATH_MAX_NEGATIVE)){let s=this.nv.dot(e);return s>r.default.MATH_MIN_POSITIVE||s<r.default.MATH_MAX_NEGATIVE?(i.copyFrom(t),1):(i.copyFrom(t),2)}{let s=this.nv.dot(e);if(s>0)return this.intersectStraightLinePos2(t,e,i)}}return-1}containsPoint(t){let e=this.nv.dot(t)-this.distance;return e>r.default.MATH_MIN_POSITIVE?1:e<r.default.MATH_MAX_NEGATIVE?-1:0}intersectSphere(t,e){this.intersectBoo=!1;let i=this.nv.dot(t)-this.distance;return i>r.default.MATH_MIN_POSITIVE?(this.intersectBoo=i<=e,1):i<r.default.MATH_MAX_NEGATIVE?(this.intersectBoo=-i<=e,-1):0}intersectSphNegSpace(t,e){this.intersectBoo=Math.abs(this.nv.dot(t)-this.distance)<e}update(){this.nv.normalize()}updateFast(){this.nv.normalize()}static PlaneIntersectSphere(t,e,i,s){l.IntersectBoo=!1,l.IntersectSatus=0,e=t.dot(i)-e,e>r.default.MATH_MIN_POSITIVE?(l.IntersectBoo=e<=s,l.IntersectSatus=1):e<r.default.MATH_MAX_NEGATIVE&&(l.IntersectBoo=-e<=s,l.IntersectSatus=-1)}static CalcPVCloseV(t,e,i){let s=t.distance-e.dot(t.nv);i.setTo(s*t.nv.x,s*t.nv.y,s*t.nv.z),i.addBy(e)}static CalcPVCloseV2(t,e,i,s){let r=e-i.dot(t);s.setTo(r*t.x,r*t.y,r*t.z),s.addBy(i)}static IntersectionSLV2(t,e,i,s,a){let h=t.dot(s);if(h>r.default.MATH_MIN_POSITIVE||h<r.default.MATH_MAX_NEGATIVE){let r=t.dot(i)-e;return a.x=1e5*s.x+i.x,a.y=1e5*s.y+i.y,a.z=1e5*s.z+i.z,h=t.dot(a)-e,h=r/(r-h),a.subtractBy(i),a.scaleBy(h),a.addBy(i),1}return h=t.dot(i)-e,h<=r.default.MATH_MIN_POSITIVE||h>=r.default.MATH_MAX_NEGATIVE?(a.copyFrom(i),2):0}toString(){return"Plane(position="+this.position.toString()+", nv="+this.nv.toString()+")"}}l.IntersectBoo=!1,l.IntersectSatus=0;class n extends l{constructor(){super(...arguments),this.v0=new a.default(100,0,0),this.v1=new a.default(0,0,-100),this.v2=new a.default(0,0,0),this.ls01=new _.default,this.ls12=new _.default,this.ls20=new _.default,this.radiusSquared=100}getRandomPosition(t){let e=this.ls01.length*Math.random();t.x=this.ls01.position.x+e*this.ls01.tv.x,t.y=this.ls01.position.y+e*this.ls01.tv.y,t.z=this.ls01.position.z+e*this.ls01.tv.z,e=this.ls12.length*Math.random(),t.x+=this.ls12.position.x+e*this.ls12.tv.x,t.y+=this.ls12.position.y+e*this.ls12.tv.y,t.z+=this.ls12.position.z+e*this.ls12.tv.z,e=this.ls20.length*Math.random(),t.x+=this.ls20.position.x+e*this.ls20.tv.x,t.y+=this.ls20.position.y+e*this.ls20.tv.y,t.z+=this.ls20.position.z+e*this.ls20.tv.z,t.x*=.33333,t.y*=.33333,t.z*=.33333}triIntersectStraightLinePos(t,e){let i=this.intersectStraightLinePos(t,e);return 1==i&&(i=this.triContainsPoint(e),i>0)?1:-1}triIntersectRadialLinePos(t,e){let i=this.intersectRadialLinePos(t,e);return 1==i&&(i=this.triContainsPoint(e),i>0)?1:-1}triIntersectStraightLinePos2(t,e,i){let s=this.intersectStraightLinePos2(t,e,i);return 1==s&&(s=this.triContainsPoint(i),s>0)?1:-1}triIntersectRadialLinePos2(t,e,i){let s=this.intersectStraightLinePos2(t,e,i);return 1==s&&(s=this.triContainsPoint(i),s>0)?1:-1}triContainsPoint(t){let e=this.nv.dot(t)-this.distance;return e>r.default.MATH_MIN_POSITIVE||e<r.default.MATH_MAX_NEGATIVE?-1:(h.default.__tV0.x=t.x-this.v0.x,h.default.__tV0.y=t.y-this.v0.y,h.default.__tV0.z=t.z-this.v0.z,a.default.Cross(this.ls01.tv,h.default.__tV0,h.default.__tV1),this.nv.dot(h.default.__tV1)<0?-1:(h.default.__tV0.x=t.x-this.v1.x,h.default.__tV0.y=t.y-this.v1.y,h.default.__tV0.z=t.z-this.v1.z,a.default.Cross(this.ls12.tv,h.default.__tV0,h.default.__tV1),this.nv.dot(h.default.__tV1)<0?-1:(h.default.__tV0.x=t.x-this.v2.x,h.default.__tV0.y=t.y-this.v2.y,h.default.__tV0.z=t.z-this.v2.z,a.default.Cross(this.ls20.tv,h.default.__tV0,h.default.__tV1),this.nv.dot(h.default.__tV1)<0?-1:1)))}update(){let t=1/3;this.position.x=t*(this.v0.x+this.v1.x+this.v2.x),this.position.y=t*(this.v0.y+this.v1.y+this.v2.y),this.position.z=t*(this.v0.z+this.v1.z+this.v2.z),this.nv.x=this.position.x-this.v0.x,this.nv.y=this.position.y-this.v0.y,this.nv.z=this.position.z-this.v0.z,this.radiusSquared=this.nv.getLengthSquared(),this.ls01.position.copyFrom(this.v0),this.ls01.anotherPosition.copyFrom(this.v1),this.ls12.position.copyFrom(this.v1),this.ls12.anotherPosition.copyFrom(this.v2),this.ls20.position.copyFrom(this.v2),this.ls20.anotherPosition.copyFrom(this.v0),this.ls01.update(),this.ls12.update(),this.ls20.update(),a.default.Cross(this.ls01.tv,this.ls12.tv,this.nv),this.nv.normalize(),this.distance=this.nv.dot(this.v0)}updateFast(){this.update()}}e.Triangle=n,e.default=l},e87b:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("ab73")),a=s(i("7279"));class h{create(t,e){let i=null;return e.hasUniformByName(r.default.ViewParam.name)&&(i=new a.default,i.uns=r.default.ViewParam.name,i.uniformNameList=[r.default.ViewParam.name],i.copyDataFromProbe(t.getRenderAdapter().uViewProbe)),i}getIDNS(){return"ViewParamUniformBuilder"}}e.default=h},eca0:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("2be1")),a=s(i("c62b"));class h{constructor(){this.idsFlag=0,this.count=0,this.rprocessUid=-1}reset(){this.idsFlag=0}}h.RenerProcessMaxTotal=16,e.RCRPObj=h;class _ extends r.default{constructor(){super(...arguments),this.m_rcpoList=[]}createNode(){let t=new h;return t.reset(),this.m_rcpoList.push(t),new a.default}restoreUid(t){this.m_rcpoList[t].reset()}testRPNodeExists(t,e){return(this.m_rcpoList[t].idsFlag&1<<e)>0}testRPNodeNotExists(t,e){return(this.m_rcpoList[t].idsFlag&1<<e)<1}setRPNodeParam(t,e,i){let s=this.m_rcpoList[t],r=1<<e;return i>-1?(s.idsFlag&r)<1&&(++s.count,s.rprocessUid=e,s.idsFlag=s.idsFlag|r):(s.idsFlag&r)>0&&(--s.count,s.idsFlag=s.idsFlag&~r),s.count}getRCRPObj(t){return this.m_rcpoList[t]}}e.RPOUnitBuilder=_},f48d:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8e17"));class a{constructor(){this.id=-1,this.position=new r.default}update(){}updateFast(){}}a.__tV0=new r.default,a.__tV1=new r.default,a.__tV2=new r.default,e.AbsGeomBase=a,e.default=a},fa60:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("919c"));class a extends r.default{constructor(){super(),this.vao=null,this.m_uid=a.s_uid++}run(){this.m_rc.testVROUid(this.m_uid)&&(this.m_rc.bindVertexArray(this.vao),this.m_rc.testRIOUid(this.m_vtxUid)&&this.m_rc.bindEleBuf(this.ibuf))}__$destroy(){r.default.s_midMap.delete(this.m_mid),this.m_mid=0,this.m_vtxUid=-1,this.ibuf=null,this.vao=null,this.m_rc=null}restoreThis(){null!=this.vao&&this.m_rc.deleteVertexArray(this.vao),a.Restore(this)}toString(){return"VaoVertexRenderObj(uid = "+this.m_uid+", type="+this.m_mid+")"}static HasMid(t){return r.default.s_midMap.has(t)}static GetByMid(t){return r.default.s_midMap.get(t)}static GetFreeId(){return a.s_freeIdList.length>0?a.s_freeIdList.pop():-1}static Create(t,e,i){let s=null,h=a.GetFreeId();return h>=0?(s=a.s_unitList[h],a.s_unitFlagList[h]=a.S_FLAG_BUSY,s.setMidAndBufUid(e,i)):(s=new a,s.setMidAndBufUid(e,i),a.s_unitList.push(s),a.s_unitFlagList.push(a.S_FLAG_BUSY),a.s_unitListLen++),s.setRC(t),r.default.s_midMap.set(e,s),s}static Restore(t){if(null!=t&&t.m_attachCount<1&&a.s_unitFlagList[t.getUid()]==a.S_FLAG_BUSY){let e=t.getUid();a.s_freeIdList.push(e),a.s_unitFlagList[e]=a.S_FLAG_FREE,t.__$destroy()}}}a.s_uid=0,a.S_FLAG_BUSY=1,a.S_FLAG_FREE=0,a.s_unitFlagList=[],a.s_unitListLen=0,a.s_unitList=[],a.s_freeIdList=[],e.default=a},fae3:function(t,e,i){"use strict";i.r(e);i("1eb2");var s=i("b529");for(var r in s)["default"].indexOf(r)<0&&function(t){i.d(e,t,(function(){return s[t]}))}(r)},fecb:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("6e01")),a=s(i("8e17"));class h{constructor(){this.min=new a.default(r.default.MATH_MAX_POSITIVE,r.default.MATH_MAX_POSITIVE,r.default.MATH_MAX_POSITIVE),this.max=new a.default(r.default.MATH_MIN_NEGATIVE,r.default.MATH_MIN_NEGATIVE,r.default.MATH_MIN_NEGATIVE),this.version=-1,this.radius=50,this.radius2=2500,this.center=new a.default(0,0,0),this.m_long=100,this.m_width=100,this.m_height=100,this.m_halfLong=50,this.m_halfWidth=50,this.m_halfHeight=50,this.m_tempV=new a.default}getLong(){return this.m_long}getWidth(){return this.m_width}getHeight(){return this.m_height}reset(){this.min.setXYZ(r.default.MATH_MAX_POSITIVE,r.default.MATH_MAX_POSITIVE,r.default.MATH_MAX_POSITIVE),this.max.setXYZ(r.default.MATH_MIN_NEGATIVE,r.default.MATH_MIN_NEGATIVE,r.default.MATH_MIN_NEGATIVE)}equals(t){return this.min.equalsXYZ(t.min)&&this.max.equalsXYZ(t.max)}setVolume(t,e,i){this.m_width=t,this.m_height=e,this.m_long=i,this.m_halfLong=.5*this.m_long,this.m_halfWidth=.5*this.m_width,this.m_halfHeight=.5*this.m_height,this.max.x=this.center.x+this.m_halfWidth,this.max.y=this.center.y+this.m_halfHeight,this.max.z=this.center.z+this.m_halfLong,this.min.x=this.center.x-this.m_halfWidth,this.min.y=this.center.y-this.m_halfHeight,this.min.z=this.center.z-this.m_halfLong,this.radius2=this.m_halfWidth*this.m_halfWidth+this.m_halfHeight*this.m_halfHeight+this.m_halfLong*this.m_halfLong,this.radius=Math.sqrt(this.radius2)}union(t){this.addPosition(t.min),this.addPosition(t.max)}addPosition(t){this.min.x>t.x&&(this.min.x=t.x),this.min.y>t.y&&(this.min.y=t.y),this.min.z>t.z&&(this.min.z=t.z),this.max.x<t.x&&(this.max.x=t.x),this.max.y<t.y&&(this.max.y=t.y),this.max.z<t.z&&(this.max.z=t.z)}addXYZ(t,e,i){this.min.x>t&&(this.min.x=t),this.min.y>e&&(this.min.y=e),this.min.z>i&&(this.min.z=i),this.max.x<t&&(this.max.x=t),this.max.y<e&&(this.max.y=e),this.max.z<i&&(this.max.z=i)}addXYZFloat32Arr(t){let e=t.length,i=0,s=0,r=0;for(let a=0;a<e;)i=t[a],++a,s=t[a],++a,r=t[a],++a,this.min.x>i&&(this.min.x=i),this.min.y>s&&(this.min.y=s),this.min.z>r&&(this.min.z=r),this.max.x<i&&(this.max.x=i),this.max.y<s&&(this.max.y=s),this.max.z<r&&(this.max.z=r)}containsV(t){return!(t.x<this.max.x||t.x>this.max.x)&&(!(t.y<this.max.y||t.y>this.max.y)&&!(t.z<this.max.z||t.z>this.max.z))}containsXY(t,e){return!(t<this.min.x||t>this.max.x)&&!(e<this.min.y||e>this.max.y)}containsXZ(t,e){return!(t<this.min.x||t>this.max.x)&&!(e<this.min.z||e>this.max.z)}containsYZ(t,e){return!(t<this.min.y||t>this.max.y)&&!(e<this.min.z||e>this.max.z)}update(){this.m_width=this.max.x,this.min.x>this.max.x&&(this.max.x=this.min.x,this.min.x=this.m_width),this.m_width=this.max.x-this.min.x,this.m_height=this.max.y,this.min.y>this.max.y&&(this.max.y=this.min.y,this.min.y=this.m_height),this.m_height=this.max.y-this.min.y,this.m_long=this.max.z,this.min.z>this.max.z&&(this.max.z=this.min.z,this.min.z=this.m_long),this.m_long=this.max.z-this.min.z,this.center.x=.5*this.m_width,this.center.y=.5*this.m_height,this.center.z=.5*this.m_long,this.m_halfLong=this.center.z,this.m_halfWidth=this.center.x,this.m_halfHeight=this.center.y,this.radius2=this.m_halfWidth*this.m_halfWidth+this.m_halfHeight*this.m_halfHeight+this.m_halfLong*this.m_halfLong,this.radius=Math.sqrt(this.radius2),this.center.x+=this.min.x,this.center.y+=this.min.y,this.center.z+=this.min.z,++this.version}updateVolume(){this.m_width=this.max.x-this.min.x,this.m_height=this.max.y-this.min.y,this.m_long=this.max.z-this.min.z,this.m_halfLong=.5*this.m_long,this.m_halfWidth=.5*this.m_width,this.m_halfHeight=.5*this.m_height}copyFrom(t){this.radius=t.radius,this.radius2=t.radius2,this.min.copyFrom(t.min),this.max.copyFrom(t.max),this.center.copyFrom(t.center),this.updateVolume()}updateFast(){this.m_width=this.max.x-this.min.x,this.m_height=this.max.y-this.min.y,this.m_long=this.max.z-this.min.z,this.center.x=.5*this.m_width,this.center.y=.5*this.m_height,this.center.z=.5*this.m_long,this.m_halfLong=this.center.z,this.m_halfWidth=this.center.x,this.m_halfHeight=this.center.y,this.radius2=this.m_halfWidth*this.m_halfWidth+this.m_halfHeight*this.m_halfHeight+this.m_halfLong*this.m_halfLong,this.radius=Math.sqrt(this.radius2),this.center.x+=this.min.x,this.center.y+=this.min.y,this.center.z+=this.min.z,++this.version}toString(){return"[AABB(min->"+this.min+",size("+this.m_width+","+this.m_height+","+this.m_long+"))]"}sphereIntersect(t,e){this.m_tempV.x=this.center.x-t.x,this.m_tempV.y=this.center.y-t.y,this.m_tempV.z=this.center.z-t.z;let i=this.m_tempV.getLengthSquared();return i<this.radius2||(e+=this.radius,e*=e,e>=i)}intersectRL(t,e){let i=0,s=(this.min.x-e.x)/t.x,r=(this.max.x-e.x)/t.x;s>r&&(i=r,r=s,s=i);let a=(this.min.y-e.y)/t.y,h=(this.max.y-e.y)/t.y;if(a>h&&(i=h,h=a,a=i),s>h||a>r)return!1;a>s&&(s=a),h<r&&(r=h);let _=(this.min.z-e.z)/t.z,l=(this.max.z-e.z)/t.z;return _>l&&(i=l,l=_,_=i),!(s>l||_>r)&&(_>s&&(s=_),l<r&&(r=l),!0)}static IntersectionRL3(t,e,i,s,r,a){return i.w=(t[e[0]].x-r.x)*i.x,s.w=(t[1-e[0]].x-r.x)*i.x,a.x=(t[e[1]].y-r.y)*i.y,a.y=(t[1-e[1]].y-r.y)*i.y,!(i.w>a.y||a.x>s.w)&&(a.x>i.w&&(i.w=a.x),a.y<s.w&&(s.w=a.y),a.x=(t[e[2]].z-r.z)*i.z,a.y=(t[1-e[2]].z-r.z)*i.z,!(i.w>a.y||a.x>s.w)&&(a.x>i.w&&(i.w=a.x),a.y<s.w&&(s.w=a.y),a.copyFrom(s),a.scaleBy(i.w),a.addBy(r),s.w=1,!0))}static IntersectionRL1(t,e,i,s){let r=0,a=(i.min.x-e.x)/t.x,h=(i.max.x-e.x)/t.x;a>h&&(r=h,h=a,a=r);let _=(i.min.y-e.y)/t.y,l=(i.max.y-e.y)/t.y;if(_>l&&(r=l,l=_,_=r),a>l||_>h)return!1;_>a&&(a=_),l<h&&(h=l);let n=(i.min.z-e.z)/t.z,o=(i.max.z-e.z)/t.z;return n>o&&(r=o,o=n,n=r),!(a>o||n>h)&&(n>a&&(a=n),o<h&&(h=o),s.copyFrom(t),s.scaleBy(a),s.addBy(e),!0)}static IntersectionRL2(t,e,i,s){s.x=i.center.x-e.x,s.y=i.center.y-e.y,s.z=i.center.z-e.z;let r=s.dot(t);if(s.x-=r*t.x,s.y-=r*t.y,s.z-=r*t.z,s.getLengthSquared()>i.radius2)return!1;if(i.containsV(e))return s.copyFrom(e),!0;if(e.x<i.min.x){if(t.x>0&&(r=(i.min.x-e.x)/t.x,s.copyFrom(t),s.scaleBy(r),s.addBy(e),i.containsYZ(s.y,s.z)))return!0}else if(e.x>i.max.x&&t.x<0&&(r=(i.max.x-e.x)/t.x,s.copyFrom(t),s.scaleBy(r),s.addBy(e),i.containsYZ(s.y,s.z)))return!0;if(e.y<i.min.y){if(t.y>0&&(r=(i.min.y-e.y)/t.y,s.copyFrom(t),s.scaleBy(r),s.addBy(e),i.containsXZ(s.x,s.z)))return!0}else if(e.y>i.max.y&&t.y<0&&(r=i.max.y,r=(i.max.y-e.y)/t.y,s.copyFrom(t),s.scaleBy(r),s.addBy(e),i.containsXZ(s.x,s.z)))return!0;if(e.z<i.min.z){if(t.z>0&&(r=(i.min.z-e.z)/t.z,s.copyFrom(t),s.scaleBy(r),s.addBy(e),i.containsXY(s.x,s.y)))return!0}else if(e.z>i.max.z&&t.z<0&&(r=(i.max.z-e.z)/t.z,s.copyFrom(t),s.scaleBy(r),s.addBy(e),i.containsXY(s.x,s.y)))return!0;return!1}}h.___pnV=new a.default,e.default=h}})}));