(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t():"function"===typeof define&&define.amd?define([],t):"object"===typeof exports?exports["ThreadCore"]=t():e["ThreadCore"]=t()})("undefined"!==typeof self?self:this,(function(){return function(e){var t={};function s(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,s),r.l=!0,r.exports}return s.m=e,s.c=t,s.d=function(e,t,a){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(a,r,function(t){return e[t]}.bind(null,r));return a},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s="fae3")}({"0e2f":function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const ThreadCMD_1=__webpack_require__("1e86"),ThreadCodeSrcType_1=__webpack_require__("d2d9"),DependenceGraph_1=__webpack_require__("9899");let TCMD=ThreadCMD_1.ThreadCMD,TCST=ThreadCodeSrcType_1.ThreadCodeSrcType,taskSlot=[],stList=[];class TaskHost{static Init(e){TaskHost.slot=new Array(e),TaskHost.stList=new Array(e),TaskHost.slot.fill(null),TaskHost.stList.fill(0),taskSlot=TaskHost.slot,stList=TaskHost.stList}}let dpGraph=new DependenceGraph_1.DependenceGraph;function getCurrTaskClass(){return dpGraph.currTaskClass}function setCurrTaskClass(e){dpGraph.currTaskClass=e}function resetCurrTaskClass(){dpGraph.currTaskClass=-1}function postMessageToThread(e,t){postMessage(e,t)}function registerDependency(e){dpGraph.registerDependency(e)}function useDependency(e){dpGraph.useDependency(e)}function bindExternModule(e){if(null!=e){const t=dpGraph.currTaskClass;if(!(t>=0))throw Error("bind extern module error task class value!!!!");TaskHost.slot[t]=e}}function initializeExternModule(e){if(null!=e){const t=dpGraph.currTaskClass;if(!(t>=0))throw Error("initialize extern module error task class value!!!!");TaskHost.slot[t]=e,postMessage({cmd:TCMD.INIT_TASK,taskclass:t}),dpGraph.currTaskClass=-1}}function acquireData(e,t,s){bindExternModule(e);let a={cmd:TCMD.THREAD_ACQUIRE_DATA,taskCmd:s,taskclass:dpGraph.currTaskClass,data:t};postMessage(a)}function transmitData(e,t,s,a){let r={cmd:TCMD.THREAD_TRANSMIT_DATA,taskCmd:s,taskclass:dpGraph.currTaskClass,data:t};void 0!=a&&null!=a?postMessage(r,a):postMessage(r)}exports.getCurrTaskClass=getCurrTaskClass,exports.setCurrTaskClass=setCurrTaskClass,exports.resetCurrTaskClass=resetCurrTaskClass,exports.postMessageToThread=postMessageToThread,exports.registerDependency=registerDependency,exports.useDependency=useDependency,exports.initializeExternModule=initializeExternModule,exports.acquireData=acquireData,exports.transmitData=transmitData;class ThreadCore{constructor(){this.m_inited=!0,this.m_threadIndex=0}receiveData(evt){let ins=null,data=evt.data;switch(data.cmd){case TCMD.DATA_PARSE:data.threadIndex=this.m_threadIndex,ins=taskSlot[data.taskclass],null!=ins&&ins.receiveData(data);break;case TCMD.THREAD_ACQUIRE_DATA:ins=taskSlot[data.taskclass],null!=ins&&ins.receiveData(data);break;case TCMD.INIT_TASK:let param=data.param,taskClass=data.info.taskClass;switch(param.type){case TCST.JS_FILE_CODE:stList[taskClass]<1&&(stList[taskClass]=1,dpGraph.loadProgramByModuleUrl(param.src,data.info));break;case TCST.DEPENDENCY:stList[taskClass]<1&&(stList[taskClass]=1,dpGraph.loadProgramByDependency(param.src,data.info));break;case TCST.BLOB_CODE:stList[taskClass]<1&&(stList[taskClass]=1);break;case TCST.STRING_CODE:if(stList[taskClass]<1)if(stList[taskClass]=1,dpGraph.currTaskClass=data.info.taskClass,void 0!=param.moduleName&&""!=param.moduleName){var mins="workerIns_"+param.moduleName,tmcodeStr="var "+mins+" = new "+param.moduleName+"();";tmcodeStr+="\ninitializeExternModule("+mins+");",param.src+="\n"+tmcodeStr,eval(param.src)}else eval(param.src);break;default:break}data.type<1?stList[taskClass]<1&&(stList[taskClass]=1,dpGraph.loadProgramByModuleUrl(param.taskName)):stList[taskClass]<1&&(stList[taskClass]=1);break;case TCMD.INIT_PARAM:this.m_inited&&(this.m_threadIndex=data.threadIndex,this.m_inited=!1,TaskHost.Init(data.total),dpGraph.graphData.initFromJsonString(data.graphJsonStr),postMessage({cmd:TCMD.INIT_PARAM,threadIndex:this.m_threadIndex}));break;case TCMD.INIT_COMMON_MODULE:switch(data.type){case TCST.JS_FILE_CODE:let e=data.modules;for(let s=0;s<e.length;++s)dpGraph.loadProgramByModuleUrl(e[s]);break;case TCST.STRING_CODE:let t=new Blob([data.src]);dpGraph.currTaskClass=data.info.taskClass,DependenceGraph_1.importJSModuleCode(URL.createObjectURL(t),data.info.keyuns);break;default:break}break;default:break}}initialize(){"undefined"!==typeof postMessage&&(self.addEventListener("message",this.receiveData.bind(this),!1),postMessage({cmd:TCMD.THREAD_INIT,threadIndex:-1}))}}exports.ThreadCore=ThreadCore;let ins=new ThreadCore;ins.initialize()},"1e86":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class a{}a.DATA_PARSE=3501,a.DATA_QUEUE_PARSE=3502,a.THREAD_INIT=3601,a.INIT_COMMON_MODULE=3621,a.THREAD_ACQUIRE_DATA=3631,a.THREAD_TRANSMIT_DATA=3632,a.INIT_TASK=3701,a.INIT_PARAM=3801,t.ThreadCMD=a},"1eb2":function(e,t,s){"use strict";if("undefined"!==typeof window){var a=window.document.currentScript,r=s("8875");a=r(),"currentScript"in document||Object.defineProperty(document,"currentScript",{get:r});var n=a&&a.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);n&&(s.p=n[1])}},8875:function(e,t,s){var a,r,n;(function(s,i){r=[],a=i,n="function"===typeof a?a.apply(t,r):a,void 0===n||(e.exports=n)})("undefined"!==typeof self&&self,(function(){function e(){var t=Object.getOwnPropertyDescriptor(document,"currentScript");if(!t&&"currentScript"in document&&document.currentScript)return document.currentScript;if(t&&t.get!==e&&document.currentScript)return document.currentScript;try{throw new Error}catch(f){var s,a,r,n=/.*at [^(]*\((.*):(.+):(.+)\)$/gi,i=/@([^@]*):(\d+):(\d+)\s*$/gi,o=n.exec(f.stack)||i.exec(f.stack),l=o&&o[1]||!1,d=o&&o[2]||!1,u=document.location.href.replace(document.location.hash,""),c=document.getElementsByTagName("script");l===u&&(s=document.documentElement.outerHTML,a=new RegExp("(?:[^\\n]+?\\n){0,"+(d-2)+"}[^<]*<script>([\\d\\D]*?)<\\/script>[\\d\\D]*","i"),r=s.replace(a,"$1").trim());for(var p=0;p<c.length;p++){if("interactive"===c[p].readyState)return c[p];if(c[p].src===l)return c[p];if(l===u&&c[p].innerHTML&&c[p].innerHTML.trim()===r)return c[p]}return null}}return e}))},9899:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let a="",r="function"===typeof importScripts;if(r){a=self.location.href;var n=importScripts}else if("undefined"!==typeof document){a=document.location.href;n=e=>{}}function i(e,t){try{n(e)}catch(s){}}t.importJSModuleCode=i;let o=a.slice(0,a.lastIndexOf("/")+1),l=o.indexOf("http://");function d(e){if(""==e)throw Error("js file url is empty !!!");let t=e.indexOf("://");return t>0?e:o+e}l<0&&(l=o.indexOf("https://")),l<0&&(l=0),o=o.slice(l);class u{constructor(e,t,s){this.includes=null,this.uniqueName=e,this.index=t,this.path=s}}class c{constructor(){this.m_nodes=[],this.m_map=new Map}initFromJsonString(e){if(void 0!=e&&""!=e){let t,s=JSON.parse(e);this.m_nodes=[];for(let e=0;e<s.nodes.length;++e){const a=s.nodes[e];t=new u(a.uniqueName,e,a.path),this.m_nodes.push(t),this.m_map.set(a.uniqueName,t)}let a=s.maps;for(let e=0;e<a.length;++e){const s=a[e];t=this.m_map.get(s.uniqueName),t.includes=s.includes.slice(0)}}}getNodeUniqueName(e){return this.m_map.get(e)}getNodeAt(e){if(e>=0&&e<this.m_nodes.length)return this.m_nodes[e]}getPathByUniqueName(e){if(this.m_map.has(e)){let t=this.m_map.get(e);return t.path}return""}}let p=new c,f=new Map,m=new Map,h=[];function T(e){let t=p.getNodeUniqueName(e.getUniqueName());if(null!=t&&null!=t.includes){let e=t.includes,s=e.length,a=0;for(;a<s;++a){const t=p.getNodeAt(e[a]);if(!f.has(t.index))break}return a>=s}return!0}let _=-1;function C(){if(_>-1&&clearTimeout(_),h.length>0){let e=h,t=0,s=e.length,a=null;for(;t<s;++t)a=e[t],T(a)&&(e.splice(t,1),t--,s--,m.delete(a.getUniqueName()),a.dependencyFinish());e.length>0&&(_=setTimeout(C,105))}}class k{constructor(){this.m_programMap=new Map,this.m_taskInfoMap=new Map,this.graphData=p,this.currTaskClass=-1}useDependency(e){if(T(e)){if(m.has(e.getUniqueName())){for(let t=0;t<h.length;++t)if(e==h[t]){h.splice(t,1);break}m.delete(e.getUniqueName())}e.dependencyFinish()}else if(!m.has(e.getUniqueName())){let t=p.getNodeUniqueName(e.getUniqueName());if(null!=t&&null!=t.includes){m.set(e.getUniqueName(),1);let s=t.includes,a=s.length,r=0,n=!1;for(;r<a;++r){const e=p.getNodeAt(s[r]);f.has(e.index)||(n=!0,this.loadProgramByDependency(e.uniqueName))}if(n){let t=h.length;h.push(e),t<1&&C()}}}}registerDependency(e){if(null!=e)for(let t=0;t<e.length;++t){const s=p.getNodeUniqueName(e[t]);f.set(s.index,1)}}loadProgramByDependency(e,t=null){""!=e&&this.loadProgramByModuleUrl(p.getPathByUniqueName(e),t)}loadProgram(e,t){if(""!=e&&!this.m_programMap.has(e)){this.m_programMap.set(e,1),null!=t&&t.taskClass>-1&&!this.m_taskInfoMap.has(e)&&this.m_taskInfoMap.set(e,t);let s=new XMLHttpRequest;s.open("GET",e,!0),s.onload=()=>{if(s.status<=206){let t=new Blob([s.responseText],{type:"text/javascript"}),a=this.m_taskInfoMap.has(e)?this.m_taskInfoMap.get(e):null;this.currTaskClass=null!=a?a.taskClass:-1,i(URL.createObjectURL(t),e)}},s.onerror=e=>{},s.send(null)}}loadProgramByModuleUrl(e,t=null){e=d(e),this.loadProgram(e,t)}destroy(){}}t.DependenceGraph=k},d2d9:function(e,t,s){"use strict";var a;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e["STRING_CODE"]=0]="STRING_CODE",e[e["BLOB_CODE"]=1]="BLOB_CODE",e[e["JS_FILE_CODE"]=2]="JS_FILE_CODE",e[e["DEPENDENCY"]=3]="DEPENDENCY"}(a||(a={})),t.ThreadCodeSrcType=a},fae3:function(e,t,s){"use strict";s.r(t);s("1eb2");var a=s("0e2f");for(var r in a)["default"].indexOf(r)<0&&function(e){s.d(t,e,(function(){return a[e]}))}(r)}})}));