(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t():"function"===typeof define&&define.amd?define([],t):"object"===typeof exports?exports["ThreadCore"]=t():e["ThreadCore"]=t()})("undefined"!==typeof self?self:this,(function(){return function(e){var t={};function a(s){if(t[s])return t[s].exports;var r=t[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,a),r.l=!0,r.exports}return a.m=e,a.c=t,a.d=function(e,t,s){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(a.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(s,r,function(t){return e[t]}.bind(null,r));return s},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s="fae3")}({"0e2f":function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const ThreadCMD_1=__webpack_require__("1e86"),ThreadCodeSrcType_1=__webpack_require__("d2d9"),DependenceGraph_1=__webpack_require__("9899");let TCMD=ThreadCMD_1.ThreadCMD,TCST=ThreadCodeSrcType_1.ThreadCodeSrcType,taskSlot=[],stList=[];class TaskHost{static Init(e){TaskHost.slot=new Array(e),TaskHost.stList=new Array(e),TaskHost.slot.fill(null),TaskHost.stList.fill(0),taskSlot=TaskHost.slot,stList=TaskHost.stList}}let dpGraph=new DependenceGraph_1.DependenceGraph;function postMessageToThread(e,t){postMessage(e,t)}function registerDependency(e){dpGraph.registerDependency(e)}function useDependency(e){dpGraph.useDependency(e)}function bindExternModule(e){null!=e&&void 0!=e.getTaskClass&&(TaskHost.slot[e.getTaskClass()]=e)}function initializeExternModule(e){null!=e&&void 0!=e.getTaskClass&&(TaskHost.slot[e.getTaskClass()]=e,dpGraph.currTaskClass=-1,postMessage({cmd:TCMD.INIT_TASK,taskclass:e.getTaskClass()}))}function acquireData(e,t,a){bindExternModule(e);let s={cmd:TCMD.THREAD_ACQUIRE_DATA,taskCmd:a,taskclass:e.getTaskClass(),data:t};postMessage(s)}function transmitData(e,t,a,s){let r={cmd:TCMD.THREAD_TRANSMIT_DATA,taskCmd:a,taskclass:e.getTaskClass(),data:t};void 0!=s&&null!=s?postMessage(r,s):postMessage(r)}exports.postMessageToThread=postMessageToThread,exports.registerDependency=registerDependency,exports.useDependency=useDependency,exports.initializeExternModule=initializeExternModule,exports.acquireData=acquireData,exports.transmitData=transmitData;class ThreadCore{constructor(){this.m_inited=!0,this.m_threadIndex=0}receiveData(evt){let ins=null,data=evt.data;switch(data.cmd){case TCMD.DATA_PARSE:data.threadIndex=this.m_threadIndex,ins=taskSlot[data.taskclass],null!=ins&&ins.receiveData(data);break;case TCMD.THREAD_ACQUIRE_DATA:ins=taskSlot[data.taskclass],null!=ins&&ins.receiveData(data);break;case TCMD.INIT_TASK:let param=data.param;switch(param.type){case TCST.JS_FILE_CODE:stList[param.taskclass]<1&&(stList[param.taskclass]=1,dpGraph.loadProgramByModuleUrl(param.src,data.info));break;case TCST.DEPENDENCY:stList[param.taskclass]<1&&(stList[param.taskclass]=1,dpGraph.loadProgramByDependency(param.src,data.info));break;case TCST.BLOB_CODE:stList[param.taskclass]<1&&(stList[param.taskclass]=1);break;case TCST.STRING_CODE:if(stList[param.taskclass]<1)if(stList[param.taskclass]=1,dpGraph.currTaskClass=data.info.taskClass,void 0!=param.moduleName&&""!=param.moduleName){var mins="workerIns_"+param.moduleName,tmcodeStr="var "+mins+" = new "+param.moduleName+"();";tmcodeStr+="\ninitializeExternModule("+mins+");",param.src+="\n"+tmcodeStr,eval(param.src)}else eval(param.src);break;default:break}data.type<1?stList[param.taskclass]<1&&(stList[param.taskclass]=1,dpGraph.loadProgramByModuleUrl(param.taskName)):stList[param.taskclass]<1&&(stList[param.taskclass]=1);break;case TCMD.INIT_PARAM:this.m_inited&&(this.m_threadIndex=data.threadIndex,this.m_inited=!1,TaskHost.Init(data.total),dpGraph.graphData.initFromJsonString(data.graphJsonStr),postMessage({cmd:TCMD.INIT_PARAM,threadIndex:this.m_threadIndex}));break;case TCMD.INIT_COMMON_MODULE:switch(data.type){case TCST.JS_FILE_CODE:let e=data.modules;for(let a=0;a<e.length;++a)dpGraph.loadProgramByModuleUrl(e[a]);break;case TCST.STRING_CODE:let t=new Blob([data.src]);dpGraph.currTaskClass=data.info.taskClass,DependenceGraph_1.importJSModuleCode(URL.createObjectURL(t),data.info.keyuns);break;default:break}break;default:break}}initialize(){"undefined"!==typeof postMessage&&(self.addEventListener("message",this.receiveData.bind(this),!1),postMessage({cmd:TCMD.THREAD_INIT,threadIndex:-1}))}}exports.ThreadCore=ThreadCore;let ins=new ThreadCore;ins.initialize()},"1e86":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{}s.DATA_PARSE=3501,s.DATA_QUEUE_PARSE=3502,s.THREAD_INIT=3601,s.INIT_COMMON_MODULE=3621,s.THREAD_ACQUIRE_DATA=3631,s.THREAD_TRANSMIT_DATA=3632,s.INIT_TASK=3701,s.INIT_PARAM=3801,t.ThreadCMD=s},"1eb2":function(e,t,a){"use strict";if("undefined"!==typeof window){var s=window.document.currentScript,r=a("8875");s=r(),"currentScript"in document||Object.defineProperty(document,"currentScript",{get:r});var n=s&&s.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);n&&(a.p=n[1])}},8875:function(e,t,a){var s,r,n;(function(a,i){r=[],s=i,n="function"===typeof s?s.apply(t,r):s,void 0===n||(e.exports=n)})("undefined"!==typeof self&&self,(function(){function e(){var t=Object.getOwnPropertyDescriptor(document,"currentScript");if(!t&&"currentScript"in document&&document.currentScript)return document.currentScript;if(t&&t.get!==e&&document.currentScript)return document.currentScript;try{throw new Error}catch(m){var a,s,r,n=/.*at [^(]*\((.*):(.+):(.+)\)$/gi,i=/@([^@]*):(\d+):(\d+)\s*$/gi,o=n.exec(m.stack)||i.exec(m.stack),d=o&&o[1]||!1,l=o&&o[2]||!1,c=document.location.href.replace(document.location.hash,""),u=document.getElementsByTagName("script");d===c&&(a=document.documentElement.outerHTML,s=new RegExp("(?:[^\\n]+?\\n){0,"+(l-2)+"}[^<]*<script>([\\d\\D]*?)<\\/script>[\\d\\D]*","i"),r=a.replace(s,"$1").trim());for(var p=0;p<u.length;p++){if("interactive"===u[p].readyState)return u[p];if(u[p].src===d)return u[p];if(d===c&&u[p].innerHTML&&u[p].innerHTML.trim()===r)return u[p]}return null}}return e}))},9899:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let s="",r="function"===typeof importScripts;if(r){s=self.location.href;var n=importScripts}else if("undefined"!==typeof document){s=document.location.href;n=e=>{}}function i(e,t){try{n(e)}catch(a){}}t.importJSModuleCode=i;let o=s.slice(0,s.lastIndexOf("/")+1),d=o.indexOf("http://");function l(e){if(""==e)throw Error("js file url is empty !!!");let t=e.indexOf("://");return t>0?e:o+e}d<0&&(d=o.indexOf("https://")),d<0&&(d=0),o=o.slice(d);class c{constructor(e,t,a){this.includes=null,this.uniqueName=e,this.index=t,this.path=a}}class u{constructor(){this.m_nodes=[],this.m_map=new Map}initFromJsonString(e){if(void 0!=e&&""!=e){let t,a=JSON.parse(e);this.m_nodes=[];for(let e=0;e<a.nodes.length;++e){const s=a.nodes[e];t=new c(s.uniqueName,e,s.path),this.m_nodes.push(t),this.m_map.set(s.uniqueName,t)}let s=a.maps;for(let e=0;e<s.length;++e){const a=s[e];t=this.m_map.get(a.uniqueName),t.includes=a.includes.slice(0)}}}getNodeUniqueName(e){return this.m_map.get(e)}getNodeAt(e){if(e>=0&&e<this.m_nodes.length)return this.m_nodes[e]}getPathByUniqueName(e){if(this.m_map.has(e)){let t=this.m_map.get(e);return t.path}return""}}let p=new u,m=new Map,f=new Map,h=[];function T(e){let t=p.getNodeUniqueName(e.getUniqueName());if(null!=t&&null!=t.includes){let e=t.includes,a=e.length,s=0;for(;s<a;++s){const t=p.getNodeAt(e[s]);if(!m.has(t.index))break}return s>=a}return!0}let _=-1;function g(){if(_>-1&&clearTimeout(_),h.length>0){let e=h,t=0,a=e.length,s=null;for(;t<a;++t)s=e[t],T(s)&&(e.splice(t,1),t--,a--,f.delete(s.getUniqueName()),s.dependencyFinish());e.length>0&&(_=setTimeout(g,105))}}class D{constructor(){this.m_programMap=new Map,this.m_taskInfoMap=new Map,this.graphData=p,this.currTaskClass=-1}useDependency(e){if(T(e)){if(f.has(e.getUniqueName())){for(let t=0;t<h.length;++t)if(e==h[t]){h.splice(t,1);break}f.delete(e.getUniqueName())}e.dependencyFinish()}else if(!f.has(e.getUniqueName())){let t=p.getNodeUniqueName(e.getUniqueName());if(null!=t&&null!=t.includes){f.set(e.getUniqueName(),1);let a=t.includes,s=a.length,r=0,n=!1;for(;r<s;++r){const e=p.getNodeAt(a[r]);m.has(e.index)||(n=!0,this.loadProgramByDependency(e.uniqueName))}if(n){let t=h.length;h.push(e),t<1&&g()}}}}registerDependency(e){if(null!=e)for(let t=0;t<e.length;++t){const a=p.getNodeUniqueName(e[t]);m.set(a.index,1)}}loadProgramByDependency(e,t=null){""!=e&&this.loadProgramByModuleUrl(p.getPathByUniqueName(e),t)}loadProgram(e,t){if(""!=e&&!this.m_programMap.has(e)){this.m_programMap.set(e,1),null!=t&&t.taskClass>-1&&!this.m_taskInfoMap.has(e)&&this.m_taskInfoMap.set(e,t);let a=new XMLHttpRequest;a.open("GET",e,!0),a.onload=()=>{if(a.status<=206){let t=new Blob([a.responseText]),s=this.m_taskInfoMap.has(e)?this.m_taskInfoMap.get(e):null;this.currTaskClass=null!=s?s.taskClass:-1,i(URL.createObjectURL(t),e)}},a.onerror=e=>{},a.send(null)}}loadProgramByModuleUrl(e,t=null){e=l(e),this.loadProgram(e,t)}destroy(){}}t.DependenceGraph=D},d2d9:function(e,t,a){"use strict";var s;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e["STRING_CODE"]=0]="STRING_CODE",e[e["BLOB_CODE"]=1]="BLOB_CODE",e[e["JS_FILE_CODE"]=2]="JS_FILE_CODE",e[e["DEPENDENCY"]=3]="DEPENDENCY"}(s||(s={})),t.ThreadCodeSrcType=s},fae3:function(e,t,a){"use strict";a.r(t);a("1eb2");var s=a("0e2f");for(var r in s)["default"].indexOf(r)<0&&function(e){a.d(t,e,(function(){return s[e]}))}(r)}})}));