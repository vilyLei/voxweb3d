(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t():"function"===typeof define&&define.amd?define([],t):"object"===typeof exports?exports["ThreadCore"]=t():e["ThreadCore"]=t()})("undefined"!==typeof self?self:this,(function(){return function(e){var t={};function a(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,a),s.l=!0,s.exports}return a.m=e,a.c=t,a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)a.d(r,s,function(t){return e[t]}.bind(null,s));return r},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s="fae3")}({"0e2f":function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const ThreadCMD_1=__webpack_require__("1e86"),ThreadCodeSrcType_1=__webpack_require__("d2d9"),DependenceGraph_1=__webpack_require__("9899");let TCMD=ThreadCMD_1.ThreadCMD,TCST=ThreadCodeSrcType_1.ThreadCodeSrcType;class TaskHost{}TaskHost.slot=new Array(__$tstl),TaskHost.stList=new Array(__$tstl);let taskSlot=TaskHost.slot,stList=TaskHost.stList;taskSlot.fill(null),stList.fill(0);let dpGraph=new DependenceGraph_1.DependenceGraph;function postMessageToThread(e,t){postMessage(e,t)}function registerDependency(e){dpGraph.registerDependency(e)}function useDependency(e){dpGraph.useDependency(e)}function bindExternModule(e){null!=e&&void 0!=e.getTaskClass&&(TaskHost.slot[e.getTaskClass()]=e)}function initializeExternModule(e){null!=e&&void 0!=e.getTaskClass&&(TaskHost.slot[e.getTaskClass()]=e,postMessage({cmd:TCMD.INIT_TASK,taskclass:e.getTaskClass()}))}function acquireData(e,t,a){bindExternModule(e);let r={cmd:TCMD.THREAD_ACQUIRE_DATA,taskCmd:a,taskclass:e.getTaskClass(),data:t};postMessage(r)}function transmitData(e,t,a,r){let s={cmd:TCMD.THREAD_TRANSMIT_DATA,taskCmd:a,taskclass:e.getTaskClass(),data:t};void 0!=r&&null!=r?postMessage(s,r):postMessage(s)}exports.postMessageToThread=postMessageToThread,exports.registerDependency=registerDependency,exports.useDependency=useDependency,exports.initializeExternModule=initializeExternModule,exports.acquireData=acquireData,exports.transmitData=transmitData;class Main{constructor(){this.m_inited=!0,this.m_threadIndex=0}receiveData(evt){let ins=null,data=evt.data;switch(data.cmd){case TCMD.DATA_PARSE:data.threadIndex=this.m_threadIndex,ins=taskSlot[data.taskclass],null!=ins&&ins.receiveData(data);break;case TCMD.THREAD_ACQUIRE_DATA:ins=taskSlot[data.taskclass],null!=ins&&ins.receiveData(data);break;case TCMD.INIT_TASK:let param=data.param;switch(param.type){case TCST.JS_FILE_CODE:stList[param.taskclass]<1&&(stList[param.taskclass]=1,dpGraph.loadProgramByModuleUrl(param.src));break;case TCST.DEPENDENCY:stList[param.taskclass]<1&&(stList[param.taskclass]=1,dpGraph.loadProgramByDependency(param.src));break;case TCST.BLOB_CODE:stList[param.taskclass]<1&&(stList[param.taskclass]=1);break;case TCST.STRING_CODE:if(stList[param.taskclass]<1&&(stList[param.taskclass]=1,eval(param.src),void 0!=param.moduleName&&""!=param.moduleName)){var mins="workerIns_"+param.moduleName,tmcodeStr="var "+mins+" = new "+param.moduleName+"();";tmcodeStr+="\ninitializeExternModule("+mins+");",eval(tmcodeStr)}break;default:break}data.type<1?stList[param.taskclass]<1&&(stList[param.taskclass]=1,dpGraph.loadProgramByModuleUrl(param.taskName)):stList[param.taskclass]<1&&(stList[param.taskclass]=1);break;case TCMD.INIT_PARAM:this.m_inited&&(this.m_threadIndex=data.threadIndex,this.m_inited=!1,dpGraph.graphData.initFromJsonString(data.graphJsonStr),postMessage({cmd:TCMD.INIT_PARAM,threadIndex:this.m_threadIndex}));break;case TCMD.INIT_COMMON_MODULE:switch(data.type){case TCST.JS_FILE_CODE:let e=data.modules;for(let a=0;a<e.length;++a)dpGraph.loadProgramByModuleUrl(e[a]);break;case TCST.STRING_CODE:let t=new Blob([data.src]);importScripts(URL.createObjectURL(t));break;default:break}break;default:break}}initialize(){"undefined"!==typeof postMessage&&(self.addEventListener("message",this.receiveData.bind(this),!1),postMessage({cmd:TCMD.THREAD_INIT,threadIndex:-1}))}}exports.Main=Main;let ins=new Main;ins.initialize()},"1e86":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{}r.DATA_PARSE=3501,r.DATA_QUEUE_PARSE=3502,r.THREAD_INIT=3601,r.INIT_COMMON_MODULE=3621,r.THREAD_ACQUIRE_DATA=3631,r.THREAD_TRANSMIT_DATA=3632,r.INIT_TASK=3701,r.INIT_PARAM=3801,t.ThreadCMD=r},"1eb2":function(e,t,a){"use strict";if("undefined"!==typeof window){var r=window.document.currentScript,s=a("8875");r=s(),"currentScript"in document||Object.defineProperty(document,"currentScript",{get:s});var n=r&&r.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);n&&(a.p=n[1])}},8875:function(e,t,a){var r,s,n;(function(a,i){s=[],r=i,n="function"===typeof r?r.apply(t,s):r,void 0===n||(e.exports=n)})("undefined"!==typeof self&&self,(function(){function e(){var t=Object.getOwnPropertyDescriptor(document,"currentScript");if(!t&&"currentScript"in document&&document.currentScript)return document.currentScript;if(t&&t.get!==e&&document.currentScript)return document.currentScript;try{throw new Error}catch(m){var a,r,s,n=/.*at [^(]*\((.*):(.+):(.+)\)$/gi,i=/@([^@]*):(\d+):(\d+)\s*$/gi,o=n.exec(m.stack)||i.exec(m.stack),d=o&&o[1]||!1,c=o&&o[2]||!1,l=document.location.href.replace(document.location.hash,""),u=document.getElementsByTagName("script");d===l&&(a=document.documentElement.outerHTML,r=new RegExp("(?:[^\\n]+?\\n){0,"+(c-2)+"}[^<]*<script>([\\d\\D]*?)<\\/script>[\\d\\D]*","i"),s=a.replace(r,"$1").trim());for(var p=0;p<u.length;p++){if("interactive"===u[p].readyState)return u[p];if(u[p].src===d)return u[p];if(d===l&&u[p].innerHTML&&u[p].innerHTML.trim()===s)return u[p]}return null}}return e}))},9899:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let r="",s="function"===typeof importScripts;if(s){r=self.location.href;var n=importScripts}else if("undefined"!==typeof document){r=document.location.href;n=e=>{}}let i=r.slice(0,r.lastIndexOf("/")+1),o=i.indexOf("http://");function d(e){if(""==e)throw Error("js file url is empty !!!");let t=e.indexOf("://");return t>0?(e.indexOf(".js")<0&&(e+=".js"),e):(e=i+e,e.indexOf(".js")<0&&(e+=".js"),e)}o<0&&(o=i.indexOf("https://")),o<0&&(o=0),i=i.slice(o);class c{constructor(e,t,a){this.includes=null,this.uniqueName=e,this.index=t,this.path=a}}class l{constructor(){this.m_nodes=[],this.m_map=new Map}initFromJsonString(e){if(void 0!=e&&""!=e){let t,a=JSON.parse(e);this.m_nodes=[];for(let e=0;e<a.nodes.length;++e){const r=a.nodes[e];t=new c(r.uniqueName,e,r.path),this.m_nodes.push(t),this.m_map.set(r.uniqueName,t)}let r=a.maps;for(let e=0;e<r.length;++e){const a=r[e];t=this.m_map.get(a.uniqueName),t.includes=a.includes.slice(0)}}}getNodeUniqueName(e){return this.m_map.get(e)}getNodeAt(e){if(e>=0&&e<this.m_nodes.length)return this.m_nodes[e]}getPathByUniqueName(e){if(this.m_map.has(e)){let t=this.m_map.get(e);return t.path}return""}}let u=new l,p=new Map,m=new Map,f=[];function h(e){let t=u.getNodeUniqueName(e.getUniqueName());if(null!=t&&null!=t.includes){let e=t.includes,a=e.length,r=0;for(;r<a;++r){const t=u.getNodeAt(e[r]);if(!p.has(t.index))break}return r>=a}return!0}let _=-1;function T(){if(_>-1&&clearTimeout(_),f.length>0){let e=f,t=0,a=e.length,r=null;for(;t<a;++t)r=e[t],h(r)&&(e.splice(t,1),t--,a--,m.delete(r.getUniqueName()),r.dependencyFinish());e.length>0&&(_=setTimeout(T,105))}}class g{constructor(){this.m_programMap=new Map,this.graphData=u}useDependency(e){if(h(e)){if(m.has(e.getUniqueName())){for(let t=0;t<f.length;++t)if(e==f[t]){f.splice(t,1);break}m.delete(e.getUniqueName())}e.dependencyFinish()}else if(!m.has(e.getUniqueName())){let t=u.getNodeUniqueName(e.getUniqueName());if(null!=t&&null!=t.includes){m.set(e.getUniqueName(),1);let a=t.includes,r=a.length,s=0,n=!1;for(;s<r;++s){const e=u.getNodeAt(a[s]);p.has(e.index)||(n=!0,this.loadProgramByDependency(e.uniqueName))}if(n){let t=f.length;f.push(e),t<1&&T()}}}}registerDependency(e){if(null!=e)for(let t=0;t<e.length;++t){const a=u.getNodeUniqueName(e[t]);p.set(a.index,1)}}loadProgramByDependency(e){""!=e&&this.loadProgramByModuleUrl(u.getPathByUniqueName(e))}loadProgram(e){""!=e&&(this.m_programMap.has(e)||(this.m_programMap.set(e,1),n(e)))}loadProgramByModuleUrl(e){e=d(e),this.loadProgram(e)}destroy(){}}t.DependenceGraph=g},d2d9:function(e,t,a){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e["STRING_CODE"]=0]="STRING_CODE",e[e["BLOB_CODE"]=1]="BLOB_CODE",e[e["JS_FILE_CODE"]=2]="JS_FILE_CODE",e[e["DEPENDENCY"]=3]="DEPENDENCY"}(r||(r={})),t.ThreadCodeSrcType=r},fae3:function(e,t,a){"use strict";a.r(t);a("1eb2");var r=a("0e2f");for(var s in r)["default"].indexOf(s)<0&&function(e){a.d(t,e,(function(){return r[e]}))}(s)}})}));