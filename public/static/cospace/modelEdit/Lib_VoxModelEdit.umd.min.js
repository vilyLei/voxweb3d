(function(t,e){"object"===typeof exports&&"object"===typeof module?module.exports=e():"function"===typeof define&&define.amd?define([],e):"object"===typeof exports?exports["Lib_VoxModelEdit"]=e():t["Lib_VoxModelEdit"]=e()})("undefined"!==typeof self?self:this,(function(){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(s,r,function(e){return t[e]}.bind(null,r));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s="fae3")}({"0148":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("832f"),r=i("b633"),n=i("aae9");class o extends n.MoveCtr{constructor(){super(),this.m_entity=null,this.m_cone=null,this.tv=CoMath.createVec3(1,0,0),this.coneTransMat4=CoMath.createMat4(),this.innerSphereRadius=30,this.coneScale=1,this.m_line_pv=CoMath.createVec3(),this.m_initPos=CoMath.createVec3(),this.m_pos=CoMath.createVec3(),this.m_dv=CoMath.createVec3(),this.m_outV=CoMath.createVec3(),this.m_initV=CoMath.createVec3(),this.m_mat4=CoMath.createMat4(),this.m_invMat4=CoMath.createMat4(),this.m_rpv=CoMath.createVec3(),this.m_rtv=CoMath.createVec3()}initialize(t=100,e=0){if(null==this.m_entity){let i=this.pickTestRadius;CoMesh.line.dynColorEnabled=!0;let n=CoMaterial.createLineMaterial(!0);CoMesh.line.setBufSortFormat(n.getBufSortFormat());let o=this.tv.clone().scaleBy(e),a=this.tv.clone().scaleBy(t),l=CoMesh.line.createLine(o,a,i);if(this.m_entity=CoEntity.createDisplayEntity(),this.m_entity.setMaterial(n),this.m_entity.setMesh(l),l){let t=new r.DashedLineRayTester(l.getVS(),1,i);t.setPrevTester(new s.SphereRayTester(this.innerSphereRadius)),l.setRayTester(t)}this.applyEvent(this.m_entity);const h=CoMesh.cone;n=CoMaterial.createDefaultMaterial(),n.initializeByCodeBuf(!1),h.setBufSortFormat(n.getBufSortFormat()),h.transMatrix=this.coneTransMat4,l=h.create(.5*this.coneScale*i,1.5*this.coneScale*i,10,0),this.m_cone=CoEntity.createDisplayEntity(),this.m_cone.setMaterial(n),this.m_cone.setMesh(l),this.applyEvent(this.m_cone)}}getCone(){return this.m_cone}getEntity(){return this.m_entity}setVisible(t){return this.m_entity.setVisible(t),this.m_cone.setVisible(t),this}getVisible(){return this.m_entity.getVisible()}showOverColor(){this.setEntityColor(this.m_entity,this.overColor),this.setEntityColor(this.m_cone,this.overColor)}showOutColor(){this.setEntityColor(this.m_entity,this.outColor),this.setEntityColor(this.m_cone,this.outColor)}enable(){super.enable(),this.m_entity.mouseEnabled=!0,this.m_cone.mouseEnabled=!0}disable(){super.disable(),this.m_entity.mouseEnabled=!1,this.m_cone.mouseEnabled=!1}destroy(){super.destroy(),this.m_entity&&(this.m_entity.destroy(),this.m_entity=null),this.m_cone&&(this.m_cone.destroy(),this.m_cone=null)}calcClosePos(t,e){if(this.isSelected()){let i=this.m_invMat4;i.transformVector3Self(t),i.deltaTransformVectorSelf(e);const s=this.m_outV;CoAGeom.Line.CalcTwoSLCloseV2(t,e,this.m_line_pv,this.tv,s),i=this.m_mat4,i.transformVector3Self(s)}}moveByRay(t,e,i=!1){this.isEnabled()&&this.isSelected()&&(this.m_rpv.copyFrom(t),this.m_rtv.copyFrom(e),this.calcClosePos(this.m_rpv,this.m_rtv),this.m_dv.copyFrom(this.m_outV),this.m_dv.subtractBy(this.m_initV),this.m_pos.copyFrom(this.m_initPos),this.m_pos.addBy(this.m_dv),this.m_target&&(this.m_target.setPosition(this.m_pos),this.m_target.update()))}mouseDownListener(t){if(this.isEnabled()){this.editBegin(),this.setThisVisible(!0),this.m_target.select(this);const e=this.m_entity.getTransform();this.m_mat4.copyFrom(e.getMatrix()),this.m_invMat4.copyFrom(e.getInvMatrix()),this.m_rpv.copyFrom(t.raypv),this.m_rtv.copyFrom(t.raytv),this.calcClosePos(this.m_rpv,this.m_rtv),this.m_initV.copyFrom(this.m_outV),this.m_target.getPosition(this.m_initPos)}}}e.DragLine=o},"0b69":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("abf9");class r extends s.ScaleCtr{constructor(){super(),this.m_entity=null,this.m_frameEntity=null,this.offsetV=CoMath.createVec3(30,30,30),this.m_planeAxisType=0,this.m_planeNV=CoMath.createVec3(0,1,0),this.m_planePos=CoMath.createVec3(),this.m_planeDis=0,this.m_pos=CoMath.createVec3(),this.m_dv=CoMath.createVec3(),this.m_outV=CoMath.createVec3(),this.m_rpv=CoMath.createVec3(),this.m_rtv=CoMath.createVec3(),this.m_sv=CoMath.createVec3(),this.m_dis=1,this.m_initNV=CoMath.createVec3()}initialize(t,e,i,s){if(null==this.m_entity){this.m_editRS=t,this.m_container=e;const r=CoMath.Vector3D;let n=CoRScene.createDefaultMaterial();n.initializeByCodeBuf(!1),this.m_entity=CoRScene.createDisplayEntity(),this.m_frameEntity=CoRScene.createDisplayEntity();let o=CoMesh.line;o.dynColorEnabled=!0;let a=CoMaterial.createLineMaterial(o.dynColorEnabled);a.initializeByCodeBuf(!1),o.setBufSortFormat(n.getBufSortFormat());let l=this.m_frameEntity;l.setMaterial(a);let h=this.m_entity;h.setMaterial(n);let c=CoMesh.plane;c.setBufSortFormat(n.getBufSortFormat());let m=this.offsetV;switch(this.m_planeAxisType=i,i){case 0:h.setMesh(c.createXOZ(m.x,m.z,s,s)),l.setMesh(o.createRectXOZ(m.x,m.z,s,s)),this.setPlaneNormal(r.Y_AXIS);break;case 1:h.setMesh(c.createXOY(m.x,m.y,s,s)),l.setMesh(o.createRectXOY(m.x,m.y,s,s)),this.setPlaneNormal(r.Z_AXIS);break;case 2:h.setMesh(c.createYOZ(m.y,m.z,s,s)),l.setMesh(o.createRectYOZ(m.y,m.z,s,s)),this.setPlaneNormal(CoMath.Vector3D.X_AXIS);break;default:throw Error("Error type !!!")}h.setRenderState(CoRScene.RendererState.NONE_TRANSPARENT_STATE),this.m_container.addEntity(h),this.m_container.addEntity(l),this.showOutColor(),this.applyEvent(this.m_entity)}}mouseOverListener(t){this.showOverColor()}mouseOutListener(t){this.showOutColor()}showOverColor(){this.setEntityColor(this.m_entity,this.overColor),this.setEntityColor(this.m_frameEntity,this.overColor,.7)}showOutColor(){this.setEntityColor(this.m_entity,this.outColor),this.setEntityColor(this.m_frameEntity,this.outColor,.7)}enable(){super.enable(),this.m_entity.mouseEnabled=!0}disable(){super.disable(),this.m_entity.mouseEnabled=!1}setRenderState(t){this.m_entity.setRenderState(t)}setVisible(t){return this.m_entity.setVisible(t),this.m_frameEntity.setVisible(t),this}getVisible(){return this.m_entity.getVisible()}destroy(){super.destroy(),this.m_container&&(this.m_container.removeEntity(this.m_entity),this.m_container.removeEntity(this.m_frameEntity)),this.m_entity&&this.m_entity.destroy(),this.m_frameEntity&&this.m_frameEntity.destroy(),this.m_entity=null,this.m_frameEntity=null,this.m_editRS=null,this.m_container=null}calcClosePos(t,e){CoAGeom.PlaneUtils.IntersectLinePos2(this.m_planeNV,this.m_planeDis,t,e,this.m_outV)}moveByRay(t,e,i=!1){if(this.isEnabled()&&this.isSelected()){this.m_rpv.copyFrom(t),this.m_rtv.copyFrom(e),this.calcClosePos(this.m_rpv,this.m_rtv);let i=CoMath.Vector3D,s=i.Distance(this.m_pos,this.m_outV);s<1&&(s=1);const r=this.m_sv;let n=1,o=1,a=1,l=s/this.m_dis,h=this.m_planeAxisType;0==h?(n=l,a=l):1==h?(n=l,o=l):(o=l,a=l),null!=this.m_target&&(this.m_target.setScaleXYZ(r.x*n,r.y*o,r.z*a),this.m_target.update())}}setPlaneNormal(t){this.m_planeNV.copyFrom(t),this.m_planeNV.normalize(),this.m_initNV.copyFrom(this.m_planeNV)}selectByParam(t,e,i){this.m_rpv.copyFrom(t),this.m_rtv.copyFrom(e),this.m_planePos.copyFrom(i),this.m_planeNV.copyFrom(this.m_initNV);let s=this.m_entity.getMatrix();s.deltaTransformVectorSelf(this.m_planeNV),this.m_planeNV.normalize(),this.m_planeDis=this.m_planePos.dot(this.m_planeNV),this.calcClosePos(this.m_rpv,this.m_rtv),this.m_target.getPosition(this.m_dv),this.m_dv.subtractBy(this.m_outV)}mouseDownListener(t){if(this.isEnabled()){this.editBegin(),this.setThisVisible(!0),this.m_target.select(),this.selectByParam(t.raypv,t.raytv,t.wpos),this.m_target.getScaleXYZ(this.m_sv),this.m_target.getPosition(this.m_pos);let e=CoMath.Vector3D;this.m_dis=e.Distance(this.m_pos,this.m_outV),this.m_dis<1&&(this.m_dis=1)}}}e.default=r},"141a":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.m_controllers=[],this.m_tars=null,this.m_vs=[],this.m_flags=[],this.m_changed=!1,this.m_v3=CoMath.createVec3(),this.valueFilter=null,this.type=-1,this.rotation=CoMath.createVec3(),this.container=null,this.position=CoMath.createVec3(),this.version=0}select(t=null){}deselect(){this.m_tars=null}addCtrlEntity(t){t&&(this.m_controllers.push(t),this.m_flags.push(!0))}setTargets(t){}getTargets(){return this.m_tars}setCtrlScaleXYZ(t,e,i){this.container.setScaleXYZ(t,e,i);const s=this.m_controllers;for(let r=0;r<s.length;++r)s[r].transFlag&&s[r].transFlag>0&&s[r].setScaleXYZ(t,e,i)}setXYZ(t,e,i){return this}setPosition(t){return this}getPosition(t){return this.container.getPosition(t)}setRotation3(t){return this}setRotationXYZ(t,e,i){return this}setScaleXYZ(t,e,i){return this}getRotationXYZ(t){return null}getScaleXYZ(t){return null}getGlobalBounds(){return null}getLocalBounds(){return null}localToGlobal(t){}globalToLocal(t){}update(){if(this.m_changed){let t=this.m_tars;if(t)for(let e=0;e<t.length;++e)t[e].update()}this.container.update()}updateCtrl(){this.container.update()}destroy(){this.m_tars=null,this.m_controllers=null,this.container=null}}e.CtrlTargetBase=s},"15a7":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.m_entities=null,this.m_rect=CoMath.createAABB2D()}query(t,e){if(this.m_entities=[],e>0){let i=this.m_entities;const s=this.m_rect;let r=CoMath.createVec3(),n=this.m_rscene.getCamera(),o=this.m_rscene.getStage3D();for(let a=0;a<e;++a)if(t[a].mouseEnabled){let e=t[a].getGlobalBounds();r.copyFrom(e.center),n.worldPosToScreen(r),r.x+=o.stageHalfWidth,r.y+=o.stageHalfHeight,s.containsXY(r.x,r.y)&&i.push(t[a])}}}initialize(t){null==this.m_rscene&&(this.m_rscene=t)}getEntities(t,e){const i=this.m_rect;if(i.setTo(t.x,t.y,e.x-t.x,e.y-t.y),i.width*i.height>0){let t=this.m_rscene;return t.getSpace().renderingEntitySet.query(this),this.m_entities}return null}}e.RectFrameQuery=s},"1eb2":function(t,e,i){"use strict";if("undefined"!==typeof window){var s=window.document.currentScript,r=i("8875");s=r(),"currentScript"in document||Object.defineProperty(document,"currentScript",{get:r});var n=s&&s.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);n&&(i.p=n[1])}},"1f30":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.m_entity=null}initialize(t,e,i,s,r=10,n=null){if(null==this.m_entity){e<0&&(e=0),r<1&&(r=1),null==n&&(n=CoMaterial.createColor4(.3,.3,.3,1)),this.m_rscene=t,this.m_entity=CoEntity.createDisplayEntity();let o=1,a=CoMath.createVec3().subVecsTo(s,i);a.z<.1?o=0:a.x<.1&&(o=2),a.scaleBy(1/r);let l=r+1,h=i.clone(),c=s.clone(),m=s.clone(),_=new Array(2*l),u=0;if(1==o)for(let t=0;t<l;++t)h.x=i.x+a.x*t,h.z=i.z,c.copyFrom(h),c.z=s.z,_[u++]=h.clone(),_[u++]=c.clone(),m.copyFrom(h),h.x=c.z,h.z=c.x,c.x=m.z,c.z=m.x,_[u++]=h.clone(),_[u++]=c.clone();else if(2==o)for(let t=0;t<l;++t)h.y=i.y+a.y*t,h.z=i.z,c.copyFrom(h),c.z=s.z,_[u++]=h.clone(),_[u++]=c.clone(),m.copyFrom(h),h.y=c.z,h.z=c.y,c.y=m.z,c.z=m.y,_[u++]=h.clone(),_[u++]=c.clone();else for(let t=0;t<l;++t)h.x=i.x+a.x*t,h.y=i.y,c.copyFrom(h),c.y=s.y,_[u++]=h.clone(),_[u++]=c.clone(),m.copyFrom(h),h.x=c.y,h.y=c.x,c.x=m.y,c.y=m.x,_[u++]=h.clone(),_[u++]=c.clone();CoMesh.line.dynColorEnabled=!0;let d=CoMaterial.createLineMaterial(CoMesh.line.dynColorEnabled);d.setColor(n),d.initializeByCodeBuf(!1),CoMesh.line.setBufSortFormat(d.getBufSortFormat());let y=CoMesh.line.createLines(_);this.m_entity.setMaterial(d),this.m_entity.setMesh(y),t.addEntity(this.m_entity,e)}}setVisible(t){null!=this.m_entity&&this.m_entity.setVisible(t)}}e.FloorLineGrid=s},"1fa8":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("141a");class r extends s.CtrlTargetBase{constructor(){super()}select(t=null){let e=this.m_tars;if(e){let i=this.m_vs;null==this.container?(null==t&&(t=this.m_controllers[0]),t.getPosition(this.m_v3)):this.container.getPosition(this.m_v3);for(let t=0;t<e.length;++t)i[t].copyFrom(e[t].getGlobalBounds().center),i[t].subtractBy(this.m_v3)}}setTargets(t){if(this.m_tars=t,t){if(null==this.m_vs||this.m_vs.length<t.length){this.m_vs=new Array(t.length);for(let e=0;e<t.length;++e)this.m_vs[e]=CoMath.createVec3()}}else this.m_vs=[]}setPosition(t){this.valueFilter&&this.valueFilter.ctrlValueFilter(this.type,t),this.version++;const e=this.m_tars;if(e){const i=this.m_vs,s=this.m_v3;let r=CoMath.createVec3(),n=CoMath.createVec3();for(let o=0;o<e.length;++o)s.addVecsTo(t,i[o]),e[o].getPosition(n),r.subVecsTo(e[o].getGlobalBounds().center,n),s.subtractBy(r),e[o].setPosition(s)}return this.container.setPosition(t),this.position.copyFrom(t),this.m_changed=!0,this}}e.MovedTarget=r},2564:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(t,e=null,i=null){this.m_uid=s.s_uid++,this.m_urlChecker=null,this.m_oneTimes=!0,this.m_loaderMap=null,this.m_callback=e,this.m_times=t,this.m_urlChecker=i}setUrlChecker(t=null){return this.m_urlChecker=t,this}getUrlChecker(){return this.m_urlChecker}getUid(){return this.m_uid}setCallback(t){return this.m_callback=t,this}addLoader(t){if(null!=t&&t!=this)if(this.isFinished())t.use();else{null==this.m_loaderMap&&(this.m_loaderMap=new Map);let e=this.m_loaderMap;e.has(t.getUid())||e.set(t.getUid(),t)}return this}isFinished(){return 0==this.m_times}useOnce(){this.m_oneTimes&&(this.m_oneTimes=!1,this.use())}use(){if(this.m_times>0&&(this.m_times--,this.isFinished()&&null!=this.m_callback&&(this.m_callback(),this.m_callback=null,null!=this.m_loaderMap))){for(let[t,e]of this.m_loaderMap)e.use();this.m_loaderMap=null}}hasModuleByUrl(t){return s.loadedMap.has(t)}load(t){if(""==t)return this;null!=this.m_urlChecker&&(t=this.m_urlChecker(t));let e=s.loadedMap;if(e.has(t))return void this.use();let i=s.loadingMap;if(!i.has(t))return i.set(t,[this]),this.loadData(t),this;{let e=i.get(t);for(let t=0;t<e.length;++t)if(e[t]==this)return;e.push(this)}}loadData(t){let e=new XMLHttpRequest;e.open("GET",t,!0),e.onerror=function(t){},e.onload=e=>{this.loadedUrl(t)},e.send(null)}loadedData(t,e){}loadedUrl(t){let e=s.loadedMap,i=s.loadingMap;e.set(t,1);let r=i.get(t);for(let s=0;s<r.length;++s)r[s].use();i.delete(t)}getDataByUrl(t){return null}clearAllData(){}destroy(){this.m_urlChecker=null}}s.s_uid=0,s.loadedMap=new Map,s.loadingMap=new Map,e.PackedLoader=s},"2b49":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("df9f");class r extends s.UserEditCtr{constructor(){super(),this.m_container=null,this.outColor=CoMaterial.createColor4(.9,.9,.9,1),this.overColor=CoMaterial.createColor4(1,1,1,1),this.pickTestRadius=20,this.m_ctrList=r.s_list,this.m_ctrList.push(this)}}r.s_list=[],e.RotationCtr=r},"2b63":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.m_entity=null,this.m_pz=0,this.m_flag=!1,this.m_prePos=CoMath.createVec3(),this.m_currPos=CoMath.createVec3(),this.m_enabled=!1,this.bounds=CoMath.createAABB()}initialize(t){if(null==this.m_entity){this.m_rscene=t,this.m_entity=CoEntity.createDisplayEntity(),CoMesh.line.dynColorEnabled=!0;let e=CoMaterial.createLineMaterial(CoMesh.line.dynColorEnabled);CoMesh.line.setBufSortFormat(e.getBufSortFormat());let i=CoMesh.line.createRectXOY(0,0,1,1);this.m_entity.setMaterial(e),this.m_entity.setMesh(i),t.addEntity(this.m_entity),this.disable()}}reset(){this.m_enabled=!1,this.bounds.reset(),this.m_prePos.copyFrom(this.m_currPos.setXYZ(0,0,0))}enable(){this.m_enabled=!0}disable(){this.m_enabled=!1,this.setVisible(!1)}isEnabled(){return this.m_enabled}isSelectEnabled(){return this.m_flag&&this.m_enabled&&CoMath.Vector3D.Distance(this.m_prePos,this.m_currPos)>.98}setVisible(t){this.m_entity&&this.m_entity.setVisible(t)}isVisible(){return!!this.m_entity&&this.m_entity.getVisible()}setZ(t){this.m_pz=t}begin(t,e){this.m_flag=!0,this.bounds.reset(),this.m_currPos.copyFrom(this.m_prePos),this.m_enabled&&(this.m_prePos.setXYZ(t,e,this.m_pz),this.m_currPos.copyFrom(this.m_prePos),this.move(t,e))}end(t,e){this.m_enabled&&this.setVisible(!1),this.m_flag=!1}move(t,e){const i=this.m_prePos;if(this.m_enabled&&this.m_flag&&CoMath.Vector3D.DistanceXYZ(i.x,i.y,0,t,e,0)>1&&null!=this.m_entity){this.m_currPos.setXYZ(t,e,0),this.setVisible(!0);let i=this.bounds;i.reset(),i.addPosition(this.m_prePos),i.addXYZ(t,e,0),i.updateFast();let s=this.m_entity;s.setScaleXYZ(i.getWidth(),i.getHeight(),1),s.setPosition(i.min),s.update()}}}e.UIRectLine=s},"30db":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("3477"),r=i("2b49"),n=i("e50b");class o extends r.RotationCtr{constructor(){super(),this.m_entity=null,this.m_cv=CoMath.createVec3(),this.m_planeNV=CoMath.createVec3(),this.m_outV=CoMath.createVec3(),this.m_rotV=CoMath.createVec3(),this.m_scaleV=CoMath.createVec3(),this.m_posV=CoMath.createVec3(),this.m_srcDV=CoMath.createVec3(),this.m_dstDV=CoMath.createVec3(),this.m_camPos=CoMath.createVec3(),this.m_mat0=CoMath.createMat4(),this.m_initDegree=0,this.m_planeDis=0,this.m_material=null,this.m_editRS=null,this.m_ring=null,this.m_camVer=-7}initialize(t,e,i,r){if(null==this.m_entity){this.m_editRS=t,this.m_container=e,this.m_ring=new n.RotationRing,this.m_entity=CoEntity.createDisplayEntity();let o,a=CoMesh.line;a.dynColorEnabled=!0;let l=this.m_planeNV;o=a.createCircleYOZ(i,r),l.setXYZ(1,0,0),o.setRayTester(new s.CircleRayTester(i,this.m_cv,null,l,this.m_planeDis,this.pickTestRadius)),this.m_entity.setMesh(o),this.m_material=CoMaterial.createLineMaterial(a.dynColorEnabled),this.m_material.setColor(this.outColor),this.m_entity.setMaterial(this.m_material),this.m_entity.update(),this.applyEvent(this.m_entity),this.m_container.addEntity(this.m_entity),this.m_ring.initialize(t,e,i,120,2),this.m_ring.setVisible(!1)}}run(t,e,i=!1){if(this.m_camVer!=t.version||i){this.m_camVer=t.version;const e=this.m_scaleV;let i=this.m_entity;i.getPosition(this.m_posV),i.getScaleXYZ(e),this.m_camPos.copyFrom(t.getPosition());let s=this.m_target.container;s.globalToLocal(this.m_camPos),this.m_srcDV.setXYZ(1,0,0),this.m_dstDV.subVecsTo(this.m_camPos,this.m_posV);let r=CoMath.Vector3D.RadianBetween(this.m_srcDV,this.m_dstDV),n=this.m_rotV;CoMath.Vector3D.Cross(this.m_srcDV,this.m_dstDV,n),n.normalize();let o=this.m_mat0;o.identity(),o.appendRotation(r,n);let a=o.decompose(CoMath.OrientationType.EULER_ANGLES)[1];i.setRotation3(a.scaleBy(CoMath.MathConst.MATH_180_OVER_PI)),i.update(),this.m_ring.setPosition(this.m_posV),this.m_ring.setRotation3(a),this.m_ring.setScale3(e)}}setVisible(t){return this.m_entity.setVisible(t),t||this.m_ring.setVisible(t),this.m_camVer=-7,this}getVisible(){return this.m_entity.getVisible()}enable(){super.enable(),this.m_entity.mouseEnabled=!0}disable(){super.disable(),this.m_entity.mouseEnabled=!1}showOverColor(){this.m_entity.getMaterial().setColor(this.overColor)}showOutColor(){this.m_entity.getMaterial().setColor(this.outColor),this.m_ring.setColor(this.outColor)}deselect(){this.isSelected()&&(this.editEnd(),this.setAllVisible(!0),this.m_ring.setVisible(!1))}destroy(){super.destroy(),null!=this.m_entity&&(this.m_container.removeEntity(this.m_entity),this.m_entity.destroy(),this.m_entity=null),null!=this.m_ring&&(this.m_ring.destroy(),this.m_ring=null),this.m_container=null,this.m_editRS=null,this.m_mat0=null,this.m_cv=null,this.m_planeNV=null}moveByRay(t,e,i=!1){if(this.isEnabled()&&this.isSelected()){let i=this.getDegree(t,e);i-=this.m_initDegree,i>360?i-=360:i<0&&(i+=360),this.m_ring.setProgress(i/360);let s=this.m_target;if(s){let t=this.m_mat0,e=this.m_dstDV;e.subVecsTo(this.m_camPos,this.m_posV),e.normalize(),t.identity(),t.appendRotation(CoMath.MathConst.DegreeToRadian(i),e);let r=t.decompose(CoMath.OrientationType.EULER_ANGLES)[1];s.setRotation3(r.scaleBy(CoMath.MathConst.MATH_180_OVER_PI)),s.update()}}}mouseDownListener(t){this.isEnabled()&&(this.editBegin(),this.m_target.select(),this.setThisVisible(!0),this.m_initDegree=this.getDegree(t.raypv,t.raytv),this.m_ring.setVisible(!0),this.m_ring.setRingRotation(this.m_initDegree),this.m_ring.setProgress(0))}getDegree(t,e){let i=0;if(this.isSelected()){let s=CoAGeom.PlaneUtils,r=this.m_srcDV.copyFrom(e).scaleBy(-1),n=this.m_posV;this.m_entity.getPosition(n);let o=s.IntersectRayLinePos2(r,n.dot(r),t,e,this.m_outV),a=this.m_outV;if(this.m_entity.globalToLocal(a),o){o=s.Intersection==CoAGeom.Intersection.Hit;let t=CoMath.Vector3D;if(o&&t.Distance(a,this.m_cv)>2){a.subtractBy(this.m_cv);let t=this.m_target;null!=t&&(i=CoMath.MathConst.GetDegreeByXY(a.y,a.z),i>360?i-=360:i<0&&(i+=360))}}}return i}}e.RotationCamZCircle=o},3477:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(t,e,i,s,r,n){this.isHit=!1,this.m_pv0=CoMath.createVec3(),this.m_outV0=CoMath.createVec3(),this.m_radius=t,this.m_center=e,this.m_direcV=i,this.m_planeNV=s,this.m_planeDis=r,this.m_rayTestRadius=n}setPrevTester(t){}testRay(t,e,i,s){const r=this.m_outV0,n=CoAGeom.PlaneUtils;if(this.isHit=n.IntersectRayLinePos2(this.m_planeNV,this.m_planeDis,t,e,r),this.isHit&&(this.isHit=n.Intersection==CoAGeom.Intersection.Hit,this.isHit)){let s=this.m_pv0;if(s.subVecsTo(r,this.m_center),s.getLengthSquared()>.1){s.normalize(),s.scaleBy(this.m_radius);let n=CoAGeom.Line.CalcPVDis(e,t,s);if(this.isHit=n<this.m_rayTestRadius,this.isHit&&(null==this.m_direcV||this.m_direcV.dot(r)>0))return i.copyFrom(s),1}}return this.isHit=!1,0}destroy(){this.m_center=null,this.m_planeNV=null}}e.CircleRayTester=s},"35d4":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.m_controllers=[],this.m_rpv=CoMath.createVec3(),this.m_rtv=CoMath.createVec3(),this.m_tempPos=CoMath.createVec3(),this.m_mv0=CoMath.createVec3(-1e5,-1e5,0),this.m_mv1=CoMath.createVec3(),this.m_visible=!0,this.m_enabled=!0,this.m_container=null,this.m_bodyContainer=null,this.m_editRS=null,this.m_editRSPI=0,this.m_target=null,this.fixSize=0,this.runningVisible=!0,this.uuid="DragTransController"}initialize(t,e,i){null==this.m_editRS&&(this.m_editRS=t,this.m_container=e,this.m_bodyContainer=i,this.init(),this.applyEvt())}init(){}applyEvt(){for(let t=0;t<this.m_controllers.length;++t)this.m_controllers[t].addEventListener(CoRScene.MouseEvent.MOUSE_DOWN,this,this.dragMouseDownListener)}dragMouseDownListener(t){this.m_editRS.addEventListener(CoRScene.MouseEvent.MOUSE_UP,this,this.dragMouseUpListener,!0,!0)}dragMouseUpListener(t){this.m_editRS.removeEventListener(CoRScene.MouseEvent.MOUSE_UP,this,this.dragMouseUpListener)}addEventListener(t,e,i,s=!0,r=!1){for(let n=0;n<this.m_controllers.length;++n)this.m_controllers[n].addEventListener(t,e,i,s,r)}removeEventListener(t,e,i){for(let s=0;s<this.m_controllers.length;++s)this.m_controllers[s].removeEventListener(t,e,i)}getCtrlTarget(){return this.m_target}enable(){this.m_enabled=!0;for(let t=0;t<this.m_controllers.length;++t)this.m_controllers[t].enable()}disable(){this.m_enabled=!1;for(let t=0;t<this.m_controllers.length;++t)this.m_controllers[t].disable();this.m_target.setTargets(null)}isEnabled(){return this.m_enabled}run(t=!0){if(this.m_enabled){let e=this.m_controllers;this.m_tempPos.copyFrom(this.m_target.position);let i=this.m_editRS.getCamera(),s=this.m_editRS.getStage3D();for(let r=0;r<e.length;++r)e[r].getVisible()&&e[r].run(i,this.m_rtv,t);if(this.m_mv1.setXYZ(s.mouseX,s.mouseY,0),CoMath.Vector3D.DistanceSquared(this.m_mv0,this.m_mv1)>.001){this.m_mv0.copyFrom(this.m_mv1),this.m_editRS.getMouseXYWorldRay(this.m_rpv,this.m_rtv);for(let t=0;t<e.length;++t)e[t].isSelected()&&e[t].moveByRay(this.m_rpv,this.m_rtv)}}}isSelected(){let t=!1,e=this.m_controllers;for(let i=0;i<e.length;++i)t=t||e[i].isSelected();return t}select(t){this.m_target.setTargets(t),this.m_target.select(null),this.setVisible(null!=t)}deselect(){this.m_target.deselect();for(let t=0;t<this.m_controllers.length;++t)this.m_controllers[t].deselect()}decontrol(){for(let t=0;t<this.m_controllers.length;++t)this.m_controllers[t].deselect()}getTargets(){return this.m_target.getTargets()}getVersion(){return this.m_target.version}setVisible(t){this.m_visible=t;for(let e=0;e<this.m_controllers.length;++e)this.m_controllers[e].setVisible(t);return this}moveByRay(t,e){}getVisible(){return this.m_visible}setXYZ(t,e,i){return this}setPosition(t){return this.m_target.setPosition(t),this.m_target.update(),this}getPosition(t){return this.m_controllers[0].getPosition(t),t}setRotation3(t){return this.m_target.setRotation3(t),this}setRotationXYZ(t,e,i){return this}setScaleXYZ(t,e,i){return this.m_target.setScaleXYZ(t,e,i),this}setCtrlScaleXYZ(t,e,i){this.m_target.setCtrlScaleXYZ(t,e,i)}getRotationXYZ(t){return null}getScaleXYZ(t){return null}getGlobalBounds(){return null}getLocalBounds(){return null}localToGlobal(t){}globalToLocal(t){}update(){}updateCtrl(){this.m_enabled&&this.m_target.updateCtrl()}destroy(){if(this.m_controllers.length>0){for(let t=0;t<this.m_controllers.length;++t)this.m_controllers[t].destroy();this.m_controllers=[]}this.m_editRS=null,this.m_container=null,this.m_bodyContainer=null}}e.DragTransController=s},"36b4":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("1f30"),r=i("7d28");e.UserEditEvent=r.UserEditEvent;const n=i("4703"),o=i("c16d"),a=i("2b63"),l=i("15a7");function h(){return new n.CoTransformRecorder}function c(){return new o.TransformController}function m(){return new s.FloorLineGrid}function _(){return new a.UIRectLine}function u(){return new l.RectFrameQuery}e.createTransformRecorder=h,e.createTransformController=c,e.createFloorLineGrid=m,e.createUIRectLine=_,e.createRectFrameQuery=u},4362:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("35d4"),r=i("cdd5"),n=i("30db"),o=i("5f45"),a=i("eaa4");class l extends s.DragTransController{constructor(){super(),this.radius=100,this.pickTestAxisRadius=20,this.camZCircleRadius=120,this.camYXCircleRadius=80}createCircle(t,e,i=100,s=20){let n=new r.RotationCircle;return n.pickTestRadius=this.pickTestAxisRadius,n.outColor.copyFrom(e),n.overColor.copyFrom(e),n.overColor.scaleBy(2),n.initialize(this.m_editRS,this.m_container,i,s,t),n.showOutColor(),n.setTarget(this.m_target),this.m_target.addCtrlEntity(n),this.m_controllers.push(n),n}init(){this.m_target=new o.RotatedTarget,this.m_target.container=this.m_bodyContainer;let t=Math.floor(this.radius/2);t<30&&(t=30);let e=CoMaterial.createColor4();this.createCircle(0,e.setRGB3Bytes(240,55,80),this.radius,t),this.createCircle(1,e.setRGB3Bytes(135,205,55),this.radius,t),this.createCircle(2,e.setRGB3Bytes(80,145,240),this.radius,t),t=Math.floor(this.camZCircleRadius/2);let i=new n.RotationCamZCircle;i.pickTestRadius=this.pickTestAxisRadius,i.initialize(this.m_editRS,this.m_container,this.camZCircleRadius,t),i.setTarget(this.m_target),this.m_target.addCtrlEntity(i),this.m_controllers.push(i);let s=new a.RotationCamXYCircle;s.pickTestRadius=this.pickTestAxisRadius,s.initialize(this.m_editRS,this.m_container,this.camYXCircleRadius),s.showOutColor(),s.setTarget(this.m_target),this.m_target.addCtrlEntity(s),this.m_controllers.push(s)}}e.DragRotationController=l},4703:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.position=CoMath.createVec3(),this.scale=CoMath.createVec3(),this.rotation=CoMath.createVec3()}}class r{constructor(){this.list=[]}add(t){let e=new s;t.getPosition(e.position),t.getScaleXYZ(e.scale),t.getRotationXYZ(e.rotation),e.target=t,this.list.push(e)}use(){let t=this.list;0;let e=[];for(let i=0;i<t.length;++i){const s=t[i],r=s.target;r.setScale3(s.scale),r.setRotation3(s.rotation),r.setPosition(s.position),r.update(),e.push(r)}return e}destroy(){this.list=[]}}class n{constructor(){this.m_undoList=[],this.m_redoList=[],this.m_currList=null,this.m_beginGroup=null}createGroup(t){if(null!=t){let e=new r;for(let i=0;i<t.length;++i)e.add(t[i]);return e}}save(t){this.m_currList=null,this.m_redoList.length>0&&(this.m_redoList=[]);let e=this.createGroup(t);null!=e&&(this.m_undoList.push(e))}saveBegin(t){this.m_currList=null,this.m_beginGroup=this.createGroup(t)}saveEnd(t){this.m_currList=null;let e=this.m_beginGroup;if(this.m_beginGroup=null,null!=e){let i=this.createGroup(t);null!=i&&(this.m_undoList.push(e),this.m_undoList.push(i),e=null)}null!=e&&e.destroy()}undo(){this.m_currList=null;let t=this.m_undoList,e=t.length;if(e>1){let e=t.pop(),i=t.pop();this.m_redoList.push(i),this.m_redoList.push(e),this.m_currList=i.use()}}redo(){this.m_currList=null;let t=this.m_redoList,e=t.length;if(e>1){let e=t.pop(),i=t.pop();this.m_currList=e.use(),this.m_undoList.push(i),this.m_undoList.push(e)}}getCurrList(){let t=this.m_currList;return this.m_currList=null,t}}e.CoTransformRecorder=n},5205:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("832f"),r=i("aae9");class n extends r.MoveCtr{constructor(){super(),this.m_entity=null,this.m_rscene=null,this.m_container=null,this.m_billPos=null,this.m_circle=null,this.m_planeNV=CoMath.createVec3(0,1,0),this.m_planePos=CoMath.createVec3(),this.m_planeDis=0,this.m_pos=CoMath.createVec3(),this.m_dv=CoMath.createVec3(),this.m_outV=CoMath.createVec3(),this.m_rpv=CoMath.createVec3(),this.m_rtv=CoMath.createVec3()}initialize(t,e,i=30){if(null==this.m_entity){this.transFlag=1,this.m_rscene=t,this.m_container=e;let r=CoEntity.createBoundsEntity(),n=.5*i,o=CoMath.createVec3(n,n,n).scaleBy(-1),a=CoMath.createVec3(n,n,n);r.setBounds(o,a),r.setRayTester(new s.SphereRayTester(n)),this.applyEvent(r),r.mouseEnabled=!1,e.addChild(r),this.m_entity=r;let l=CoParticle.createBillboard();l.initializeSquare(.2*n,[this.createTexByUrl("static/assets/circle01.png")]),e.addChild(l.entity);let h=CoRScene.RendererState;l.entity.setRenderState(h.NONE_TRANSPARENT_ALWAYS_STATE),this.m_billPos=l;let c=Math.floor(.5*n),m=CoParticle.createBillboardLine();m.initializeCircleXOY(n,c<50?50:c),e.addChild(m.entity),m.entity.setRenderState(h.NONE_TRANSPARENT_ALWAYS_STATE),this.m_circle=m,this.showOutColor()}}createTexByUrl(t=""){let e=this.m_rscene.textureBlock.createImageTex2D(64,64,!1),i=new Image;return i.onload=t=>{e.setDataFromImage(i,0,0,0,!1)},i.src=""!=t?t:"static/assets/box.jpg",e}getEntity(){return this.m_entity}showOverColor(){let t=this.overColor;this.m_circle.setRGB3f(t.r,t.g,t.b)}showOutColor(){let t=this.outColor;this.m_circle.setRGB3f(t.r,t.g,t.b)}enable(){super.enable(),this.m_entity.mouseEnabled=!0}disable(){super.disable(),this.m_entity.mouseEnabled=!1}setRenderState(t){this.m_entity.setRenderState(t)}setVisible(t){return this.m_entity.setVisible(t),this.m_circle.entity.setVisible(t),this.m_billPos.entity.setVisible(t),this}getVisible(){return this.m_entity.getVisible()}setScaleXYZ(t,e,i){return this.m_entity.setScaleXYZ(t,e,i),this.m_circle.setScaleXY(t,e),this.m_billPos.setScaleXY(t,e),this.m_entity.update(),this.m_circle.update(),this.m_billPos.update(),this}destroy(){super.destroy(),this.m_entity&&(this.m_container.removeEntity(this.m_entity),this.m_entity.destroy()),this.m_circle&&(this.m_container.removeEntity(this.m_circle.entity),this.m_circle.destroy()),this.m_billPos&&(this.m_container.removeEntity(this.m_billPos.entity),this.m_billPos.destroy()),this.m_rscene=null,this.m_container=null}calcClosePos(t,e){CoAGeom.PlaneUtils.IntersectLinePos2(this.m_planeNV,this.m_planeDis,t,e,this.m_outV)}moveByRay(t,e,i=!1){if(this.isEnabled()&&this.isSelected()){this.m_rpv.copyFrom(t),this.m_rtv.copyFrom(e);const i=this.m_pos;this.calcClosePos(this.m_rpv,this.m_rtv),i.copyFrom(this.m_outV),i.addBy(this.m_dv),this.m_target&&(this.m_target.setPosition(i),this.m_target.update())}}setPlaneNormal(t){this.m_planeNV.copyFrom(t),this.m_planeNV.normalize()}selectByParam(t,e,i){this.m_rpv.copyFrom(t),this.m_rtv.copyFrom(e),this.m_planePos.copyFrom(i),this.m_planeNV.copyFrom(this.m_rtv),this.m_planeNV.normalize(),this.m_planeDis=this.m_planePos.dot(this.m_planeNV),this.calcClosePos(this.m_rpv,this.m_rtv),this.m_target.getPosition(this.m_dv),this.m_dv.subtractBy(this.m_outV)}mouseDownListener(t){this.isEnabled()&&(this.editBegin(),this.setThisVisible(!0),this.m_target.select(this),this.selectByParam(t.raypv,t.raytv,t.wpos))}}e.default=n},"5e48":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("141a");class r extends s.CtrlTargetBase{constructor(){super(),this.m_svs=[],this.m_sv=CoMath.createVec3(),this.m_pv=CoMath.createVec3()}select(t=null){let e=this.m_tars;if(null!=e){const t=this.m_vs,i=this.m_svs;let s=this.position;s.setXYZ(0,0,0);for(let r=0;r<e.length;++r)t[r].copyFrom(e[r].getGlobalBounds().center),s.addBy(t[r]);s.scaleBy(1/e.length);for(let r=0;r<e.length;++r)t[r].copyFrom(e[r].getGlobalBounds().center),t[r].subtractBy(s),e[r].getScaleXYZ(i[r])}}setTargets(t){if(this.m_tars=t,null!=t){if(null==this.m_vs||this.m_vs.length<t.length){this.m_vs=new Array(t.length),this.m_svs=new Array(t.length);for(let e=0;e<t.length;++e)this.m_vs[e]=CoMath.createVec3(),this.m_svs[e]=CoMath.createVec3()}}else this.m_vs=[],this.m_svs=[]}setPosition(t){return this.container.setPosition(t),this}setScaleXYZ(t,e,i){if(this.m_tars){this.version++,this.m_sv.setXYZ(t,e,i),this.valueFilter&&(this.valueFilter.ctrlValueFilter(this.type,this.m_sv),t=this.m_sv.x,e=this.m_sv.y,i=this.m_sv.z);const s=this.m_vs,r=this.m_svs,n=this.position;let o=this.m_pv,a=CoMath.createVec3(),l=CoMath.createVec3(),h=this.m_tars;for(let c=0;c<h.length;++c){const s=r[c];h[c].setScaleXYZ(s.x*t,s.y*e,s.z*i)}for(let t=0;t<h.length;++t)o.copyFrom(s[t]).multBy(this.m_sv).addBy(n),h[t].update(),a.subVecsTo(h[t].getGlobalBounds().center,o),h[t].getPosition(l),l.subtractBy(a),h[t].setPosition(l);this.m_changed=!0}return this}getScaleXYZ(t){return t.setXYZ(1,1,1),t}}e.ScaleTarget=r},"5f45":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("141a");class r extends s.CtrlTargetBase{constructor(){super(),this.m_rvs=[],this.m_rv=CoMath.createVec3(),this.m_pv=CoMath.createVec3(),this.m_rotv=CoMath.createVec3(),this.m_mat0=CoMath.createMat4(),this.m_mat1=CoMath.createMat4()}select(t=null){let e=this.m_tars;if(e){const t=this.m_vs,i=this.m_rvs;let s=Math.PI/180,r=this.position;r.setXYZ(0,0,0);for(let n=0;n<e.length;++n)t[n].copyFrom(e[n].getGlobalBounds().center),r.addBy(t[n]);r.scaleBy(1/e.length);for(let n=0;n<e.length;++n)t[n].copyFrom(e[n].getGlobalBounds().center),t[n].subtractBy(r),e[n].getRotationXYZ(i[n]),i[n].scaleBy(s)}}setTargets(t){if(this.m_tars=t,t){if(null==this.m_vs||this.m_vs.length<t.length){this.m_vs=new Array(t.length),this.m_rvs=new Array(t.length);for(let e=0;e<t.length;++e)this.m_vs[e]=CoMath.createVec3(),this.m_rvs[e]=CoMath.createVec3()}this.m_rotv.setXYZ(0,0,0),this.rotation.setXYZ(0,0,0)}else this.m_vs=[],this.m_rvs=[]}setPosition(t){return this.container.setPosition(t),this}getPosition(t){return t.copyFrom(this.position),t}setRotation3(t){if(this.m_tars){this.version++;let e=this.m_tars,i=Math.PI/180,s=180/Math.PI,r=this.m_rv;this.valueFilter&&this.valueFilter.ctrlValueFilter(this.type,t),r.copyFrom(t).scaleBy(i);let n=this.m_mat0,o=this.m_mat1;const a=this.m_vs,l=this.m_rvs,h=this.position;let c=this.m_pv;c.setXYZ(0,0,0);let m=CoMath.createVec3(),_=CoMath.createVec3(),u=this.m_rotv,d=CoMath.OrientationType.EULER_ANGLES;n.identity(),n.setRotationEulerAngle(u.x,u.y,u.z),o.identity(),o.setRotationEulerAngle(r.x,r.y,r.z),n.append(o);let y=n.decompose(d)[1];y.scaleBy(s),this.rotation.copyFrom(y);for(let t=0;t<e.length;++t)u=l[t],n.identity(),n.setRotationEulerAngle(u.x,u.y,u.z),o.identity(),o.setRotationEulerAngle(r.x,r.y,r.z),n.append(o),y=n.decompose(d)[1],y.scaleBy(s),e[t].setRotation3(y),e[t].update(),y=e[t].getMatrix().decompose(d)[1].scaleBy(s);1==e.length&&this.rotation.copyFrom(y);for(let t=0;t<e.length;++t)n.identity(),n.setRotationEulerAngle(r.x,r.y,r.z),c.copyFrom(a[t]),n.transformVector3Self(c),c.addBy(h),e[t].update(),m.subVecsTo(e[t].getGlobalBounds().center,c),e[t].getPosition(_),_.subtractBy(m),e[t].setPosition(_);this.m_changed=!0}return this}getRotationXYZ(t){return t.setXYZ(0,0,0),t}}e.RotatedTarget=r},7281:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("0b69")),n=s(i("d51f")),o=i("91df"),a=i("8441"),l=i("5e48"),h=i("35d4");class c extends h.DragTransController{constructor(){super(),this.circleSize=60,this.axisSize=100,this.planeSize=30,this.planeAlpha=.6,this.pickTestAxisRadius=20,this.camZCircleRadius=120}createDragPlane(t,e,i){let s=new r.default;return s.moveSelfEnabled=!1,s.initialize(this.m_editRS,this.m_container,t,this.planeSize),i.a=e,s.outColor.copyFrom(i),i.scaleBy(1.5),i.a=1.3*e,s.overColor.copyFrom(i),s.setTarget(this.m_target),this.m_target.addCtrlEntity(s),this.m_controllers.push(s),s.showOutColor(),s}createDragLine(t,e,i){let s=t.clone().scaleBy(this.axisSize);i.setTranslation(s);let r=new a.ScaleDragLine;r.boxScale=.4,r.coneTransMat4=i,r.tv.copyFrom(t),r.innerSphereRadius=.5*this.circleSize,r.moveSelfEnabled=!1,r.pickTestRadius=this.pickTestAxisRadius,r.initialize(this.m_container,this.axisSize,r.innerSphereRadius),r.outColor.copyFrom(e),e.scaleBy(1.5),r.overColor.copyFrom(e),r.showOutColor(),r.setTarget(this.m_target),this.m_target.addCtrlEntity(r.getEntity()),this.m_target.addCtrlEntity(r.getBox()),this.m_controllers.push(r)}init(){this.m_target=new l.ScaleTarget,this.m_target.container=this.m_bodyContainer;let t=this.planeAlpha,e=CoMaterial.createColor4,i=e();const s=CoMath.Vector3D;let r=CoMath.createMat4();i.setRGB3Bytes(240,55,80),r.identity(),this.createDragLine(s.X_AXIS,i,r),i.setRGB3Bytes(135,205,55),r.identity(),this.createDragLine(s.Y_AXIS,i,r),i.setRGB3Bytes(80,145,240),r.identity(),this.createDragLine(s.Z_AXIS,i,r),i.setRGB3Bytes(240,55,80),this.createDragPlane(0,t,i),i.setRGB3Bytes(135,205,55),this.createDragPlane(1,t,i),i.setRGB3Bytes(80,145,240),this.createDragPlane(2,t,i);let a=new n.default;a.moveSelfEnabled=!1,a.initialize(this.m_editRS,this.m_container,this.circleSize),a.setTarget(this.m_target),this.m_target.addCtrlEntity(a),this.m_controllers.push(a);let h=Math.floor(this.camZCircleRadius/2),c=new o.ScaleCamZCircle;c.pickTestRadius=this.pickTestAxisRadius,c.initialize(this.m_editRS,this.m_container,this.camZCircleRadius,h),c.setTarget(this.m_target),this.m_target.addCtrlEntity(c),this.m_controllers.push(c)}}e.DragScaleController=c},"75f5":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("2564");class r extends s.PackedLoader{constructor(t,e=null,i=null){super(t,e,i)}loadData(t){let e=new XMLHttpRequest;e.open("GET",t,!0),e.onerror=function(t){},e.onload=i=>{this.loadedData(e.response,t),this.loadedUrl(t)},e.send(null)}loadedData(t,e){let i=document.createElement("script");i.onerror=t=>{},i.type="text/javascript";try{i.innerHTML=t,document.head.appendChild(i)}catch(s){throw s}}}e.ModuleLoader=r},"7d28":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{}s.EDIT_BEGIN=20001,s.EDIT_END=20002,e.UserEditEvent=s},"832f":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(t,e=null){this.isHit=!1,null==e&&(e=CoMath.createVec3()),this.m_radius=t,this.m_center=e}setPrevTester(t){}testRay(t,e,i,s){return this.isHit=CoAGeom.RayLine.IntersectSphereNearPos(t,e,this.m_center,this.m_radius,i),this.isHit?1:0}destroy(){this.m_center=null}}e.SphereRayTester=s},8441:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("832f"),r=i("b633"),n=i("abf9");class o extends n.ScaleCtr{constructor(){super(),this.m_entity=null,this.m_box=null,this.innerSphereRadius=30,this.type=0,this.tv=CoMath.createVec3(1,0,0),this.coneTransMat4=CoMath.createMat4(),this.boxScale=1,this.m_line_pv=CoMath.createVec3(),this.m_initPos=CoMath.createVec3(),this.m_dv=CoMath.createVec3(),this.m_outV=CoMath.createVec3(),this.m_initV=CoMath.createVec3(),this.m_mat4=CoMath.createMat4(),this.m_invMat4=CoMath.createMat4(),this.m_rpv=CoMath.createVec3(),this.m_rtv=CoMath.createVec3(),this.m_sv=CoMath.createVec3()}initialize(t,e=100,i=0){if(this.m_container=t,null==this.m_entity){let t=this.pickTestRadius;CoMesh.line.dynColorEnabled=!0;let n=CoMaterial.createLineMaterial(!0);CoMesh.line.setBufSortFormat(n.getBufSortFormat());let o=this.tv.clone().scaleBy(i),a=this.tv.clone().scaleBy(e),l=CoMesh.line.createLine(o,a,t);if(this.m_entity=CoEntity.createDisplayEntity(),this.m_entity.setMaterial(n),this.m_entity.setMesh(l),null!=l){let e=new r.DashedLineRayTester(l.getVS(),1,t);e.setPrevTester(new s.SphereRayTester(this.innerSphereRadius)),l.setRayTester(e)}this.applyEvent(this.m_entity),n=CoMaterial.createDefaultMaterial(),n.initializeByCodeBuf(!1),CoMesh.box.setBufSortFormat(n.getBufSortFormat()),CoMesh.box.transMatrix=this.coneTransMat4,l=CoMesh.box.createCube(this.boxScale*t*2),this.m_box=CoEntity.createDisplayEntity(),this.m_box.setMaterial(n),this.m_box.setMesh(l),this.m_container.addChild(this.m_entity),this.m_container.addChild(this.m_box),this.applyEvent(this.m_box)}}getBox(){return this.m_box}getEntity(){return this.m_entity}setVisible(t){return this.m_entity.setVisible(t),this.m_box.setVisible(t),this}getVisible(){return this.m_entity.getVisible()}showOverColor(){this.setEntityColor(this.m_entity,this.overColor),this.setEntityColor(this.m_box,this.overColor)}showOutColor(){this.setEntityColor(this.m_entity,this.outColor),this.setEntityColor(this.m_box,this.outColor)}enable(){super.enable(),this.m_entity.mouseEnabled=!0,this.m_box.mouseEnabled=!0}disable(){super.disable(),this.m_entity.mouseEnabled=!1,this.m_box.mouseEnabled=!1}destroy(){super.destroy(),this.m_entity&&(this.m_container.removeChild(this.m_entity),this.m_entity.destroy(),this.m_entity=null),this.m_box&&(this.m_container.removeChild(this.m_box),this.m_box.destroy(),this.m_box=null),this.m_container=null}calcClosePos(t,e){if(this.isSelected()){let i=this.m_invMat4;i.transformVector3Self(t),i.deltaTransformVectorSelf(e);let s=this.m_outV;CoAGeom.Line.CalcTwoSLCloseV2(t,e,this.m_line_pv,this.tv,s),i=this.m_mat4,i.transformVector3Self(s);let r=this.m_target.container;r.globalToLocal(s)}}moveByRay(t,e,i=!1){if(this.isEnabled()&&this.isSelected()){this.m_rpv.copyFrom(t),this.m_rtv.copyFrom(e),this.calcClosePos(this.m_rpv,this.m_rtv),this.m_dv.copyFrom(this.m_outV),this.m_dv.subtractBy(this.m_initV);const i=this.m_dv,s=this.m_sv;let r=1,n=1,o=1,a=1,l=this.tv,h=100;l.x>.1?(h+=i.x,h<1&&(h=1),r=h/100,n=r):l.y>.1?(h+=i.y,h<1&&(h=1),r=h/100,o=r):l.z>.1&&(h+=i.z,h<1&&(h=1),r=h/100,a=r),null!=this.m_target&&(this.m_target.setScaleXYZ(s.x*n,s.y*o,s.z*a),this.m_target.update())}}mouseDownListener(t){if(this.isEnabled()){this.editBegin(),this.setThisVisible(!0),this.m_target.select();let e=this.m_entity.getTransform();this.m_mat4.copyFrom(e.getMatrix()),this.m_invMat4.copyFrom(e.getInvMatrix()),this.m_rpv.copyFrom(t.raypv),this.m_rtv.copyFrom(t.raytv),this.calcClosePos(this.m_rpv,this.m_rtv),this.m_initV.copyFrom(this.m_outV),this.m_target.getPosition(this.m_initPos),this.m_target.getScaleXYZ(this.m_sv)}}}e.ScaleDragLine=o},8875:function(t,e,i){var s,r,n;(function(i,o){r=[],s=o,n="function"===typeof s?s.apply(e,r):s,void 0===n||(t.exports=n)})("undefined"!==typeof self&&self,(function(){function t(){var e=Object.getOwnPropertyDescriptor(document,"currentScript");if(!e&&"currentScript"in document&&document.currentScript)return document.currentScript;if(e&&e.get!==t&&document.currentScript)return document.currentScript;try{throw new Error}catch(u){var i,s,r,n=/.*at [^(]*\((.*):(.+):(.+)\)$/gi,o=/@([^@]*):(\d+):(\d+)\s*$/gi,a=n.exec(u.stack)||o.exec(u.stack),l=a&&a[1]||!1,h=a&&a[2]||!1,c=document.location.href.replace(document.location.hash,""),m=document.getElementsByTagName("script");l===c&&(i=document.documentElement.outerHTML,s=new RegExp("(?:[^\\n]+?\\n){0,"+(h-2)+"}[^<]*<script>([\\d\\D]*?)<\\/script>[\\d\\D]*","i"),r=i.replace(s,"$1").trim());for(var _=0;_<m.length;_++){if("interactive"===m[_].readyState)return m[_];if(m[_].src===l)return m[_];if(l===c&&m[_].innerHTML&&m[_].innerHTML.trim()===r)return m[_]}return null}}return t}))},"91df":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("3477"),r=i("abf9");class n extends r.ScaleCtr{constructor(){super(),this.m_entity=null,this.m_cv=CoMath.createVec3(),this.m_planeNV=CoMath.createVec3(),this.m_outV=CoMath.createVec3(),this.m_rotV=CoMath.createVec3(),this.m_scaleV=CoMath.createVec3(),this.m_posV=CoMath.createVec3(),this.m_srcDV=CoMath.createVec3(),this.m_dstDV=CoMath.createVec3(),this.m_camPos=CoMath.createVec3(),this.m_mat0=CoMath.createMat4(),this.m_initDegree=0,this.m_planeDis=0,this.m_material=null,this.m_camVer=-7,this.m_sv=CoMath.createVec3(),this.m_dis=0}initialize(t,e,i,r){if(null==this.m_entity){this.m_editRS=t,this.m_container=e,this.m_entity=CoEntity.createDisplayEntity();let n,o=CoMesh.line;o.dynColorEnabled=!0;let a=this.m_planeNV;n=o.createCircleYOZ(i,r),a.setXYZ(1,0,0),n.setRayTester(new s.CircleRayTester(i,this.m_cv,null,a,this.m_planeDis,this.pickTestRadius)),this.m_entity.setMesh(n),this.m_material=CoMaterial.createLineMaterial(o.dynColorEnabled),this.m_material.setColor(this.outColor),this.m_entity.setMaterial(this.m_material),this.m_entity.update(),this.applyEvent(this.m_entity),e.addEntity(this.m_entity)}}run(t,e,i=!1){if(this.m_camVer!=t.version||i){this.m_camVer=t.version;let e=this.m_entity;this.m_target.getPosition(this.m_posV),this.m_camPos.copyFrom(t.getPosition());let i=this.m_target.container;i.globalToLocal(this.m_camPos),this.m_srcDV.setXYZ(1,0,0),this.m_dstDV.subVecsTo(this.m_camPos,this.m_posV);let s=CoMath.Vector3D.RadianBetween(this.m_srcDV,this.m_dstDV),r=this.m_rotV;CoMath.Vector3D.Cross(this.m_srcDV,this.m_dstDV,r),r.normalize();let n=this.m_mat0;n.identity(),n.appendRotation(s,r);let o=n.decompose(CoMath.OrientationType.EULER_ANGLES)[1];e.setRotation3(o.scaleBy(CoMath.MathConst.MATH_180_OVER_PI)),e.update()}}setVisible(t){return this.m_entity.setVisible(t),this.m_camVer=-7,this}getVisible(){return this.m_entity.getVisible()}enable(){super.enable(),this.m_entity.mouseEnabled=!0}disable(){super.disable(),this.m_entity.mouseEnabled=!1}showOverColor(){this.setEntityColor(this.m_entity,this.overColor)}showOutColor(){this.setEntityColor(this.m_entity,this.outColor)}deselect(){this.isSelected()&&(this.editEnd(),this.setAllVisible(!0))}destroy(){super.destroy(),this.m_entity&&(this.m_container.removeEntity(this.m_entity),this.m_entity.destroy(),this.m_entity=null),this.m_container=null,this.m_editRS=null,this.m_mat0=null,this.m_cv=null,this.m_planeNV=null}moveByRay(t,e,i=!1){if(this.isEnabled()&&this.isSelected()){let i=this.getDis(t,e),s=this.m_target;if(null!=s&&i>.001){let t=i/this.m_dis;const e=this.m_sv;s.setScaleXYZ(e.x*t,e.y*t,e.z*t),s.update()}}}mouseDownListener(t){this.isEnabled()&&(this.editBegin(),this.m_target.select(),this.setThisVisible(!0),this.m_target.getScaleXYZ(this.m_sv),this.m_dis=this.getDis(t.raypv,t.raytv))}getDis(t,e){let i=0;if(this.isSelected()){let i=CoAGeom.PlaneUtils,s=this.m_srcDV.copyFrom(e).scaleBy(-1),r=this.m_posV;this.m_target.getPosition(r);let n=i.IntersectRayLinePos2(s,r.dot(s),t,e,this.m_outV),o=this.m_outV;if(this.m_entity.globalToLocal(o),n){n=i.Intersection==CoAGeom.Intersection.Hit;let t=CoMath.Vector3D;if(n&&t.Distance(o,this.m_cv)>2){o.subtractBy(this.m_cv);let t=this.m_target;if(null!=t)return o.getLength()}}}return i}}e.ScaleCamZCircle=n},"956f":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("ec63")),n=s(i("5205")),o=i("1fa8"),a=i("0148"),l=i("35d4");class h extends l.DragTransController{constructor(){super(),this.circleSize=60,this.axisSize=100,this.planeSize=30,this.planeAlpha=.6,this.pickTestAxisRadius=20}createDragPlane(t,e,i){let s=new r.default;return s.moveSelfEnabled=!1,s.initialize(this.m_editRS,this.m_container,t,this.planeSize),i.a=e,s.outColor.copyFrom(i),i.scaleBy(1.5),i.a=1.3*e,s.overColor.copyFrom(i),s.showOutColor(),s.setTarget(this.m_target),this.m_target.addCtrlEntity(s),this.m_controllers.push(s),s}createDragLine(t,e,i){let s=t.clone().scaleBy(this.axisSize);i.setTranslation(s);let r=new a.DragLine;r.coneScale=.8,r.coneTransMat4.copyFrom(i),r.tv.copyFrom(t),r.innerSphereRadius=.5*this.circleSize,r.moveSelfEnabled=!0,r.pickTestRadius=this.pickTestAxisRadius,r.initialize(this.axisSize,r.innerSphereRadius),r.outColor.copyFrom(e),e.scaleBy(1.5),r.overColor.copyFrom(e),r.showOutColor(),r.setTarget(this.m_target),this.m_container.addChild(r.getEntity()),this.m_container.addChild(r.getCone()),this.m_target.addCtrlEntity(r.getEntity()),this.m_target.addCtrlEntity(r.getCone()),this.m_controllers.push(r)}init(){this.m_target=new o.MovedTarget,this.m_target.container=this.m_bodyContainer;let t=this.planeAlpha,e=CoMaterial.createColor4,i=e();const s=CoMath.Vector3D;let r=CoMath.createMat4();r.identity(),r.rotationZ(-.5*Math.PI),i.setRGB3Bytes(240,55,80),this.createDragLine(s.X_AXIS,i,r),r.identity(),r.rotationX(.5*Math.PI),r.rotationY(.5*Math.PI),i.setRGB3Bytes(135,205,55),this.createDragLine(s.Y_AXIS,i,r),r.identity(),r.rotationY(.5*Math.PI),r.rotationX(.5*Math.PI),i.setRGB3Bytes(80,145,240),this.createDragLine(s.Z_AXIS,i,r),i.setRGB3Bytes(240,55,80),this.createDragPlane(0,t,i),i.setRGB3Bytes(135,205,55),this.createDragPlane(1,t,i),i.setRGB3Bytes(80,145,240),this.createDragPlane(2,t,i);let a=new n.default;a.moveSelfEnabled=!1,a.initialize(this.m_editRS,this.m_container,this.circleSize),a.setTarget(this.m_target),this.m_target.addCtrlEntity(a),this.m_controllers.push(a)}}e.DragMoveController=h},aae9:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("df9f");class r extends s.UserEditCtr{constructor(){super(),this.m_editRS=null,this.m_editRSPI=0,this.outColor=CoMaterial.createColor4(.9,.9,.9,1),this.overColor=CoMaterial.createColor4(1,1,1,1),this.pickTestRadius=10,this.m_ctrList=r.s_list,this.m_ctrList.push(this)}}r.s_list=[],e.MoveCtr=r},abf9:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("df9f");class r extends s.UserEditCtr{constructor(){super(),this.m_editRS=null,this.m_container=null,this.outColor=CoMaterial.createColor4(.9,.9,.9,1),this.overColor=CoMaterial.createColor4(1,1,1,1),this.pickTestRadius=10,this.m_ctrList=r.s_list,this.m_ctrList.push(this)}}r.s_list=[],e.ScaleCtr=r},b633:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(t,e,i){this.m_pv0=CoMath.createVec3(),this.m_pv1=CoMath.createVec3(),this.m_tester=null,this.m_vs=t,this.m_rayTestRadius=i,this.m_lsTotal=e}setPrevTester(t){t!=this&&(this.m_tester=t)}testRay(t,e,i,s){if(null!=this.m_tester&&this.m_tester.testRay(t,e,i,s)>0)return 0;let r=0,n=this.m_vs,o=!1,a=this.m_rayTestRadius,l=this.m_pv0,h=this.m_pv1;const c=CoAGeom.RayLine;for(let m=0;m<this.m_lsTotal;++m){if(l.setXYZ(n[r],n[r+1],n[r+2]),h.setXYZ(n[r+3],n[r+4],n[r+5]),o=c.IntersectSegmentLine(t,e,l,h,i,a),o)return 1;r+=6}return 0}destroy(){this.m_vs=null}}e.DashedLineRayTester=s},c16d:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("956f"),r=i("7281"),n=i("4362"),o=i("d1de"),a=i("f042");class l{constructor(){this.m_rsc=null,this.m_enabled=!1,this.m_controllers=[null,null,null],this.m_camVer=-7,this.m_ctrVer=-7,this.m_scale=.015,this.m_targets=null,this.m_valueFilter=null,this.m_movedCtr=null,this.m_scaleCtr=null,this.m_rotatedCtr=null,this.m_bodyContainer=null,this.m_type=-1,this.m_local=!1,this.m_global=!0,this.TRANSLATION=0,this.SCALE=1,this.ROTATION=2}setCtrlValueFilter(t){if(this.m_valueFilter=t,t){let e=this.m_controllers;for(let i=0;i<e.length;++i)e[i]&&(e[i].getCtrlTarget().valueFilter=t)}}isLocal(){return this.m_local}isGlobal(){return this.m_global}toLocal(){this.m_local=!0,this.m_global=!1;let t=this.m_bodyContainer;t.setRotation3(this.getTargetRotation()),t.update(),this.run(!0)}toGlobal(){this.m_local=!1,this.m_global=!0;let t=this.m_bodyContainer;t.setRotation3(a.VoxMath.createVec3()),t.update(),this.run(!0)}getContainer(){return this.m_bodyContainer}setScale(t){this.m_scale=t}getScale(){return this.m_scale}initialize(t,e=0){if(null==this.m_rsc){let i=o.VoxRScene.createDisplayEntityContainer();i.uuid="bodyContainer";let a=o.VoxRScene.createDisplayEntityContainer(),l=o.VoxRScene.createDisplayEntityContainer(),h=o.VoxRScene.createDisplayEntityContainer();i.addChild(a),i.addChild(l),i.addChild(h),this.m_bodyContainer=i,t.addContainer(i,e),this.m_rsc=t,this.m_pv=CoMath.createVec3(),this.m_wpos=CoMath.createVec3();let c=this.m_controllers,m=this.m_movedCtr=new s.DragMoveController;m.axisSize=100,m.planeSize=30,m.pickTestAxisRadius=10,m.runningVisible=!0,m.initialize(t,a,i),m.getCtrlTarget().type=this.TRANSLATION,m.disable(),m.setVisible(!1),c[0]=m;let _=this.m_scaleCtr=new r.DragScaleController;_.axisSize=100,_.planeSize=30,_.pickTestAxisRadius=10,_.initialize(t,h,i),_.getCtrlTarget().type=this.SCALE,_.disable(),_.setVisible(!1),c[1]=_;let u=this.m_rotatedCtr=new n.DragRotationController;u.pickTestAxisRadius=10,u.runningVisible=!0,u.initialize(t,l,i),u.getCtrlTarget().type=this.ROTATION,u.disable(),u.setVisible(!1),c[2]=u,this.setCtrlValueFilter(this.m_valueFilter),this.toTranslation(),this.disable()}}getTargetRotation(){return this.m_rotatedCtr.getCtrlTarget().rotation}addEventListener(t,e,i,s=!0,r=!1){let n=this.m_controllers;for(let o=0;o<n.length;++o)n[o].addEventListener(t,e,i,s,r)}removeEventListener(t,e,i){let s=this.m_controllers;for(let r=0;r<s.length;++r)s[r].removeEventListener(t,e,i)}toTranslation(){this.enable(this.TRANSLATION)}toScale(){this.enable(this.SCALE)}toRotation(){this.enable(this.ROTATION)}getCurrType(){return this.m_type}enable(t=-1){let e=this.m_controllers,i=this.m_type;if(this.m_enabled=!0,t>=0&&t<=2){if(i!=t){let s=this.m_targets;i>=0&&(null==s&&(s=e[i].getTargets()),this.m_bodyContainer.getPosition(this.m_wpos),e[i].decontrol(),e[i].disable(),e[i].setVisible(!1)),this.m_camVer=-7,this.m_type=t,this.applyCtrl(t,s)}}else this.applyCtrl(i)}applyCtrl(t,e=null){t>=0&&(this.m_controllers[t].enable(),e&&this.select(e,this.m_wpos,!1),this.m_local?this.toLocal():this.toGlobal())}disable(t=!1){this.m_enabled=!1,this.m_targets=null;let e=this.m_controllers,i=this.m_type;i>=0&&(e[i].decontrol(),e[i].disable(),e[i].setVisible(!1)),t&&(this.m_type=-1)}decontrol(){null!=this.m_rsc&&this.m_enabled&&this.m_type>=0&&this.m_controllers[this.m_type].decontrol()}destroy(){null!=this.m_rsc&&(this.decontrol(),this.m_rsc=null)}select(t,e=null,i=!0){if(t)if(this.m_type>=0){if(null==e){let e=this.m_wpos,i=CoMath.createVec3();e.setXYZ(0,0,0);for(let s=0;s<t.length;++s)e.addBy(t[s].getPosition(i));e.scaleBy(1/t.length)}else this.m_wpos.copyFrom(e);this.m_camVer=-7;const s=this.m_controllers[this.m_type];i&&!s.isEnabled()&&(this.m_enabled=!0,s.enable()),s.deselect(),s.setPosition(this.m_wpos),s.update(),s.select(t),s.setVisible(!0),this.updateSize(this.m_rsc,s)}else this.m_targets=t,this.m_wpos.copyFrom(e)}updateSize(t,e,i=!1){t.updateCamera();let s=t.getCamera();if(this.m_camVer!=s.version||this.m_ctrVer!=e.getVersion()||i){const t=this.m_pv;this.m_bodyContainer.getPosition(t);let i=s.getViewMatrix();i.transformVector3Self(t);let r=-this.m_scale*t.z/s.getZNear();e.setCtrlScaleXYZ(r,r,r),e.updateCtrl(),this.m_camVer=s.version,this.m_ctrVer=e.getVersion()}}run(t=!1){let e=this.m_rsc;if(e&&this.m_enabled&&this.m_type>=0){let i=this.m_controllers[this.m_type];this.updateSize(e,i,t),i.run(t)}}}e.TransformController=l},cdd5:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("3477"),r=i("2b49"),n=i("e50b");class o extends r.RotationCtr{constructor(){super(),this.m_cv=CoMath.createVec3(),this.m_planeNV=CoMath.createVec3(),this.m_initNV=CoMath.createVec3(),this.m_outV=CoMath.createVec3(),this.m_preRotV=CoMath.createVec3(),this.m_rotV=CoMath.createVec3(),this.m_camPos=CoMath.createVec3(),this.m_initDegree=0,this.m_planeDis=0,this.m_type=0,this.m_material=null,this.m_ring=null,this.m_entity=null,this.m_circle=null,this.m_editRS=null}initialize(t,e,i,r,o){if(null==this.m_entity){this.m_editRS=t,this.m_container=e,this.m_ring=new n.RotationRing,this.m_entity=CoEntity.createDisplayEntity(),this.m_circle=CoEntity.createDisplayEntity();let a,l,h=CoMesh.line;h.dynColorEnabled=!0,this.m_type=o;let c=CoMath.createVec3(),m=this.m_planeNV;switch(o){case 1:a=h.createCircleXOZ(i,Math.round(.5*r),null,0,Math.PI),l=h.createCircleXOZ(i,r),m.setXYZ(0,1,0),c.setXYZ(0,0,1);break;case 2:a=h.createCircleYOZ(i,Math.round(.5*r),null,0,Math.PI),l=h.createCircleYOZ(i,r),m.setXYZ(1,0,0),c.setXYZ(0,0,1);break;default:a=h.createCircleXOY(i,Math.round(.5*r),null,0,Math.PI),l=h.createCircleXOY(i,r),m.setXYZ(0,0,1),c.setXYZ(0,1,0),o=0;break}this.m_initNV.copyFrom(m),a.setRayTester(new s.CircleRayTester(i,this.m_cv,c,m,this.m_planeDis,this.pickTestRadius)),this.m_entity.setMesh(a),this.m_material=CoMaterial.createLineMaterial(h.dynColorEnabled),this.m_material.setColor(this.outColor),this.m_entity.setMaterial(this.m_material),this.m_entity.update(),this.m_circle.setMesh(l),this.m_circle.setMaterial(this.m_material),this.m_circle.update(),this.m_circle.setVisible(!1),this.applyEvent(this.m_entity),e.addEntity(this.m_entity),e.addEntity(this.m_circle),this.m_ring.initialize(t,e,i,120,o),this.m_ring.setVisible(!1)}}run(t,e,i){let s=this.m_outV,r=this.m_camPos.copyFrom(t.getPosition()),n=this.m_target.container;n.globalToLocal(this.m_camPos),this.m_planeNV.copyFrom(this.m_initNV),s.copyFrom(this.m_camPos);let o=s.dot(this.m_planeNV);s.copyFrom(this.m_planeNV),s.scaleBy(-o),s.addBy(r);let a=CoMath.MathConst;const l=this.m_entity;let h=0;switch(this.m_type){case 0:h=-a.GetDegreeByXY(s.x,s.y),l.setRotationXYZ(0,0,270-h),l.update();break;case 1:h=-a.GetDegreeByXY(s.x,s.z),l.setRotationXYZ(0,90+h,0),l.update();break;case 2:h=-a.GetDegreeByXY(s.z,s.y),l.setRotationXYZ(h,0,0),l.update();break;default:break}}setVisible(t){return this.m_entity.setVisible(t),t||this.m_ring.setVisible(t),this}getVisible(){return this.m_entity.getVisible()}enable(){super.enable(),this.m_entity.mouseEnabled=!0}disable(){super.disable(),this.m_entity.mouseEnabled=!1}showOverColor(){this.m_entity.getMaterial().setColor(this.overColor)}showOutColor(){this.m_entity.getMaterial().setColor(this.outColor),this.m_ring.setColor(this.outColor)}deselect(){this.isSelected()&&(super.deselect(),this.m_circle.getVisible()&&(this.m_entity.setVisible(!0),this.m_circle.setVisible(!1)),this.m_ring.setVisible(!1))}destroy(){super.destroy(),this.m_entity&&(this.m_container.removeEntity(this.m_entity),this.m_entity.destroy(),this.m_entity=null),this.m_circle&&(this.m_container.removeEntity(this.m_circle),this.m_circle.destroy(),this.m_circle=null),this.m_ring&&(this.m_ring.destroy(),this.m_ring=null),this.m_container=null,this.m_editRS=null,this.m_cv=null,this.m_planeNV=null}moveByRay(t,e,i=!1){if(this.isEnabled()&&this.isSelected()){let i=this.getDegree(t,e);i-=this.m_initDegree,this.m_ring.setProgress(i/360);let s=this.m_target;if(s){let t=this.m_rotV,e=this.m_preRotV;switch(s.getRotationXYZ(t),this.m_type){case 1:t.y=e.y+i;break;case 2:t.x=e.x+i;break;default:t.z=e.z+i;break}s.setRotation3(t),s.update()}}}mouseDownListener(t){this.isEnabled()&&(this.editBegin(),this.m_target.select(),this.m_entity.setVisible(!1),this.m_circle.setVisible(!0),this.setThisVisible(!0),this.m_initDegree=this.getDegree(t.raypv,t.raytv),this.m_ring.setVisible(!0),this.m_ring.setRingRotation(this.m_initDegree),this.m_ring.setProgress(0),this.m_preRotV.setXYZ(0,0,0),this.m_target&&this.m_target.getRotationXYZ(this.m_preRotV))}getDegree(t,e){let i=0;if(this.isSelected()){this.m_planeNV.copyFrom(this.m_initNV),this.m_target.container.getMatrix().deltaTransformVectorSelf(this.m_planeNV);let s=CoAGeom.PlaneUtils;this.m_target.getPosition(this.m_outV);let r=this.m_planeNV.dot(this.m_outV),n=s.IntersectRayLinePos2(this.m_planeNV,r,t,e,this.m_outV),o=this.m_outV;if(this.m_circle.globalToLocal(o),n){n=s.Intersection==CoAGeom.Intersection.Hit;let t=CoMath.Vector3D;if(n&&t.Distance(o,this.m_cv)>2){o.subtractBy(this.m_cv);let t=this.m_target;if(null!=t){switch(this.m_type){case 1:i=CoMath.MathConst.GetDegreeByXY(o.x,o.z),i=-i;break;case 2:i=CoMath.MathConst.GetDegreeByXY(o.y,o.z);break;default:i=CoMath.MathConst.GetDegreeByXY(o.x,o.y);break}i>360?i-=360:i<0&&(i+=360)}}}}return i}}e.RotationCircle=o},d1de:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("75f5"),r=i("dab7");var n=null;e.RendererDevice=n;var o=null;e.SelectionEvent=o;var a=null;e.ProgressDataEvent=a;var l=null;e.MouseEvent=l;var h=null;e.EventBase=h;var c=null;e.RendererState=c;var m=null;e.TextureConst=m;var _=null;e.Keyboard=_;var u=null;e.KeyboardEvent=u;var d=null;e.RenderDrawMode=d;var y=null;e.CullFaceMode=y;var p=null;e.DepthTestMode=p;var C=null;e.RenderBlendMode=C;var g=null;e.GLStencilFunc=g;var M=null;e.GLStencilOp=M;var v=null;e.GLBlendMode=v;var b=null;e.GLBlendEquation=b;class V{constructor(){this.m_init=!0}init(){const t=CoRScene,i=CoRenderer;"undefined"!==typeof t&&(e.RendererDevice=n=t.RendererDevice,e.SelectionEvent=o=t.SelectionEvent,e.ProgressDataEvent=a=t.ProgressDataEvent,e.EventBase=h=t.EventBase,e.MouseEvent=l=t.MouseEvent,e.RendererState=c=t.RendererState,e.TextureConst=m=t.TextureConst,e.Keyboard=_=t.Keyboard,e.KeyboardEvent=u=t.KeyboardEvent,e.RenderDrawMode=d=i.RenderDrawMode,e.CullFaceMode=y=i.CullFaceMode,e.DepthTestMode=p=i.DepthTestMode,e.RenderBlendMode=C=i.RenderBlendMode,e.GLStencilFunc=g=i.GLStencilFunc,e.GLStencilOp=M=i.GLStencilOp,e.GLBlendMode=v=i.GLBlendMode,e.GLBlendEquation=b=i.GLBlendEquation)}initialize(t=null,e=""){if(this.m_init=!this.isEnabled(),this.m_init||(r.VoxRenderer.initialize(),this.init()),this.m_init){this.m_init=!1;let i=!1,n=0,o="";return i=r.VoxRenderer.initialize(i=>{o=i[0],n++,n>1&&null!=t&&this.isEnabled()&&t([o,e])}),""!=e&&void 0!==e||(e="static/cospace/engine/rscene/CoRScene.umd.min.js"),new s.ModuleLoader(1,()=>{r.VoxRenderer.initialize(),this.init(),i?(n++,n>1&&null!=t&&this.isEnabled()&&t([o,e])):null!=t&&"undefined"!==typeof CoRScene&&t([e])}).load(e),!0}return!1}get RendererDevice(){return CoRScene.RendererDevice}get RendererState(){return CoRScene.RendererState}get RenderDrawMode(){return CoRScene.RenderDrawMode}get VtxBufConst(){return CoRScene.VtxBufConst}get TextureConst(){return CoRScene.TextureConst}get Vector3D(){return CoRScene.Vector3D}get MouseEvent(){return CoRScene.MouseEvent}get EventBase(){return CoRScene.EventBase}get SelectionEvent(){return CoRScene.SelectionEvent}get ProgressDataEvent(){return CoRScene.ProgressDataEvent}get KeyboardEvent(){return CoRScene.KeyboardEvent}get Keyboard(){return CoRScene.Keyboard}get ShaderCodeUUID(){return CoRScene.ShaderCodeUUID}get MaterialContextParam(){return CoRScene.MaterialContextParam}get MaterialPipeType(){return CoRScene.MaterialPipeType}createSelectionEvent(){return CoRScene.createSelectionEvent()}createProgressDataEvent(){return CoRScene.createProgressDataEvent()}createVec3(t,e,i,s){return CoRScene.createVec3(t,e,i,s)}createMat4(t,e){return CoRScene.createMat4(t,e)}createColor4(t,e,i,s){return CoRScene.createColor4(t,e,i,s)}createAABB(){return CoRScene.createAABB()}applySceneBlock(t){return CoRScene.applySceneBlock(t)}createRendererSceneParam(t){return CoRScene.createRendererSceneParam(t)}createRendererScene(t,e,i){return CoRScene.createRendererScene(t,e,i)}setRendererScene(t){return CoRScene.setRendererScene(t)}getRendererScene(){return CoRScene.getRendererScene()}createMouseEvt3DDispatcher(){return CoRScene.createMouseEvt3DDispatcher()}createEventBaseDispatcher(){return CoRScene.createEventBaseDispatcher()}createVtxDrawingInfo(){return CoRScene.createVtxDrawingInfo()}createDefaultMaterial(t){return CoRScene.createDefaultMaterial()}createLineMaterial(t){return CoRScene.createLineMaterial(t)}createQuadLineMaterial(t){return CoRScene.createQuadLineMaterial(t)}createShaderMaterial(t){return CoRScene.createShaderMaterial(t)}createMaterial(t){return CoRScene.createMaterial(t)}createDataMesh(){return CoRScene.createDataMesh()}createRawMesh(){return CoRScene.createRawMesh()}createBoundsMesh(){return CoRScene.createBoundsMesh()}createDataMeshFromModel(t,e,i){return CoRScene.createDataMeshFromModel(t,e,i)}createDisplayEntityFromModel(t,e,i){return CoRScene.createDisplayEntityFromModel(t,e,i)}createFreeAxis3DEntity(t,e,i){return CoRScene.createFreeAxis3DEntity(t,e,i)}createAxis3DEntity(t,e){return CoRScene.createAxis3DEntity(t,e)}createCrossAxis3DEntity(t,e){return CoRScene.createCrossAxis3DEntity(t,e)}createDisplayEntityWithDataMesh(t,e,i){return CoRScene.createDisplayEntityWithDataMesh(t,e,i)}createDisplayEntity(t){return CoRScene.createDisplayEntity(t)}createMouseEventEntity(t){return CoRScene.createMouseEventEntity(t)}createBoundsEntity(t){return CoRScene.createBoundsEntity(t)}createDisplayEntityContainer(){return CoRScene.createDisplayEntityContainer()}creatMaterialContextParam(){return CoRScene.creatMaterialContextParam()}createMaterialContext(){return CoRScene.createMaterialContext()}VerticalCCWOnXOY(t){return CoRScene.VerticalCCWOnXOY(t)}VerticalCWOnXOY(t){return CoRScene.VerticalCWOnXOY(t)}createRendererSceneGraph(){return CoRScene.createRendererSceneGraph()}createEvtNode(){return CoRScene.createEvtNode()}isEnabled(){return r.VoxRenderer.isEnabled()&&"undefined"!==typeof CoRScene}}const f=new V;e.VoxRScene=f},d51f:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("832f"),r=i("abf9");class n extends r.ScaleCtr{constructor(){super(),this.m_entity=null,this.m_rscene=null,this.m_billPos=null,this.m_circle=null,this.m_planeNV=CoMath.createVec3(0,1,0),this.m_planePos=CoMath.createVec3(),this.m_planeDis=0,this.m_pos=CoMath.createVec3(),this.m_dv=CoMath.createVec3(),this.m_outV=CoMath.createVec3(),this.m_rpv=CoMath.createVec3(),this.m_rtv=CoMath.createVec3(),this.m_sv=CoMath.createVec3(),this.m_dis=1}initialize(t,e,i=30){if(null==this.m_entity){this.transFlag=1,this.m_rscene=t,this.m_container=e;let r=CoEntity.createBoundsEntity(),n=.5*i,o=CoMath.createVec3(n,n,n).scaleBy(-1),a=CoMath.createVec3(n,n,n);r.setBounds(o,a),r.setRayTester(new s.SphereRayTester(n)),this.applyEvent(r),e.addChild(r),this.m_entity=r;let l=CoParticle.createBillboard();l.initializeSquare(.2*n,[this.createTexByUrl("static/assets/circle01.png")]),e.addEntity(l.entity);let h=CoRScene.RendererState;l.entity.setRenderState(h.NONE_TRANSPARENT_ALWAYS_STATE),this.m_billPos=l;let c=Math.floor(.5*n),m=CoParticle.createBillboardLine();m.initializeCircleXOY(n,c<50?50:c),e.addEntity(m.entity),m.entity.setRenderState(h.NONE_TRANSPARENT_ALWAYS_STATE),this.m_circle=m,this.showOutColor()}}createTexByUrl(t=""){let e=this.m_rscene.textureBlock.createImageTex2D(64,64,!1),i=new Image;return i.onload=t=>{e.setDataFromImage(i,0,0,0,!1)},i.src=""!=t?t:"static/assets/box.jpg",e}getEntity(){return this.m_entity}showOverColor(){let t=this.overColor;this.m_circle.setRGB3f(t.r,t.g,t.b)}showOutColor(){let t=this.outColor;this.m_circle.setRGB3f(t.r,t.g,t.b)}enable(){super.enable(),this.m_entity.mouseEnabled=!0}disable(){super.disable(),this.m_entity.mouseEnabled=!1}setRenderState(t){this.m_entity.setRenderState(t)}setVisible(t){return this.m_entity.setVisible(t),this.m_circle.entity.setVisible(t),this.m_billPos.entity.setVisible(t),this}getVisible(){return this.m_entity.getVisible()}setScaleXYZ(t,e,i){return this.m_entity.setScaleXYZ(t,e,i),this.m_circle.setScaleXY(t,e),this.m_billPos.setScaleXY(t,e),this.m_entity.update(),this.m_circle.update(),this.m_billPos.update(),this}destroy(){super.destroy(),this.m_entity&&(this.m_container.removeEntity(this.m_entity),this.m_entity.destroy()),this.m_circle&&(this.m_container.removeEntity(this.m_circle.entity),this.m_circle.destroy()),this.m_billPos&&(this.m_container.removeEntity(this.m_billPos.entity),this.m_billPos.destroy()),this.m_entity=null,this.m_circle=null,this.m_billPos=null,this.m_container=null,this.m_rscene=null}calcClosePos(t,e){CoAGeom.PlaneUtils.IntersectLinePos2(this.m_planeNV,this.m_planeDis,t,e,this.m_outV)}moveByRay(t,e,i=!1){if(this.isEnabled()&&this.isSelected()){this.m_rpv.copyFrom(t),this.m_rtv.copyFrom(e),this.calcClosePos(this.m_rpv,this.m_rtv);let i=CoMath.Vector3D,s=i.Distance(this.m_pos,this.m_outV);s<1&&(s=1);const r=this.m_sv;let n=s/this.m_dis;this.m_target&&(this.m_target.setScaleXYZ(r.x*n,r.y*n,r.z*n),this.m_target.update())}}setPlaneNormal(t){this.m_planeNV.copyFrom(t),this.m_planeNV.normalize()}selectByParam(t,e,i){this.m_rpv.copyFrom(t),this.m_rtv.copyFrom(e),this.m_planePos.copyFrom(i),this.m_planeNV.copyFrom(this.m_rtv),this.m_planeNV.normalize(),this.m_planeDis=this.m_planePos.dot(this.m_planeNV),this.calcClosePos(this.m_rpv,this.m_rtv),this.m_target.getPosition(this.m_dv),this.m_dv.subtractBy(this.m_outV)}mouseDownListener(t){if(this.isEnabled()){this.editBegin(),this.setThisVisible(!0),this.m_target.select(),this.selectByParam(t.raypv,t.raytv,t.wpos),this.m_target.getScaleXYZ(this.m_sv),this.m_target.getPosition(this.m_pos);let e=CoMath.Vector3D;this.m_dis=e.Distance(this.m_pos,this.m_outV),this.m_dis<1&&(this.m_dis=1)}}}e.default=n},dab7:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("75f5");var r,n,o,a,l,h,c,m;e.RenderDrawMode=r,e.CullFaceMode=n,e.DepthTestMode=o,e.RenderBlendMode=a,e.GLStencilFunc=l,e.GLStencilOp=h,e.GLBlendMode=c,e.GLBlendEquation=m;class _{constructor(){this.m_init=!0}init(){"undefined"!==typeof CoRenderer&&(e.RenderDrawMode=r=CoRenderer.RenderDrawMode,e.CullFaceMode=n=CoRenderer.CullFaceMode,e.DepthTestMode=o=CoRenderer.DepthTestMode,e.RenderBlendMode=a=CoRenderer.RenderBlendMode,e.GLStencilFunc=l=CoRenderer.GLStencilFunc,e.GLStencilOp=h=CoRenderer.GLStencilOp,e.GLBlendMode=c=CoRenderer.GLBlendMode,e.GLBlendEquation=m=CoRenderer.GLBlendEquation)}initialize(t=null,e=""){return this.init(),this.m_init=!this.isEnabled(),!!this.m_init&&(this.m_init=!1,""!=e&&void 0!==e||(e="static/cospace/engine/renderer/CoRenderer.umd.min.js"),new s.ModuleLoader(1,()=>{this.init(),null!=t&&this.isEnabled()&&t([e])}).load(e),!0)}get RenderDrawMode(){return CoRenderer.RenderDrawMode}get CullFaceMode(){return CoRenderer.CullFaceMode}get DepthTestMode(){return CoRenderer.DepthTestMode}get RenderBlendMode(){return CoRenderer.RenderBlendMode}get GLStencilFunc(){return CoRenderer.GLStencilFunc}get GLStencilOp(){return CoRenderer.GLStencilOp}get GLBlendMode(){return CoRenderer.GLBlendMode}get GLBlendEquation(){return CoRenderer.GLBlendEquation}get RendererDevice(){return CoRenderer.RendererDevice}get RendererState(){return CoRenderer.RendererState}createRendererInstance(){return CoRenderer.createRendererInstance()}isEnabled(){return"undefined"!==typeof CoRenderer}}const u=new _;e.VoxRenderer=u},df9f:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("7d28");class r{constructor(){this.m_enabled=!1,this.m_flag=-1,this.m_dispatcher=null,this.m_target=null,this.m_ctrList=null,this.editType="",this.runningVisible=!0,this.uuid="editCtrl",this.moveSelfEnabled=!0,this.transFlag=0;let t=new Map;const e=s.UserEditEvent;let i=CoRScene.createEvtNode();i.type=e.EDIT_BEGIN,t.set(i.type,i),i=CoRScene.createEvtNode(),i.type=e.EDIT_END,t.set(i.type,i),this.m_evtMap=t}editBegin(){this.m_flag=1;let t=this.m_evtMap.get(s.UserEditEvent.EDIT_BEGIN),e=t.createEvent(this,this);t.dispatch(e),e.target=null,e.currentTarget=null}editEnd(){this.m_flag=-1;let t=this.m_evtMap.get(s.UserEditEvent.EDIT_END),e=t.createEvent(this,this);t.dispatch(e),e.target=null,e.currentTarget=null}enable(){this.m_enabled=!0}disable(){this.m_enabled=!1}isEnabled(){return this.m_enabled}isSelected(){return this.m_flag>-1}select(){}deselect(){this.isSelected()&&(this.editEnd(),this.setAllVisible(!0))}setVisible(t){return this}getVisible(){return!1}getGlobalBounds(){return null}getLocalBounds(){return null}addEventListener(t,e,i,s=!0,r=!1){if(this.m_evtMap.has(t)){let s=this.m_evtMap.get(t);s.addListener(e,i)}else this.m_dispatcher.addEventListener(t,e,i,s,r)}removeEventListener(t,e,i){if(this.m_evtMap.has(t)){let s=this.m_evtMap.get(t);s.removeListener(e,i)}else this.m_dispatcher.removeEventListener(t,e,i)}setTarget(t){this.m_target=t}getTargetEntities(){if(this.m_target)return this.m_target.getTargets()}applyEvent(t){if(null==this.m_dispatcher){const t=CoRScene.MouseEvent;let e=CoRScene.createMouseEvt3DDispatcher();e.addEventListener(t.MOUSE_DOWN,this,this.mouseDownListener),e.addEventListener(t.MOUSE_OVER,this,this.mouseOverListener),e.addEventListener(t.MOUSE_OUT,this,this.mouseOutListener),this.m_dispatcher=e}t.setEvtDispatcher(this.m_dispatcher),t.mouseEnabled=!0}mouseOverListener(t){this.showOverColor()}mouseOutListener(t){this.showOutColor()}mouseDownListener(t){}setMaterialColor(t,e,i=1){t.setRGBA4f(e.r*i,e.g*i,e.b*i,e.a)}setEntityColor(t,e,i=1){t.getMaterial().setRGBA4f(e.r*i,e.g*i,e.b*i,e.a)}showOverColor(){}showOutColor(){}run(t,e,i){}destroy(){if(this.m_target=null,this.m_ctrList=null,null!=this.m_dispatcher){for(var[t,e]of this.m_evtMap.entries())e.destroy();this.m_dispatcher.destroy(),this.m_dispatcher=null}}setAllVisible(t){let e=this.m_ctrList;for(let i=0;i<e.length;++i)e[i].setVisible(t)}setThisVisible(t){let e=this.m_ctrList;if(t)for(let i=0;i<e.length;++i)e[i].setVisible(e[i]==this);else for(let i=0;i<e.length;++i)e[i].setVisible(e[i]!=this)}setXYZ(t,e,i){throw Error("illegal operations !!!")}setPosition(t){throw Error("illegal operations !!!")}getScaleXYZ(t){throw Error("illegal operations !!!")}setRotation3(t){throw Error("illegal operations !!!")}setRotationXYZ(t,e,i){throw Error("illegal operations !!!")}getRotationXYZ(t){throw Error("illegal operations !!!")}getPosition(t){throw Error("illegal operations !!!")}setScaleXYZ(t,e,i){throw Error("illegal operations !!!")}localToGlobal(t){throw Error("illegal operations !!!")}globalToLocal(t){throw Error("illegal operations !!!")}update(){throw Error("illegal operations !!!")}}e.UserEditCtr=r},e50b:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.m_container=null,this.m_ring=null,this.m_material=null,this.m_type=0,this.m_total=0,this.m_parentContainer=null}initialize(t,e,i,s,r){if(null==this.m_container){this.m_parentContainer=e;let t=CoEntity.createDisplayEntity();this.m_container=CoEntity.createDisplayEntityContainer();let n,o=CoMesh.line;o.dynColorEnabled=!0,this.m_type=r;let a=0,l=null,h=0;const c=.95;let m=2*Math.PI;switch(l=new Array(2*s),this.m_total=s,r){case 1:for(let t=s-1;t>=0;--t){a=m*t/s;const e=i*Math.cos(a),r=i*Math.sin(a);l[h++]=CoMath.createVec3(e,0,r),l[h++]=CoMath.createVec3(e*c,0,r*c)}break;case 2:for(let t=0;t<s;++t){a=m*t/s;const e=i*Math.cos(a),r=i*Math.sin(a);l[h++]=CoMath.createVec3(0,e,r),l[h++]=CoMath.createVec3(0,e*c,r*c)}break;default:for(let t=0;t<s;++t){a=m*t/s;const e=i*Math.cos(a),r=i*Math.sin(a);l[h++]=CoMath.createVec3(e,r,0),l[h++]=CoMath.createVec3(e*c,r*c,0)}break}n=o.createLines(l),t.setMesh(n),this.m_material=CoMaterial.createLineMaterial(o.dynColorEnabled),this.m_material.vtxInfo=CoRScene.createVtxDrawingInfo(),t.setMaterial(this.m_material),t.update(),this.m_ring=t,this.m_container.addEntity(t),this.m_parentContainer.addChild(this.m_container)}}getContainer(){return this.m_container}setProgress(t){if(null!=this.m_ring){t<0&&(t+=2*Math.round(t)),t-=Math.floor(t);let e=2*this.m_total,i=Math.round(e*t)+2;i>e&&(i=e),this.m_ring.getMaterial().vtxInfo.setIvsParam(0,i)}}setRingRotation(t){if(null!=this.m_ring){switch(this.m_type){case 1:this.m_ring.setRotationXYZ(0,t,0);break;case 2:this.m_ring.setRotationXYZ(t,0,0);break;default:this.m_ring.setRotationXYZ(0,0,t);break}this.m_ring.update()}}setVisible(t){this.m_container.setVisible(t)}getVisible(){return this.m_container.getVisible()}setRotation3(t){this.m_container.setRotation3(t)}setScale3(t){this.m_container.setScale3(t)}setColor(t){this.m_ring.getMaterial().setColor(t)}setPosition(t){this.m_container.setPosition(t)}destroy(){this.m_container&&(this.m_parentContainer.removeChild(this.m_container),this.m_container.destroy(),this.m_container=null),this.m_parentContainer=null}}e.RotationRing=s},eaa4:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("2b49"),r=i("832f");class n extends s.RotationCtr{constructor(){super(),this.m_entity=null,this.m_rotV=CoMath.createVec3(),this.m_scaleV=CoMath.createVec3(),this.m_posV=CoMath.createVec3(),this.m_srcDV=CoMath.createVec3(),this.m_dstDV=CoMath.createVec3(),this.m_camPos=CoMath.createVec3(),this.m_mat0=CoMath.createMat4(),this.m_stage=null,this.m_stagePos=CoMath.createVec3(),this.m_circle=null,this.m_editRS=null,this.m_camVer=-7}initialize(t,e,i){if(null==this.m_entity){this.m_editRS=t,this.m_container=e,this.m_stage=t.getStage3D();let s=CoEntity.createBoundsEntity(),n=CoMath.createVec3(i,i,i).scaleBy(-1),o=CoMath.createVec3(i,i,i);s.setBounds(n,o),s.setRayTester(new r.SphereRayTester(i)),this.applyEvent(s),this.m_entity=s;let a=Math.floor(i/2);a<30&&(a=30);let l=CoRScene.RendererState,h=CoMath.createMat4();h.setRotationEulerAngle(.5*Math.PI,0,.5*Math.PI);let c=CoMesh.plane;c.transMatrix=h;let m=CoMaterial.createDefaultMaterial(!1);m.initializeByCodeBuf(!1),c.setBufSortFormat(m.getBufSortFormat());let _=c.createCircle(i,a),u=CoEntity.createDisplayEntity();u.setMaterial(m),u.setMesh(_),u.setRenderState(l.NONE_TRANSPARENT_ALWAYS_STATE),this.m_container.addEntity(u),this.m_circle=u,this.applyEvent(s),this.m_container.addEntity(this.m_entity)}}enable(){super.enable(),this.m_entity.mouseEnabled=!0}disable(){super.disable(),this.m_entity.mouseEnabled=!1}run(t,e,i=!1){if(this.m_camVer!=t.version||i){this.m_camVer=t.version;const e=this.m_scaleV;let i=this.m_circle;i.getPosition(this.m_posV),i.getScaleXYZ(e),this.m_camPos.copyFrom(t.getPosition());let s=this.m_target.container;s.globalToLocal(this.m_camPos),this.m_srcDV.setXYZ(1,0,0),this.m_dstDV.subVecsTo(this.m_camPos,this.m_posV);let r=CoMath.Vector3D.RadianBetween(this.m_srcDV,this.m_dstDV),n=this.m_rotV;CoMath.Vector3D.Cross(this.m_srcDV,this.m_dstDV,n),n.normalize();let o=this.m_mat0;o.identity(),o.appendRotation(r,n);let a=o.decompose(CoMath.OrientationType.EULER_ANGLES)[1];i.setPosition(this.m_posV),i.setScale3(e),i.setRotation3(a.scaleBy(CoMath.MathConst.MATH_180_OVER_PI))}}setVisible(t){return this.m_entity.setVisible(t),this.m_circle.setVisible(t),this.m_camVer=-7,this}getVisible(){return this.m_entity.getVisible()}showOverColor(){this.overColor.a=.1,this.m_circle.getMaterial().setColor(this.overColor)}showOutColor(){this.outColor.a=.05,this.m_circle.getMaterial().setColor(this.outColor)}destroy(){super.destroy(),null!=this.m_entity&&(this.m_container.removeEntity(this.m_entity),this.m_entity.destroy(),this.m_entity=null),this.m_container=null,this.m_editRS=null,this.m_stage=null,this.m_mat0=null}moveByRay(t,e,i=!1){if(this.isEnabled()&&this.isSelected()){let t=this.m_target;if(null!=t){const e=.02;let i=this.m_editRS.getCamera(),s=i.getUV(),r=i.getRV(),n=this.m_stagePos,o=this.m_stage,a=this.m_mat0,l=o.mouseX-n.x,h=n.y-o.mouseY,c=this.m_rotV;a.identity(),a.appendRotation(l*e,s),a.appendRotation(h*e,r),c=a.decompose(CoMath.OrientationType.EULER_ANGLES)[1],t.setRotation3(c.scaleBy(CoMath.MathConst.MATH_180_OVER_PI)),t.update()}}}mouseDownListener(t){if(this.isEnabled()){this.editBegin(),this.m_target.select(),this.setThisVisible(!0);let t=this.m_stage;this.m_stagePos.setXYZ(t.mouseX,t.mouseY,0)}}}e.RotationCamXYCircle=n},ec63:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("aae9");class r extends s.MoveCtr{constructor(){super(),this.m_entity=null,this.m_frameEntity=null,this.m_container=null,this.offsetV=CoMath.createVec3(30,30,30),this.crossRay=!1,this.m_planeNV=CoMath.createVec3(0,1,0),this.m_planePos=CoMath.createVec3(),this.m_planeDis=0,this.m_pos=CoMath.createVec3(),this.m_dv=CoMath.createVec3(),this.m_outV=CoMath.createVec3(),this.m_rpv=CoMath.createVec3(),this.m_rtv=CoMath.createVec3(),this.m_initNV=CoMath.createVec3()}initialize(t,e,i,s){if(null==this.m_entity){this.m_editRS=t,this.m_container=e;const r=CoMath.Vector3D;let n=CoRScene.getRendererScene(),o=(n.entityBlock,CoRScene.createDefaultMaterial());o.initializeByCodeBuf(!1),this.m_entity=CoRScene.createDisplayEntity(),this.m_frameEntity=CoRScene.createDisplayEntity();let a=CoMesh.line;a.dynColorEnabled=!0;let l=CoMaterial.createLineMaterial(a.dynColorEnabled);l.initializeByCodeBuf(!1),a.setBufSortFormat(o.getBufSortFormat());let h=this.m_frameEntity;h.setMaterial(l);let c=this.m_entity;c.setMaterial(o);let m=CoMesh.plane;m.setBufSortFormat(o.getBufSortFormat());let _=this.offsetV;switch(i){case 0:c.setMesh(m.createXOZ(_.x,_.z,s,s)),h.setMesh(a.createRectXOZ(_.x,_.z,s,s)),this.setPlaneNormal(r.Y_AXIS);break;case 1:c.setMesh(m.createXOY(_.x,_.y,s,s)),h.setMesh(a.createRectXOY(_.x,_.y,s,s)),this.setPlaneNormal(r.Z_AXIS);break;case 2:c.setMesh(m.createYOZ(_.y,_.z,s,s)),h.setMesh(a.createRectYOZ(_.y,_.z,s,s)),this.setPlaneNormal(CoMath.Vector3D.X_AXIS);break;default:throw Error("Error type !!!")}c.setRenderState(CoRScene.RendererState.NONE_TRANSPARENT_STATE),e.addChild(c),e.addChild(h),this.showOutColor(),this.applyEvent(this.m_entity)}}showOverColor(){this.setEntityColor(this.m_entity,this.overColor),this.setEntityColor(this.m_frameEntity,this.overColor,.7)}showOutColor(){this.setEntityColor(this.m_entity,this.outColor),this.setEntityColor(this.m_frameEntity,this.outColor,.7)}enable(){super.enable(),this.m_entity.mouseEnabled=!0}disable(){super.disable(),this.m_entity.mouseEnabled=!1}setRenderState(t){this.m_entity.setRenderState(t)}setVisible(t){return this.m_entity.setVisible(t),this.m_frameEntity.setVisible(t),this}getVisible(){return this.m_entity.getVisible()}destroy(){super.destroy(),this.m_container&&(this.m_container.removeEntity(this.m_entity),this.m_container.removeEntity(this.m_frameEntity)),this.m_editRS=null,this.m_container=null,null!=this.m_entity&&this.m_entity.destroy(),null!=this.m_frameEntity&&this.m_frameEntity.destroy()}calcClosePos(t,e){CoAGeom.PlaneUtils.IntersectLinePos2(this.m_planeNV,this.m_planeDis,t,e,this.m_outV)}moveByRay(t,e,i=!1){if(this.isEnabled()&&this.isSelected()){this.m_rpv.copyFrom(t),this.m_rtv.copyFrom(e);const i=this.m_pos;this.calcClosePos(this.m_rpv,this.m_rtv),i.copyFrom(this.m_outV),i.addBy(this.m_dv),this.m_target&&(this.m_target.setPosition(i),this.m_target.update())}}mouseDownListener(t){this.isEnabled()&&(this.editBegin(),this.setThisVisible(!0),this.m_target.select(this),this.selectByParam(t.raypv,t.raytv,t.wpos))}setPlaneNormal(t){this.m_planeNV.copyFrom(t),this.m_planeNV.normalize(),this.m_initNV.copyFrom(this.m_planeNV)}selectByParam(t,e,i){this.m_rpv.copyFrom(t),this.m_rtv.copyFrom(e),this.m_planePos.copyFrom(i),this.m_planeNV.copyFrom(this.m_initNV),this.crossRay&&this.m_planeNV.copyFrom(this.m_rtv);let s=this.m_entity.getMatrix();s.deltaTransformVectorSelf(this.m_planeNV),this.m_planeNV.normalize(),this.m_planeDis=this.m_planePos.dot(this.m_planeNV),this.calcClosePos(this.m_rpv,this.m_rtv),this.m_target.getPosition(this.m_dv),this.m_dv.subtractBy(this.m_outV)}}e.default=r},f042:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("75f5");var r,n,o;e.OrientationType=r,e.MathConst=n,e.Vector3D=o;class a{constructor(){this.m_init=!0}init(){this.isEnabled()&&(e.OrientationType=r=CoMath.OrientationType,e.MathConst=n=CoMath.MathConst,e.Vector3D=o=CoMath.Vector3D)}initialize(t=null,e=""){return this.init(),this.m_init=!this.isEnabled(),!!this.m_init&&(this.m_init=!1,""!=e&&void 0!==e||(e="static/cospace/math/CoMath.umd.min.js"),new s.ModuleLoader(1,()=>{this.init(),null!=t&&this.isEnabled()&&t([e])}).load(e),!0)}isEnabled(){return"undefined"!==typeof CoMath}get Vector3D(){return CoMath.Vector3D}get MathConst(){return CoMath.MathConst}get OrientationType(){return CoMath.OrientationType}createVec3(t,e,i,s){return CoMath.createVec3(t,e,i,s)}createMat4(t,e){return CoMath.createMat4(t,e)}createAABB(){return CoMath.createAABB()}createAABB2D(t,e,i,s){return CoMath.createAABB2D(t,e,i,s)}isZero(t){return CoMath.isZero(t)}isNotZero(t){return CoMath.isNotZero(t)}isGreaterPositiveZero(t){return CoMath.isGreaterPositiveZero(t)}isLessNegativeZero(t){return CoMath.isLessNegativeZero(t)}isLessPositiveZero(t){return CoMath.isLessPositiveZero(t)}isGreaterNegativeZero(t){return CoMath.isGreaterNegativeZero(t)}isPostiveZero(t){return CoMath.isPostiveZero(t)}isNegativeZero(t){return CoMath.isNegativeZero(t)}isGreaterRealZero(t){return CoMath.isGreaterRealZero(t)}isLessRealZero(t){return CoMath.isLessRealZero(t)}}const l=new a;e.VoxMath=l},fae3:function(t,e,i){"use strict";i.r(e);i("1eb2");var s=i("36b4");for(var r in s)["default"].indexOf(r)<0&&function(t){i.d(e,t,(function(){return s[t]}))}(r)}})}));