(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t():"function"===typeof define&&define.amd?define([],t):"object"===typeof exports?exports["DSRDShell"]=t():e["DSRDShell"]=t()})("undefined"!==typeof self?self:this,(function(){return function(e){var t={};function i(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(s,n,function(t){return e[t]}.bind(null,n));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s="fae3")}({"06e0":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(){this.taskid=0,this.version=-1,this.phase="new",this.filepath="",this.taskname="",this.success=!1,this.drcsTotal=0,this.fileName="",this.time=0,this.bgTransparent=!1,this.imgResolution=[512,512],this.imgsTotal=1,this.miniImgUrls=[],this.bigImgUrl="",this.modelLoadStatus=0,this.reneringTimes=0,this.rtJsonData=null}reset(){}isModelDataLoaded(){return 2==this.modelLoadStatus}copyFromJson(e){let t=this;void 0!==e.taskid&&(t.taskid=e.taskid),e.version!==e.version&&(t.version=e.version),void 0!==e.filepath&&(t.filepath=e.filepath),void 0!==e.taskname&&(t.taskname=e.taskname),void 0!==e.success&&(t.success=e.success),void 0!==e.filepath&&(t.filepath=e.filepath),void 0!==e.fileName&&(t.fileName=e.fileName),void 0!==e.phase&&(t.phase=e.phase),void 0!==e.imgsTotal&&(this.imgsTotal=e.imgsTotal),void 0!==e.sizes&&(this.imgResolution=e.sizes),void 0!==e.bgTransparent&&(this.bgTransparent=1==e.bgTransparent),this.updateUrl()}getUrlParams(){let e="?ver="+Math.random()+"-"+Math.random()*Date.now()+"&rrtime="+this.reneringTimes;return e}updateUrl(){let e=this.filepath,t=this.bgTransparent?"png":"jpg",i=e.lastIndexOf("/"),s=e.slice(2,i+1);this.bigImgUrl=s+"bld_rendering."+t+this.getUrlParams();let n=this.imgResolution,a=s+"bld_rendering_mini_0."+t+this.getUrlParams();this.miniImgUrls=[],this.miniImgUrls.push(a),1==this.imgsTotal?(n[0]<=512||n[1]<=512)&&n[0]>128&&n[1]>128&&this.miniImgUrls.push(this.bigImgUrl):this.imgsTotal>1&&(a=s+"bld_rendering_mini_1."+t+this.getUrlParams(),this.miniImgUrls.push(a));for(let r=0;r<this.miniImgUrls.length;r++);}}t.RTaskData=s},"195d":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("a7c5"),n=i("9bbe");class a extends s.SettingDataPanel{constructor(){super()}getJsonStr(e="{",t="}"){let i=this.getItemCompByKeyName("image_width").getParam(),s=this.getItemCompByKeyName("image_height").getParam(),n=[i.numberValue,s.numberValue],a=`${e}"path":"", "resolution":[${n}]`;return super.getJsonStr(a,t)}init(e){let t=[],i=new n.DataItemComponentParam;i.keyName="image_width",i.name="图像宽",i.numberValue=512,i.inputType="number",i.numberMinValue=1,i.numberMaxValue=4096,i.editEnabled=!0,i.autoEncoding=!1,i.toNumber(),t.push(i),i=new n.DataItemComponentParam,i.keyName="image_height",i.name="图像高",i.numberValue=512,i.inputType="number",i.numberMinValue=1,i.numberMaxValue=4096,i.editEnabled=!0,i.autoEncoding=!1,i.toNumber(),t.push(i),i=new n.DataItemComponentParam,i.keyName="bgTransparent",i.name="背景透明",i.toBoolean(),i.booleanValue=!1,t.push(i),i=new n.DataItemComponentParam,i.keyName="outputType",i.name="出图类型",i.textValue="single_image",i.textContent="单张图",i.toText(),t.push(i),i=new n.DataItemComponentParam,i.keyName="bgColor",i.name="背景色",i.numberValue=91786,i.editEnabled=!0,i.toColor(),t.push(i),this.m_params=t;let s=this.m_container,a=45,r=60,o=60,l=0;for(let h=0;h<t.length;++h){let e=new n.DataItemComponent;e.x=a,e.y=r+l,e.initialize(s,t[h]),this.addItemComp(e),l+=o}}}t.OutputDataPanel=a},"1eb2":function(e,t,i){"use strict";if("undefined"!==typeof window){var s=window.document.currentScript,n=i("8875");s=n(),"currentScript"in document||Object.defineProperty(document,"currentScript",{get:n});var a=s&&s.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);a&&(i.p=a[1])}},"22b3":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(){this.m_viewerLayer=null,this.m_panel=null,this.m_areaWidth=512,this.m_areaHeight=512,this.m_selected=!1,this.m_deselectColors=[12442081,11457759,8635607],this.m_selectColors=[8039642,4887509,3898293],this.group=null}initialize(e,t,i,s){this.m_viewerLayer=e,this.m_areaWidth=t,this.m_areaHeight=i,this.m_panel=s,e.innerHTML=s.getName(),this.initEvent(e)}getPanel(){return this.m_panel}getName(){return this.m_panel.getName()}getKeyName(){return this.m_panel.getKeyName()}getType(){return this.m_panel.getType()}applyColorAt(e){let t=this.m_selected?this.m_selectColors:this.m_deselectColors;this.m_viewerLayer.style.backgroundColor="#"+t[e].toString(16)}initEvent(e){e.onmouseover=e=>{this.applyColorAt(1)},e.onmouseout=e=>{this.applyColorAt(0)},e.onmouseup=e=>{this.select(),this.applyColorAt(1)},e.onmousedown=e=>{this.applyColorAt(2)}}isSelected(){return this.m_selected}select(){let e=this.group,t=e.length;for(let i=0;i<t;++i)if(e[i].isSelected()){e[i].deselect();break}this.m_selected=!0,this.applyColorAt(0),this.m_panel.setVisible(!0)}deselect(){this.m_selected=!1,this.applyColorAt(0),this.m_panel.setVisible(!1)}}t.RenderingSettingItem=s},"23ff":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(){this.taskStatus=0,this.startTime=0,this.rt_phase_times=0,this.rt_phase=""}initialize(){}reset(){this.rt_phase="",this.rt_phase_times=0,this.taskStatus=0,this.startTime=Date.now(),this.showSpecInfo("waiting...")}taskSuccess(){}taskFailure(){}showSpecInfo(e,t=-1){var i=this.infoDiv;if(null!=i)if(t>=0){let s=t%3;switch(s){case 0:i.innerHTML=e+"&nbsp;.&nbsp;&nbsp;";break;case 1:i.innerHTML=e+"&nbsp;..&nbsp;";break;default:i.innerHTML=e+"&nbsp;...";break}}else i.innerHTML=e}parseSyncRStatuReqInfo(e){}parseModelReqInfo(e){void 0!==e.drcsTotal&&(this.data.drcsTotal=e.drcsTotal,this.process.updateModel(this.data.drcsTotal)),this.process.running=!0}parseRenderingReqInfo(e){e.status;this.infoDiv;let t=e.phase;this.rt_phase!=t&&(this.rt_phase=t,this.rt_phase_times=0);let i="",s=!1;switch(void 0!==e.drcsTotal&&(this.process.isModelFinish()||(this.data.drcsTotal=e.drcsTotal,this.process.updateModel(this.data.drcsTotal))),this.data.phase=t,this.process.renderingPhase=t,this.process.running=!0,t){case"running":e.progress<6?this.showSpecInfo("正在解析模型数据",this.rt_phase_times):this.showSpecInfo('正在进行渲染: <b><font color="#008800">'+e.progress+"%</font></b>"),s=!0;break;case"new":i='排队<b><font color="#880000">('+e.teamIndex+"/"+e.teamLength+")</font></b>等待可用的空闲渲染器",this.showSpecInfo(i,this.rt_phase_times);break;case"task_rendering_enter":this.rt_phase_times>2?this.showSpecInfo("配置渲染任务",this.rt_phase_times):this.showSpecInfo("启动渲染任务",this.rt_phase_times);break;case"task_rendering_load_res":this.showSpecInfo('同步模型资源: <b><font color="#008800">'+e.progress+"%</font></b>");break;case"task_rendering_begin":this.showSpecInfo("准备渲染数据",this.rt_phase_times);break;case"finish":if(this.taskStatus<1){this.data.version=e.version,this.taskStatus=1;let t=e.sizes,i=Date.now()-this.startTime,s=Math.round(i/1e3);this.showSpecInfo('<b><font color="#008800">'+t[0]+"x"+t[1]+"</font></b>效果图渲染完成<br/><b>(总耗时"+s+"s)</b>"),this.data.bgTransparent=1==e.bgTransparent,this.data.copyFromJson(e),this.taskSuccess()}break;case"rtaskerror":if(this.taskStatus<2)return this.taskStatus=2,this.showSpecInfo("渲染失败(模型数据不能正确解析)"),void this.taskFailure();case"query-re-rendering-task":break;default:break}this.rt_phase_times++}}t.RTaskInfoViewer=s},2403:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("7191");class n{constructor(e=null){this.unit="px",this.m_viewer=e,e&&(this.m_style=e.style)}getDiv(){return this.m_viewer}setViewer(e){this.m_viewer=e,e&&(this.m_style=e.style)}setInnerHTML(e){this.m_viewer.innerHTML=e}clearInnerHTML(){this.m_viewer.innerHTML=""}setDisplayMode(e="block"){""!=e&&(this.m_style.display=e)}setPositionMode(e="relative"){""!=e&&(this.m_style.position=e)}setTextAlign(e){this.m_style.textAlign=e}contentAlignToCenter(){let e=this.m_style;e.textAlign="center",e.alignItems="center",e.justifyContent="center"}layoutToCenter(e=0,t=0){let i=this.m_viewer.getBoundingClientRect(),s=this.m_viewer.parentElement.getBoundingClientRect(),n=.5*(s.width-i.width)+e,a=.5*(s.height-i.height)+t;this.setXY(n,a)}setXY(e,t){this.m_style.left=e+this.unit,this.m_style.top=t+this.unit}setX(e){this.m_style.left=e+this.unit}setY(e){this.m_style.top=e+this.unit}setSize(e,t){e>0&&t>0&&(this.m_style.width=e+this.unit,this.m_style.height=t+this.unit)}setWidth(e){e>0&&(this.m_style.width=e+this.unit)}setHeight(e){e>0&&(this.m_style.height=e+this.unit)}setTextColor(e,t=1){this.m_style.color="#"+e.toString(16)}setBackgroundColor(e,t=1){this.m_style.backgroundColor="#"+e.toString(16)}setVisible(e){s.DivTool.setVisible(this.m_viewer,e)}isVisible(){return s.DivTool.isVisible(this.m_viewer)}show(){this.setVisible(!0)}hide(){this.setVisible(!1)}clearDivAllEles(){s.DivTool.clearDivAllEles(this.m_viewer)}getRect(){return this.m_viewer.getBoundingClientRect()}}t.HTMLViewerLayer=n},"24cc":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("a7c5"),n=i("195d"),a=i("faa5"),r=i("4f1d"),o=i("2eea"),l=i("22b3"),h=i("538b"),u=i("47c8"),m=i("7191"),d=[{name:"出图设置",id:0,type:"output"},{name:"环境设置",id:1,type:"env"},{name:"摄像机",id:2,type:"camera"},{name:"材质",id:3,type:"material"},{name:"灯光",id:4,type:"light"}];class c{constructor(){this.m_viewerLayer=null,this.m_areaWidth=512,this.m_areaHeight=512,this.m_items=[],this.m_itemMap=new Map,this.rtaskSys=null,this.m_rscViewer=null}initialize(e,t,i){this.m_viewerLayer=e,this.m_areaWidth=t,this.m_areaHeight=i,this.initUIScene(e,t,i)}setRSCViewer(e){this.m_rscViewer=e;for(let t=0;t<this.m_items.length;t++)this.m_items[t].getPanel().rscViewer=e}initUIScene(e,t,i){let s=5,n=400,a=n/s,r=110,o=0,h=this.createDiv(0,0,r,n,"absolute"),u=h.style;u.backgroundColor="#668fb6",e.appendChild(h);let m=this.createDiv(0,n,t,i-n,"absolute",!1);u=m.style,u.backgroundColor="#bdd9e1",e.appendChild(m),this.buildBtns(m);let c=this.createDiv(r,0,t-r,n,"absolute",!1);u=c.style,e.appendChild(c);let p=d,b=this.m_items,g=r,y=a-2;for(let d=0;d<s;++d){let i="#bdd9e1",s=this.createDiv(0,o+d*a,g,y,"absolute");u=s.style,u.backgroundColor=i,u.cursor="pointer",u.userSelect="none",e.appendChild(s);let h=this.createSettingPanel(c,t-r,n,p[d]);const m=new l.RenderingSettingItem;m.group=b,m.initialize(s,g,y,h),b.push(m),this.m_itemMap.set(m.getType(),m)}b[0].select()}getItemByKeyName(e){return this.m_itemMap.get(e)}getPanelByKeyName(e){return this.m_itemMap.get(e).getPanel()}buildBtns(e){let t=130,i=60,s=this.createDiv(90,30,t,i,"absolute",!0),n=s.style;e.appendChild(s);let a=[s],r=new u.ButtonDivItem;r.initialize(s,"新建渲染任务","new_rendering"),r.onmouseup=e=>{this.rtaskSys.request.updatePage()},t=100,s=this.createDiv(230,30,t,i,"absolute",!0),n=s.style,e.appendChild(s),a.push(s),r=new u.ButtonDivItem,r.initialize(s,"发起渲染","send_rendering"),r.onmouseup=e=>{this.rtaskSys.rerendering()},t=130,s=this.createDiv(370,30,t,i,"absolute",!0),n=s.style,e.appendChild(s),a.push(s),r=new u.ButtonDivItem,r.initialize(s,"查看渲染原图","view_rendering_img"),r.onmouseup=e=>{window.open(this.rtaskSys.data.bigImgUrl,"_blank")},m.DivTool.hArrangementDivs(a)}isRTJsonActiveByKeyName(e){let t=this.getPanelByKeyName(e);return!!t&&t.isActive()}getRTJsonStrByKeyName(e,t=!0){let i="";switch(e){case"rnode":return i=this.getRSettingJsonStr(),i=`{"name":"rnode","unit":"m","version":0,${i}}`,i;default:let s=this.getPanelByKeyName(e);return i=s.getJsonStr(),t&&(i=`{"name":"rnode","unit":"m","version":0,${i}}`),i}}getRTJsonStrByKeyNames(e,t=!0){let i=e.length,s="";for(let n=0;n<i;n++){let t=e[n];switch(t){case"rnode":return s=this.getRSettingJsonStr(),s=`{"name":"rnode","unit":"m","version":0,${s}}`,s;default:let e=this.getPanelByKeyName(t);""!=s?s+=","+e.getJsonStr():s=e.getJsonStr();break}}return t&&(s=`{"name":"rnode","unit":"m","version":0,${s}}`),s}getRSettingJsonStr(){let e=this.getPanelByKeyName("output"),t="",i=e.getJsonStr();return t=i,e=this.getPanelByKeyName("env"),i=e.getJsonStr(),t+=","+i,e=this.getPanelByKeyName("camera"),i=e.getJsonStr(),t+=","+i,e=this.getPanelByKeyName("material"),i=e.getJsonStr(),t+=","+i,e=this.getPanelByKeyName("light"),i=e.getJsonStr(),t+=","+i,t}createSettingPanel(e,t,i,l){let u=null;switch(l.type){case"output":u=new n.OutputDataPanel;break;case"env":u=new a.EnvDataPanel;break;case"camera":u=new r.CameraDataPanel;break;case"material":u=new o.MaterialDataPanel;break;case"light":u=new h.LightDataPanel;break;default:u=new s.SettingDataPanel}return u.initialize(e,t,i,l),u}createDiv(e,t,i,s,n="",a=!0){const r=document.createElement("div");let o=r.style;return o.left=e+"px",o.top=t+"px",o.width=i+"px",o.height=s+"px",o.display="flex",a&&(o.alignItems="center",o.justifyContent="center"),o.position="relative",""!=n&&(o.position=n),r}}t.DsrdUI=c},"2eea":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("a7c5"),n=i("9bbe");class a extends s.SettingDataPanel{constructor(){super(),this.modelName="apple_body_model",this.uvScales=[1,1]}getJsonStr(e="{",t="}"){let i=this.getItemCompByKeyName("uvScale_x").getParam(),s=this.getItemCompByKeyName("uvScale_y").getParam(),n=[i.numberValue,s.numberValue],a=`${e}"modelName":"${this.modelName}", "uvScales":[${n}]`,r=this.getJsonBodyStr(a,t);return`"materials":[${r}]`}init(e){let t=[],i=new n.DataItemComponentParam;i.keyName="type",i.name="材质类型",i.textContent="BSDF",i.textValue="bsdf",i.toText(),t.push(i),i=new n.DataItemComponentParam,i.keyName="color",i.name="颜色",i.numberValue=16777215,i.editEnabled=!0,i.toColor(),t.push(i),i=new n.DataItemComponentParam,i.keyName="specular",i.name="反射率",i.numberValue=.5,i.inputType="number",i.floatNumberEnabled=!0,i.numberMinValue=0,i.numberMaxValue=3,i.editEnabled=!0,i.toNumber(),t.push(i),i=new n.DataItemComponentParam,i.keyName="metallic",i.name="金属度",i.numberValue=.5,i.inputType="number",i.floatNumberEnabled=!0,i.numberMinValue=0,i.numberMaxValue=3,i.editEnabled=!0,i.toNumber(),t.push(i),i=new n.DataItemComponentParam,i.keyName="roughness",i.name="粗糙度",i.numberValue=.5,i.inputType="number",i.floatNumberEnabled=!0,i.numberMinValue=0,i.numberMaxValue=3,i.editEnabled=!0,i.toNumber(),t.push(i),i=new n.DataItemComponentParam,i.keyName="normalStrength",i.name="凹凸强度",i.numberValue=1,i.inputType="number",i.floatNumberEnabled=!0,i.numberMinValue=0,i.numberMaxValue=3,i.editEnabled=!0,i.toNumber(),t.push(i),i=new n.DataItemComponentParam,i.keyName="uvScale_x",i.name="X轴UV缩放",i.numberValue=1,i.inputType="number",i.floatNumberEnabled=!0,i.numberMinValue=0,i.numberMaxValue=30,i.editEnabled=!0,i.autoEncoding=!1,i.toNumber(),t.push(i),i=new n.DataItemComponentParam,i.keyName="uvScale_y",i.name="Y轴UV缩放",i.numberValue=1,i.inputType="number",i.floatNumberEnabled=!0,i.numberMinValue=0,i.numberMaxValue=30,i.editEnabled=!0,i.autoEncoding=!1,i.toNumber(),t.push(i),this.m_params=t;let s=this.m_container,a=45,r=45,o=41,l=0;for(let h=0;h<t.length;++h){let e=new n.DataItemComponent;e.x=a,e.y=r+l,e.initialize(s,t[h]),this.addItemComp(e),l+=o}}}t.MaterialDataPanel=a},"3a06":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("2403"),n=i("47c8"),a=i("438a"),r=i("7191");class o{constructor(){this.m_viewerLayer=null,this.m_areaWidth=512,this.m_areaHeight=512,this.m_time=0,this.m_resLoaded=0,this.m_textViewer=null,this.onaction=null,this.rtaskSys=null,this.m_backBtn=null}initialize(e,t,i){this.m_viewerLayer=e,this.m_areaWidth=t,this.m_areaHeight=i}uploadFile(e){this.m_time=(new Date).getTime()-100,this.m_resLoaded=0,this.initUI(),this.uploadAndSendRendering(e)}open(){}close(){}initUI(){if(this.open(),null==this.m_textViewer){let e=r.DivTool.createDiv(320,300);this.m_viewerLayer.appendChild(e);let t=new s.HTMLViewerLayer(e);t.setTextAlign("center"),t.layoutToCenter(),this.m_textViewer=t}else this.m_textViewer.show();this.m_textViewer.setInnerHTML("uploading..."),this.progressCall({lengthComputable:!0,loaded:100,total:5e4})}completeCall(e){let t=e.target.responseText+"",i=null;try{i=JSON.parse(t)}catch(n){i={success:!1}}let s="upload_success";i.success?(this.rtaskSys.process.toFirstRendering(),this.rtaskSys.data.copyFromJson(i),this.rtaskSys.infoViewer.reset(),this.rtaskSys.infoViewer.infoDiv=this.m_textViewer.getDiv(),this.rtaskSys.startup(),this.onaction&&this.onaction("uploading_success",s)):(s="upload_svr_failed",this.toUploadFailure(s))}toUploadFailure(e){this.m_textViewer.setInnerHTML("上传失败...");let t=80,i=50,s=.5*(this.m_areaWidth-t),a=.5*(this.m_areaHeight-i)+20,o=this.m_backBtn;if(null==o){let l=r.DivTool.createDivT1(s,a,t,i,"flex","absolute",!0),h=[1408115,1403525,1401995];this.m_viewerLayer.appendChild(l),o=new n.ButtonDivItem,o.setDeselectColors(h),o.initialize(l,"返回","upload_back"),o.onmouseup=t=>{let i=t;o.hide(),this.m_textViewer.clearInnerHTML(),this.m_textViewer.hide(),this.onaction&&this.onaction(i.button_idns,e)},o.setTextColor(15658734),this.m_backBtn=o}o.show()}progressCall(e){let t="0%";e.lengthComputable&&(t=Math.round(e.loaded/e.total*100)+"%");var i=(new Date).getTime(),s=(i-this.m_time)/1e3;this.m_time=(new Date).getTime();var n=e.loaded-this.m_resLoaded;this.m_resLoaded=e.loaded;var a=n/s,r=a,o="B/s";a/1024>1&&(a/=1024,o="K/s"),a/1024>1&&(a/=1024,o="M/s");let l=a.toFixed(1)+o,h=((e.total-e.loaded)/r).toFixed(1),u="uploading "+t+"<br/>"+l+"<br/>rest time: "+h+"s";this.m_textViewer.setInnerHTML(u)}uploadAndSendRendering(e){if(null==e)return;if(!e)return alert("the file dosen't exist !!!"),void this.updatePage();let t=Math.floor(e.size/1048576),i=30;if(t>i)return alert("模型文件超过"+i+"M, 带宽太小暂时不支持 !!!"),void this.updatePage();let s=this.rtaskSys.request;s.sendUploadReq(e,e=>{this.completeCall(e)},(e,t)=>{this.toUploadFailure("upload_net_failed")},e=>{this.progressCall(e)},e=>{this.m_time=(new Date).getTime(),this.m_resLoaded=0}),e=null}updatePage(){a.HTTPTool.updatePage()}}t.RModelUploadingUI=o},"438a":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{}s.host="/",t.HTTPUrl=s;class n{static updatePage(){location.reload()}}t.HTTPTool=n},"47c8":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("2403");class n extends s.HTMLViewerLayer{constructor(){super(),this.m_btn_name="",this.m_btn_idns="",this.m_selected=!1,this.m_selectColors=[12442081,11457759,8635607],this.m_deselectColors=[8039642,4887509,3898293],this.group=null,this.onmousedown=null,this.onmouseup=null}initialize(e,t,i){let s=e.style;s.cursor="pointer",s.userSelect="none",this.setViewer(e),this.m_btn_name=t,this.m_btn_idns=i,e.innerHTML=t,this.initEvent(e),this.applyColorAt(0)}setSelectColors(e){this.m_selectColors=e}setDeselectColors(e){this.m_deselectColors=e}getName(){return this.m_btn_name}getIdns(){return this.m_btn_idns}applyColorAt(e){let t=this.m_selected?this.m_selectColors:this.m_deselectColors;this.setBackgroundColor(t[e])}initEvent(e){e.onmouseover=e=>{this.applyColorAt(1)},e.onmouseout=e=>{this.applyColorAt(0)},e.onmouseup=e=>{this.select(),this.applyColorAt(1),this.onmouseup&&(e.buttonTarget=this,e.button_idns=this.m_btn_idns,this.onmouseup(e))},e.onmousedown=e=>{this.applyColorAt(2),this.onmousedown&&(e.buttonTarget=this,e.button_idns=this.m_btn_idns,this.onmousedown(e))}}isSelected(){return this.m_selected}select(){if(null!=this.group){let e=this.group,t=e.length;for(let i=0;i<t;++i)if(e[i].isSelected()){e[i].deselect();break}this.m_selected=!0,this.applyColorAt(0)}}deselect(){null!=this.group&&(this.m_selected=!1,this.applyColorAt(0))}}t.ButtonDivItem=n},"4f1d":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("a7c5"),n=i("9bbe");class a extends s.SettingDataPanel{constructor(){super()}getCamMatrixData(){return this.rscViewer.getCameraData(.01,!0)}getJsonStr(e="{",t="}"){let i=`${e}"matrix":[${this.getCamMatrixData()}]`;return super.getJsonStr(i,t)}init(e){let t=[],i=new n.DataItemComponentParam;i.keyName="type",i.name="类型",i.textValue="perspective",i.toText(),t.push(i),i=new n.DataItemComponentParam,i.keyName="viewAngle",i.name="视角",i.numberValue=45,i.inputType="number",i.numberMinValue=0,i.numberMaxValue=180,i.unit="度",i.editEnabled=!0,i.toNumber(),t.push(i),i=new n.DataItemComponentParam,i.keyName="near",i.name="近平面",i.numberValue=.1,i.inputType="number",i.floatNumberEnabled=!0,i.numberMinValue=0,i.numberMaxValue=10,i.editEnabled=!0,i.unit="m",i.toNumber(),t.push(i),i=new n.DataItemComponentParam,i.keyName="far",i.name="远平面",i.numberValue=20,i.inputType="number",i.floatNumberEnabled=!0,i.numberMinValue=0,i.numberMaxValue=100,i.editEnabled=!0,i.unit="m",i.toNumber(),t.push(i),this.m_params=t;let s=this.m_container,a=45,r=95,o=60,l=0;for(let h=0;h<t.length;++h){let e=new n.DataItemComponent;e.x=a,e.y=r+l,e.initialize(s,t[h]),this.addItemComp(e),l+=o}}}t.CameraDataPanel=a},"538b":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("a7c5"),n=i("9bbe");class a extends s.SettingDataPanel{constructor(){super()}getJsonStr(e="{",t="}"){let i=this.getJsonBodyStr(e,t);return`"lights":[${i}]`}init(e){let t=[],i=new n.DataItemComponentParam;i.keyName="type",i.name="类型",i.textValue="point",i.toText(),t.push(i),i=new n.DataItemComponentParam,i.keyName="color",i.name="灯光颜色",i.numberValue=11202235,i.editEnabled=!0,i.toColor(),t.push(i),i=new n.DataItemComponentParam,i.keyName="power",i.name="灯光功率",i.numberValue=500,i.inputType="number",i.numberMinValue=0,i.numberMaxValue=5e4,i.editEnabled=!0,i.unit="W",i.toNumber(),t.push(i),i=new n.DataItemComponentParam,i.keyName="new_light",i.name="新建光源",i.textValue="...",i.toText(),i.autoEncoding=!1,t.push(i),this.m_params=t;let s=this.m_container,a=45,r=95,o=60,l=0;for(let h=0;h<t.length;++h){let e=new n.DataItemComponent;e.x=a,e.y=r+l,e.initialize(s,t[h]),this.addItemComp(e),l+=o}}}t.LightDataPanel=a},7191:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{static hArrangementDivs(e){if(e.length>0){let t=e[0].parentElement;if(t){let i=t.getBoundingClientRect(),s=0;for(let t=0;t<e.length;++t){const i=e[t].getBoundingClientRect();s+=i.width}let n=i.width-s,a=.5*n;n/=e.length+1,n<=0?n=0:a=.5*(i.width-s-n*(e.length-1));for(let t=0;t<e.length;++t){let i=e[t];const s=i.getBoundingClientRect();i.style.left=Math.round(a)+"px",a+=s.width+n}}}}static createDiv(e,t,i="",s="",n=!1){const a=document.createElement("div");let r=a.style;return e>0&&t>0&&(r.width=e+"px",r.height=t+"px"),r.display="block",""!=i&&(r.display=i),r.position="relative",""!=s&&(r.position=s),n&&(r.alignItems="center",r.justifyContent="center"),a}static createDivT1(e,t,i,s,n="",a="",r=!0){const o=document.createElement("div");let l=o.style;return e>0&&t>0&&(l.left=e+"px",l.top=t+"px"),i>0&&s>0&&(l.width=i+"px",l.height=s+"px"),l.display="block",""!=n&&(l.display=n),l.position="relative",""!=a&&(l.position=a),r&&(l.alignItems="center",l.justifyContent="center"),o}static clearDivAllEles(e){e.replaceChildren()}static setVisible(e,t){let i=e.style;i.visibility=t?"visible":"hidden"}static isVisible(e){return"visible"==e.style.visibility}static setTextColor(e,t){e.style.color="#"+t.toString(16)}}t.DivTool=s},"79c5":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("438a");class n{constructor(){this.taskReqSvrUrl="",this.taskInfoGettingUrl="",this.uploadModelUrl=""}getDomain(e){var t=/http:\/\/([^\/]+)/i;let i=e.match(t);return null!=i&&i.length>0?i[0]:""}getHostUrl(e){let t=location.href,i=this.getDomain(t),s=i.split(":");return t=s[0]+":"+s[1],e?t+":"+e+"/":i+"/"}initialize(){this.taskReqSvrUrl=s.HTTPUrl.host+"renderingTask",this.taskInfoGettingUrl=s.HTTPUrl.host+"getRTInfo",this.uploadModelUrl=s.HTTPUrl.host+"uploadRTData"}reset(){}updatePage(){s.HTTPTool.updatePage()}getRenderingParams(e){let t=[512,512],i="&sizes="+t;return i+="&rtBGTransparent="+(this.data.bgTransparent?"1":"0"),""!=e&&(i+=e),i}createReqUrlStr(e,t,i,s,n,a=""){let r=e+"?srcType=viewer&&phase="+t+"&progress="+i+a;return s>0&&(r+="&taskid="+s+"&taskname="+n),r}sendRerenderingReq(e=""){const t=this.data;let i=["output","env","camera"],s=this.data.rtJsonData,n="material";s.isRTJsonActiveByKeyName(n)&&i.push(n);let a=s.getRTJsonStrByKeyNames(i,!0);e+="&rnode="+a;let r=this.createReqUrlStr(this.taskReqSvrUrl,"query-re-rendering-task",0,t.taskid,t.taskname,e);this.sendnotifyTaskInfoReq(r)}sendUploadReq(e,t,i,s,n){let a=this.data.rtJsonData.getRTJsonStrByKeyNames(["output","env","camera"],!0),r=this.uploadModelUrl+"?srcType=viewer&phase=newrtask&rnode="+a,o=new FormData;o.append("file",e);let l=new XMLHttpRequest;l.open("post",r,!0),l.onload=e=>{t(e)},l.onerror=e=>{i(e,"upload_net_failed")},l.upload.onprogress=e=>{s(e)},l.upload.onloadstart=e=>{n(e)},l.send(o)}sendACommonGetReq(e,t){let i=new XMLHttpRequest;i.open("GET",e,!0),i.onerror=function(e){},i.onload=s=>{t&&t(e,i.response)},i.send(null)}notifyRenderingInfoToSvr(e=""){const t=this.data;let i=this.createReqUrlStr(this.taskReqSvrUrl,"queryataskrst",0,t.taskid,t.taskname,e);this.sendnotifyTaskInfoReq(i)}notifyModelInfoToSvr(e=""){const t=this.data;let i=this.createReqUrlStr(this.taskReqSvrUrl,"queryataskrst",0,t.taskid,t.taskname,e);this.sendACommonGetReq(i,(e,t)=>{let i=JSON.parse(t);this.taskInfoViewer.parseRenderingReqInfo(i)})}notifySyncRStatusToSvr(e=""){const t=this.data;let i=this.createReqUrlStr(this.taskInfoGettingUrl,"syncAnAliveTask",0,t.taskid,t.taskname,e);this.sendACommonGetReq(i,(e,t)=>{let i=JSON.parse(t);this.taskInfoViewer.parseSyncRStatuReqInfo(i)})}sendnotifyTaskInfoReq(e){let t=new XMLHttpRequest;t.open("GET",e,!0),t.onerror=function(e){},t.onprogress=e=>{},t.onload=e=>{let i=JSON.parse(t.response);this.taskInfoViewer.parseRenderingReqInfo(i)},t.send(null)}}t.RTaskRquest=n},"7d31":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(){this.m_viewerLayer=null,this.ui=null,this.taskSys=null,this.rscViewer=null}initialize(e){this.m_viewerLayer=e;let t="static/cospace/dsrdiffusion/scViewer/SceneViewer.umd.js";this.loadModule(t)}init3DScene(){let e=new SceneViewer.SceneViewer;this.rscViewer=e;let t=!0,i=location.href;i=i.toLowerCase(),i.indexOf("diffusion")>0&&(t=!1),e.initialize(this.m_viewerLayer,()=>{},!0,t),e.setForceRotate90(!0),this.ui.setRSCViewer(e),this.taskSys.setRSCViewer(e)}loadModule(e){let t=new XMLHttpRequest;t.open("GET",e,!0),t.onerror=function(e){},t.onprogress=e=>{},t.onload=()=>{let e=document.createElement("script");e.onerror=e=>{},e.innerHTML=t.response,document.head.appendChild(e),this.init3DScene()},t.send(null)}}t.DsrdScene=s},8448:function(e,t,i){"use strict";function s(e,t,i){return Math.max(Math.min(e,i),t)}function n(e){let t=e.toString(16),i="000000",s=i.length-t.length;return s>0&&(t=i.slice(0,s)+t),t}function a(e){let t=e.replace(/[^\a,b,c,e,f\0-9]/g,"");if(t.length<1)t="0";else if(t.length>6){let e=t.length-6;t=t.slice(e)}return t}function r(e,t,i){let n=e.replace(/[^\.\0-9]/g,""),a=parseFloat(n);return isNaN(a)&&(a=0),a=Math.round(a),a=s(a,t,i),n=a+"",n}function o(e,t,i){let n=e.replace(/[^\.\0-9]/g,""),a=parseFloat(n);return isNaN(a)&&(a=0),a=s(a,t,i),n=a.toFixed(4),a=parseFloat(n),n=a+"",n.indexOf(".")<1&&(n+=".0"),n}Object.defineProperty(t,"__esModule",{value:!0});class l{constructor(){this.keyName="",this.name="",this.unit="",this.compType="number",this.editEnabled=!1,this.inputType="text",this.numberMinValue=0,this.numberMaxValue=1,this.floatNumberEnabled=!1,this.autoEncoding=!0}getJsonStr(){let e=this.getCurrValueString(!1);return e="text"==this.compType?`"${e}"`:e,`"${this.keyName}":${e}`}toNumber(){this.compType="number"}toBoolean(){this.compType="boolean"}toText(){this.compType="text"}toColor(){this.compType="color"}initEvents(){if(this.editEnabled){let e=this.body_viewer;switch(e.type="text",this.compType){case"color":"text"==this.inputType&&(e.onkeyup=t=>{let i=a(e.value);e.value=i+this.unit,this.numberValue=parseInt("0x"+i)});break;default:"number"==this.inputType&&(this.floatNumberEnabled?e.onkeyup=t=>{let i=o(e.value,this.numberMinValue,this.numberMaxValue);e.value=i+this.unit,this.numberValue=parseFloat(i)}:e.onkeyup=t=>{let i=r(e.value,this.numberMinValue,this.numberMaxValue);e.value=i+this.unit,this.numberValue=parseInt(i)})}}else{let e=this.body_viewer;switch(this.compType){case"boolean":e.onmouseup=e=>{this.booleanValue=!this.booleanValue,this.displayToViewer()};break}}}getCurrValueString(e=!0){let t="",i="";switch(this.compType){case"number":case"text":e?(i=this.unit,void 0!==this.numberValue?t=this.numberValue+"":void 0!==this.textContent?t=this.textContent:void 0!==this.textValue&&(t=this.textValue)):void 0!==this.numberValue?t=this.numberValue+"":void 0!==this.textValue?t=this.textValue:void 0!==this.textContent&&(t=this.textContent);break;case"boolean":t=e?this.booleanValue?"是":"否":this.booleanValue?"1":"0";break;case"color":t=e?n(this.numberValue):this.numberValue+"";break}return e?t+i:t}displayToViewer(){let e=this.head_viewer,t=this.body_viewer;e.innerHTML=this.name;let i=this.getCurrValueString(!0);""!=i&&(this.editEnabled?t.value=i:t.innerHTML=i)}}t.DataItemComponentParam=l},8875:function(e,t,i){var s,n,a;(function(i,r){n=[],s=r,a="function"===typeof s?s.apply(t,n):s,void 0===a||(e.exports=a)})("undefined"!==typeof self&&self,(function(){function e(){var t=Object.getOwnPropertyDescriptor(document,"currentScript");if(!t&&"currentScript"in document&&document.currentScript)return document.currentScript;if(t&&t.get!==e&&document.currentScript)return document.currentScript;try{throw new Error}catch(c){var i,s,n,a=/.*at [^(]*\((.*):(.+):(.+)\)$/gi,r=/@([^@]*):(\d+):(\d+)\s*$/gi,o=a.exec(c.stack)||r.exec(c.stack),l=o&&o[1]||!1,h=o&&o[2]||!1,u=document.location.href.replace(document.location.hash,""),m=document.getElementsByTagName("script");l===u&&(i=document.documentElement.outerHTML,s=new RegExp("(?:[^\\n]+?\\n){0,"+(h-2)+"}[^<]*<script>([\\d\\D]*?)<\\/script>[\\d\\D]*","i"),n=i.replace(s,"$1").trim());for(var d=0;d<m.length;d++){if("interactive"===m[d].readyState)return m[d];if(m[d].src===l)return m[d];if(l===u&&m[d].innerHTML&&m[d].innerHTML.trim()===n)return m[d]}return null}}return e}))},8900:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("47c8"),n=i("bb2b"),a=i("3a06"),r=i("7191");class o{constructor(){this.m_viewerLayer=null,this.m_areaWidth=512,this.m_areaHeight=512,this.m_uploadModelBtn=null,this.m_openTasksListBtn=null,this.m_dropController=new n.DropFileController,this.m_uploadUI=new a.RModelUploadingUI,this.onaction=null,this.rtaskSys=null,this.m_dropEnabled=!0,this.m_tasksListDiv=null,this.m_backFromTaskListBtn=null}initialize(e,t,i){this.m_viewerLayer=e,this.m_areaWidth=t,this.m_areaHeight=i,this.buildBtns(this.m_viewerLayer),this.m_dropController.geomModelKeys.push("glb","usdz","usdc","blend","bld"),this.m_dropController.createObjectURLEnabled=!1,this.m_dropController.initialize(e,this),this.m_uploadUI.rtaskSys=this.rtaskSys,this.m_uploadUI.initialize(this.m_viewerLayer,t,i),this.m_uploadUI.onaction=(e,t)=>{switch(e){case"upload_back":this.m_uploadModelBtn.setVisible(!0),this.m_openTasksListBtn.setVisible(!0);break}}}initFileLoad(e){this.m_uploadModelBtn.setVisible(!1),this.m_openTasksListBtn.setVisible(!1),this.m_uploadUI.uploadFile(e[0].file)}isDropEnabled(){return this.m_dropEnabled}openDir(){const e=document.createElement("input");e.type="file",e.accept=".glb,.fbx,.obj,.usdz,.usdc,.blend,.bld",e.addEventListener("change",()=>{let t=Array.from(e.files);this.m_dropController.initFilesLoad(t)}),e.click()}showTasksList(){this.m_uploadModelBtn.setVisible(!1),this.m_openTasksListBtn.setVisible(!1),this.buildTasksList()}gotoAliveTaskAt(e){}backFromTasksList(){this.m_tasksListDiv.style.visibility="hidden",this.m_backFromTaskListBtn.setVisible(!1),this.m_uploadModelBtn.setVisible(!0),this.m_openTasksListBtn.setVisible(!0)}buildTasksList(){let e=this.m_tasksListDiv;if(null==e){let t=320,i=300,n=.5*(this.m_areaWidth-t),a=50;this.m_tasksListDiv=r.DivTool.createDivT1(n,a,t,300,"flex","absolute",!1),e=this.m_tasksListDiv;let o=e.style;o.textAlign="center",o.display="block",this.m_viewerLayer.appendChild(e),t=80,i=50,n=.5*(this.m_areaWidth-t),a=this.m_areaHeight-i-20;let l=r.DivTool.createDivT1(n,a,t,i,"flex","absolute",!0),h=[1408115,1403525,1401995];this.m_viewerLayer.appendChild(l);let u=new s.ButtonDivItem;u.setDeselectColors(h),u.initialize(l,"返回","back_from_tasks_list"),u.onmouseup=e=>{this.backFromTasksList()},this.m_backFromTaskListBtn=u,u.setTextColor(15658734)}this.m_tasksListDiv.style.visibility="visible",this.m_backFromTaskListBtn.setVisible(!0),r.DivTool.clearDivAllEles(e);let t=8;for(let s=0;s<t;++s){let t=document.createElement("br");e.appendChild(t);let i=document.createElement("a");i.innerHTML="选择第<"+(s+1)+">个渲染任务: vkTask-"+s,i.href="#",i.addEventListener("click",()=>{this.gotoAliveTaskAt(s)}),e.appendChild(i),t=document.createElement("br"),e.appendChild(t)}let i=document.createElement("br");e.appendChild(i),i=document.createElement("br"),e.appendChild(i)}buildBtns(e){let t=[1408115,1403525,1401995],i=150,n=60,a=50,o=.5*(this.m_areaWidth-(2*i+a)),l=.5*(this.m_areaHeight-2*n)+30,h=r.DivTool.createDivT1(o,l,i,n,"flex","absolute",!0);e.appendChild(h);let u=new s.ButtonDivItem;u.setDeselectColors(t),u.initialize(h,"上传渲染模型","upload_model"),u.applyColorAt(0),u.onmouseup=e=>{this.openDir()},u.setTextColor(15658734),this.m_uploadModelBtn=u,h=r.DivTool.createDivT1(o+a+i,l,i,n,"flex","absolute",!0),e.appendChild(h),u=new s.ButtonDivItem,u.setDeselectColors(t),u.initialize(h,"打开任务列表","open_task_list"),u.applyColorAt(0),u.onmouseup=e=>{this.showTasksList()},u.setTextColor(15658734),this.m_openTasksListBtn=u}open(){this.m_viewerLayer.style.visibility="visible"}close(){this.m_viewerLayer.style.visibility="hidden"}}t.RTaskBeginUI=o},"9bbe":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("8448");t.DataItemComponentParam=s.DataItemComponentParam;class n{constructor(){this.x=45,this.y=50}initialize(e,t){this.m_viewerLayer=e,this.m_param=t,this.init(e,t)}getKeyName(){return this.m_param.keyName}getParam(){return this.m_param}init(e,t){let i=23,s=159,n=this.createDiv(this.x,this.y,320,i,"","","absolute"),a=n.style,r=this.createDiv(0,0,s,i,"","","absolute"),o=this.createDiv(161,0,s,i,"","","absolute");a=r.style,a.background="#286dab",a.color="#eeeeee",a=o.style,a.background="#286dab",a.color="#eeeeee",e.appendChild(n),this.m_containerDiv=n,this.m_headDiv=r,this.m_bodyDiv=o,t.head_viewer=r,t.body_viewer=o,this.createInput(o,t,s,i),n.appendChild(r),n.appendChild(o),t.displayToViewer(),t.initEvents()}createInput(e,t,i,s){if(t.editEnabled){var n=document.createElement("input");let a=n.style;a.position="absolute",a.left="0px",a.top="0px",a.width=i+"px",a.height=s+"px",a.background="transparent",a.borderWidth="0px",a.outline="none",a.color="#eeeeee",a.fontSize="17px",a.textAlign="center",e.append(n),this.m_input=n,t.body_viewer=n}}createDiv(e,t,i,s,n="block",a="",r=""){const o=document.createElement("div");let l=o.style;if(l.left=e+"px",l.top=t+"px",l.width=i+"px",l.height=s+"px",""!=n&&(l.display=n),""!=a)switch(a){case"center":l.alignItems="center",l.justifyContent="center";break}return""!=r&&(l.position=r),o}}t.DataItemComponent=n},a7c5:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("7191");class n{constructor(){this.m_viewerLayer=null,this.m_container=null,this.m_itemData=null,this.m_areaWidth=512,this.m_areaHeight=512,this.m_itemCompDict=new Map,this.m_isActive=!1}initialize(e,t,i,n){this.m_viewerLayer=e,this.m_areaWidth=t,this.m_areaHeight=i,this.m_itemData=n,this.m_container=s.DivTool.createDivT1(0,0,t,t,"","absolute",!1),e.appendChild(this.m_container),this.init(e),this.setVisible(!1)}getName(){return this.m_itemData.name}getKeyName(){return this.m_itemData.type}getType(){return this.m_itemData.type}getJsonBodyStr(e="{",t="}"){let i=this.m_params,s=e,n=e.length>1?",":"";for(let a=0;a<i.length;a++){const e=i[a];e.autoEncoding&&(s+=n+e.getJsonStr(),n=",")}return s+=t,s}getJsonStr(e="{",t="}"){return`"${this.getKeyName()}":${this.getJsonBodyStr(e,t)}`}addItemComp(e){this.m_itemCompDict.set(e.getKeyName(),e)}getItemCompByKeyName(e){return this.m_itemCompDict.get(e)}init(e){}setVisible(e){let t=this.m_container,i=t.style;e?(i.visibility="visible",this.m_isActive=!0):i.visibility="hidden"}isVisible(){return"visible"==this.m_container.style.visibility}isActive(){return this.m_isActive}}t.SettingDataPanel=n},b66b:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("06e0");t.IRTaskDataParam=s.IRTaskDataParam,t.RTaskData=s.RTaskData;const n=i("23ff"),a=i("79c5"),r=i("c758");class o{constructor(){this.m_startup=!0,this.process=new r.RTaskProcess,this.data=new s.RTaskData,this.request=new a.RTaskRquest,this.infoViewer=new n.RTaskInfoViewer,this.onaction=null,this.m_timerId=-1,this.m_rerenderingTimes=0,this.m_workSpaceStatus=0,this.m_rscViewer=null,this.m_taskAlive=!1}initialize(){this.infoViewer.data=this.data,this.infoViewer.process=this.process,this.infoViewer.initialize(),this.request.data=this.data,this.request.taskInfoViewer=this.infoViewer,this.request.initialize()}startup(){this.m_startup&&(this.m_startup=!1,this.timerUpdate())}setProcess(e){}setTimerDelay(e){this.process.timerDelay=e}timerUpdate(){this.m_timerId>-1&&clearTimeout(this.m_timerId),this.m_timerId=setTimeout(this.timerUpdate.bind(this),this.process.timerDelay);const e=this.data,t=this.process;if(t.running&&!t.isError()){switch(this.process.type){case r.RTPType.SyncRStatus:this.request.notifySyncRStatusToSvr();break;case r.RTPType.CurrRendering:t.isAllFinish()?(this.m_rscViewer.setViewImageUrls(e.miniImgUrls),t.toSyncRStatus(),this.onaction&&this.onaction("curr-rendering","finish")):(t.running=!1,this.request.notifyRenderingInfoToSvr());break;case r.RTPType.FirstRendering:t.isRunning()?(t.isModelFinish()&&this.loadModel(),t.isRenderingFinish()?t.isModelFinish()||t.toSyncModelStatus():(t.running=!1,this.request.notifyRenderingInfoToSvr())):t.isAllFinish()&&(this.m_taskAlive||2!=e.modelLoadStatus||(this.m_taskAlive=!0,this.m_rscViewer.setViewImageUrls(e.miniImgUrls),t.toSyncRStatus()));break;case r.RTPType.SyncModelStatus:t.isModelFinish()?this.loadModel():(t.running=!1,this.request.notifyModelInfoToSvr());break;default:break}this.isRTDataFinish()&&this.toWorkSpace()}}rerendering(){this.isTaskAlive()&&(this.m_rerenderingTimes++,this.infoViewer.reset(),this.process.toCurrRendering(),this.request.sendRerenderingReq(),this.onaction&&this.onaction("curr-rendering","new"))}toWorkSpace(){0==this.m_workSpaceStatus&&(this.m_workSpaceStatus=1,this.onaction&&this.onaction("toWorkSpace","finish"))}setRSCViewer(e){this.m_rscViewer=e}isRTDataFinish(){return this.data.isModelDataLoaded()&&this.process.isAllFinish()}isTaskAlive(){return this.m_taskAlive}loadModel(){let e=this.data;if(0==e.modelLoadStatus){e.modelLoadStatus=1;let t=this.request,i="",s=t.createReqUrlStr(t.taskInfoGettingUrl,"modelToDrc",0,e.taskid,e.taskname,i);t.sendACommonGetReq(s,(i,s)=>{var n=JSON.parse(s);let a=t.getHostUrl(9090)+n.filepath.slice(2),r=a+"status.json";t.sendACommonGetReq(r,(t,i)=>{let s=JSON.parse(i),n=s.list,r=n.length,o=[],l=[];for(let e=0;e<r;e++){let t=a+n[e];o.push(t),l.push("drc")}null!=this.m_rscViewer&&(this.m_rscViewer.initSceneByUrls(o,l,e=>{},200),this.m_rscViewer.setViewImageFakeAlpha(.1)),e.modelLoadStatus=2,this.process.isSyncModelStatus()&&this.process.toFirstRendering()})})}}}t.RTaskSystem=o},bb2b:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(){this.m_htmlObj=null,this.m_listener=null,this.m_files=null,this.imgKeys=["jpg","jpeg","png","gif","bmp","webp","jfif","ico","avif"],this.geomModelKeys=["obj","ctm","draco","drc","fbx"],this.createObjectURLEnabled=!0}initialize(e,t){null==this.m_htmlObj&&(this.m_htmlObj=e,this.m_listener=t,this.initDrop(this.m_htmlObj))}initDrop(e){e.addEventListener("dragenter",e=>{e.preventDefault(),e.stopPropagation()},!1),e.addEventListener("dragover",e=>{e.preventDefault(),e.stopPropagation()},!1),e.addEventListener("dragleave",e=>{e.preventDefault(),e.stopPropagation()},!1),e.addEventListener("drop",e=>{e.preventDefault(),e.stopPropagation(),this.receiveDropFile(e)},!1)}receiveDropFile(e){if(this.m_files=null,this.m_listener.isDropEnabled()){let t=e.dataTransfer,i=[],s=0,n=0;if(void 0!==t.items){let e=t.items;for(let t=0;t<e.length;t++){let a=e[t],r=a.webkitGetAsEntry();if(null!=r)if(r.isFile){let e=a.getAsFile();i.push(e),this.initFilesLoad(i,"drop"),s=1}else if(r.isDirectory){let e=r.createReader();e.readEntries(e=>{s=e.length,s>0?e.forEach(e=>{e.isFile&&e.file(e=>{i.push(e),n++,s==n&&this.initFilesLoad(i,"drop")})}):this.alertShow(31)});break}if(s>0)break}this.m_files=i}}}alertShow(e){switch(e){case 31:alert("无法找到或无法识别对应的文件");break;default:break}}initFilesLoad(e,t="undefine"){this.m_files=null,this.m_listener&&(this.m_files=e,this.m_listener.initFileLoad(this.getFiles(),t))}testFile(e){let t=e.toLocaleLowerCase(),i="";return t.lastIndexOf(".")>0&&(i=t.slice(t.lastIndexOf(".")+1)),this.imgKeys.includes(i)?{name:e,type:i,resType:s.Image_File,url:""}:this.geomModelKeys.includes(i)?{name:e,type:i,resType:s.Geometry_Model_File,url:""}:null}getFiles(){let e=1,t=this.m_files;if(t){if(t.length>0){let e=[];for(let i=0;i<t.length;i++){let s=this.testFile(t[i].name);s&&(this.createObjectURLEnabled?s.url=window.URL.createObjectURL(t[i]):s.file=t[i],e.push(s))}return e}e=31}return this.alertShow(e),null}}s.Image_File="image",s.Geometry_Model_File="geometryModel",t.DropFileController=s},c758:function(e,t,i){"use strict";var s;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e["FirstRendering"]=0]="FirstRendering",e[e["CurrRendering"]=1]="CurrRendering",e[e["SyncRStatus"]=2]="SyncRStatus",e[e["SyncModelStatus"]=3]="SyncModelStatus"}(s||(s={})),t.RTPType=s;class n{constructor(){this.timerDelay=800,this.type=s.FirstRendering,this.renderingPhase="new",this.modelPhase="new",this.running=!0}updateModel(e){e>0&&"finish"!=this.modelPhase&&(this.modelPhase="finish")}isAllFinish(){return this.isModelFinish()&&this.isRenderingFinish()}isRenderingFinish(){let e="finish"==this.renderingPhase;return e}isModelFinish(){let e="finish"==this.modelPhase;return e}isRunning(){let e=!this.isModelFinish()||!this.isRenderingFinish();return e}isError(){let e="error"==this.renderingPhase||"rtaskerror"==this.renderingPhase;return e=e||"error"==this.modelPhase||"rtaskerror"==this.modelPhase,e}toFirstRendering(){this.renderingPhase="new",this.modelPhase="new",this.type=s.FirstRendering}isFirstRendering(){return this.type==s.FirstRendering}toCurrRendering(){this.renderingPhase="new",this.timerDelay=800,this.type=s.CurrRendering}isCurrRendering(){return this.type==s.CurrRendering}toSyncRStatus(){this.timerDelay=2500,this.type=s.SyncRStatus}isSyncRStatus(){return this.type==s.SyncRStatus}toSyncModelStatus(){this.modelPhase="new",this.timerDelay=1500,this.type=s.SyncModelStatus}isSyncModelStatus(){return this.type==s.SyncModelStatus}}t.RTaskProcess=n},edb0:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("7d31"),n=i("24cc"),a=i("8900"),r=i("b66b"),o=i("7191");class l{constructor(){this.m_init=!0,this.m_rscene=new s.DsrdScene,this.m_ui=new n.DsrdUI,this.m_rtaskBeginUI=new a.RTaskBeginUI,this.m_rtaskSys=new r.RTaskSystem,this.m_viewerLayer=null,this.mIDV=null,this.m_workSpaceStatus=0}initialize(){this.m_init&&(this.m_init=!1,this.m_rscene.ui=this.m_ui,this.m_rscene.taskSys=this.m_rtaskSys,this.initWorkSpace())}initViewLayer(){let e=document.body;e.style.background="#121212";let t=this.m_viewerLayer;t=document.createElement("div");let i=t.style;i.width="100vw",i.height="100vh",i.backgroundImage="linear-gradient(to right bottom, #159957, #155799)",this.elementCenter(t),e.appendChild(t),e.style.margin="0",this.m_viewerLayer=t}initWorkSpace(){this.initViewLayer(),this.initDSRDUI()}initDSRDUI(){let e=512,t=512,i=2,s=2,n=o.DivTool.createDivT1(0,0,2*e+2*i,t+2*s,"block"),a=n.style;a.backgroundImage="linear-gradient(to right bottom, #5b6f93, #1d91a5, #375283)";let r=o.DivTool.createDivT1(i,s,e,t,"block");a=r.style,a.backgroundColor="#335533",n.appendChild(r);let l=o.DivTool.createDivT1(e+i,s,e,t,"block","absolute");a=l.style,a.backgroundColor="#5b9bd5",n.appendChild(l);let h=o.DivTool.createDivT1(i,s,2*e,t,"block","absolute");a=h.style,a.backgroundImage="linear-gradient(to right bottom, #c0e1d1, #aec7dd)",a.visibility="hidden",n.appendChild(h),this.m_viewerLayer.appendChild(n);let u=(e,t)=>{switch(e){case"toWorkSpace":this.toWorkSpace();break;case"curr-rendering":"new"==t?this.m_rtaskBeginUI.open():"finish"==t&&this.m_rtaskBeginUI.close();break;default:break}};this.initDSRDSys(r,l,e,t),this.m_ui.rtaskSys=this.m_rtaskSys,this.m_rtaskSys.initialize(),this.m_rtaskSys.onaction=u,this.m_rtaskSys.data.rtJsonData=this.m_ui,this.m_rtaskBeginUI.rtaskSys=this.m_rtaskSys,this.m_rtaskBeginUI.onaction=u,this.m_rtaskBeginUI.initialize(h,2*e,t),this.m_rtaskBeginUI.open()}toWorkSpace(){0==this.m_workSpaceStatus&&(this.m_workSpaceStatus=1,this.m_rtaskBeginUI.close())}initDSRDSys(e,t,i,s){this.m_rscene.initialize(e),this.m_ui.initialize(t,i,s)}elementCenter(e,t="50%",i="50%",s="absolute"){const n=e.style;n.textAlign="center",n.display="flex",n.flexDirection="column",n.justifyContent="center",n.alignItems="center"}}t.DsrdShell=l},faa5:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("a7c5"),n=i("9bbe");class a extends s.SettingDataPanel{constructor(){super()}getJsonStr(e="{",t="}"){let i=e+'"path":""';return super.getJsonStr(i,t)}init(e){let t=[],i=new n.DataItemComponentParam;i.keyName="type",i.name="环境选择",i.textValue="inner_room",i.textContent="室内",i.toText(),t.push(i),i=new n.DataItemComponentParam,i.keyName="brightness",i.name="环境亮度",i.numberValue=.7,i.inputType="number",i.numberMinValue=0,i.numberMaxValue=3,i.floatNumberEnabled=!0,i.editEnabled=!0,i.toNumber(),t.push(i),i=new n.DataItemComponentParam,i.keyName="ao",i.name="AO",i.numberValue=0,i.inputType="number",i.numberMinValue=0,i.numberMaxValue=10,i.floatNumberEnabled=!0,i.editEnabled=!0,i.toNumber(),t.push(i),i=new n.DataItemComponentParam,i.keyName="rotation",i.name="旋转角度",i.numberValue=0,i.toNumber(),t.push(i),this.m_params=t;let s=this.m_container,a=45,r=95,o=60,l=0;for(let h=0;h<t.length;++h){let e=new n.DataItemComponent;e.x=a,e.y=r+l,e.initialize(s,t[h]),this.addItemComp(e),l+=o}}}t.EnvDataPanel=a},fae3:function(e,t,i){"use strict";i.r(t);i("1eb2");var s=i("edb0");for(var n in s)["default"].indexOf(n)<0&&function(e){i.d(t,e,(function(){return s[e]}))}(n)}})}));