(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t():"function"===typeof define&&define.amd?define([],t):"object"===typeof exports?exports["DsrdViewer"]=t():e["DsrdViewer"]=t()})("undefined"!==typeof self?self:this,(function(){return function(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s="fae3")}({"0efa":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i("75f5");class n{constructor(){this.m_init=!0}initialize(e=null,t=""){return this.m_init=!this.isEnabled(),!!this.m_init&&(this.m_init=!1,""!=t&&void 0!==t||(t="static/cospace/coMaterial/CoMaterial.umd.min.js"),new r.ModuleLoader(1,()=>{null!=e&&this.isEnabled()&&e([t])}).load(t),!0)}isEnabled(){return"undefined"!==typeof CoMaterial}createColor4(e,t,i,r){return CoMaterial.createColor4(e,t,i,r)}createDefaultMaterial(e){return CoMaterial.createDefaultMaterial(e)}createLineMaterial(e){return CoMaterial.createLineMaterial(e)}createQuadLineMaterial(e){return CoMaterial.createQuadLineMaterial(e)}createShaderMaterial(e){return CoMaterial.createShaderMaterial(e)}createMaterial(e){return CoMaterial.createMaterial(e)}creatMaterialContextParam(){return CoMaterial.creatMaterialContextParam()}createMaterialContext(){return CoMaterial.createMaterialContext()}}const a=new n;t.VoxMaterial=a},"1eb2":function(e,t,i){"use strict";if("undefined"!==typeof window){var r=window.document.currentScript,n=i("8875");r=n(),"currentScript"in document||Object.defineProperty(document,"currentScript",{get:n});var a=r&&r.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);a&&(i.p=a[1])}},2564:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(e,t=null,i=null){this.m_uid=r.s_uid++,this.m_urlChecker=null,this.m_oneTimes=!0,this.m_loaderMap=null,this.m_callback=t,this.m_times=e,this.m_urlChecker=i}setUrlChecker(e=null){return this.m_urlChecker=e,this}getUrlChecker(){return this.m_urlChecker}getUid(){return this.m_uid}setCallback(e){return this.m_callback=e,this}addLoader(e){if(null!=e&&e!=this)if(this.isFinished())e.use();else{null==this.m_loaderMap&&(this.m_loaderMap=new Map);let t=this.m_loaderMap;t.has(e.getUid())||t.set(e.getUid(),e)}return this}isFinished(){return 0==this.m_times}useOnce(){this.m_oneTimes&&(this.m_oneTimes=!1,this.use())}use(){if(this.m_times>0&&(this.m_times--,this.isFinished()&&null!=this.m_callback&&(this.m_callback(),this.m_callback=null,null!=this.m_loaderMap))){for(let[e,t]of this.m_loaderMap)t.use();this.m_loaderMap=null}}hasModuleByUrl(e){return r.loadedMap.has(e)}load(e){if(""==e)return this;null!=this.m_urlChecker&&(e=this.m_urlChecker(e));let t=r.loadedMap;if(t.has(e))return void this.use();let i=r.loadingMap;if(!i.has(e))return i.set(e,[this]),this.loadData(e),this;{let t=i.get(e);for(let e=0;e<t.length;++e)if(t[e]==this)return;t.push(this)}}loadData(e){let t=new XMLHttpRequest;t.open("GET",e,!0),t.onerror=function(e){},t.onload=t=>{this.loadedUrl(e)},t.send(null)}loadedData(e,t){}loadedUrl(e){let t=r.loadedMap,i=r.loadingMap;t.set(e,1);let n=i.get(e);for(let r=0;r<n.length;++r)n[r].use();i.delete(e)}getDataByUrl(e){return null}clearAllData(){}destroy(){this.m_urlChecker=null}}r.s_uid=0,r.loadedMap=new Map,r.loadingMap=new Map,t.PackedLoader=r},"2a2b":function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(i("7aa4")),a=i("75f5");class s{constructor(e){if(this.m_infoObj=null,this.m_verMap=new Map,this.forceFiltering=!1,null!=e){this.m_infoObj=e;const t=this.m_infoObj,i=this.m_verMap;let r=t.items;for(let e=0;e<r.length;++e){const t=r[e];if(i.set(t.name,t),t.type&&"dir"==t.type){let e=t.items;for(let t=0;t<e.length;++t){const r=e[t];i.set(r.name,r)}}}}}filterUrl(e){let t=e.indexOf("/dracoLib/")>0;if(t){let t=n.default.getFileNameAndSuffixName(e,!0);if(this.m_verMap.has(t)){let i=this.m_verMap.get(t);e+="?ver="+i.ver}}else{let t=n.default.getFileName(e,!0);if(this.m_verMap.has(t)){let i=this.m_verMap.get(t);e+="?ver="+i.ver}}return e}}function o(e,t){let i=e.lastIndexOf("/"),r=e.indexOf(".",i),n=e.slice(i,r);return e.indexOf(".umd.")>0?(n=n.toLocaleLowerCase(),e=t+e.slice(0,i)+n+".js"):e=t+e,e}t.CoModuleVersion=s;class l extends a.ModuleLoader{constructor(e,t=null,i=null){super(e,t,null),this.forceFiltering=!1;let r=e=>{if(e.indexOf(".artvily.")>0)return e;let t=window.location.href;return e=e.trim(),t.indexOf(".artvily.")>0||this.forceFiltering?(l.urlHostFilterEnabled&&(t=this.forceFiltering?n.default.getHostUrl("9090"):"http://www.artvily.com:9090/"),e=o(e,t),i&&(e=i.filterUrl(e)),e):(l.forceReleaseEnabled&&(e=o(e,"")),i&&(e=i.filterUrl(e)),e)};this.setUrlChecker(r)}}l.urlHostFilterEnabled=!0,l.forceReleaseEnabled=!1,t.CoModuleLoader=l},"2e41":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i("4427");t.ICoTransformRecorder=r.ICoTransformRecorder;const n=i("8ccd");t.ITransformController=n.ITransformController;const a=i("c333");t.IFloorLineGrid=a.IFloorLineGrid;const s=i("5b9f");t.IUIRectLine=s.IUIRectLine;const o=i("d07b");t.IRectFrameQuery=o.IRectFrameQuery;const l=i("75f5");var c=null;t.UserEditEvent=c;class u{constructor(){this.m_init=!0}initialize(e=null,i=""){return this.isEnabled()&&(t.UserEditEvent=c=Lib_VoxModelEdit.UserEditEvent),this.m_init=!this.isEnabled(),!!this.m_init&&(this.m_init=!1,""!=i&&void 0!==i||(i="static/cospace/modelEdit/Lib_VoxModelEdit.umd.min.js"),e&&new l.ModuleLoader(1,()=>{this.isEnabled()&&e([i])}).load(i),!0)}isEnabled(){return"undefined"!==typeof Lib_VoxModelEdit}get UserEditEvent(){return Lib_VoxModelEdit.UserEditEvent}createTransformRecorder(){return Lib_VoxModelEdit.createTransformRecorder()}createTransformController(){return Lib_VoxModelEdit.createTransformController()}createFloorLineGrid(){return Lib_VoxModelEdit.createFloorLineGrid()}createUIRectLine(){return Lib_VoxModelEdit.createUIRectLine()}createRectFrameQuery(){return Lib_VoxModelEdit.createRectFrameQuery()}}const d=new u;t.VoxModelEdit=d},3347:function(e,t,i){"use strict";var r,n,a;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e["ctmParser"]="ctmGeomParser",e["objParser"]="objGeomParser",e["dracoParser"]="dracoGeomParser",e["pngParser"]="pngParser",e["fbxFastParser"]="fbxFastParser",e["threadCore"]="threadCore",e["coSpaceApp"]="coSpaceApp"}(r||(r={})),t.CoModuleNS=r,function(e){e["Undefined"]="undefined-format",e["CTM"]="ctm",e["Draco"]="draco",e["OBJ"]="obj",e["FBX"]="fbx",e["GLB"]="glb",e["Jpg"]="jpg",e["Png"]="png",e["Gif"]="gif"}(n||(n={})),t.CoDataFormat=n,function(e){e["JS"]="js-text",e["Binasy"]="binary"}(a||(a={})),t.CoModuleFileType=a},"36c5":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(){}renderBegin(e){let t=e.getRenderProxy();t.clearDepth(1)}renderEnd(e){}}t.SceneAccessor=r},"39ed":function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i("2a2b"),a=i("7d28"),s=i("d1de"),o=i("634f"),l=i("3edd"),c=i("0efa"),u=i("f042"),d=i("2e41"),h=i("fd42"),m=r(i("7aa4")),_=i("5b39"),p=i("4a3f"),f=i("77da");class C{constructor(){this.m_verTool=null,this.m_teamLoader=new h.CoModelTeamLoader,this.m_edit3DUIRScene=null,this.m_graph=null,this.m_rscene=null,this.m_uiScene=null,this.m_mi=null,this.m_posV0=null,this.m_posV1=null,this.m_transCtr=null,this.m_selectFrame=null,this.m_valueFilter=new p.VecValueFilter,this.m_map=new Map,this.m_layouter=new f.EntityLayouter,this.m_entityQuery=null,this.m_entities=[],this.m_modelTexUrl=""}loadInfo(){let e="static/cospace/info.json";e=m.default.filterUrl(e);let t=new _.HttpFileLoader;t.load(e,(e,t)=>{this.m_verTool=new n.CoModuleVersion(e),this.initEngineModule()},null,null,"json")}initEngineModule(){let e="static/cospace/engine/uiInteract/CoUIInteraction.umd.js",t=new n.CoModuleLoader(2,()=>{},this.m_verTool),i="static/cospace/engine/renderer/CoRenderer.umd.js",r="static/cospace/engine/rscene/CoRScene.umd.js",a="static/cospace/math/CoMath.umd.js",o="static/cospace/ageom/CoAGeom.umd.js",l="static/cospace/comesh/CoMesh.umd.js",c="static/cospace/coentity/CoEntity.umd.js",h="static/cospace/particle/CoParticle.umd.js",m="static/cospace/coMaterial/CoMaterial.umd.js",_=" static/cospace/cotexture/CoTexture.umd.js",p="static/cospace/ui/Lib_VoxUI.umd.js",f="static/cospace/modelEdit/Lib_VoxModelEdit.umd.js";new n.CoModuleLoader(2,()=>{s.VoxRScene.isEnabled()&&new n.CoModuleLoader(3,()=>{new n.CoModuleLoader(6,()=>{s.VoxRScene.initialize(),u.VoxMath.initialize(),d.VoxModelEdit.initialize(),this.initRenderer(),this.initMouseInteract(),this.createEditEntity(),this.initUIScene()},this.m_verTool).load(o).load(c).load(h).load(_).load(p).load(f)},this.m_verTool).load(a).load(l).load(m)},this.m_verTool).addLoader(t).load(i).load(r),t.load(e)}initMouseInteract(){const e=o.VoxUIInteraction.createMouseInteraction();e.initialize(this.m_rscene,0).setAutoRunning(!0,1),this.m_mi=e,this.m_posV0=u.VoxMath.createVec3(),this.m_posV1=u.VoxMath.createVec3()}createDiv(e,t,i,r){let n=document.createElement("div");return n.style.width=i+"px",n.style.height=r+"px",document.body.appendChild(n),n.style.display="bolck",n.style.left=e+"px",n.style.top=t+"px",n.style.position="absolute",n.style.display="bolck",n.style.position="absolute",n}initRenderer(){}initUIScene(){let e=this.m_uiScene=l.VoxUI.createUIScene(this.m_graph);e.texAtlasNearestFilter=!0,e.rscene.addEventListener(s.MouseEvent.MOUSE_BG_DOWN,this,this.uiMouseDownListener),e.rscene.addEventListener(s.MouseEvent.MOUSE_UP,this,this.uiMouseUpListener),e.rscene.addEventListener(s.MouseEvent.MOUSE_MOVE,this,this.uiMouseMoveListener),this.initUIEntities(),this.m_entityQuery=d.VoxModelEdit.createRectFrameQuery(),this.m_entityQuery.initialize(this.m_rscene),null==this.m_selectFrame&&(this.m_selectFrame=d.VoxModelEdit.createUIRectLine(),this.m_selectFrame.initialize(e.rscene),this.m_selectFrame.enable());let t=this.m_rscene;t.addEventListener(s.KeyboardEvent.KEY_DOWN,this,this.keyDown),t.addEventListener(s.MouseEvent.MOUSE_BG_CLICK,this,this.mouseBGClickListener),t.addEventListener(s.MouseEvent.MOUSE_UP,this,this.mouseUpListener,!0,!0)}createBtn(e,t,i,r,n){let a=c.VoxMaterial.createColor4(1,1,1,1),o=l.VoxUI.createTextLabelButton(e,t,100,50,a);return o.setXY(i,r),this.m_uiScene.addEntity(o),o.addEventListener(s.MouseEvent.MOUSE_UP,this,this.btnMouseUpListener),n.addButton(o),o}createSelectBtn(e,t,i,r,n,a,o){let c=l.VoxUI.createSelectionEntity();c.uuid=r;let u=[4284333731,4281578057,4284144565,4281578057];return c.setBGColorsWithARGBUint32(u),c.initialize(this.m_uiScene,i,n,a,30),c.addEventListener(s.SelectionEvent.SELECT,this,this.selectChange),o?c.select(!1):c.deselect(!1),c.setXY(e,t),this.m_uiScene.addEntity(c),c}selectChange(e){this.m_valueFilter.setAbsorbing(e.flag)}initUIEntities(){this.m_btnGroup0=l.VoxUI.createSelectButtonGroup(),this.m_btnGroup1=l.VoxUI.createSelectButtonGroup(),this.m_btnGroup2=l.VoxUI.createSelectButtonGroup()}createEditEntity(){let e=this.m_edit3DUIRScene;this.m_transCtr=d.VoxModelEdit.createTransformController();const t=this.m_transCtr;t.initialize(e),t.addEventListener(a.UserEditEvent.EDIT_BEGIN,this,this.trans3DEditBegin),t.addEventListener(a.UserEditEvent.EDIT_END,this,this.trans3DEditEnd),this.m_transCtr.setCtrlValueFilter(this.m_valueFilter),this.m_prevPos=u.VoxMath.createVec3(),this.m_currPos=u.VoxMath.createVec3(),this.m_keyInterac=o.VoxUIInteraction.createKeyboardInteraction();const i=this.m_keyInterac;i.initialize(this.m_rscene);let r=s.Keyboard,n=i.createKeysEventType([r.CTRL,r.Y]);i.addKeysDownListener(n,this,this.keyCtrlYDown),n=i.createKeysEventType([r.CTRL,r.Z]),i.addKeysDownListener(n,this,this.keyCtrlZDown),this.m_recoder=d.VoxModelEdit.createTransformRecorder()}keyCtrlZDown(e){this.m_recoder.undo();let t=this.m_recoder.getCurrList();this.selectEntities(t)}keyCtrlYDown(e){this.m_recoder.redo();let t=this.m_recoder.getCurrList();this.selectEntities(t)}trans3DEditBegin(e){let t=e.currentTarget.getTargetEntities(),i=this.m_rscene.getStage3D();this.m_prevPos.setXYZ(i.mouseX,i.mouseY,0),this.m_recoder.saveBegin(t),this.m_selectFrame.disable()}trans3DEditEnd(e){let t=this.m_rscene.getStage3D();if(this.m_currPos.setXYZ(t.mouseX,t.mouseY,0),u.Vector3D.Distance(this.m_prevPos,this.m_currPos)>.5){let t=e.currentTarget.getTargetEntities();this.m_recoder.saveEnd(t)}else this.m_recoder.saveEnd(null);this.m_selectFrame.enable()}uiMouseDownListener(e){}uiMouseUpListener(e){}uiMouseMoveListener(e){this.m_selectFrame.move(e.mouseX,e.mouseY)}btnMouseUpListener(e){let t=e.uuid;switch(t){case"local":this.m_transCtr.toLocal();break;case"global":this.m_transCtr.toGlobal();break;case"move":this.m_transCtr.toTranslation();break;case"scale":this.m_transCtr.toScale();break;case"rotate":this.m_transCtr.toRotation();break;case"redo":this.keyCtrlYDown(null);break;case"undo":this.keyCtrlZDown(null);break;default:break}}createTexByUrl(e="",t=!0){let i=this.m_map;if(e=""!=e?e:"static/assets/box.jpg",e=m.default.filterUrl(e),i.has(e))return i.get(e);let r=this.m_rscene.textureBlock.createImageTex2D();t&&i.set(e,r);const n=new XMLHttpRequest;return n.open("GET",e,!0),n.responseType="blob",n.onload=e=>{let t=new Image;t.onload=e=>{r.setDataFromImage(t,0,0,0,!1)};let i=window;var a=(i.URL||i.webkitURL).createObjectURL(n.response);t.src=a},n.onerror=e=>{},n.send(null),r}keyDown(e){let t=s.Keyboard;switch(e.keyCode){case t.W:this.m_transCtr.toTranslation();break;case t.E:this.m_transCtr.toScale();break;case t.R:this.m_transCtr.toRotation();break;default:break}}loadModels(){let e="static/private/",t=e+"obj/base.obj";t=e+"fbx/base4.fbx",t="static/assets/fbx/base4.fbx",t=m.default.filterUrl(t);let i=this.m_teamLoader;i.verTool=this.m_verTool,i.load([t],(e,t)=>{this.m_layouter.layoutReset();for(let i=0;i<e.length;++i)this.createEntity(e[i],null!=t?t[i]:null,1);this.m_layouter.layoutUpdate(200,u.VoxMath.createVec3(0,0,0))})}createEntity(e,t=null,i=1,r=""){let n=s.VoxRScene.createDefaultMaterial(!0);n.setRGB3f(.85,.85,.85),n.setTextureList([this.createTexByUrl(this.m_modelTexUrl)]),n.initializeByCodeBuf(!0);let a=s.VoxRScene.createDataMeshFromModel(e,n),o=s.VoxRScene.createMouseEventEntity();return""!=r&&(o.uuid=r),o.setMaterial(n),o.setMesh(a),o.update(),null==this.m_entityContainer?this.m_rscene.addEntity(o):this.m_entityContainer.addEntity(o),o.addEventListener(s.MouseEvent.MOUSE_OVER,this,this.mouseOverTargetListener),o.addEventListener(s.MouseEvent.MOUSE_OUT,this,this.mouseOutTargetListener),o.addEventListener(s.MouseEvent.MOUSE_DOWN,this,this.mouseDownTargetListener),o.addEventListener(s.MouseEvent.MOUSE_UP,this,this.mouseUpTargetListener),this.m_entities.push(o),this.m_layouter.layoutAppendItem(o,s.VoxRScene.createMat4(t)),o}mouseOverTargetListener(e){}mouseOutTargetListener(e){}mouseDownTargetListener(e){this.m_posV0.setXYZ(e.mouseX,e.mouseY,0),this.m_posV1.copyFrom(this.m_posV0),this.m_mi.drager.attach()}selectEntities(e,t=null){if(e&&e.length>0){let t=this.m_transCtr,i=u.VoxMath.createVec3();for(let r=0;r<e.length;++r)i.addBy(e[r].getGlobalBounds().center);if(i.scaleBy(1/e.length),e.length>0&&this.m_modelSelectCall){let t=[];for(let i=0;i<e.length;i++)t.push(e[i].uuid);this.m_modelSelectCall(t)}t&&e.length>0&&this.m_outline.select(e)}}setMouseUpListener(e){this.m_mouseUpCall=e}setModelSelectListener(e){this.m_modelSelectCall=e}mouseUpTargetListener(e){if(this.m_posV1.setXYZ(e.mouseX,e.mouseY,0),this.m_posV0.subtractBy(this.m_posV1),this.m_posV0.getLength()<.5){let t=e.target;this.selectEntities([t],e.wpos)}this.m_mouseUpCall&&this.m_mouseUpCall(e)}mouseUpListener(e){this.m_transCtr&&this.m_transCtr.decontrol()}mouseBGClickListener(e){this.m_transCtr&&this.m_transCtr.disable(),this.m_outline.deselect(),this.m_mouseUpCall&&this.m_mouseUpCall(e),this.m_modelSelectCall&&this.m_modelSelectCall([])}run(){this.m_graph&&(this.m_transCtr&&this.m_transCtr.run(),this.m_graph.run())}}t.DsrdViewerBase=C},"3edd":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i("75f5");class n{constructor(){this.m_init=!0}initialize(e=null,t=""){return this.isEnabled()&&Lib_VoxUI.initialize(),this.m_init=!this.isEnabled(),!!this.m_init&&(this.m_init=!1,""!=t&&void 0!==t||(t="static/cospace/ui/Lib_VoxUI.umd.min.js"),null!=e&&new r.ModuleLoader(1,()=>{this.isEnabled()&&e([t])}).load(t),!0)}isEnabled(){return"undefined"!==typeof Lib_VoxUI}createColorLabel(){return Lib_VoxUI.createColorLabel()}createUILayout(){return Lib_VoxUI.createUILayout()}createTipInfo(){return Lib_VoxUI.createTipInfo()}createRectTextTip(){return Lib_VoxUI.createRectTextTip()}createClipLabel(){return Lib_VoxUI.createClipLabel()}createClipColorLabel(){return Lib_VoxUI.createClipColorLabel()}createColorClipLabel(){return Lib_VoxUI.createColorClipLabel()}createTextLabel(){return Lib_VoxUI.createTextLabel()}createButton(){return Lib_VoxUI.createButton()}createFlagButton(){return Lib_VoxUI.createFlagButton()}createSelectButtonGroup(){return Lib_VoxUI.createSelectButtonGroup()}createTextButton(e,t,i,r,n,a){return Lib_VoxUI.createTextButton(e,t,i,r,n,a)}createTextLabelButton(e,t,i,r,n,a,s){return Lib_VoxUI.createTextLabelButton(e,t,i,r,n,a,s)}createUIPanel(){return Lib_VoxUI.createUIPanel()}createPromptPanel(){return Lib_VoxUI.createPromptPanel()}createParamCtrlPanel(){return Lib_VoxUI.createParamCtrlPanel()}createUIScene(e,t,i,r){return Lib_VoxUI.createUIScene(e,t,i,r)}createSelectionEntity(){return Lib_VoxUI.createSelectionEntity()}createProgressEntity(){return Lib_VoxUI.createProgressEntity()}}const a=new n;t.VoxUI=a},4427:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},4620:function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(i("7aa4"));class a{constructor(){this.m_listeners=[],this.url="",this.img=null,this.loaded=!1}addListener(e){let t=this.m_listeners,i=0;for(;i<t.length;++i)if(t[i]==e)break;i>=t.length&&t.push(e)}removeListener(e){let t=this.m_listeners;for(let i=0;i<t.length;++i)if(t[i]==e){t.splice(i,1);break}}dispatch(){if(this.loaded){let e=this.m_listeners;this.m_listeners=[];for(let t=0;t<e.length;++t)e[t](this.img,this.url)}}}class s{constructor(){this.m_map=new Map}load(e,t){if(""!=e){let i=e,r=this.m_map;if(e=""!=e?e:"static/assets/box.jpg",e=n.default.filterUrl(e),r.has(i)){let i=r.get(e);i.loaded?t(i.img,i.url):i.addListener(t)}let s=new Image,o=new a;o.img=s,o.url=i,o.addListener(t),r.set(i,o);const l=new XMLHttpRequest;l.open("GET",e,!0),l.responseType="blob",l.onload=e=>{s.onload=e=>{o.loaded=!0,o.dispatch()};let t=window;s.src=(t.URL||t.webkitURL).createObjectURL(l.response)},l.onerror=e=>{},l.send(null)}}}t.default=s},"4a3f":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(){this.m_absorb=!1}filterScale(e){return Math.abs(e)<1?e<0?e=-1:e>0&&(e=1):e=Math.floor(e),e}setAbsorbing(e){this.m_absorb=e}ctrlValueFilter(e,t){if(this.m_absorb)switch(e){case 0:t.x=10*Math.round(t.x/10),t.y=10*Math.round(t.y/10),t.z=10*Math.round(t.z/10);break;case 1:t.x=this.filterScale(t.x),t.y=this.filterScale(t.y),t.z=this.filterScale(t.z);break;case 2:t.x=5*Math.round(t.x/5),t.y=5*Math.round(t.y/5),t.z=5*Math.round(t.z/5);break;default:break}}}t.VecValueFilter=r},"5b39":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(){this.crossOrigin="anonymous"}setCrossOrigin(e){this.crossOrigin=e}async load(e,t,i=null,r=null,n="blob",a=""){if(null==t)throw Error("onload == null !!!");const s=new FileReader;s.onload=i=>{t&&t(s.result,e)};const o=new XMLHttpRequest;o.open("GET",e,!0),""!=a&&o.setRequestHeader("Range",a),o.responseType=n,o.onload=i=>{if(o.status<=206)switch(n){case"arraybuffer":case"blob":s.readAsArrayBuffer(o.response);break;case"json":t&&t(o.response,e);break;case"text":t&&t(o.response,e);break;default:t&&t(o.response,e);break}else r&&r(o.status,e)},null!=i&&(o.onprogress=t=>{let r=0;if(t.total>0||t.lengthComputable)r=Math.min(1,t.loaded/t.total);else{let e=parseInt(o.getResponseHeader("content-length"));e>0&&(e*=4,r=Math.min(1,t.loaded/e))}i(r,e)}),null!=r&&(o.onerror=t=>{r(o.status,e)}),o.send(null)}}t.HttpFileLoader=r},"5b9f":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},"634f":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i("75f5");class n{constructor(){this.m_init=!0}initialize(e=null,t=""){return!!this.m_init&&(this.m_init=!1,""!=t&&void 0!==t||(t="static/cospace/engine/uiInteract/CoUIInteraction.umd.min.js"),new r.ModuleLoader(1,()=>{null!=e&&this.isEnabled()&&e([t])}).load(t),!0)}createMouseInteraction(){return CoUIInteraction.createMouseInteraction()}createKeyboardInteraction(){return CoUIInteraction.createKeyboardInteraction()}isEnabled(){return"undefined"!==typeof CoUIInteraction}}const a=new n;t.VoxUIInteraction=a},"75f5":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i("2564");class n extends r.PackedLoader{constructor(e,t=null,i=null){super(e,t,i)}loadData(e){let t=new XMLHttpRequest;t.open("GET",e,!0),t.onerror=function(e){},t.onload=i=>{this.loadedData(t.response,e),this.loadedUrl(e)},t.send(null)}loadedData(e,t){let i=document.createElement("script");i.onerror=e=>{},i.type="text/javascript";try{i.innerHTML=e,document.head.appendChild(i)}catch(r){throw r}}}t.ModuleLoader=n},"77da":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(){this.m_scaleV=null,this.m_tempMat=null,this.m_currMat=null,this.m_aabb=null,this.m_sizeScale=1,this.m_entities=[],this.m_transforms=[],this.locationEnabled=!0,this.rotationEnabled=!1}initialize(){null==this.m_scaleV&&(this.m_scaleV=CoMath.createVec3(),this.m_tempMat=CoMath.createMat4(),this.m_currMat=CoMath.createMat4(),this.m_aabb=CoMath.createAABB())}getAABB(){return this.m_aabb}layoutReset(){this.m_sizeScale=1,this.m_scaleV=null,this.initialize(),this.m_entities=[],this.m_transforms=[]}getEntities(){return this.m_entities}layoutAppendItem(e,t){this.m_entities.push(e),this.m_transforms.push(t)}layoutUpdate(e=300,t=null,i=!1){this.rotationEnabled=i;for(let r=0;r<this.m_entities.length;++r){let e=this.m_entities[r];e.setXYZ(0,0,0),e.setScaleXYZ(1,1,1),e.setRotationXYZ(0,0,0)}null==t&&(t=CoMath.createVec3()),this.fixToPosition(this.m_entities,this.m_transforms,t,e)}calcAABB(e,t){this.initialize();let i=this.m_aabb;for(let r=0;r<e.length;++r)e[r].update(),r>0?i.union(e[r].getGlobalBounds()):i.copyFrom(e[r].getGlobalBounds());return i.update(),i}fixToPosition(e,t,i,r=300){this.initialize();let n,a=this.m_tempMat,s=this.m_currMat,o=this.m_aabb;for(let d=0;d<e.length;++d)n=t[d],a.identity(),this.rotationEnabled&&a.setRotationEulerAngle(.5*Math.PI,0,0),null!=n?(s.copyFrom(n),s.append(a),e[d].getTransform().setParentMatrix(s)):(s.copyFrom(a),e[d].getTransform().setParentMatrix(s)),e[d].update(),d>0?o.union(e[d].getGlobalBounds()):o.copyFrom(e[d].getGlobalBounds());o.update();let l=r/o.getWidth(),c=r/o.getHeight(),u=r/o.getLong();l=Math.min(l,c,u),this.m_sizeScale=l,this.m_scaleV.setXYZ(l,l,l),o.reset();for(let d=0;d<e.length;++d){n=t[d],a.identity(),a.setScale(this.m_scaleV),this.rotationEnabled&&a.setRotationEulerAngle(.5*Math.PI,0,0),null!=n?(s.copyFrom(n),s.append(a)):s.copyFrom(a);let i=s.decompose(CoMath.OrientationType.EULER_ANGLES);e[d].setScale3(i[2]),e[d].setRotation3(i[1]),e[d].setPosition(i[0]),e[d].getTransform().setParentMatrix(null),e[d].update(),d>0?o.union(e[d].getGlobalBounds()):o.copyFrom(e[d].getGlobalBounds())}if(o.update(),this.locationEnabled){let t=CoMath.createVec3();t.subVecsTo(i,o.center),o.reset();for(let i=0;i<e.length;++i){let r=e[i].getPosition();r.addBy(t),e[i].setPosition(r),e[i].update(),i>0?o.union(e[i].getGlobalBounds()):o.copyFrom(e[i].getGlobalBounds())}o.update()}}getSizeScale(){return this.m_sizeScale}}t.EntityLayouter=r},"79da":function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i("d1de"),a=i("9b53"),s=r(i("4620")),o=i("0efa");class l{constructor(){this.m_rscene=null,this.m_imgViewEntity=null,this.m_imageAlpha=1,this.m_imageFakeAlpha=.2,this.m_imageVisible=!0,this.m_viewImageUrl="static/assets/modules/apple_01/mini.jpg",this.m_imgResLoader=new s.default,this.m_imgLoaded=!0,this.m_imgUrls=[],this.m_imgTex=null,this.m_imgTexDelay=0,this.m_rsceneCamVer=-10,this.m_material=null,this.debugDev=!0}initialize(e){e.updateCamera(),this.m_rscene=e,this.m_rsceneCamVer=this.m_rscene.getCamera().version;let t=30;this.m_rscene.addEventListener(n.MouseEvent.MOUSE_DOUBLE_CLICK,this,e=>{this.m_imageAlpha>this.m_imageFakeAlpha?this.setViewImageAlpha(this.m_imageFakeAlpha):this.setViewImageAlpha(1)}),this.m_rscene.addEventListener(n.EventBase.ENTER_FRAME,this,e=>{const i=this.m_rscene.getCamera();this.m_rsceneCamVer!=i.version&&(this.m_rsceneCamVer=i.version,this.setViewImageAlpha(this.m_imageFakeAlpha)),t>0&&(t--,t<1&&(t=30,this.m_imgLoaded&&this.m_imgUrls.length>0&&this.setViewImageUrl(this.m_imgUrls.shift()))),null!=this.m_imgTex&&this.m_imgTex.isGpuEnabled()&&this.m_imgTexDelay>0&&(this.m_imgTexDelay--,this.m_imgTexDelay<1&&(this.setViewImageAlpha(this.m_imageAlpha),this.m_imgTex=null))})}filterUrl(e){return e}setViewImageUrls(e){null!==e&&void 0!==e||(e=[]),this.m_imgUrls=e}setViewImageUrl(e,t=!1,i=1){""!=e&&(this.m_imageAlpha=i,null!=this.m_imgViewEntity?this.m_viewImageUrl!=e&&(this.m_imgLoaded?(this.m_viewImageUrl=e,this.m_imgLoaded=!1,this.m_imgResLoader.load(this.filterUrl(e),(e,t)=>{let i=this.m_rscene.textureBlock.createImageTex2D();i.flipY=!0,i.setDataFromImage(e),this.m_imgViewEntity.setTextureList([i]),this.m_imgViewEntity.updateMaterialToGpu(),this.m_imgLoaded=!0,this.m_imgTex=i,this.m_imgTexDelay=5})):this.m_imgUrls.push(e)):(this.m_viewImageUrl=e,this.initImgViewer()))}setViewImageFakeAlpha(e){this.m_imageFakeAlpha=e}setViewImageAlpha(e){this.m_imageAlpha=e,null!=this.m_material&&this.m_material.setAlpha(this.m_imageAlpha)}getViewImageAlpha(){return this.m_imageAlpha}setViewImageVisible(e){this.m_imageVisible=e,null!=this.m_imgViewEntity&&this.m_imgViewEntity.setVisible(e)}getViewImageVisible(){return this.m_imageVisible}initImgViewer(){null==this.m_imgViewEntity&&this.m_imgResLoader.load(this.filterUrl(this.m_viewImageUrl),(e,t)=>{let i=this.m_rscene.textureBlock.createImageTex2D();i.flipY=!0,i.setDataFromImage(e);let r=o.VoxMaterial.createDefaultMaterial(!1);r.fixAlignScreen=!0,r.setAlpha(this.m_imageAlpha),r.setTextureList([i]),r.initializeByCodeBuf(!0),this.m_material=r,this.m_imgViewEntity=a.VoxEntity.createFixScreenPlane(-1,-1,2,2,r,!0),this.m_imgViewEntity.setRenderState(n.RendererState.BACK_TRANSPARENT_ALWAYS_STATE),this.m_imgViewEntity.setVisible(this.m_imageVisible),this.m_rscene.addEntity(this.m_imgViewEntity,1)})}}t.DsrdImageViewer=l},"7aa4":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{static getDomain(e){var t=/http:\/\/([^\/]+)/i;let i=e.match(t);return null!=i&&i.length>0?i[0]:""}static getHostUrl(e,t="/"){let i=location.href,n=r.getDomain(i),a=n.split(":");return i=a[0]+":"+a[1],e?i+":"+e+"/":n+t}static isEnabled(){let e=window.location.href;return e.indexOf(".artvily.com")>0}static filterUrl(e){if(e.indexOf("blob:")<0){let t=window.location.href;t.indexOf(".artvily.")>0&&(t="http://www.artvily.com:9090/",e=t+e)}return e}static getFileName(e,t=!1,i=!1){if(e.indexOf("blob:")<0||i){let i=e.lastIndexOf("/");if(i<0)return"";let r=e.lastIndexOf(".",e.length);if(r<0)return"";if(i+2<r){let n=e.slice(i+1,r);return t?n.toLocaleLowerCase():n}}return""}static getFileNameAndSuffixName(e,t=!1,i=!1){if(e.indexOf("blob:")<0||i){let i=e.lastIndexOf("/"),r=e.lastIndexOf(".",e.length);if(r<0)return"";let n=e.slice(i+1);return t?n.toLocaleLowerCase():n}return""}static getFileSuffixName(e,t=!1,i=!1){if(e.indexOf("blob:")<0||i){let i=e.lastIndexOf(".",e.length);if(i<0)return"";let r=e.slice(i+1);return t?r.toLocaleLowerCase():r}return""}}t.default=r},"7c62":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i("3347"),n=i("2a2b");class a{constructor(){this.m_init=!0,this.m_sysIniting=!0,this.m_initInsFlag=!0,this.verTool=null,this.m_initCalls=[]}initialize(e=null,t=!1){if(this.m_init){this.m_init=!1,this.m_sysInitCallback=e,this.m_deferredInit=t;let i=[{url:"static/cospace/core/coapp/CoSpaceApp.umd.js",name:r.CoModuleNS.coSpaceApp,type:r.CoModuleFileType.JS},{url:"static/cospace/core/code/ThreadCore.umd.js",name:r.CoModuleNS.threadCore,type:r.CoModuleFileType.JS},{url:"static/cospace/modules/ctm/ModuleCTMGeomParser.umd.js",name:r.CoModuleNS.ctmParser,type:r.CoModuleFileType.JS},{url:"static/cospace/modules/obj/ModuleOBJGeomParser.umd.js",name:r.CoModuleNS.objParser,type:r.CoModuleFileType.JS},{url:"static/cospace/modules/png/ModulePNGParser.umd.js",name:r.CoModuleNS.pngParser,type:r.CoModuleFileType.JS},{url:"static/cospace/modules/fbxFast/ModuleFBXGeomFastParser.umd.js",name:r.CoModuleNS.fbxFastParser,type:r.CoModuleFileType.JS},{url:"static/cospace/modules/draco/ModuleDracoGeomParser.umd.js",name:r.CoModuleNS.dracoParser,type:r.CoModuleFileType.JS,params:["static/cospace/modules/dracoLib/"]}];this.m_modules=i;let a={nodes:[{uniqueName:"dracoGeomParser",path:"static/cospace/modules/draco/ModuleDracoGeomParser.umd.js"},{uniqueName:"dracoWasmWrapper",path:"static/cospace/modules/dracoLib/w2.js"},{uniqueName:"ctmGeomParser",path:"static/cospace/modules/ctm/ModuleCTMGeomParser.umd.js"}],maps:[{uniqueName:"dracoGeomParser",includes:[1]}]};this.m_dependencyGraphObj=a;let s=new n.CoModuleLoader(1,null,this.verTool);this.verTool&&(s.forceFiltering=this.verTool.forceFiltering);let o=s.getUrlChecker();if(o){for(let t=0;t<i.length;++t)i[t].url=o(i[t].url);let e=a.nodes;for(let t=0;t<e.length;++t)e[t].path=o(e[t].path)}t||this.loadSys()}}loadSys(){this.m_sysIniting&&(new n.CoModuleLoader(1,()=>{this.initCoSpaceSys()}).load(this.m_modules[0].url),this.m_sysIniting=!1)}getCPUDataByUrlAndCallback(e,t,i,r){if(null!=this.coappIns){let n=this.coappIns.getCPUDataByUrlAndCallback(e,t,i,r);if(this.m_deferredInit&&this.m_initInsFlag){this.m_initInsFlag=!1;let e=this.m_modules;this.coappIns.initialize(3,e[1].url,!0)}return n}return null}deferredInit(e){null==this.coappIns?(this.m_initCalls.push(e),this.loadSys()):null!=e&&e()}initCoSpaceSys(){if(null==this.coappIns&&"undefined"!==typeof CoSpaceApp){let e=CoSpaceApp.createInstance(),t=this.m_modules,i=JSON.stringify(this.m_dependencyGraphObj);e.setThreadDependencyGraphJsonString(i),e.setTaskModuleParams(t),this.m_deferredInit||e.initialize(3,t[1].url,!0);let r=this;r.coappIns=e;for(let n=0;n<this.m_initCalls.length;++n)null!=this.m_initCalls[n]&&this.m_initCalls[n]();this.m_initCalls=[]}null!=this.m_sysInitCallback&&this.m_sysInitCallback(),this.m_sysInitCallback=null}destroy(){}}t.CoDataModule=a,t.default=a},"7d28":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{}r.EDIT_BEGIN=20001,r.EDIT_END=20002,t.UserEditEvent=r},8875:function(e,t,i){var r,n,a;(function(i,s){n=[],r=s,a="function"===typeof r?r.apply(t,n):r,void 0===a||(e.exports=a)})("undefined"!==typeof self&&self,(function(){function e(){var t=Object.getOwnPropertyDescriptor(document,"currentScript");if(!t&&"currentScript"in document&&document.currentScript)return document.currentScript;if(t&&t.get!==e&&document.currentScript)return document.currentScript;try{throw new Error}catch(m){var i,r,n,a=/.*at [^(]*\((.*):(.+):(.+)\)$/gi,s=/@([^@]*):(\d+):(\d+)\s*$/gi,o=a.exec(m.stack)||s.exec(m.stack),l=o&&o[1]||!1,c=o&&o[2]||!1,u=document.location.href.replace(document.location.hash,""),d=document.getElementsByTagName("script");l===u&&(i=document.documentElement.outerHTML,r=new RegExp("(?:[^\\n]+?\\n){0,"+(c-2)+"}[^<]*<script>([\\d\\D]*?)<\\/script>[\\d\\D]*","i"),n=i.replace(r,"$1").trim());for(var h=0;h<d.length;h++){if("interactive"===d[h].readyState)return d[h];if(d[h].src===l)return d[h];if(l===u&&d[h].innerHTML&&d[h].innerHTML.trim()===n)return d[h]}return null}}return e}))},"8ccd":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},"9b53":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i("75f5");class n{constructor(){this.m_init=!0}initialize(e=null,t=""){return this.m_init=!this.isEnabled(),!!this.m_init&&(this.m_init=!1,""!=t&&void 0!==t||(t="static/cospace/coentity/CoEntity.umd.min.js"),new r.ModuleLoader(1,()=>{null!=e&&this.isEnabled()&&e([t])}).load(t),!0)}isEnabled(){return"undefined"!==typeof CoEntity&&"undefined"!==typeof CoRScene}createDataMeshFromModel(e,t,i){return CoEntity.createDataMeshFromModel(e,t,i)}createDisplayEntityFromModel(e,t,i){return CoEntity.createDisplayEntityFromModel(e,t,i)}createLine(e,t,i=null){return CoEntity.createLine(e,t,i)}createFreeAxis3DEntity(e,t){return CoEntity.createFreeAxis3DEntity(e,t)}createAxis3DEntity(e){return CoEntity.createAxis3DEntity(e)}createDisplayEntityWithDataMesh(e,t,i){return CoEntity.createDisplayEntityWithDataMesh(e,t,i)}createDisplayEntity(){return CoEntity.createDisplayEntity()}createMouseEventEntity(){return CoEntity.createMouseEventEntity()}createBoundsEntity(){return CoEntity.createBoundsEntity()}createCrossAxis3DEntity(e){return CoEntity.createCrossAxis3DEntity(e)}createDisplayEntityContainer(){return CoEntity.createDisplayEntityContainer()}createFixScreenPlane(e=-1,t=-1,i=2,r=2,n=null,a=!1){return CoEntity.createFixScreenPlane(e,t,i,r,n,a)}createXOYPlane(e,t,i,r,n=null,a=!1){return CoEntity.createXOYPlane(e,t,i,r,n,a)}createXOZPlane(e,t,i,r,n=null,a=!1){return CoEntity.createXOZPlane(e,t,i,r,n,a)}createYOZPlane(e,t,i,r,n=null,a=!1){return CoEntity.createYOZPlane(e,t,i,r,n,a)}createCube(e,t=null,i=!1){return CoEntity.createCube(e,t,i)}createBox(e,t,i=null,r=!1){return CoEntity.createBox(e,t,i,r)}createSphere(e,t=20,i=20,r=null,n=!1,a=!1){return CoEntity.createSphere(e,t,i,r,n,a)}createCone(e,t,i=20,r=null,n=!1,a=-.5){return CoEntity.createCone(e,t,i,r,n,a)}createCylinder(e,t,i=20,r=null,n=!1,a=1,s=-.5){return CoEntity.createCylinder(e,t,i,r,n,a,s)}createTube(e,t,i=20,r=1,n=0,a=null,s=!1,o=1,l=-.5){return CoEntity.createTube(e,t,i,r,n,a,s,o,l)}createTorus(e,t,i=20,r=1,n=0,a=null,s=!1,o=1,l=-.5){return CoEntity.createTorus(e,t,i,r,n,a,s,o,l)}}const a=new n;t.VoxEntity=a},c333:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},c75a:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i("2a2b");class n{constructor(e,t=null){this.m_rscene=e;let i="static/cospace/renderEffect/occPostOutline/OccPostOutlineModule.umd.js";new r.CoModuleLoader(1,null,t).setCallback(()=>{this.m_postOutline=OccPostOutlineModule.create(),this.initOutline(),this.m_rscene.appendRenderNode(this)}).load(i)}initOutline(){this.m_postOutline.initialize(this.m_rscene,0,[0]),this.m_postOutline.setFBOSizeScaleRatio(.5),this.m_postOutline.setRGB3f(0,1,0),this.m_postOutline.setOutlineDensity(2),this.m_postOutline.setOcclusionDensity(.2)}select(e){null!=this.m_postOutline&&this.m_postOutline.setTargetList(e)}deselect(){null!=this.m_postOutline&&this.m_postOutline.setTargetList(null)}render(){null!=this.m_postOutline&&(this.m_postOutline.drawBegin(),this.m_postOutline.draw(),this.m_postOutline.drawEnd())}}t.PostOutline=n},d07b:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},d1de:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i("75f5"),n=i("dab7");var a=null;t.RendererDevice=a;var s=null;t.SelectionEvent=s;var o=null;t.ProgressDataEvent=o;var l=null;t.MouseEvent=l;var c=null;t.EventBase=c;var u=null;t.RendererState=u;var d=null;t.TextureConst=d;var h=null;t.Keyboard=h;var m=null;t.KeyboardEvent=m;var _=null;t.RenderDrawMode=_;var p=null;t.CullFaceMode=p;var f=null;t.DepthTestMode=f;var C=null;t.RenderBlendMode=C;var M=null;t.GLStencilFunc=M;var y=null;t.GLStencilOp=y;var b=null;t.GLBlendMode=b;var g=null;t.GLBlendEquation=g;class E{constructor(){this.m_init=!0}init(){const e=CoRScene,i=CoRenderer;"undefined"!==typeof e&&(t.RendererDevice=a=e.RendererDevice,t.SelectionEvent=s=e.SelectionEvent,t.ProgressDataEvent=o=e.ProgressDataEvent,t.EventBase=c=e.EventBase,t.MouseEvent=l=e.MouseEvent,t.RendererState=u=e.RendererState,t.TextureConst=d=e.TextureConst,t.Keyboard=h=e.Keyboard,t.KeyboardEvent=m=e.KeyboardEvent,t.RenderDrawMode=_=i.RenderDrawMode,t.CullFaceMode=p=i.CullFaceMode,t.DepthTestMode=f=i.DepthTestMode,t.RenderBlendMode=C=i.RenderBlendMode,t.GLStencilFunc=M=i.GLStencilFunc,t.GLStencilOp=y=i.GLStencilOp,t.GLBlendMode=b=i.GLBlendMode,t.GLBlendEquation=g=i.GLBlendEquation)}initialize(e=null,t=""){if(this.m_init=!this.isEnabled(),this.m_init||(n.VoxRenderer.initialize(),this.init()),this.m_init){this.m_init=!1;let i=!1,a=0,s="";return i=n.VoxRenderer.initialize(i=>{s=i[0],a++,a>1&&null!=e&&this.isEnabled()&&e([s,t])}),""!=t&&void 0!==t||(t="static/cospace/engine/rscene/CoRScene.umd.min.js"),new r.ModuleLoader(1,()=>{n.VoxRenderer.initialize(),this.init(),i?(a++,a>1&&null!=e&&this.isEnabled()&&e([s,t])):null!=e&&"undefined"!==typeof CoRScene&&e([t])}).load(t),!0}return!1}get RendererDevice(){return CoRScene.RendererDevice}get RendererState(){return CoRScene.RendererState}get RenderDrawMode(){return CoRScene.RenderDrawMode}get VtxBufConst(){return CoRScene.VtxBufConst}get TextureConst(){return CoRScene.TextureConst}get Vector3D(){return CoRScene.Vector3D}get MouseEvent(){return CoRScene.MouseEvent}get EventBase(){return CoRScene.EventBase}get SelectionEvent(){return CoRScene.SelectionEvent}get ProgressDataEvent(){return CoRScene.ProgressDataEvent}get KeyboardEvent(){return CoRScene.KeyboardEvent}get Keyboard(){return CoRScene.Keyboard}get ShaderCodeUUID(){return CoRScene.ShaderCodeUUID}get MaterialContextParam(){return CoRScene.MaterialContextParam}get MaterialPipeType(){return CoRScene.MaterialPipeType}createSelectionEvent(){return CoRScene.createSelectionEvent()}createProgressDataEvent(){return CoRScene.createProgressDataEvent()}createVec3(e,t,i,r){return CoRScene.createVec3(e,t,i,r)}createMat4(e,t){return CoRScene.createMat4(e,t)}createColor4(e,t,i,r){return CoRScene.createColor4(e,t,i,r)}createAABB(){return CoRScene.createAABB()}applySceneBlock(e){return CoRScene.applySceneBlock(e)}createRendererSceneParam(e){return CoRScene.createRendererSceneParam(e)}createRendererScene(e,t,i){return CoRScene.createRendererScene(e,t,i)}setRendererScene(e){return CoRScene.setRendererScene(e)}getRendererScene(){return CoRScene.getRendererScene()}createMouseEvt3DDispatcher(){return CoRScene.createMouseEvt3DDispatcher()}createEventBaseDispatcher(){return CoRScene.createEventBaseDispatcher()}createVtxDrawingInfo(){return CoRScene.createVtxDrawingInfo()}createDefaultMaterial(e){return CoRScene.createDefaultMaterial(e)}createLineMaterial(e){return CoRScene.createLineMaterial(e)}createQuadLineMaterial(e){return CoRScene.createQuadLineMaterial(e)}createShaderMaterial(e){return CoRScene.createShaderMaterial(e)}createMaterial(e){return CoRScene.createMaterial(e)}createDataMesh(){return CoRScene.createDataMesh()}createRawMesh(){return CoRScene.createRawMesh()}createBoundsMesh(){return CoRScene.createBoundsMesh()}createDataMeshFromModel(e,t,i){return CoRScene.createDataMeshFromModel(e,t,i)}createDisplayEntityFromModel(e,t,i){return CoRScene.createDisplayEntityFromModel(e,t,i)}createFreeAxis3DEntity(e,t,i){return CoRScene.createFreeAxis3DEntity(e,t,i)}createAxis3DEntity(e,t){return CoRScene.createAxis3DEntity(e,t)}createCrossAxis3DEntity(e,t){return CoRScene.createCrossAxis3DEntity(e,t)}createDisplayEntityWithDataMesh(e,t,i){return CoRScene.createDisplayEntityWithDataMesh(e,t,i)}createDisplayEntity(e){return CoRScene.createDisplayEntity(e)}createMouseEventEntity(e){return CoRScene.createMouseEventEntity(e)}createBoundsEntity(e){return CoRScene.createBoundsEntity(e)}createDisplayEntityContainer(){return CoRScene.createDisplayEntityContainer()}creatMaterialContextParam(){return CoRScene.creatMaterialContextParam()}createMaterialContext(){return CoRScene.createMaterialContext()}VerticalCCWOnXOY(e){return CoRScene.VerticalCCWOnXOY(e)}VerticalCWOnXOY(e){return CoRScene.VerticalCWOnXOY(e)}createRendererSceneGraph(){return CoRScene.createRendererSceneGraph()}createEvtNode(){return CoRScene.createEvtNode()}isEnabled(){return n.VoxRenderer.isEnabled()&&"undefined"!==typeof CoRScene}}const v=new E;t.VoxRScene=v},d82c:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i("3347");t.CoGeomDataType=r.CoGeomDataType,t.CoDataFormat=r.CoDataFormat;const n=i("7c62");class a{constructor(){this.m_loadedCall=null,this.m_loadedAllCall=null,this.m_loadTotal=0,this.m_loadedTotal=0,this.verTool=null}setListener(e,t){this.m_loadedCall=e,this.m_loadedAllCall=t}load(e,t=""){if(a.s_coapp.verTool=this.verTool,null!=e&&e.length>0){a.s_coapp.initialize(null,!0);let i=e.slice(0);a.s_coapp.deferredInit(()=>{for(let e=0;e<i.length;++e)this.loadModel(i[e],t)})}}loadWithType(e,t){if(a.s_coapp.verTool=this.verTool,null!=e&&e.length>0){a.s_coapp.initialize(null,!0);let i=e.slice(0);a.s_coapp.deferredInit(()=>{for(let e=0;e<i.length;++e)this.loadModel(i[e],t[e])})}}reset(){this.m_loadedTotal=0,this.m_loadTotal=0}loadModel(e,t=""){let i=t;if(""==t){let t=e.lastIndexOf(".")+1,r=e.lastIndexOf("?");i=r<0?e.slice(t):e.slice(t,r)}i=i.toLocaleLowerCase();let n=r.CoDataFormat.Undefined;switch(i){case"obj":n=r.CoDataFormat.OBJ;break;case"fbx":n=r.CoDataFormat.FBX;break;case"drc":n=r.CoDataFormat.Draco;break;case"ctm":n=r.CoDataFormat.CTM;break;default:break}n!=r.CoDataFormat.Undefined&&this.loadGeomModel(e,n)}loadGeomModel(e,t){let i=a.s_coapp;if(null!=i){let n=i.getCPUDataByUrlAndCallback(e,t,(e,i)=>{t!=r.CoDataFormat.FBX&&(this.loadedModels(e.data.models,e.data.transforms,t,e.url),this.m_loadTotal++,this.loadedModelFromUnit(e,i))},!0);t==r.CoDataFormat.FBX&&(n.data.modelReceiver=(e,i,r,a)=>{0==r&&this.m_loadTotal++,this.loadedModels(e,i,t,n.url),this.loadedModelFromUnit(n,0,r+1==a)})}}loadedModels(e,t,i,r){null!=this.m_loadedCall&&this.m_loadedCall(e,t,i,r)}loadedModelFromUnit(e,t=0,i=!0){if(i&&this.m_loadedTotal++,this.m_loadedTotal>=this.m_loadTotal){let t=this.m_loadedTotal;this.reset(),this.m_loadedAllCall(t,e.url)}}destroy(){this.m_loadedCall=null}}a.s_coapp=new n.CoDataModule,t.CoGeomModelLoader=a},dab7:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i("75f5");var n,a,s,o,l,c,u,d;t.RenderDrawMode=n,t.CullFaceMode=a,t.DepthTestMode=s,t.RenderBlendMode=o,t.GLStencilFunc=l,t.GLStencilOp=c,t.GLBlendMode=u,t.GLBlendEquation=d;class h{constructor(){this.m_init=!0}init(){"undefined"!==typeof CoRenderer&&(t.RenderDrawMode=n=CoRenderer.RenderDrawMode,t.CullFaceMode=a=CoRenderer.CullFaceMode,t.DepthTestMode=s=CoRenderer.DepthTestMode,t.RenderBlendMode=o=CoRenderer.RenderBlendMode,t.GLStencilFunc=l=CoRenderer.GLStencilFunc,t.GLStencilOp=c=CoRenderer.GLStencilOp,t.GLBlendMode=u=CoRenderer.GLBlendMode,t.GLBlendEquation=d=CoRenderer.GLBlendEquation)}initialize(e=null,t=""){return this.init(),this.m_init=!this.isEnabled(),!!this.m_init&&(this.m_init=!1,""!=t&&void 0!==t||(t="static/cospace/engine/renderer/CoRenderer.umd.min.js"),new r.ModuleLoader(1,()=>{this.init(),null!=e&&this.isEnabled()&&e([t])}).load(t),!0)}get RenderDrawMode(){return CoRenderer.RenderDrawMode}get CullFaceMode(){return CoRenderer.CullFaceMode}get DepthTestMode(){return CoRenderer.DepthTestMode}get RenderBlendMode(){return CoRenderer.RenderBlendMode}get GLStencilFunc(){return CoRenderer.GLStencilFunc}get GLStencilOp(){return CoRenderer.GLStencilOp}get GLBlendMode(){return CoRenderer.GLBlendMode}get GLBlendEquation(){return CoRenderer.GLBlendEquation}get RendererDevice(){return CoRenderer.RendererDevice}get RendererState(){return CoRenderer.RendererState}createRendererInstance(){return CoRenderer.createRendererInstance()}isEnabled(){return"undefined"!==typeof CoRenderer}}const m=new h;t.VoxRenderer=m},f042:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i("75f5");var n,a,s;t.OrientationType=n,t.MathConst=a,t.Vector3D=s;class o{constructor(){this.m_init=!0}init(){this.isEnabled()&&(t.OrientationType=n=CoMath.OrientationType,t.MathConst=a=CoMath.MathConst,t.Vector3D=s=CoMath.Vector3D)}initialize(e=null,t=""){return this.init(),this.m_init=!this.isEnabled(),!!this.m_init&&(this.m_init=!1,""!=t&&void 0!==t||(t="static/cospace/math/CoMath.umd.min.js"),new r.ModuleLoader(1,()=>{this.init(),null!=e&&this.isEnabled()&&e([t])}).load(t),!0)}isEnabled(){return"undefined"!==typeof CoMath}get Vector3D(){return CoMath.Vector3D}get MathConst(){return CoMath.MathConst}get OrientationType(){return CoMath.OrientationType}createVec3(e,t,i,r){return CoMath.createVec3(e,t,i,r)}createMat4(e,t){return CoMath.createMat4(e,t)}createAABB(){return CoMath.createAABB()}createAABB2D(e,t,i,r){return CoMath.createAABB2D(e,t,i,r)}isZero(e){return CoMath.isZero(e)}isNotZero(e){return CoMath.isNotZero(e)}isGreaterPositiveZero(e){return CoMath.isGreaterPositiveZero(e)}isLessNegativeZero(e){return CoMath.isLessNegativeZero(e)}isLessPositiveZero(e){return CoMath.isLessPositiveZero(e)}isGreaterNegativeZero(e){return CoMath.isGreaterNegativeZero(e)}isPostiveZero(e){return CoMath.isPostiveZero(e)}isNegativeZero(e){return CoMath.isNegativeZero(e)}isGreaterRealZero(e){return CoMath.isGreaterRealZero(e)}isLessRealZero(e){return CoMath.isLessRealZero(e)}}const l=new o;t.VoxMath=l},f046:function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i("c75a"),a=i("d1de"),s=i("f042"),o=i("9b53"),l=i("fd42"),c=r(i("7aa4")),u=i("36c5"),d=i("39ed"),h=i("79da"),m=i("2a2b");class _ extends d.DsrdViewerBase{constructor(){super(),this.m_viewDiv=null,this.m_initCallback=null,this.m_zAxisUp=!1,this.m_debugDev=!1,this.m_loadingCallback=null,this.m_modelDataUrl="",this.m_baseSize=200,this.m_forceRot90=!1}initialize(e=null,t=null,i=!1,r=!1,n=!1){document.oncontextmenu=function(e){e.preventDefault()},m.CoModuleLoader.forceReleaseEnabled=n,this.m_viewDiv=e,this.m_initCallback=t,this.m_zAxisUp=i,this.m_debugDev=r,this.loadInfo()}setCamProjectParam(e,t,i){if(this.m_rscene){let r=this.m_rscene.getCamera();r.perspectiveRH(Math.PI*e/180,r.getAspect(),t,i)}}updateCamera(){this.m_rscene&&this.m_rscene.updateCamera()}updateCameraWithF32Arr16(e,t=!0){16==e.length&&this.applyCamvs(e,t)}getCameraData(e,t=!1){if(this.m_rscene){let i=this.m_rscene.getCamera(),r=i.getViewMatrix().clone();r.invert(),t&&r.transpose();let n=r.getLocalFS32().slice(0);return n[3]*=e,n[7]*=e,n[11]*=e,n}return null}initRenderer(){let e=a.RendererDevice;e.SHADERCODE_TRACE_ENABLED=!1,e.VERT_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED=!0;let t=this.m_graph=a.VoxRScene.createRendererSceneGraph(),i=512,r=512,s=this.m_zAxisUp,o=this.m_viewDiv,l=window.devicePixelRatio,c=t.createRendererSceneParam(o||this.createDiv(0,0,i/l,r/l));c.autoSyncRenderBufferAndWindowSize=!1,c.syncBgColor=!1,c.setCamProject(45,10,2e3),c.setCamPosition(239,-239,239),s||null==o?c.setCamUpDirect(0,0,1):c.setCamUpDirect(0,1,0),c.setAttriAntialias(!0),this.m_rscene=t.createScene(c),this.m_rscene.enableMouseEvent(!0),a.VoxRScene.setRendererScene(this.m_rscene);let d=this.m_rscene.createSubScene(c,3,!1);d.enableMouseEvent(!0),d.setAccessor(new u.SceneAccessor),this.m_edit3DUIRScene=d,t.addScene(this.m_edit3DUIRScene),this.m_outline=new n.PostOutline(this.m_rscene,this.m_verTool),this.imgViewer=new h.DsrdImageViewer,this.imgViewer.initialize(this.m_rscene),this.init3DScene(),this.m_initCallback&&this.m_initCallback()}init3DScene(){this.m_modelTexUrl="static/assets/white.jpg",null==this.m_entityContainer&&(this.m_entityContainer=o.VoxEntity.createDisplayEntityContainer(),this.m_rscene.addEntity(this.m_entityContainer));let e=this.m_debugDev,t=this.m_viewDiv;if(this.m_layouter.locationEnabled=!1,this.m_debugDev=e,t&&!e);else{this.m_debugDev=!0,this.m_teamLoader=new l.CoModelTeamLoader,this.initModels();let e=["static/assets/modules/apple_01/mini.jpg","static/assets/box.jpg"];this.imgViewer.setViewImageUrl(e[0],!0)}}initModels(){this.m_forceRot90=!0;let e=[],t=[];for(let i=0;i<2;++i){let r="static/assets/modules/apple_01/export_"+i+".drc";e.push(r),t.push("drc")}this.initSceneByUrls(e,t,e=>{},200)}initSceneByUrls(e,t,i,r=200){this.m_baseSize=r,this.m_loadingCallback=i;let n=this.m_teamLoader;n.loadWithTypes(e,t,(i,r)=>{this.m_layouter.layoutReset();for(let e=0;e<i.length;++e)this.createEntity(i[e],null!=r?r[e]:null,2,i[e].url);this.m_modelDataUrl=e[0]+"."+t[0],this.fitEntitiesSize(),this.m_loadingCallback&&this.m_loadingCallback(1)})}setForceRotate90(e){this.m_forceRot90=e}fitEntitiesSize(e=!1){e=e||this.m_forceRot90,this.m_layouter.layoutUpdate(this.m_baseSize,s.VoxMath.createVec3());let t=this.m_entityContainer,i=c.default.getFileSuffixName(this.m_modelDataUrl,!0,!0);switch(i){case"obj":t.setRotationXYZ(90,0,0);break;default:e&&t.setRotationXYZ(90,0,0);break}t.update()}applyCamvs(e,t){null==e&&(e=[.7071067690849304,-.40824827551841736,.5773502588272095,2.390000104904175,.7071067690849304,.40824827551841736,-.5773502588272095,-2.390000104904175,0,.8164965510368347,.5773502588272095,2.390000104904175,0,0,0,1]);let i=s.VoxMath.createMat4(new Float32Array(e));i.transpose();let r=i.getLocalFS32(),n=0;n=4;let a=s.VoxMath.createVec3(r[n],r[n+1],r[n+2],r[n+3]);n=12;let o=s.VoxMath.createVec3(r[n],r[n+1],r[n+2]),l=this.m_rscene.getCamera();if(o.getLength()>.001){let e=o.clone().scaleBy(100);l.lookAtRH(e,s.VoxMath.createVec3(),a),t&&l.update()}}}t.DsrdViewer=_},fae3:function(e,t,i){"use strict";i.r(t);i("1eb2");var r=i("f046");for(var n in r)["default"].indexOf(n)<0&&function(e){i.d(t,e,(function(){return r[e]}))}(n)},fd42:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i("2a2b");t.CoModuleVersion=r.CoModuleVersion;const n=i("d82c");t.CoGeomDataType=n.CoGeomDataType;class a{constructor(e){this.m_map=new Map,this.m_total=0,this.m_loadedTotal=0,this.types=null,this.models=[],this.transforms=[],this.init(e)}init(e){this.urls=e,this.m_total=e.length;for(let t=0;t<this.m_total;++t)this.m_map.set(e[t],0)}testWithUrl(e){let t=!1;if(this.m_map.has(e)&&this.m_map.get(e)<1&&(this.m_map.set(e,1),this.m_loadedTotal++,t=this.m_loadedTotal>=this.m_total,t)){let e=this.callback;e(this.models,this.transforms),this.callback=null}return t}}class s{constructor(){this.m_modelLoader=new n.CoGeomModelLoader,this.m_team=null,this.m_teams=[],this.m_enabled=!0,this.verTool=null,this.initialize()}initialize(){this.m_modelLoader.setListener((e,t,i,r)=>{if(null!=this.m_team)for(let n=0;n<e.length;++n)null!=e[n]&&(e[n].url=r,null!=e[n].vertices&&(t?this.m_team.transforms.push(t[n]):this.m_team.transforms.push(null),this.m_team.models.push(e[n])))},(e,t)=>{let i=this.m_team.testWithUrl(t);i&&(this.m_enabled=!0,this.loadNext())})}loadNext(){if(this.m_enabled&&this.m_teams.length>0){let e=this.m_teams.shift();this.m_team=e,this.m_enabled=!1,e.types?this.m_modelLoader.loadWithType(e.urls,e.types):this.m_modelLoader.load(e.urls)}}load(e,t){this.m_modelLoader.verTool=this.verTool;let i=new a(e);i.callback=t,this.m_teams.push(i),this.loadNext()}loadWithTypes(e,t,i){this.m_modelLoader.verTool=this.verTool;let r=new a(e);r.types=t,r.callback=i,this.m_teams.push(r),this.loadNext()}}t.CoModelTeamLoader=s}})}));