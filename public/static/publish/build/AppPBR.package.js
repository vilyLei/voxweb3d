(function(a,t){"object"===typeof exports&&"object"===typeof module?module.exports=t():"function"===typeof define&&define.amd?define([],t):"object"===typeof exports?exports["AppPBR"]=t():a["AppPBR"]=t()})("undefined"!==typeof self?self:this,(function(){return function(a){var t={};function e(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return a[r].call(s.exports,s,s.exports,e),s.l=!0,s.exports}return e.m=a,e.c=t,e.d=function(a,t,r){e.o(a,t)||Object.defineProperty(a,t,{enumerable:!0,get:r})},e.r=function(a){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},e.t=function(a,t){if(1&t&&(a=e(a)),8&t)return a;if(4&t&&"object"===typeof a&&a&&a.__esModule)return a;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:a}),2&t&&"string"!=typeof a)for(var s in a)e.d(r,s,function(t){return a[t]}.bind(null,s));return r},e.n=function(a){var t=a&&a.__esModule?function(){return a["default"]}:function(){return a};return e.d(t,"a",t),t},e.o=function(a,t){return Object.prototype.hasOwnProperty.call(a,t)},e.p="",e(e.s="fae3")}({"1eb2":function(a,t,e){"use strict";if("undefined"!==typeof window){var r=window.document.currentScript,s=e("8875");r=s(),"currentScript"in document||Object.defineProperty(document,"currentScript",{get:s});var i=r&&r.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);i&&(e.p=i[1])}},"2fe4":function(a,t,e){"use strict";var r=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(e("b3bd")),i=e("f3a2");class n{constructor(){this.A="PBR",this.B=128,this.C=128,this.D=new Float32Array([0,0,1,.02,1,.1,1,1,.1,.1,.1,1,1,1,1,.07]),this.E=null,this.F=null,this.G=new Float32Array([0,0,-1,1,1,.3,0,0]),this.vertColorEnabled=!1,this.premultiplyAlpha=!1,this.shadowReceiveEnabled=!1,this.lightEnabled=!0,this.fogEnabled=!1,this.envAmbientLightEnabled=!1,this.brightnessOverlayEnabeld=!1,this.glossinessEnabeld=!0,this.specularEnvMap=null,this.diffuseMap=null,this.normalMap=null,this.mirrorMap=null,this.indirectEnvMap=null,this.parallaxMap=null,this.aoMap=null,this.roughnessMap=null,this.metalhnessMap=null,this.armMap=null,this.woolEnabled=!0,this.toneMappingEnabled=!0,this.scatterEnabled=!0,this.specularBleedEnabled=!0,this.metallicCorrection=!0,this.gammaCorrection=!0,this.absorbEnabled=!1,this.normalNoiseEnabled=!1,this.pixelNormalNoiseEnabled=!1,this.mirrorMapLodEnabled=!1,this.hdrBrnEnabled=!1,this.vtxFlatNormal=!1,this.texturesTotal=1,this.fragLocalParamsTotal=2,this.parallaxParamIndex=2,this.vertUniform=null}initialize(){this.fragLocalParamsTotal=2,this.parallaxParamIndex=2,null!=this.parallaxMap&&(this.fragLocalParamsTotal+=1),this.E=new Float32Array(4*this.fragLocalParamsTotal),this.E.set([0,0,0,1,.2,.2,.2,0],0),null!=this.parallaxMap&&(this.F=this.E.subarray(4*this.parallaxParamIndex,4*(this.parallaxParamIndex+1)),this.F.set([1,10,2,.1]))}seNormalMapIntensity(a){a=Math.min(Math.max(a,0),1),this.E[4]=a}setPixelNormalNoiseIntensity(a){a=Math.min(Math.max(a,0),2),this.D[3]=a}getPixelNormalNoiseIntensity(){return this.D[3]}setMirrorViewNV(a){this.G[0]=a.x,this.G[1]=a.y,this.G[2]=a.z}setMirrorPlaneNV(a){}setMirrorMapLodLevel(a){this.G[3]=a}setMirrorIntensity(a){this.G[4]=Math.min(Math.max(a,.01),2)}setMirrorMixFactor(a){this.G[5]=Math.min(Math.max(a,.01),2)}setEnvMapLodMipMapLevel(a,t=0){a=Math.min(Math.max(a,0),14),t=Math.min(Math.max(t,-7),12),this.D[15]=.01*Math.round(a)+t}log2(a){return Math.log(a)/Math.LN2}getMaxMipMapLevel(a,t){return Math.round(this.log2(Math.max(a,t))+1)}setEnvMapLodMipMapLevelWithSize(a,t,e=0){this.B=a,this.C=t,e=Math.min(Math.max(e,-7),12);Math.log(Math.max(a,t)),Math.LN2;this.D[15]=.01*this.getMaxMipMapLevel(a,t)+e}setScatterIntensity(a){this.D[11]=Math.min(Math.max(a,.01),512)}getScatterIntensity(){return this.D[11]}setToneMapingExposure(a){this.D[4]=Math.min(Math.max(a,.1),128)}getToneMapingExposure(){return this.D[4]}setReflectionIntensity(a){this.D[5]=Math.min(Math.max(a,.001),1)}getReflectionIntensity(){return this.D[5]}setSurfaceIntensity(a){this.D[6]=Math.min(Math.max(a,.001),32)}getSurfaceIntensity(){return this.D[6]}setSideIntensity(a){this.D[7]=Math.min(Math.max(a,.001),32)}getSideIntensity(){return this.D[7]}setEnvSpecularColorFactor(a,t,e){this.D[12]=a,this.D[13]=t,this.D[14]=e}getEnvSpecularColorFactor(a){a.r=this.D[12],a.g=this.D[13],a.b=this.D[14]}setAmbientFactor(a,t,e){this.D[8]=a,this.D[9]=t,this.D[10]=e}getAmbientFactor(a){a.r=this.D[8],a.g=this.D[9],a.b=this.D[10]}setMetallic(a){this.D[0]=Math.min(Math.max(a,.05),1)}getMetallic(){return this.D[0]}setRoughness(a){this.D[1]=Math.min(Math.max(a,.05),1)}getRoughness(){return this.D[1]}setAO(a){this.D[2]=a}getAO(){return this.D[2]}setF0(a,t,e){this.E[0]=a,this.E[1]=t,this.E[2]=e}getF0(a){a.r=this.E[0],a.g=this.E[1],a.b=this.E[2]}setAlbedoColor(a,t,e){this.E[4]=a,this.E[5]=t,this.E[6]=e}getAlbedoColor(a){a.r=this.E[4],a.g=this.E[5],a.b=this.E[6]}setParallaxParams(a=1,t=10,e=2,r=.1){null!=this.F&&(this.F[0]=a,this.F[1]=t,this.F[2]=e,this.F[3]=r)}buildBufParams(){}buildTextureList(a){a.addSpecularEnvMap(this.specularEnvMap,!0),a.addDiffuseMap(this.diffuseMap),a.addNormalMap(this.normalMap),a.addParallaxMap(this.parallaxMap,this.parallaxParamIndex),a.addAOMap(this.aoMap),a.addRoughnessMap(this.roughnessMap),a.addMetalnessMap(this.metalhnessMap),a.addARMMap(this.armMap),a.add2DMap(this.mirrorMap,"VOX_MIRROR_PROJ_MAP",!0,!0,!1),a.addCubeMap(this.indirectEnvMap,"VOX_INDIRECT_ENV_MAP",!0,!1)}buildShader(a){a.normalMapEnabled=null!=this.normalMap,a.mapLodEnabled=!0,a.useHighPrecious();let t=null!=this.mirrorMap&&this.texturesTotal>0;this.normalNoiseEnabled&&a.addDefine("VOX_NORMAL_NOISE","1"),this.woolEnabled&&a.addDefine("VOX_WOOL","1"),this.toneMappingEnabled&&a.addDefine("VOX_TONE_MAPPING","1"),this.scatterEnabled&&a.addDefine("VOX_SCATTER","1"),this.specularBleedEnabled&&a.addDefine("VOX_SPECULAR_BLEED","1"),this.metallicCorrection&&a.addDefine("VOX_METALLIC_CORRECTION","1"),this.gammaCorrection&&a.addDefine("VOX_GAMMA_CORRECTION","1"),this.absorbEnabled&&a.addDefine("VOX_ABSORB","1"),this.pixelNormalNoiseEnabled&&a.addDefine("VOX_PIXEL_NORMAL_NOISE","1"),this.mirrorMapLodEnabled&&a.addDefine("VOX_MIRROR_MAP_LOD","1"),this.hdrBrnEnabled&&a.addDefine("VOX_HDR_BRN","1"),this.vtxFlatNormal&&a.addDefine("VOX_VTX_FLAT_NORMAL","1"),a.addFragUniform("vec4","u_fragLocalParams",this.fragLocalParamsTotal),a.addFragUniform("vec4","u_pbrParams",4),t&&(a.uniform.useStage(!1,!0),a.addFragUniform("vec4","u_mirrorParams",2)),a.vertMatrixInverseEnabled=!0}createUniformData(){let a=new s.default;return a.uniformNameList=["u_pbrParams","u_fragLocalParams","u_mirrorParams"],a.dataList=[this.D,this.E,this.G],a}getShaderCodeObjectUUID(){return i.ShaderCodeUUID.PBR}getShaderCodeObject(){return null}getUniqueName(){let a=this.A;return this.woolEnabled&&(a+="_wl"),this.toneMappingEnabled&&(a+="TM"),this.scatterEnabled&&(a+="Sct"),this.specularBleedEnabled&&(a+="SpecBl"),this.metallicCorrection&&(a+="MetCorr"),this.gammaCorrection&&(a+="GmaCorr"),this.absorbEnabled&&(a+="Absorb"),this.pixelNormalNoiseEnabled&&(a+="PNNoise"),this.normalNoiseEnabled&&(a+="NNoise"),null!=this.indirectEnvMap&&(a+="IndirEnv"),this.shadowReceiveEnabled&&(a+="Shadow"),this.fogEnabled&&(a+="Fog"),this.hdrBrnEnabled&&(a+="HdrBrn"),this.vtxFlatNormal&&(a+="vtxFlagN"),this.mirrorMapLodEnabled&&(a+="MirLod"),this.A=a,this.A}destroy(){this.D=null,this.E=null,this.G=null}}t.PBRDecorator=n},3221:function(a,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(){this.H=null,this.I=""}initialize(){}use(a){}getTextures(a,t=null){return null}reset(){}destroy(){}getUniqueNSKeyString(){return this.I}clone(){return null}getParams(){return this.H}getParamsTotal(){return null!=this.H?this.H.length>>2:0}buildShaderUniformData(a){}}t.UniformComp=r},8875:function(a,t,e){var r,s,i;(function(e,n){s=[],r=n,i="function"===typeof r?r.apply(t,s):r,void 0===i||(a.exports=i)})("undefined"!==typeof self&&self,(function(){function a(){var t=Object.getOwnPropertyDescriptor(document,"currentScript");if(!t&&"currentScript"in document&&document.currentScript)return document.currentScript;if(t&&t.get!==a&&document.currentScript)return document.currentScript;try{throw new Error}catch(d){var e,r,s,i=/.*at [^(]*\((.*):(.+):(.+)\)$/gi,n=/@([^@]*):(\d+):(\d+)\s*$/gi,l=i.exec(d.stack)||n.exec(d.stack),m=l&&l[1]||!1,o=l&&l[2]||!1,u=document.location.href.replace(document.location.hash,""),h=document.getElementsByTagName("script");m===u&&(e=document.documentElement.outerHTML,r=new RegExp("(?:[^\\n]+?\\n){0,"+(o-2)+"}[^<]*<script>([\\d\\D]*?)<\\/script>[\\d\\D]*","i"),s=e.replace(r,"$1").trim());for(var c=0;c<h.length;c++){if("interactive"===h[c].readyState)return h[c];if(h[c].src===m)return h[c];if(m===u&&h[c].innerHTML&&h[c].innerHTML.trim()===s)return h[c]}return null}}return a}))},"8d98":function(a,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{static GetConst(a,t){switch(t){case r.NEAREST:return a.NEAREST;case r.LINEAR:return a.LINEAR;case r.LINEAR_MIPMAP_LINEAR:return a.LINEAR_MIPMAP_LINEAR;case r.NEAREST_MIPMAP_NEAREST:return a.NEAREST_MIPMAP_NEAREST;case r.LINEAR_MIPMAP_NEAREST:return a.LINEAR_MIPMAP_NEAREST;case r.NEAREST_MIPMAP_LINEAR:return a.NEAREST_MIPMAP_LINEAR;case r.WRAP_REPEAT:return a.REPEAT;case r.WRAP_CLAMP_TO_EDGE:return a.CLAMP_TO_EDGE;case r.WRAP_MIRRORED_REPEAT:return a.MIRRORED_REPEAT;default:break}return-1}}r.WRAP_REPEAT=3001,r.WRAP_CLAMP_TO_EDGE=3002,r.WRAP_MIRRORED_REPEAT=3003,r.NEAREST=4001,r.LINEAR=4002,r.LINEAR_MIPMAP_LINEAR=4003,r.NEAREST_MIPMAP_NEAREST=4004,r.LINEAR_MIPMAP_NEAREST=4005,r.NEAREST_MIPMAP_LINEAR=4006,t.default=r},"8e69":function(a,t,e){"use strict";var r=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(t,"__esModule",{value:!0});const s=e("debe"),i=e("2fe4"),n=r(e("8d98"));class l{constructor(){this.hdrBrnEnabled=!1,this.texture=null,this.width=128,this.height=128}createTexture(a,t){if(null==this.texture){let e=t.textureBlock;this.texture=a?e.createBytesCubeTex(32,32):e.createFloatCubeTex(32,32)}}createFloat(a,t){this.createTexture(!1,a);let e=0,r=this.width,s=this.height,i=3,l=new Float32Array(t),m=null,o=this.texture;o.toRGBFormat(),o.minFilter=n.default.LINEAR_MIPMAP_LINEAR,o.magFilter=n.default.LINEAR;for(let n=0;n<9;n++){for(let a=0;a<6;a++){const t=r*s*i;m=l.subarray(e,e+t),o.setDataFromBytesToFaceAt(a,m,r,s,n),e+=t}r>>=1,s>>=1}return this.texture}createHdrBrn(a,t){this.createTexture(!0,a);let e=new Uint16Array(t),r=new Uint8Array(t),s=0,i=e[4],l=e[5],m=e[6],o=0,u=r.subarray(32),h=this.texture;h.mipmapEnabled=m<=1,h.minFilter=n.default.LINEAR_MIPMAP_LINEAR,h.magFilter=n.default.LINEAR;for(let n=0;n<m;n++){for(let a=0;a<6;a++)o=i*l*4,h.setDataFromBytesToFaceAt(a,u.subarray(s,s+o),i,l,n),s+=o;i>>=1,l>>=1}return this.texture}}t.SpecularTextureBuilder=l;class m{constructor(){this.J=null,this.K=null}initialize(a){this.J=a}createMaterial(a=!0){let t=a?new s.VertUniformComp:null,e=new i.PBRDecorator;return e.vertUniform=t,this.J.materialBlock.createMaterial(e)}createSpecularTex(a,t){return t?this.K.createHdrBrn(this.J,a):this.K.createFloat(this.J,a)}}t.Instance=m},b3bd:function(a,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(){this.uns="",this.types=null,this.uniformSize=0,this.uniformNameList=null,this.locations=null,this.dataList=null,this.calcModels=null,this.always=!0,this.next=null}getDataRefFromUniformName(a){if(null!=this.uniformNameList){let t=this.uniformNameList,e=t.length;for(let r=0;r<e;++r)if(a==t[r])return this.dataList[r]}return null}setDataRefFromUniformName(a,t){if(null!=this.uniformNameList){let e=this.uniformNameList,r=e.length;for(let s=0;s<r;++s)if(a==e[s]){this.dataList[s]=t;break}}}copyDataFromProbe(a){this.types=[];for(let t=0;t<a.uniformsTotal;++t)this.types.push(a.uniformTypes[t]);this.uniformSize=a.uniformsTotal}destroy(){let a=0,t=this.dataList.length;for(;a<t;++a)this.dataList[a]=null;if(null!=this.calcModels)for(t=this.calcModels.length,a=0;a<t;++a)this.calcModels[a].destroy(),this.calcModels[a]=null;this.dataList=null,this.types=null,this.locations=null,this.calcModels=null}}t.default=r},debe:function(a,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=e("3221");class s extends r.UniformComp{constructor(){super(),this.L=null,this.M=null,this.N=null,this.O=-1,this.P=-1,this.Q=-1,this.uvTransformEnabled=!1,this.curveMoveMap=null,this.displacementMap=null}initialize(){if(null==this.H){this.I="";let a=0;if(this.uvTransformEnabled&&(this.O=a,a++,this.I+="UV"),null!=this.curveMoveMap&&(this.P=a,a++,this.I+="CM"),null!=this.displacementMap&&(this.Q=a,a++,this.I+="DC"),a>0){this.H=new Float32Array(4*a);let t=this.O;t>=0&&(this.L=this.H.subarray(4*t,4*(t+1)),this.L.set([1,1,0,0])),t=this.P,t>=0&&(this.M=this.H.subarray(4*t,4*(t+1))),t=this.Q,t>=0&&(this.N=this.H.subarray(4*t,4*(t+1)),this.N.set([10,0,0,0]))}}}use(a){this.getParamsTotal()>0&&(a.addVertUniform("vec4","u_vertLocalParams",this.getParamsTotal()),this.P>=0&&a.addVertLayout("vec4","a_vs"),this.O>=0&&a.addDefine("VOX_VTX_TRANSFORM_PARAM_INDEX",""+this.O))}reset(){}destroy(){}getTextures(a,t=null){return this.getParamsTotal()>0?(null==t&&(t=[]),this.P>=0&&(t.push(this.curveMoveMap),a.uniform.add2DMap("VTX_CURVE_MOVE_MAP",!1,!1,!0),a.addDefine("VOX_VTX_CURVE_MOVE_PARAM_INDEX",""+this.P)),this.Q>=0&&(t.push(this.displacementMap),a.uniform.addDisplacementMap(this.Q)),t):null}setCurveMoveParam(a,t){null!=this.M&&(this.M[0]=1/a,this.M[2]=t)}setCurveMoveDistance(a){null!=this.M&&(this.M[1]=a)}setUVScale(a,t){null!=this.L&&(this.L[0]=a,this.L[1]=t)}getUVScale(a){null!=this.L&&(a.x=this.L[0],a.y=this.L[1])}setUVTranslation(a,t){null!=this.L&&(this.L[2]=a,this.L[3]=t)}setDisplacementParams(a,t){null!=this.N&&(this.N[0]=a,this.N[1]=t)}clone(){let a=new s;return a.uvTransformEnabled=this.uvTransformEnabled,a.displacementMap=this.displacementMap,a.curveMoveMap=this.curveMoveMap,a}buildShaderUniformData(a){this.getParamsTotal()>0&&(a.uniformNameList.push("u_vertLocalParams"),a.dataList.push(this.getParams()))}}t.VertUniformComp=s},f3a2:function(a,t,e){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(a){a["None"]="",a["Default"]="pbr",a["Lambert"]="lambert",a["PBR"]="pbr"}(r||(r={})),t.ShaderCodeUUID=r},fae3:function(a,t,e){"use strict";e.r(t);e("1eb2");var r=e("8e69");for(var s in r)["default"].indexOf(s)<0&&function(a){e.d(t,a,(function(){return r[a]}))}(s)}})}));